var vF=Object.defineProperty;var $F=(e,t,n)=>t in e?vF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var In=(e,t,n)=>$F(e,typeof t!="symbol"?t+"":t,n);import{t as os,a as yn,n as Hk}from"../chunks/Dzpm0BjD.js";import"../chunks/B_Oo2Ca8.js";import{a6 as CF,o as kF,w as Mg,m as Zn,a1 as IF,n as SF,g as dt,P as Ea,q as NF,v as Mv,x as Fg,B as Hc,ae as _F,y as qk,z as Xk,A as TF,ao as Og,ai as jk,a5 as Fv,ap as EF,I as us,aq as Ov,aa as RF,ar as AF,as as DF,ah as MF,at as FF,au as OF,av as LF,aw as PF,ac as zF,ax as BF,ay as VF,az as WF,aA as UF,aB as GF,aC as HF,b as qF,D as XF,C as Kk,aD as jF,s as Ve,k as de,aE as fp,l as oe,p as ms,aF as Xe,aG as or,j as gs,J as sn,t as Io,aH as KF,e as Dt,i as Nx}from"../chunks/CAt5XuYi.js";import{i as Os}from"../chunks/BBcGpK8g.js";import{i as _x,s as ir,a as Kt,c as G0,p as mt,b as Yk,m as Lv}from"../chunks/sXTVPNNL.js";import{b as Al}from"../chunks/DKzZ_1c-.js";import{w as Gn,g as Nn,a as Zk,o as YF}from"../chunks/BdFME54P.js";import{a as ZF,l as Qk,e as vl,s as Gf}from"../chunks/jZcBnRC3.js";function QF(e,t){for(var n=0;n<t.length;n++){const s=t[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in e)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function Tx(e,t){return t}function JF(e,t,n,s){for(var r=[],o=t.length,i=0;i<o;i++)DF(t[i].e,r,!0);var a=o>0&&r.length===0&&n!==null;if(a){var c=n.parentNode;MF(c),c.append(n),s.clear(),mo(e,t[0].prev,t[o-1].next)}FF(r,()=>{for(var l=0;l<o;l++){var u=t[l];a||(s.delete(u.k),mo(e,u.prev,u.next)),OF(u.e,!a)}})}function Ex(e,t,n,s,r,o=null){var i=e,a={flags:t,items:new Map,first:null};{var c=e;i=Zn?Mg(IF(c)):c.appendChild(CF())}Zn&&SF();var l=null,u=!1,h=Ea(()=>{var f=n();return RF(f)?f:f==null?[]:jk(f)});kF(()=>{var f=dt(h),d=f.length;if(u&&d===0)return;u=d===0;let p=!1;if(Zn){var g=i.data===NF;g!==(d===0)&&(i=Mv(),Mg(i),Fg(!1),p=!0)}if(Zn){for(var m=null,x,b=0;b<d;b++){if(Hc.nodeType===8&&Hc.data===_F){i=Hc,p=!0,Fg(!1);break}var w=f[b],y=s(w,b);x=Jk(Hc,a,m,null,w,y,b,r,t,n),a.items.set(y,x),m=x}d>0&&Mg(Mv())}Zn||tO(f,a,i,r,t,s,n),o!==null&&(d===0?l?qk(l):l=Xk(()=>o(i)):l!==null&&TF(l,()=>{l=null})),p&&Fg(!0),dt(h)}),Zn&&(i=Hc)}function tO(e,t,n,s,r,o,i){var a=e.length,c=t.items,l=t.first,u=l,h,f=null,d=[],p=[],g,m,x,b;for(b=0;b<a;b+=1){if(g=e[b],m=o(g,b),x=c.get(m),x===void 0){var w=u?u.e.nodes_start:n;f=Jk(w,t,f,f===null?t.first:f.next,g,m,b,s,r,i),c.set(m,f),d=[],p=[],u=f.next;continue}if(eO(x,g,b),(x.e.f&Og)!==0&&qk(x.e),x!==u){if(h!==void 0&&h.has(x)){if(d.length<p.length){var y=p[0],v;f=y.prev;var $=d[0],I=d[d.length-1];for(v=0;v<d.length;v+=1)Pv(d[v],y,n);for(v=0;v<p.length;v+=1)h.delete(p[v]);mo(t,$.prev,I.next),mo(t,f,$),mo(t,I,y),u=y,f=I,b-=1,d=[],p=[]}else h.delete(x),Pv(x,u,n),mo(t,x.prev,x.next),mo(t,x,f===null?t.first:f.next),mo(t,f,x),f=x;continue}for(d=[],p=[];u!==null&&u.k!==m;)(u.e.f&Og)===0&&(h??(h=new Set)).add(u),p.push(u),u=u.next;if(u===null)continue;x=u}d.push(x),f=x,u=x.next}if(u!==null||h!==void 0){for(var N=h===void 0?[]:jk(h);u!==null;)(u.e.f&Og)===0&&N.push(u),u=u.next;var k=N.length;if(k>0){var S=a===0?n:null;JF(t,N,S,c)}}Fv.first=t.first&&t.first.e,Fv.last=f&&f.e}function eO(e,t,n,s){EF(e.v,t),e.i=n}function Jk(e,t,n,s,r,o,i,a,c,l){var u=(c&LF)!==0,h=(c&PF)===0,f=u?h?us(r):Ov(r):r,d=(c&AF)===0?i:Ov(i),p={i:d,v:f,k:o,a:null,e:null,prev:n,next:s};try{return p.e=Xk(()=>a(e,f,d,l),Zn),p.e.prev=n&&n.e,p.e.next=s&&s.e,n===null?t.first=p:(n.next=p,n.e.next=p.e),s!==null&&(s.prev=p,s.e.prev=p.e),p}finally{}}function Pv(e,t,n){for(var s=e.next?e.next.e.nodes_start:n,r=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==s;){var i=zF(o);r.before(o),o=i}}function mo(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function tI(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=tI(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function nO(){for(var e,t,n=0,s="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=tI(e))&&(s&&(s+=" "),s+=t);return s}function sO(e){return typeof e=="object"?nO(e):e??""}function rO(e,t,n){var s=e==null?"":""+e;return s=s?s+" "+t:t,s===""?null:s}function oO(e,t){return e==null?null:String(e)}function iO(e,t,n,s,r,o){var i=e.__className;if(Zn||i!==n||i===void 0){var a=rO(n,s);(!Zn||a!==e.getAttribute("class"))&&(a==null?e.removeAttribute("class"):e.className=a),e.__className=n}return o}function aO(e,t,n,s){var r=e.__style;if(Zn||r!==t){var o=oO(t);(!Zn||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}return s}const cO=Symbol("is custom element"),lO=Symbol("is html");function eI(e){if(Zn){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;ki(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var r=e.checked;ki(e,"checked",null),e.checked=r}}};e.__on_r=n,UF(n),ZF()}}function uO(e,t){var n=nI(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function ki(e,t,n,s){var r=nI(e);Zn&&(r[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||r[t]!==(r[t]=n)&&(t==="loading"&&(e[GF]=n),n==null?e.removeAttribute(t):typeof n!="string"&&hO(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function nI(e){return e.__attributes??(e.__attributes={[cO]:e.nodeName.includes("-"),[lO]:e.namespaceURI===BF})}var zv=new Map;function hO(e){var t=zv.get(e.nodeName);if(t)return t;zv.set(e.nodeName,t=[]);for(var n,s=e,r=Element.prototype;r!==s;){n=WF(s);for(var o in n)n[o].set&&t.push(o);s=VF(s)}return t}function fO(e,t,n=t){var s=HF();Qk(e,"input",r=>{var o=r?e.defaultValue:e.value;if(o=Lg(e)?Pg(o):o,n(o),s&&o!==(o=t())){var i=e.selectionStart,a=e.selectionEnd;e.value=o??"",a!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(a,e.value.length))}}),(Zn&&e.defaultValue!==e.value||qF(t)==null&&e.value)&&n(Lg(e)?Pg(e.value):e.value),XF(()=>{var r=t();Lg(e)&&r===Pg(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function Lg(e){var t=e.type;return t==="number"||t==="range"}function Pg(e){return e===""?null:+e}function sI(e,t,n){if(e.multiple)return mO(e,t);for(var s of e.options){var r=$l(s);if(jF(r,t)){s.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function dO(e,t){Kk(()=>{var n=new MutationObserver(()=>{var s=e.__value;sI(e,s)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function pO(e,t,n=t){var s=!0;Qk(e,"change",r=>{var o=r?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(o),$l);else{var a=e.querySelector(o)??e.querySelector("option:not([disabled])");i=a&&$l(a)}n(i)}),Kk(()=>{var r=t();if(sI(e,r,s),s&&r===void 0){var o=e.querySelector(":checked");o!==null&&(r=$l(o),n(r))}e.__value=r,s=!1}),dO(e)}function mO(e,t){for(var n of e.options)n.selected=~t.indexOf($l(n))}function $l(e){return"__value"in e?e.__value:e.value}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gO=1e-7,xO=1e-4;class rI{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class Rx{refCount(t){return Xn("refCount")}incRef(t){return Xn("incRef")}timerAvailable(){return!0}time(t){return Xn("time")}read(t){return Xn("read")}readSync(t){return Xn("readSync")}readToGPU(t,n){return Xn("readToGPU")}numDataIds(){return Xn("numDataIds")}disposeData(t,n){return Xn("disposeData")}write(t,n,s){return Xn("write")}move(t,n,s,r,o){return Xn("move")}createTensorFromGPUData(t,n,s){return Xn("createTensorFromGPUData")}memory(){return Xn("memory")}floatPrecision(){return Xn("floatPrecision")}epsilon(){return this.floatPrecision()===32?gO:xO}dispose(){return Xn("dispose")}}function Xn(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Sa(e,t,n)}function Ii(e,t,n){return Math.max(e,Math.min(t,n))}function Ax(e){return e%2===0?e:e+1}function Sa(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function yO(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function D(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Ls(e,t,n=""){D(Xt(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function oI(e){D(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function K(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Xt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ha(e){return e%1===0}function H0(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Da(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Bv(e,t=r=>0,n,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(e()){r();return}i++;const c=t(i);if(n!=null&&i>=n){o();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function iI(e,t){let n=1,s=-1;for(let o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(e[o]<0)throw Error(`Shapes can not be < 0. Found ${e[o]} at dim ${o}`);if(s===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const r=e.slice();return r[s]=t/n,r}function Lt(e,t){const n=t.length;return e=e==null?t.map((s,r)=>r):[].concat(e),D(e.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),D(e.every(s=>Ha(s)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(s=>s<0?n+s:s)}function Uo(e,t){const n=[],s=[],r=t!=null&&Array.isArray(t)&&t.length===0,o=t==null||r?null:Lt(t,e).sort();let i=0;for(let a=0;a<e.length;++a){if(o!=null){if(o[i]===a&&e[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${e[a]}' is not 1`);(o[i]==null||o[i]>a)&&e[a]===1&&(n.push(e[a]),s.push(a)),o[i]<=a&&i++}e[a]!==1&&(n.push(e[a]),s.push(a))}return{newShape:n,keptDims:s}}function rn(e,t){return ke(e,t)}function ke(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function wO(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function vO(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function aI(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function Hf(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function $O(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function cu(e){return typeof e=="string"||e instanceof String}function CO(e){return typeof e=="boolean"}function q0(e){return typeof e=="number"}function Cc(e){return Array.isArray(e)?Cc(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":q0(e)?"float32":cu(e)?"string":CO(e)?"bool":"float32"}function X0(e){return!!(e&&e.constructor&&e.call&&e.apply)}function j0(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function vt(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let s=t-3;s>=0;--s)n[s]=n[s+1]*e[s+1];return n}function cI(e,t,n,s=!1){const r=new Array;if(t.length===1){const o=t[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=n[e+i]}else{const o=t[0],i=t.slice(1),a=i.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<o;c++)r[c]=cI(e+c*a,i,n,s)}return r}function Ys(e,t,n=!1){if(e.length===0)return t[0];const s=e.reduce((r,o)=>r*o)*(n?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return cI(0,e,t,n)}function kO(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function Dx(e,t){const n=on(e,t);for(let s=0;s<n.length;s++)n[s]=1;return n}function on(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function lI(e,t){const n=e.reduce((s,r)=>s*r,1);if(t==null||t==="float32")return Ys(e,new Float32Array(n));if(t==="int32")return Ys(e,new Int32Array(n));if(t==="bool")return Ys(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function so(e){e.forEach(t=>{D(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function yr(e,t,n){if(t===0)return 0;if(t===1)return e[0];let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=n[r]*e[r];return s}function kc(e,t,n){if(t===0)return[];if(t===1)return[e];const s=new Array(t);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(e/n[r]),e-=s[r]*n[r];return s[s.length-1]=e,s}function Mx(e){return e&&e.then&&typeof e.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vv="tfjsflags";class IO{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=SO,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,s){if(this.flagRegistry[t]={evaluationFn:n,setHook:s},this.urlFlags[t]!=null){const r=this.urlFlags[t];X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${r}.`),this.set(t,r)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(Mx(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);Vv in t&&t[Vv].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=_O(r,o)})}}function SO(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(NO(t,s[0],s[1]),s.join("="))),t}function NO(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function _O(e,t){const n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function X(){return uI}let uI=null;function TO(e){uI=e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let zg;function hI(){if(zg==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");zg=e}return zg}function EO(){const e=hI();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function Fx(e,t){const n=EO();if(n.has(e))return n.get(e);{const s=t();return n.set(e,s),n.get(e)}}const dp="Abs",lu="Acos",uu="Acosh",Ic="Add",Ox="AddN",Lx="All",Px="Any",pp="ArgMax",mp="ArgMin",hu="Asin",fu="Asinh",du="Atan",pu="Atanh",mu="Atan2",gp="AvgPool",zx="AvgPoolGrad",xp="AvgPool3D",Bx="AvgPool3DGrad",bp="BatchMatMul",yp="BatchToSpaceND",Vx="Bincount",Wx="BitwiseAnd",RO="BroadcastTo",fI="BroadcastArgs",gu="Cast",xu="Ceil",bu="ClipByValue",Ux="Complex",wp="ComplexAbs",vp="Concat",$p="Conv2D",Gx="Conv2DBackpropFilter",Cp="Conv2DBackpropInput",kp="Conv3D",Hx="Conv3DBackpropFilterV2",qx="Conv3DBackpropInputV2",yu="Cos",wu="Cosh",Xx="Cumprod",Ip="Cumsum",jx="CropAndResize",Kx="DenseBincount",Yx="DepthToSpace",Sp="DepthwiseConv2dNative",Zx="DepthwiseConv2dNativeBackpropFilter",Qx="DepthwiseConv2dNativeBackpropInput",dI="Diag",Np="Dilation2D",K0="Dilation2DBackpropInput",Y0="Dilation2DBackpropFilter",AO="Draw",vu="RealDiv",Jx="Einsum",$u="Elu",tb="EluGrad",Cu="Erf",_p="Equal",ku="Exp",Tp="ExpandDims",Iu="Expm1",eb="FFT",nb="Fill",sb="FlipLeftRight",Su="Floor",Nu="FloorDiv",Ep="FusedBatchNorm",Rp="GatherV2",pI="GatherNd",Ap="Greater",_u="GreaterEqual",Tu="Identity",rb="IFFT",ob="Imag",Eu="IsFinite",Ru="IsInf",Au="IsNan",Dp="LeakyRelu",Mp="Less",Fp="LessEqual",ib="LinSpace",Du="Log",Mu="Log1p",Op="LogicalAnd",Lp="LogicalNot",Pp="LogicalOr",DO="LogSoftmax",zp="LRN",ab="LRNGrad",Bp="Max",Fu="Maximum",Vp="MaxPool",cb="MaxPoolGrad",Wp="MaxPool3D",lb="MaxPool3DGrad",mI="MaxPoolWithArgmax",Up="Mean",Gp="Min",Ou="Minimum",Hp="MirrorPad",Lu="Mod",gI="Multinomial",Pu="Multiply",qp="Neg",Xp="NotEqual",ub="NonMaxSuppressionV3",hb="NonMaxSuppressionV4",fb="NonMaxSuppressionV5",jp="OnesLike",Kp="OneHot",Yp="Pack",Zp="PadV2",zu="Pow",Qp="Prelu",Jp="Prod",xI="RaggedGather",bI="RaggedRange",yI="RaggedTensorToTensor",db="Range",pb="Real",Bu="Reciprocal",Vu="Relu",tm="Reshape",em="ResizeNearestNeighbor",mb="ResizeNearestNeighborGrad",nm="ResizeBilinear",gb="ResizeBilinearGrad",Wu="Relu6",sm="Reverse",Uu="Round",Gu="Rsqrt",wI="ScatterNd",vI="TensorScatterUpdate",$I="SearchSorted",rm="Select",Hu="Selu",om="Slice",qu="Sin",Xu="Sinh",ju="Sign",Ku="Sigmoid",Yu="Softplus",Zu="Sqrt",im="Sum",am="SpaceToBatchND",cm="SplitV",lm="Softmax",CI="SparseFillEmptyRows",kI="SparseReshape",II="SparseSegmentMean",SI="SparseSegmentSum",NI="SparseToDense",Qu="SquaredDifference",xb="Square",bb="StaticRegexReplace",yb="StridedSlice",_I="StringNGrams",TI="StringSplit",EI="StringToHashBucketFast",Ju="Sub",th="Tan",eh="Tanh",nh="Tile",wb="TopK",vb="Transform",Ma="Transpose",$b="Unique",um="Unpack",hm="UnsortedSegmentSum",fm="ZerosLike",sh="Step",MO="FromPixels",Cb="RotateWithOffset",qf="_FusedMatMul",Xf="FusedConv2D",RI="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(...e){X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(...e)}function FO(...e){X().getBool("IS_TEST")||X().getBool("PROD")||console.log(...e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jf=Fx("kernelRegistry",()=>new Map),Z0=Fx("gradRegistry",()=>new Map);function Wv(e,t){const n=DI(e,t);return jf.get(n)}function Uv(e){return Z0.get(e)}function Gv(e){const t=jf.entries(),n=[];for(;;){const{done:s,value:r}=t.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===e&&n.push(i)}return n}function AI(e){const{kernelName:t,backendName:n}=e,s=DI(t,n);jf.has(s)&&ls(`The kernel '${t}' for backend '${n}' is already registered`),jf.set(s,e)}function OO(e){const{kernelName:t}=e;Z0.has(t)&&X().getBool("DEBUG")&&ls(`Overriding the gradient for '${t}'`),Z0.set(t,e)}function DI(e,t){return`${t}_${e}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MI(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function LO(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function PO(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}),n}var Bg,Hv;function zO(){if(Hv)return Bg;Hv=1,Bg=t;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(S,C,A){this.low=S|0,this.high=C|0,this.unsigned=!!A}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function n(S){return(S&&S.__isLong__)===!0}t.isLong=n;var s={},r={};function o(S,C){var A,R,_;return C?(S>>>=0,(_=0<=S&&S<256)&&(R=r[S],R)?R:(A=a(S,(S|0)<0?-1:0,!0),_&&(r[S]=A),A)):(S|=0,(_=-128<=S&&S<128)&&(R=s[S],R)?R:(A=a(S,S<0?-1:0,!1),_&&(s[S]=A),A))}t.fromInt=o;function i(S,C){if(isNaN(S))return C?b:x;if(C){if(S<0)return b;if(S>=p)return I}else{if(S<=-9223372036854776e3)return N;if(S+1>=g)return $}return S<0?i(-S,C).neg():a(S%d|0,S/d|0,C)}t.fromNumber=i;function a(S,C,A){return new t(S,C,A)}t.fromBits=a;var c=Math.pow;function l(S,C,A){if(S.length===0)throw Error("empty string");if(S==="NaN"||S==="Infinity"||S==="+Infinity"||S==="-Infinity")return x;if(typeof C=="number"?(A=C,C=!1):C=!!C,A=A||10,A<2||36<A)throw RangeError("radix");var R;if((R=S.indexOf("-"))>0)throw Error("interior hyphen");if(R===0)return l(S.substring(1),C,A).neg();for(var _=i(c(A,8)),T=x,E=0;E<S.length;E+=8){var M=Math.min(8,S.length-E),O=parseInt(S.substring(E,E+M),A);if(M<8){var L=i(c(A,M));T=T.mul(L).add(i(O))}else T=T.mul(_),T=T.add(i(O))}return T.unsigned=C,T}t.fromString=l;function u(S,C){return typeof S=="number"?i(S,C):typeof S=="string"?l(S,C):a(S.low,S.high,typeof C=="boolean"?C:S.unsigned)}t.fromValue=u;var h=65536,f=1<<24,d=h*h,p=d*d,g=p/2,m=o(f),x=o(0);t.ZERO=x;var b=o(0,!0);t.UZERO=b;var w=o(1);t.ONE=w;var y=o(1,!0);t.UONE=y;var v=o(-1);t.NEG_ONE=v;var $=a(-1,2147483647,!1);t.MAX_VALUE=$;var I=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=I;var N=a(0,-2147483648,!1);t.MIN_VALUE=N;var k=t.prototype;return k.toInt=function(){return this.unsigned?this.low>>>0:this.low},k.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},k.toString=function(C){if(C=C||10,C<2||36<C)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var A=i(C),R=this.div(A),_=R.mul(A).sub(this);return R.toString(C)+_.toInt().toString(C)}else return"-"+this.neg().toString(C);for(var T=i(c(C,6),this.unsigned),E=this,M="";;){var O=E.div(T),L=E.sub(O.mul(T)).toInt()>>>0,B=L.toString(C);if(E=O,E.isZero())return B+M;for(;B.length<6;)B="0"+B;M=""+B+M}},k.getHighBits=function(){return this.high},k.getHighBitsUnsigned=function(){return this.high>>>0},k.getLowBits=function(){return this.low},k.getLowBitsUnsigned=function(){return this.low>>>0},k.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var C=this.high!=0?this.high:this.low,A=31;A>0&&(C&1<<A)==0;A--);return this.high!=0?A+33:A+1},k.isZero=function(){return this.high===0&&this.low===0},k.eqz=k.isZero,k.isNegative=function(){return!this.unsigned&&this.high<0},k.isPositive=function(){return this.unsigned||this.high>=0},k.isOdd=function(){return(this.low&1)===1},k.isEven=function(){return(this.low&1)===0},k.equals=function(C){return n(C)||(C=u(C)),this.unsigned!==C.unsigned&&this.high>>>31===1&&C.high>>>31===1?!1:this.high===C.high&&this.low===C.low},k.eq=k.equals,k.notEquals=function(C){return!this.eq(C)},k.neq=k.notEquals,k.ne=k.notEquals,k.lessThan=function(C){return this.comp(C)<0},k.lt=k.lessThan,k.lessThanOrEqual=function(C){return this.comp(C)<=0},k.lte=k.lessThanOrEqual,k.le=k.lessThanOrEqual,k.greaterThan=function(C){return this.comp(C)>0},k.gt=k.greaterThan,k.greaterThanOrEqual=function(C){return this.comp(C)>=0},k.gte=k.greaterThanOrEqual,k.ge=k.greaterThanOrEqual,k.compare=function(C){if(n(C)||(C=u(C)),this.eq(C))return 0;var A=this.isNegative(),R=C.isNegative();return A&&!R?-1:!A&&R?1:this.unsigned?C.high>>>0>this.high>>>0||C.high===this.high&&C.low>>>0>this.low>>>0?-1:1:this.sub(C).isNegative()?-1:1},k.comp=k.compare,k.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(w)},k.neg=k.negate,k.add=function(C){n(C)||(C=u(C));var A=this.high>>>16,R=this.high&65535,_=this.low>>>16,T=this.low&65535,E=C.high>>>16,M=C.high&65535,O=C.low>>>16,L=C.low&65535,B=0,G=0,q=0,Y=0;return Y+=T+L,q+=Y>>>16,Y&=65535,q+=_+O,G+=q>>>16,q&=65535,G+=R+M,B+=G>>>16,G&=65535,B+=A+E,B&=65535,a(q<<16|Y,B<<16|G,this.unsigned)},k.subtract=function(C){return n(C)||(C=u(C)),this.add(C.neg())},k.sub=k.subtract,k.multiply=function(C){if(this.isZero())return x;if(n(C)||(C=u(C)),e){var A=e.mul(this.low,this.high,C.low,C.high);return a(A,e.get_high(),this.unsigned)}if(C.isZero())return x;if(this.eq(N))return C.isOdd()?N:x;if(C.eq(N))return this.isOdd()?N:x;if(this.isNegative())return C.isNegative()?this.neg().mul(C.neg()):this.neg().mul(C).neg();if(C.isNegative())return this.mul(C.neg()).neg();if(this.lt(m)&&C.lt(m))return i(this.toNumber()*C.toNumber(),this.unsigned);var R=this.high>>>16,_=this.high&65535,T=this.low>>>16,E=this.low&65535,M=C.high>>>16,O=C.high&65535,L=C.low>>>16,B=C.low&65535,G=0,q=0,Y=0,tt=0;return tt+=E*B,Y+=tt>>>16,tt&=65535,Y+=T*B,q+=Y>>>16,Y&=65535,Y+=E*L,q+=Y>>>16,Y&=65535,q+=_*B,G+=q>>>16,q&=65535,q+=T*L,G+=q>>>16,q&=65535,q+=E*O,G+=q>>>16,q&=65535,G+=R*B+_*L+T*O+E*M,G&=65535,a(Y<<16|tt,G<<16|q,this.unsigned)},k.mul=k.multiply,k.divide=function(C){if(n(C)||(C=u(C)),C.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&C.low===-1&&C.high===-1)return this;var A=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,C.low,C.high);return a(A,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?b:x;var R,_,T;if(this.unsigned){if(C.unsigned||(C=C.toUnsigned()),C.gt(this))return b;if(C.gt(this.shru(1)))return y;T=b}else{if(this.eq(N)){if(C.eq(w)||C.eq(v))return N;if(C.eq(N))return w;var E=this.shr(1);return R=E.div(C).shl(1),R.eq(x)?C.isNegative()?w:v:(_=this.sub(C.mul(R)),T=R.add(_.div(C)),T)}else if(C.eq(N))return this.unsigned?b:x;if(this.isNegative())return C.isNegative()?this.neg().div(C.neg()):this.neg().div(C).neg();if(C.isNegative())return this.div(C.neg()).neg();T=x}for(_=this;_.gte(C);){R=Math.max(1,Math.floor(_.toNumber()/C.toNumber()));for(var M=Math.ceil(Math.log(R)/Math.LN2),O=M<=48?1:c(2,M-48),L=i(R),B=L.mul(C);B.isNegative()||B.gt(_);)R-=O,L=i(R,this.unsigned),B=L.mul(C);L.isZero()&&(L=w),T=T.add(L),_=_.sub(B)}return T},k.div=k.divide,k.modulo=function(C){if(n(C)||(C=u(C)),e){var A=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,C.low,C.high);return a(A,e.get_high(),this.unsigned)}return this.sub(this.div(C).mul(C))},k.mod=k.modulo,k.rem=k.modulo,k.not=function(){return a(~this.low,~this.high,this.unsigned)},k.and=function(C){return n(C)||(C=u(C)),a(this.low&C.low,this.high&C.high,this.unsigned)},k.or=function(C){return n(C)||(C=u(C)),a(this.low|C.low,this.high|C.high,this.unsigned)},k.xor=function(C){return n(C)||(C=u(C)),a(this.low^C.low,this.high^C.high,this.unsigned)},k.shiftLeft=function(C){return n(C)&&(C=C.toInt()),(C&=63)===0?this:C<32?a(this.low<<C,this.high<<C|this.low>>>32-C,this.unsigned):a(0,this.low<<C-32,this.unsigned)},k.shl=k.shiftLeft,k.shiftRight=function(C){return n(C)&&(C=C.toInt()),(C&=63)===0?this:C<32?a(this.low>>>C|this.high<<32-C,this.high>>C,this.unsigned):a(this.high>>C-32,this.high>=0?0:-1,this.unsigned)},k.shr=k.shiftRight,k.shiftRightUnsigned=function(C){if(n(C)&&(C=C.toInt()),C&=63,C===0)return this;var A=this.high;if(C<32){var R=this.low;return a(R>>>C|A<<32-C,A>>>C,this.unsigned)}else return C===32?a(A,0,this.unsigned):a(A>>>C-32,0,this.unsigned)},k.shru=k.shiftRightUnsigned,k.shr_u=k.shiftRightUnsigned,k.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},k.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},k.toBytes=function(C){return C?this.toBytesLE():this.toBytesBE()},k.toBytesLE=function(){var C=this.high,A=this.low;return[A&255,A>>>8&255,A>>>16&255,A>>>24,C&255,C>>>8&255,C>>>16&255,C>>>24]},k.toBytesBE=function(){var C=this.high,A=this.low;return[C>>>24,C>>>16&255,C>>>8&255,C&255,A>>>24,A>>>16&255,A>>>8&255,A&255]},t.fromBytes=function(C,A,R){return R?t.fromBytesLE(C,A):t.fromBytesBE(C,A)},t.fromBytesLE=function(C,A){return new t(C[0]|C[1]<<8|C[2]<<16|C[3]<<24,C[4]|C[5]<<8|C[6]<<16|C[7]<<24,A)},t.fromBytesBE=function(C,A){return new t(C[4]<<24|C[5]<<16|C[6]<<8|C[7],C[0]<<24|C[1]<<16|C[2]<<8|C[3],A)},Bg}var FI=zO();const OI=LO(FI),BO=QF({__proto__:null,default:OI},[FI]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ui=OI||BO;function dm(e){return ui.fromString(e,!0,16)}const LI=dm("c3a5c85c97cb3127"),ai=dm("b492b66fbe98f273"),xn=dm("9ae16a3b2f90404f");function Q0(e){return e.xor(e.shru(47))}function PI(e,t,n){const s=e.slice(t,t+n);return ui.fromBytes(Array.from(s),!0,!0)}function ne(e,t){return PI(e,t,8)}function qv(e,t){return PI(e,t,4)}function Be(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function So(e,t,n=dm("9ddfea08eb382d69")){let s=e.xor(t).mul(n);s=s.xor(s.shru(47));let r=t.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function VO(e,t,n,s,r,o){r=r.add(e),o=Be(o.add(r).add(s),21);const i=r;return r=r.add(t),r=r.add(n),o=o.add(Be(r,44)),[r.add(s),o.add(i)]}function Bh(e,t,n,s){return VO(ne(e,t),ne(e,t+8),ne(e,t+16),ne(e,t+24),n,s)}function WO(e,t=e.length){if(t>=8){const n=xn.add(t*2),s=ne(e,0).add(xn),r=ne(e,t-8),o=Be(r,37).mul(n).add(s),i=Be(s,25).add(r).mul(n);return So(o,i,n)}if(t>=4){const n=xn.add(t*2),s=qv(e,0);return So(s.shl(3).add(t),qv(e,t-4),n)}if(t>0){const n=e[0],s=e[t>>1],r=e[t-1],o=n+(s<<8),i=t+(r<<2);return Q0(xn.mul(o).xor(LI.mul(i))).mul(xn)}return xn}function UO(e,t=e.length){const n=xn.add(t*2),s=ne(e,0).mul(ai),r=ne(e,8),o=ne(e,t-8).mul(n),i=ne(e,t-16).mul(xn);return So(Be(s.add(r),43).add(Be(o,30)).add(i),s.add(Be(r.add(xn),18)).add(o),n)}function GO(e,t=e.length){const n=xn.add(t*2),s=ne(e,0).mul(xn),r=ne(e,8),o=ne(e,t-8).mul(n),i=ne(e,t-16).mul(xn),a=Be(s.add(r),43).add(Be(o,30)).add(i),c=So(a,s.add(Be(r.add(xn),18)).add(o),n),l=ne(e,16).mul(n),u=ne(e,24),h=a.add(ne(e,t-32)).mul(n),f=c.add(ne(e,t-24)).mul(n);return So(Be(l.add(u),43).add(Be(h,30)).add(f),l.add(Be(u.add(s),18)).add(h),n)}function HO(e,t=e.length){const n=ui.fromNumber(81,!0);if(t<=32)return t<=16?WO(e,t):UO(e,t);if(t<=64)return GO(e,t);let s=n,r=n.mul(ai).add(113),o=Q0(r.mul(xn).add(113)).mul(xn),i=[ui.UZERO,ui.UZERO],a=[ui.UZERO,ui.UZERO];s=s.mul(xn).add(ne(e,0));let c=0;const l=(t-1>>6)*64,u=l+(t-1&63)-63;do s=Be(s.add(r).add(i[0]).add(ne(e,c+8)),37).mul(ai),r=Be(r.add(i[1]).add(ne(e,c+48)),42).mul(ai),s=s.xor(a[1]),r=r.add(i[0]).add(ne(e,c+40)),o=Be(o.add(a[0]),33).mul(ai),i=Bh(e,c,i[1].mul(ai),s.add(a[0])),a=Bh(e,c+32,o.add(a[1]),r.add(ne(e,c+16))),[o,s]=[s,o],c+=64;while(c!==l);const h=ai.add(o.and(255).shl(1));return c=u,a[0]=a[0].add(t-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Be(s.add(r).add(i[0]).add(ne(e,c+8)),37).mul(h),r=Be(r.add(i[1]).add(ne(e,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(ne(e,c+40))),o=Be(o.add(a[0]),33).mul(h),i=Bh(e,c,i[1].mul(h),s.add(a[0])),a=Bh(e,c+32,o.add(a[1]),r.add(ne(e,c+16))),[o,s]=[s,o],So(So(i[0],a[0],h).add(Q0(r).mul(LI)).add(o),So(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(e,t){return t==="string"?No(e):Ji([e],t)}function qO(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function Ji(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Si(e)),X().getBool("DEBUG")&&wO(e,t),qO(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){const n=new Uint8Array(e.length);for(let s=0;s<n.length;++s)Math.round(e[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${t}`)}function _n(){return X().platform.now()}function No(e,t="utf-8"){return t=t||"utf-8",X().platform.encode(e,t)}function Ro(e,t="utf-8"){return t=t||"utf-8",X().platform.decode(e,t)}function Ds(e){return X().platform.isTypedArray!=null?X().platform.isTypedArray(e):MI(e)}function Si(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||Mx(e)||e==null||Ds(e)&&n)t.push(e);else if(Array.isArray(e)||Ds(e))for(let s=0;s<e.length;++s)Si(e[s],t,n);else{let s=-1;for(const r of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Si(e[r],t,n)}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XO{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new KO)}profileKernel(t,n,s){let r;const o=()=>{r=s()};let i;const a=_n();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const l of r)l.dataSync();i=Promise.resolve({kernelMs:_n()-a})}if(X().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const u=r[l];u.data().then(h=>{jO(h,u.dtype,t)})}return{kernelName:t,outputs:r,inputs:n,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:s,timeMs:r,inputs:o,extraInfo:i}=t;s.forEach(a=>{Promise.all([a.data(),r,i]).then(c=>{this.logger.logKernelProfile(n,a,c[0],c[1],o,c[2])})})}}function jO(e,t,n){if(t!=="float32")return!1;for(let s=0;s<e.length;s++){const r=e[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class KO{logKernelProfile(t,n,s,r,o,i){const a=typeof r=="number"?Da(`${r}ms`,9):r.error,c=Da(t,25),l=n.rank,u=n.size,h=Da(n.shape.toString(),14);let f="";for(const d in o){const p=o[d];if(p!=null){const g=p.shape||n.shape,m=g.length;f+=`${d}: ${m}D ${m>0?g:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${u}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YO(e,t,n){const s={},r={};for(let c=0;c<t.length;c++)s[t[c].id]=!0;for(let c=0;c<e.length;c++){const l=e[c],u=l.inputs;for(const h in u){const f=u[h];let d=!1;for(let p=0;p<t.length;p++)if(s[f.id]){l.outputs.forEach(g=>s[g.id]=!0),d=!0,r[l.id]=!0;break}if(d)break}}const o={};o[n.id]=!0;const i={};for(let c=e.length-1;c>=0;c--){const l=e[c],u=l.inputs;for(let h=0;h<l.outputs.length;h++)if(o[l.outputs[h].id]){for(const f in u)o[u[f].id]=!0,i[l.id]=!0;break}}const a=[];for(let c=0;c<e.length;c++){const l=e[c];if(r[l.id]&&i[l.id]){const u={};for(const f in l.inputs){const d=l.inputs[f];s[d.id]&&(u[f]=d)}const h=Object.assign({},l);h.inputs=u,h.outputs=l.outputs,a.push(h)}}return a}function ZO(e,t,n,s){for(let r=t.length-1;r>=0;r--){const o=t[r],i=[];if(o.outputs.forEach(c=>{const l=e[c.id];l!=null?i.push(l):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const c in o.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=n(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const u=o.inputs[c];if(!Xt(l.shape,u.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${u.shape}'`);if(e[u.id]==null)e[u.id]=l;else{const h=e[u.id];e[u.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xv=20,qc=3,Vg=7;function QO(e,t,n,s){const r=vt(t),o=JO(e,t,n,r),i=t.length,a=Cf(e,t,n,r,o),c=["Tensor"];return s&&(c.push(`  dtype: ${n}`),c.push(`  rank: ${i}`),c.push(`  shape: [${t}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function JO(e,t,n,s){const r=K(t),o=s[s.length-1],i=new Array(o).fill(0),a=t.length,c=n==="complex64"?ol(e):e;if(a>1)for(let l=0;l<r/o;l++){const u=l*o;for(let h=0;h<o;h++)i[h]=Math.max(i[h],rl(c[u+h],0,n).length)}return i}function rl(e,t,n){let s;return Array.isArray(e)?s=`${parseFloat(e[0].toFixed(Vg))} + ${parseFloat(e[1].toFixed(Vg))}j`:cu(e)?s=`'${e}'`:n==="bool"?s=zI(e):s=parseFloat(e.toFixed(Vg)).toString(),Da(s,t)}function zI(e){return e===0?"false":"true"}function Cf(e,t,n,s,r,o=!0){const i=n==="complex64"?2:1,a=t[0],c=t.length;if(c===0){if(n==="complex64"){const g=ol(e);return[rl(g[0],0,n)]}return n==="bool"?[zI(e[0])]:[e[0].toString()]}if(c===1){if(a>Xv){const m=qc*i;let x=Array.from(e.slice(0,m)),b=Array.from(e.slice((a-qc)*i,a*i));return n==="complex64"&&(x=ol(x),b=ol(b)),["["+x.map((w,y)=>rl(w,r[y],n)).join(", ")+", ..., "+b.map((w,y)=>rl(w,r[a-qc+y],n)).join(", ")+"]"]}return["["+(n==="complex64"?ol(e):Array.from(e)).map((m,x)=>rl(m,r[x],n)).join(", ")+"]"]}const l=t.slice(1),u=s.slice(1),h=s[0]*i,f=[];if(a>Xv){for(let g=0;g<qc;g++){const m=g*h,x=m+h;f.push(...Cf(e.slice(m,x),l,n,u,r,!1))}f.push("...");for(let g=a-qc;g<a;g++){const m=g*h,x=m+h;f.push(...Cf(e.slice(m,x),l,n,u,r,g===a-1))}}else for(let g=0;g<a;g++){const m=g*h,x=m+h;f.push(...Cf(e.slice(m,x),l,n,u,r,g===a-1))}const d=c===2?",":"";f[0]="["+(a>0?f[0]+d:"");for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+d;let p=`,
`;for(let g=2;g<c;g++)p+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":p),f}function ol(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ye{constructor(t,n,s){if(this.dtype=n,this.shape=t.slice(),this.size=K(t),s!=null){const r=s.length;D(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||ke(n,this.size),this.strides=vt(t)}set(t,...n){n.length===0&&(n=[0]),D(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const r of t){if(r<0||r>=this.shape[n]){const o=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=this.strides[r]*t[r];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let s=0;s<t.length-1;++s)n+=this.strides[s]*t[s];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(t/this.strides[s]),t-=n[s]*this.strides[s];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return Hs().makeTensor(this.values,this.shape,this.dtype)}}let Hs=null,Na=null;function t4(e){Hs=e}function e4(e){Na=e}class ve{constructor(t,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=K(t),this.strides=vt(t),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return Na.buffer(this.shape,this.dtype,t)}bufferSync(){return Na.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Ys(this.shape,t,this.dtype==="complex64")}arraySync(){return Ys(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=Hs().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(s=>Ro(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),Hs().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=Hs().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>Ro(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await Hs().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Hs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return Na.print(this,t)}clone(){return this.throwIfDisposed(),Na.clone(this)}toString(t=!1){const n=this.dataSync();return QO(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),Na.cast(this,t)}variable(t=!0,n,s){return this.throwIfDisposed(),Hs().makeVariable(this,t,n,s)}}Object.defineProperty(ve,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function j(){return Fx("Tensor",()=>ve)}j();class Kf extends ve{constructor(t,n,s,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=n,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Xt(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Hs().disposeTensor(this),this.dataId=t.dataId,Hs().incRef(this,null)}dispose(){Hs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Kf,Symbol.hasInstance,{value:e=>e instanceof ve&&e.assign!=null&&e.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var jv;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(jv||(jv={}));var J0;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(J0||(J0={}));var t1;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(t1||(t1={}));var e1;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(e1||(e1={}));var n1;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(n1||(n1={}));const n4={float32:e1,int32:J0,bool:t1,complex64:n1};function ns(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return n4[e][t]}function kb(e){return ns(e,"int32")}function BI(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function VI(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ie(e,t){if(e.dtype===t.dtype)return[e,t];const n=ns(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function WI(e){const t=[];return UI(e,t,new Set),t}function UI(e,t,n){if(e==null)return;if(e instanceof ve){t.push(e);return}if(!s4(e))return;const s=e;for(const r in s){const o=s[r];n.has(o)||(n.add(o),UI(o,t,n))}}function s4(e){return Array.isArray(e)||typeof e=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(e){return e.kernelName!=null}class Kv{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class qa{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Kv}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const s=t[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,s=1){return t in this.registryFactory?(ls(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(t);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new XO(this.backendInstance),!0}setupRegisteredKernels(){Gv(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){Gv(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof Rx)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[t]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,ls(`Initialization of backend ${t} failed`),ls(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return ls(`Initialization of backend ${t} failed`),ls(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const s=t[n],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const s=this.state.tensorInfo.get(n),r=s.backend,o=this.readSync(n),i=r.refCount(n);r.disposeData(n,!0),s.backend=t,t.move(n,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let s=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(t,n,s){t();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return qa.nextTensorId++}nextVariableId(){return qa.nextVariableId++}clone(t){const n=V.runKernel(Tu,{x:t}),s={x:t},r=i=>({x:()=>{const a="float32",c={x:i},l={dtype:a};return V.runKernel(gu,c,l)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,o,{}),n}runKernel(t,n,s){if(this.backendName==null&&this.backend,!(Wv(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,s){const r=this.backend.numDataIds();let o=0;s.forEach(c=>{o+=c.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let n,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=Wg(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Wg(t)){const{kernelName:p,inputs:g,attrs:m}=t;this.backendName==null&&this.backend;const x=Wv(p,this.backendName);D(x!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();c=x.kernelFunc({inputs:g,attrs:m,backend:this.backend});const w=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,w);const y=w.map(v=>v.rank!=null?v:this.makeTensorFromTensorInfo(v));if(r){const v=this.getTensorsForGradient(p,g,y);s=this.saveTensorsForBackwardMode(v)}return y}}else{const{forwardFunc:p}=t,g=m=>{r&&(s=m.map(x=>this.keep(this.clone(x))))};a=()=>{const m=this.backend.numDataIds();c=this.tidy(()=>p(this.backend,g));const x=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,m,x),x}}const{inputs:u,attrs:h}=t,f=Wg(t)?null:t.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(l,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),r&&this.addTapeNode(l,u,n,f,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(c)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,n,s){const r=Uv(t);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(D(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(l=>n[l])):a=o.map(l=>n[l]);const c=s.filter((l,u)=>i[u]);return a.concat(c)}return[]}makeTensor(t,n,s,r){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=t;s==="string"&&cu(t[0])&&(o=t.map(c=>No(c)));const i=r.write(o,n,s),a=new ve(n,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const c=this.state.tensorInfo.get(i),l=$O(o);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(t,n,s,r){s=s||"float32";const o={dataId:t,shape:n,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(t,n){const{dataId:s,shape:r,dtype:o}=t,i=new ve(r,o,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(t,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==t.dtype&&(t=t.cast(r));const o=new Kf(t,n,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*Hf(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof Kf||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*Hf(t.dtype);this.state.numBytes-=s}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:s,saved:o},c=Uv(t);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((u,h)=>{if(u==null){const f=s[h],d=on(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return u}),r(l.length>1?l:l[0],o,i))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=WI(t),s=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(t,n,s,r=!1){if(D(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));D(o instanceof ve,()=>"The result y returned by f() must be a tensor.");const i=YO(this.state.activeTape,n,o);if(!r&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??r4(o.shape),ZO(a,i,l=>this.tidy(l),o4);const c=n.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const u of l.saved)u.dispose()}),this.state.activeTape=null),{value:o,grads:c}})}customGrad(t){return D(X0(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{D(n.every(a=>a instanceof ve),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,c)=>{r[c]=a});const o=(a,c)=>(s=t(...n,c),D(s.value instanceof ve,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),D(X0(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,c)=>{const l=s.gradFunc(a,c),u=Array.isArray(l)?l:[l];D(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),D(u.every(f=>f instanceof ve),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((f,d)=>{h[d]=()=>f}),h};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=_n(),s=await this.backend.time(t);return s.wallMs=_n()-n,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Kv;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}qa.nextTensorId=0;qa.nextVariableId=0;function r4(e){const t=Dx(K(e),"float32");return V.makeTensor(t,e,"float32")}function GI(){const e=hI();if(e._tfengine==null){const t=new IO(e);e._tfengine=new qa(t)}return TO(e._tfengine.ENV),t4(()=>e._tfengine),e._tfengine}const V=GI();function o4(e,t){const n={a:e,b:t};return V.runKernel(Ic,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(){return typeof navigator<"u"&&navigator!=null}function HI(e){if(e||i4()){if(e||(e=navigator),e.product==="ReactNative")return!0;const t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){const n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function qI(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pn=X();Pn.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Pn.registerFlag("IS_BROWSER",()=>qI());Pn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Pn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Pn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Pn.registerFlag("PROD",()=>!1);Pn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Pn.getBool("DEBUG"));Pn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Pn.registerFlag("IS_TEST",()=>!1);Pn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Pn.getBool("DEBUG"));Pn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Pn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Pn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pm(e,t){let n=e;if(Ds(e))return t==="string"?[]:[e.length];if(BI(e)){const r=e.channels||"RGBA";return[e.height,e.width*r.length]}else if(VI(e))return[e.buffer.size/(t==null?4:Hf(t))];if(!Array.isArray(e))return[];const s=[];for(;Array.isArray(n)||Ds(n)&&t!=="string";)s.push(n.length),n=n[0];return Array.isArray(e)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&XI(e,s,[]),s}function XI(e,t,n){if(n=n||[],!Array.isArray(e)&&!Ds(e)){D(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}D(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),D(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const s=t.slice(1);for(let r=0;r<e.length;++r)XI(e[r],s,n.concat(r))}function Yv(e,t,n,s){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${e} tensor, but got ${t} tensor`)}}function F(e,t,n,s="numeric"){if(e instanceof j())return Yv(s,e.dtype,t,n),e;let r=Cc(e);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),Yv(s,r,t,n),e==null||!Ds(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){const c=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${c}'`)}const o=pm(e,r);!Ds(e)&&!Array.isArray(e)&&(e=[e]);const a=r!=="string"?Ji(e,r):Si(e,[],!0);return V.makeTensor(a,o,r)}function jI(e,t,n,s="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((o,i)=>F(o,`${t}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a4="__op";function W(e){const t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const s=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+a4;const r=(...o)=>{V.startScope(n);try{const i=s(...o);return Mx(i)&&console.error("Cannot return a Promise inside of tidy."),V.endScope(i),i}catch(i){throw V.endScope(null),i}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4(e,t){const n=F(e,"real","complex"),s=F(t,"imag","complex");Ls(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return V.runKernel(Ux,r)}const Xa=W({complex_:c4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(e,t,n,s){if(s==null)s=Cc(e);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(VI(e)||BI(e)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return V.backend.createTensorFromGPUData(e,t||n,s)}if(!Ds(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){so(t);const r=K(t),o=K(n);D(r===o,()=>`Based on the provided shape, [${t}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<n.length;++i){const a=n[i],c=i===n.length-1?a!==K(t.slice(i)):!0;D(n[i]===t[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Ds(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=s!=="string"?Ji(e,s):Si(e,[],!0),V.makeTensor(e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zs(e,t,n){const s=pm(e,n);return mm(e,t,s,n)}class Sc{static join(t){return new Sc(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(s=>Ds(s)?s.buffer:s),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let s=0;s<t.length;s++){const r=t[s];s!==t.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+r.byteLength;this.shards.push({buffer:r,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);const s=this.findShardForByte(t);if(s===-1)throw new Error(`Could not find start shard for byte ${t}`);const r=n-t,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=t+a-l.start,f=a,p=Math.min(n,l.end)-l.start,g=new Uint8Array(l.buffer,h,p-h);if(i.set(g,f),a+=g.length,n<l.end)break}return o}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(r){return t<r.start?-1:t>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=l4(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function l4(e,t){let n=0,s=e.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,o=t(e[r]);if(o===0)return r;o<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lr(){return V}function Zv(){return V.memory()}function H(e,t){return V.tidy(e,t)}function zt(e){WI(e).forEach(n=>n.dispose())}function wr(e){return V.keep(e)}function KI(e,t,n=1){return V.registerBackend(e,t,n)}function u4(){return V.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qv=4;async function Jv(e,t){const n=[],s=[],r=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);for(let i=0;i<r.length;++i){const a=r[i],c=Array.isArray(e)?e[i].tensor:e[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const u=new Promise(async h=>{const f=await c.bytes(),d=f.reduce((m,x)=>m+x.length,0)+Qv*f.length,p=new Uint8Array(d);let g=0;for(let m=0;m<f.length;m++){const x=f[m],b=new Uint8Array(new Uint32Array([x.length]).buffer);p.set(b,g),g+=Qv,p.set(x,g),g+=x.length}h(p)});s.push(u)}else s.push(c.data());t!=null&&(l.group=t),n.push(l)}const o=await Promise.all(s);return{data:h4(o),specs:n}}function h4(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(o=>{if(t+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(t);let r=0;return n.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Ib=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function t2(e){return Ib?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function f4(e){if(Ib)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let s=0,r=t.length;s<r;s++)n+=String.fromCharCode(t[s]);return btoa(n)}function d4(e){if(Ib){const s=Buffer.from(e,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let s=0;s<t.length;++s)n.set([t.charCodeAt(s)],s);return n.buffer}function p4(e){return Sc.join(e)}function YI(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:t2(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:t2(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Sc(e.weightData).byteLength}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return gn.instance==null&&(gn.instance=new gn),gn.instance}static registerSaveRouter(t){gn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){gn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return gn.getHandlers(t,"save")}static getLoadHandlers(t,n){return gn.getHandlers(t,"load",n)}static getHandlers(t,n,s){const r=[];return(n==="load"?gn.getInstance().loadRouters:gn.getInstance().saveRouters).forEach(i=>{const a=i(t,s);a!==null&&r.push(a)}),r}}const m4=e=>gn.getSaveHandlers(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s1="tensorflowjs",r1=1,pi="models_store",wo="model_info_store";function ZI(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function o1(e){const t=e.result;t.createObjectStore(pi,{keyPath:"modelPath"}),t.createObjectStore(wo,{keyPath:"modelPath"})}class Ni{constructor(t){if(this.indexedDB=ZI(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((s,r)=>{const o=this.indexedDB.open(s1,r1);o.onupgradeneeded=()=>o1(o),o.onsuccess=()=>{const i=o.result;if(n==null){const a=i.transaction(pi,"readonly"),l=a.objectStore(pi).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=u=>(i.close(),r(l.error)),a.oncomplete=()=>i.close()}else{n.weightData=Sc.join(n.weightData);const a=YI(n),c=i.transaction(wo,"readwrite");let l=c.objectStore(wo),u;try{u=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let h;u.onsuccess=()=>{h=i.transaction(pi,"readwrite");const f=h.objectStore(pi);let d;try{d=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}d.onsuccess=()=>s({modelArtifactsInfo:a}),d.onerror=p=>{l=c.objectStore(wo);const g=l.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(d.error)),g.onerror=m=>(i.close(),r(d.error))}},u.onerror=f=>(i.close(),r(u.error)),c.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Ni.URL_SCHEME="indexeddb://";const QI=e=>X().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ni.URL_SCHEME)?g4(e.slice(Ni.URL_SCHEME.length)):null;gn.registerSaveRouter(QI);gn.registerLoadRouter(QI);function g4(e){return new Ni(e)}function x4(e){return e.startsWith(Ni.URL_SCHEME)?e.slice(Ni.URL_SCHEME.length):e}class b4{constructor(){this.indexedDB=ZI()}async listModels(){return new Promise((t,n)=>{const s=this.indexedDB.open(s1,r1);s.onupgradeneeded=()=>o1(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(wo,"readonly"),a=o.objectStore(wo).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;t(c)},a.onerror=c=>(r.close(),n(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(t){return t=x4(t),new Promise((n,s)=>{const r=this.indexedDB.open(s1,r1);r.onupgradeneeded=()=>o1(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(wo,"readwrite"),a=i.objectStore(wo),c=a.get(t);let l;c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const u=a.delete(t),h=()=>{l=o.transaction(pi,"readwrite");const d=l.objectStore(pi).delete(t);d.onsuccess=()=>n(c.result.modelArtifactsInfo),d.onerror=p=>s(c.error)};u.onsuccess=h,u.onerror=f=>(h(),o.close(),s(c.error))}},c.onerror=u=>(o.close(),s(c.error)),i.oncomplete=()=>{l==null?o.close():l.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wr="/",_a="tensorflowjs_models",JI="info",y4="model_topology",w4="weight_specs",v4="weight_data",$4="model_metadata";function tS(e){return{info:[_a,e,JI].join(Wr),topology:[_a,e,y4].join(Wr),weightSpecs:[_a,e,w4].join(Wr),weightData:[_a,e,v4].join(Wr),modelMetadata:[_a,e,$4].join(Wr)}}function eS(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function C4(e){const t=e.split(Wr);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Wr)}function k4(e){return e.startsWith(_i.URL_SCHEME)?e.slice(_i.URL_SCHEME.length):e}class _i{constructor(t){if(!X().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=tS(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),r=YI(t),o=Sc.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,f4(o));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw eS(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=d4(i),n}}_i.URL_SCHEME="localstorage://";const nS=e=>X().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(_i.URL_SCHEME)?I4(e.slice(_i.URL_SCHEME.length)):null;gn.registerSaveRouter(nS);gn.registerLoadRouter(nS);function I4(e){return new _i(e)}class S4{constructor(){D(X().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),D(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=_a+Wr,s=Wr+JI;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(n)&&o.endsWith(s)){const i=C4(o);t[i]=JSON.parse(this.LS.getItem(o))}}return t}async removeModel(t){t=k4(t);const n=tS(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(n.info));return eS(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e2="://";class ur{constructor(){this.managers={}}static getInstance(){return ur.instance==null&&(ur.instance=new ur),ur.instance}static registerManager(t,n){D(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(e2)&&(t=t.slice(0,t.indexOf(e2))),D(t.length>0,()=>"scheme must not be an empty string.");const s=ur.getInstance();D(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=n}static getManager(t){const n=ur.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(ur.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N4{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(typeof window>"u"||!X().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return MI(t)}}if(X().get("IS_BROWSER")){X().setPlatform("browser",new N4);try{ur.registerManager(_i.URL_SCHEME,new S4)}catch{}try{ur.registerManager(Ni.URL_SCHEME,new b4)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _4={importFetch:()=>require("node-fetch")};let Ug;class T4{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return X().global.fetch!=null?X().global.fetch(t,n):(Ug==null&&(Ug=_4.importFetch()),Ug(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}X().get("IS_NODE")&&!X().get("IS_BROWSER")&&X().setPlatform("node",new T4);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(e,t="float32",n){return t=t||"float32",so(e),new Ye(e,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(e,t){const n=F(e,"x","cast");if(!vO(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:t};return V.runKernel(gu,s,r)}const ct=W({cast_:E4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4(e){const n={x:F(e,"x","clone","string_or_numeric")};return V.runKernel(Tu,n)}const bi=W({clone_:R4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(e,t=!1){console.log(e.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */GI();const D4={buffer:Ot,cast:ct,clone:bi,print:A4};e4(D4);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M4(e,t){let n=F(e,"a","add"),s=F(t,"b","add");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(Ic,r)}const nt=W({add_:M4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(e,t){let n=F(e,"a","floorDiv"),s=F(t,"b","floorDiv");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(Nu,r)}const sS=W({floorDiv_:F4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(e,t){let n=F(e,"a","div"),s=F(t,"b","div");if([n,s]=Ie(n,s),n.dtype==="int32"&&s.dtype==="int32")return sS(n,s);const r={a:n,b:s},o={};return V.runKernel(vu,r,o)}const yt=W({div_:O4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4(e,t){let n=F(e,"a","mul"),s=F(t,"b","mul");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(Pu,r)}const P=W({mul_:L4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(e){const t=F(e,"x","abs");if(t.dtype==="complex64"){const n={x:t};return V.runKernel(wp,n)}else{const n={x:t};return V.runKernel(dp,n)}}const ze=W({abs_:P4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(e){const n={x:F(e,"x","acos")};return V.runKernel(lu,n)}const B4=W({acos_:z4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4(e){const n={x:F(e,"x","acosh")};return V.runKernel(uu,n)}const W4=W({acosh_:V4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(e,t=null,n=!1){const r={x:F(e,"x","all","bool")},o={axis:t,keepDims:n};return V.runKernel(Lx,r,o)}const rS=W({all_:U4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G4(e,t=null,n=!1){const r={x:F(e,"x","any","bool")},o={axis:t,keepDims:n};return V.runKernel(Px,r,o)}const i1=W({any_:G4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(e,t=0){const s={x:F(e,"x","argMax")},r={axis:t};return V.runKernel(pp,s,r)}const Dl=W({argMax_:H4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(e,t=0){const s={x:F(e,"x","argMin")},r={axis:t};return V.runKernel(mp,s,r)}const X4=W({argMin_:q4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4(e){const n={x:F(e,"x","asin")};return V.runKernel(hu,n)}const K4=W({asin_:j4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(e){const n={x:F(e,"x","asinh")};return V.runKernel(fu,n)}const Z4=W({asinh_:Y4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(e){const n={x:F(e,"x","atan")};return V.runKernel(du,n)}const J4=W({atan_:Q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(e,t){let n=F(e,"a","atan2"),s=F(t,"b","atan2");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(mu,r)}const eL=W({atan2_:tL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(e){const n={x:F(e,"x","atanh")};return V.runKernel(pu,n)}const sL=W({atanh_:nL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rh(e,t,n,s,r="NHWC",o){const i=e[3],a=[...t,i],c=oo(r);return Je(e,a,n,o,s,null,null,c)}function Ps(e,t,n,s,r,o,i="channelsLast"){const[a,c]=Ml(t);let l;if(i==="channelsLast")l=[a,c,e[3],e[3]];else if(i==="channelsFirst")l=[a,c,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return Je(e,l,n,s,r,o,!1,i)}function ro(e,t,n,s,r,o,i="NDHWC"){const[a,c,l]=a1(t);let u,h;if(i==="NDHWC")h="channelsLast",u=[a,c,l,e[4],e[4]];else if(i==="NCDHW")h="channelsFirst",u=[a,c,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return Ho(e,u,n,s,r,!1,h,o)}function Je(e,t,n,s,r,o,i=!1,a="channelsLast"){let[c,l,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,u,h]=e;else if(a==="channelsFirst")[c,h,l,u]=e;else throw new Error(`Unknown dataFormat ${a}`);const[f,d,,p]=t,[g,m]=Ml(n),[x,b]=Ml(s),w=Fa(f,x),y=Fa(d,b),{padInfo:v,outHeight:$,outWidth:I}=iL(r,l,u,g,m,w,y,o,a),N=i?p*h:p;let k;return a==="channelsFirst"?k=[c,N,$,I]:a==="channelsLast"&&(k=[c,$,I,N]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:u,inChannels:h,outHeight:$,outWidth:I,outChannels:N,padInfo:v,strideHeight:g,strideWidth:m,filterHeight:f,filterWidth:d,effectiveFilterHeight:w,effectiveFilterWidth:y,dilationHeight:x,dilationWidth:b,inShape:e,outShape:k,filterShape:t}}function Ho(e,t,n,s,r,o=!1,i="channelsLast",a){let[c,l,u,h,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,u,h,f]=e;else if(i==="channelsFirst")[c,f,l,u,h]=e;else throw new Error(`Unknown dataFormat ${i}`);const[d,p,g,,m]=t,[x,b,w]=a1(n),[y,v,$]=a1(s),I=Fa(d,y),N=Fa(p,v),k=Fa(g,$),{padInfo:S,outDepth:C,outHeight:A,outWidth:R}=aL(r,l,u,h,x,b,w,I,N,k,a),_=o?m*f:m;let T;return i==="channelsFirst"?T=[c,_,C,A,R]:i==="channelsLast"&&(T=[c,C,A,R,_]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:u,inWidth:h,inChannels:f,outDepth:C,outHeight:A,outWidth:R,outChannels:_,padInfo:S,strideDepth:x,strideHeight:b,strideWidth:w,filterDepth:d,filterHeight:p,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:N,effectiveFilterWidth:k,dilationDepth:y,dilationHeight:v,dilationWidth:$,inShape:e,outShape:T,filterShape:t}}function rL(e,t,n,s,r){s==null&&(s=Sb(e,t,n));const o=e[0],i=e[1],a=Fl((o-t+2*s)/n+1,r),c=Fl((i-t+2*s)/n+1,r);return[a,c]}function oL(e,t,n,s,r,o){r==null&&(r=Sb(e,t[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)e[a]+2*r>=t[a]&&(i[a]=Fl((e[a]-t[a]+2*r)/s[a]+1,o));return i}function Sb(e,t,n,s=1){const r=Fa(t,s);return Math.floor((e[0]*(n-1)-n+r)/2)}function Ml(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function a1(e){return typeof e=="number"?[e,e,e]:e}function Fa(e,t){return t<=1?e:e+(e-1)*(t-1)}function iL(e,t,n,s,r,o,i,a,c){let l,u,h;if(typeof e=="number"){l={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};const d=rL([t,n],o,s,e,a);u=d[0],h=d[1]}else if(e==="same"){u=Math.ceil(t/s),h=Math.ceil(n/r);const f=Math.max(0,(u-1)*s+o-t),d=Math.max(0,(h-1)*r+i-n),p=Math.floor(f/2),g=f-p,m=Math.floor(d/2),x=d-m;l={top:p,bottom:g,left:m,right:x,type:"SAME"}}else if(e==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-o+1)/s),h=Math.ceil((n-i+1)/r);else if(typeof e=="object"){const f=c==="channelsLast"?e[1][0]:e[2][0],d=c==="channelsLast"?e[1][1]:e[2][1],p=c==="channelsLast"?e[2][0]:e[3][0],g=c==="channelsLast"?e[2][1]:e[3][1];l={top:f,bottom:d,left:p,right:g,type:f===0&&d===0&&p===0&&g===0?"VALID":"EXPLICIT"},u=Fl((t-o+f+d)/s+1,a),h=Fl((n-i+p+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:l,outHeight:u,outWidth:h}}function aL(e,t,n,s,r,o,i,a,c,l,u){let h,f,d,p;if(e==="valid"&&(e=0),typeof e=="number"){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};const m=oL([t,n,s,1],[a,c,l],1,[r,o,i],e,u);f=m[0],d=m[1],p=m[2]}else if(e==="same"){f=Math.ceil(t/r),d=Math.ceil(n/o),p=Math.ceil(s/i);const g=(f-1)*r+a-t,m=(d-1)*o+c-n,x=(p-1)*i+l-s,b=Math.floor(g/2),w=g-b,y=Math.floor(m/2),v=m-y,$=Math.floor(x/2),I=x-$;h={top:y,bottom:v,left:$,right:I,front:b,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function Fl(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Ti(e){const[t,n,s]=Ml(e);return t===1&&n===1&&s===1}function an(e,t){return Ti(e)||Ti(t)}function Ei(e){return Ml(e).every(t=>t>0)}function oo(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Hn(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")D(Ha(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(r=>{D(Ha(r),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(e,t){const s={x:F(e,"x","reshape","string_or_numeric")},r={shape:t};return V.runKernel(tm,s,r)}const U=W({reshape_:cL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(e,t,n,s,r){const o=F(e,"x","avgPool","float32"),i=1;D(an(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=o,c=!1;o.rank===3&&(c=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Hn("avgPool",s,r);const l={x:a},u={filterSize:t,strides:n,pad:s,dimRoundingMode:r};let h=V.runKernel(gp,l,u);return h=ct(h,o.dtype),c?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Nb=W({avgPool_:lL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(e,t,n,s,r,o="NDHWC"){const i=F(e,"x","avgPool3d","float32");let a=i,c=!1;i.rank===4&&(c=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),D(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),D(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Hn("avgPool3d",s,r);const l={x:a},u={filterSize:t,strides:n,pad:s,dimRoundingMode:r,dataFormat:o};let h=V.runKernel(xp,l,u);return h=ct(h,a.dtype),c?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const hL=W({avgPool3d_:uL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(e,t=0){D(e.length>=1,()=>"Pass at least one tensor to concat");const n=jI(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return bi(n[0]);const s=n,r={axis:t};return V.runKernel(vp,s,r)}const Ze=W({concat_:fL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(e,t,n=!1,s=!1){let r=F(e,"a","matMul"),o=F(t,"b","matMul");[r,o]=Ie(r,o);const i={a:r,b:o},a={transposeA:n,transposeB:s};return V.runKernel(bp,i,a)}const Vt=W({matMul_:dL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(e){const n={x:F(e,"x","sigmoid","float32")};return V.runKernel(Ku,n)}const Nc=W({sigmoid_:pL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(e,t,n){const s=F(e,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:t,size:n};return V.runKernel(om,r,o)}const se=W({slice_:mL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(e){const n={x:F(e,"x","tanh","float32")};return V.runKernel(eh,n)}const gm=W({tanh_:gL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(e,t,n){const s=F(e,"x","batchToSpaceND"),r=t.reduce((a,c)=>a*c);D(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),D(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),D(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${r}`);const o={x:s},i={blockShape:t,crops:n};return V.runKernel(yp,o,i)}const _b=W({batchToSpaceND_:xL});function bL(e){let t;return e.rank===0||e.rank===1?t=U(e,[1,1,1,e.size]):e.rank===2?t=U(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(e,t,n,s,r,o){o==null&&(o=.001);const i=F(e,"x","batchNorm"),a=F(t,"mean","batchNorm"),c=F(n,"variance","batchNorm");let l;r!=null&&(l=F(r,"scale","batchNorm"));let u;s!=null&&(u=F(s,"offset","batchNorm")),D(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:bL(i),scale:l,offset:u,mean:a,variance:c},d={varianceEpsilon:o},p=V.runKernel(Ep,f,d);return U(p,i.shape)}const xm=W({batchNorm_:yL});function wL(e,t,n,s,r,o){const i=F(e,"x","batchNorm"),a=F(t,"mean","batchNorm"),c=F(n,"variance","batchNorm");let l;r!=null&&(l=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),D(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),D(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),D(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&D(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),xm(i,a,c,u,l,o)}const vL=W({batchNorm2d_:wL});function $L(e,t,n,s,r,o){const i=F(e,"x","batchNorm"),a=F(t,"mean","batchNorm"),c=F(n,"variance","batchNorm");let l;r!=null&&(l=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),D(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),D(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),D(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&D(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),xm(i,a,c,u,l,o)}const CL=W({batchNorm3d_:$L});function kL(e,t,n,s,r,o){const i=F(e,"x","batchNorm"),a=F(t,"mean","batchNorm"),c=F(n,"variance","batchNorm");let l;r!=null&&(l=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),D(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),D(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),D(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&D(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),xm(i,a,c,u,l,o)}const IL=W({batchNorm4d_:kL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(e,t,n){const s=F(e,"x","bincount"),r=F(t,"weights","bincount");D(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),D(n>=0,()=>`size must be non-negative, but got ${n}.`),D(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:n};return V.runKernel(Vx,o,i)}const NL=W({bincount_:SL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(e,t){let n=F(e,"broadcastTo","x");const s=n.shape;if(so(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=U(n,l)}const r=n.shape,o=Array.from(t);for(let l=t.length-1;l>=0;l--)if(r[l]===t[l])o[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(o.map((l,u)=>l>1?u:-1).filter(l=>l>=0).length===0)return bi(n);const a={x:n},c={reps:o};return V.runKernel(nh,a,c)}const Cl=W({broadcastTo_:_L});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(e){const n={x:F(e,"x","ceil","float32")};return V.runKernel(xu,n)}const EL=W({ceil_:TL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(e,t,n){so(e),n=n||Cc(t);const s={shape:e,value:t,dtype:n};return V.runKernel(nb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(e,t,n){const s=F(e,"x","clipByValue");if(D(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return ja(s.shape,t,s.dtype);const r={x:s},o={clipValueMin:t,clipValueMax:n};return V.runKernel(bu,r,o)}const ds=W({clipByValue_:RL});function AL(e){return Ze(e,0)}const DL=W({concat1d_:AL});function ML(e,t){return Ze(e,t)}const FL=W({concat2d_:ML});function OL(e,t){return Ze(e,t)}const LL=W({concat3d_:OL});function PL(e,t){return Ze(e,t)}const zL=W({concat4d_:PL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(e,t,n,s,r="NHWC",o=[1,1],i){const a=F(e,"x","conv2d","float32"),c=F(t,"filter","conv2d","float32");let l=a,u=!1;a.rank===3&&(u=!0,l=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),D(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),Hn("conv2d",s,i);const h=r==="NHWC"?l.shape[3]:l.shape[1];D(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),D(an(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),D(Ei(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),D(Ei(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:l,filter:c},d={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=V.runKernel($p,f,d);return u?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ri=W({conv2d_:BL});function VL(e,t,n,s,r="NWC",o=1,i){const a=F(e,"x","conv1d"),c=F(t,"filter","conv1d");let l=a,u=!1;a.rank===2&&(u=!0,l=U(a,[1,a.shape[0],a.shape[1]])),D(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),D(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),Hn("conv1d",s,i),D(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),D(an(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),D(Ei(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),D(Ei(n),()=>"Error in conv1D: Stride should be larger than 0."),D(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=U(c,[1,c.shape[0],c.shape[1],c.shape[2]]),f=U(l,[l.shape[0],1,l.shape[1],l.shape[2]]),m=Ri(f,h,[1,n],s,"NHWC",[1,o],i);return u?U(m,[m.shape[2],m.shape[3]]):U(m,[m.shape[0],m.shape[2],m.shape[3]])}const oS=W({conv1d_:VL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(e,t,n,s,r,o="NHWC",i){D(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,c=t,l=!1;t.rank===3&&(l=!0,c=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,e[0],e[1],e[2]]),D(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),D(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),D(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?c.shape[3]:c.shape[1];D(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),D(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),Hn("conv2dDerInput",r,i);const f={dy:c,filter:n},d={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},p=V.runKernel(Cp,f,d);return l?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Tb=W({conv2DBackpropInput_:WL});function UL(e,t,n,s,r,o){const i=F(e,"x","conv2dTranspose"),a=F(t,"filter","conv2dTranspose");return Tb(n,i,a,s,r,"NHWC",o)}const iS=W({conv2dTranspose_:UL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(e,t,n,s,r="NDHWC",o=[1,1,1]){const i=F(e,"x","conv3d"),a=F(t,"filter","conv3d");let c=i,l=!1;i.rank===4&&(l=!0,c=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),D(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),D(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),D(an(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),D(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),D(Ei(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),D(Ei(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:c,filter:a},h={strides:n,pad:s,dataFormat:r,dilations:o},f=V.runKernel(kp,u,h);return l?U(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const HL=W({conv3d_:GL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(e,t,n,s,r){D(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let o=e,i=t,a=!1;t.rank===4&&(a=!0,i=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),o=[1,e[0],e[1],e[2],e[3]]);const c=o[4],l=i.shape[4];D(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),D(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),D(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),D(c===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[3]}.`),D(l===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`);const u={dy:i,filter:n},h={pad:r,strides:s,inputShape:o},f=V.runKernel(qx,u,h);return a?U(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const aS=W({conv3DBackpropInput_:qL});function XL(e,t,n,s,r){const o=F(e,"x","conv3dTranspose"),i=F(t,"filter","conv3dTranspose");return aS(n,o,i,s,r)}const jL=W({conv3dTranspose_:XL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(e){const n={x:F(e,"x","cos","float32")};return V.runKernel(yu,n)}const Eb=W({cos_:KL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(e){const n={x:F(e,"x","cosh","float32")};return V.runKernel(wu,n)}const cS=W({cosh_:YL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(e,t=0,n=!1,s=!1){const o={x:F(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:s};return V.runKernel(Xx,o,i)}const Yf=W({cumprod_:ZL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(e,t=0,n=!1,s=!1){const o={x:F(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:s};return V.runKernel(Ip,o,i)}const lS=W({cumsum_:QL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(e,t,n,s=!1){const r=F(e,"x","denseBincount"),o=F(t,"weights","denseBincount");D(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),D(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),D(n>=0,()=>`size must be non-negative, but got ${n}.`),D(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:n,binaryOutput:s};return V.runKernel(Kx,i,a)}const n2=W({denseBincount_:JL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(e,t,n="NHWC"){const s=F(e,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],o=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];D(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),D(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${t}  for depthToSpace with input shape
    ${s.shape}`),D(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t} for depthToSpace with input shape
        ${s.shape}`),D(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:t,dataFormat:n};return V.runKernel(Yx,a,c)}const eP=W({depthToSpace_:tP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nP(e,t,n,s,r="NHWC",o=[1,1],i){const a=F(e,"x","depthwiseConv2d","float32"),c=F(t,"filter","depthwiseConv2d","float32");let l=a,u=!1;a.rank===3&&(u=!0,l=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),D(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];D(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),Hn("depthwiseConv2d",s,i);const f={x:l,filter:c},d={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=V.runKernel(Sp,f,d);return u?U(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Rb=W({depthwiseConv2d_:nP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sP(e,t,n,s,r=[1,1],o="NHWC"){const i=F(e,"x","dilation2d"),a=F(t,"filter","dilation2d");D(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),D(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),D(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let c=i,l=!1;i.rank===3&&(c=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),D(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const u={x:c,filter:a},h={strides:n,pad:s,dilations:r},f=V.runKernel(Np,u,h);return l?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const rP=W({dilation2d_:sP});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ka(e,t){const n=e.length,s=[];for(let r=0;r<n;r++){const o=n-1-r,i=e[o]||1;(t[t.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Oe(e,t){const n=[];for(let s=0;s<t.length;s++){const r=e[e.length-s-1],o=t.length-s-1,i=t[o];(r==null||r===1&&i>1)&&n.unshift(o)}return n}function Et(e,t){const n=Math.max(e.length,t.length),s=new Array(n);for(let r=0;r<n;r++){let o=e[e.length-r-1];o==null&&(o=1);let i=t[t.length-r-1];if(i==null&&(i=1),o===1)s[n-r-1]=i;else if(i===1)s[n-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(a)}else s[n-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(e,t){let n=F(e,"a","equal","string_or_numeric"),s=F(t,"b","equal","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(_p,r)}const Ir=W({equal_:oP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iP(e,t,n){const s=F(t,"a","where"),r=F(n,"b","where"),o=F(e,"condition","where","bool"),i=Et(Et(o.shape,s.shape),r.shape),a=Cl(o,i),c=Cl(s,i),l=Cl(r,i),u={condition:a,t:c,e:l};return V.runKernel(rm,u)}const wn=W({where_:iP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aP(e){const n={x:F(e,"x","zerosLike")};return V.runKernel(fm,n)}const Gt=W({zerosLike_:aP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cP(e,t){let n=F(e,"a","div"),s=F(t,"b","div");[n,s]=Ie(n,s);const r=yt(n,s),o=Gt(r),i=Ir(s,o);return wn(i,o,r)}const lP=W({divNoNan_:cP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uP(e,t){const n=F(e,"t1","dot"),s=F(t,"t2","dot");D((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],o=s.rank===1?s.size:s.shape[0];if(D(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),n.rank===1&&s.rank===1){const i=U(n,[1,-1]),a=U(s,[-1,1]),c=Vt(i,a);return U(c,[])}else if(n.rank===1&&s.rank===2){const i=U(n,[1,-1]),a=U(s,[s.shape[0],s.shape[1]]),c=Vt(i,a);return U(c,[c.size])}else if(n.rank===2&&s.rank===1){const i=U(s,[-1,1]),a=Vt(n,i);return U(a,[a.size])}else{const i=U(s,[s.shape[0],s.shape[1]]);return Vt(n,i)}}const hP=W({dot_:uP});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fP(e,...t){const n=t.map((r,o)=>F(r,`tensors${o}`,"einsum")),s={equation:e};return V.runKernel(Jx,n,s)}const Xc=W({einsum_:fP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(e){const n={x:F(e,"x","elu","float32")};return V.runKernel($u,n)}const bm=W({elu_:dP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(e){let t=F(e,"x","erf");D(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=ct(t,"float32"));const n={x:t};return V.runKernel(Cu,n)}const uS=W({erf_:pP});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ab(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function hS(e,t,n){const s=e.length+t.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(e[o++]):r.push(t[i++]);return r}function He(e,t){const n=[],s=e.length;for(let o=0;o<s;o++)t.indexOf(o)===-1&&n.push(e[o]);const r=t.map(o=>e[o]);return[n,r]}function Se(e,t){const n=t.map(s=>1);return hS(e,n,t)}function tn(e,t,n){D(Ab(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function me(e,t){if(Ab(e,t))return null;const n=[];for(let s=0;s<t;++s)e.indexOf(s)===-1&&n.push(s);return e.forEach(s=>n.push(s)),n}function qo(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function Ne(e,t){const n=[];for(let s=t-e;s<t;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mP(e,t=null,n=!1){const r={x:F(e,"x","max")},o={reductionIndices:t,keepDims:n};return V.runKernel(Bp,r,o)}const Qs=W({max_:mP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(e,t=null,n=!1){const r={x:F(e,"x","min")},o={axis:t,keepDims:n};return V.runKernel(Gp,r,o)}const Zf=W({min_:gP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xP(e,t){let n=F(e,"base","pow"),s=F(t,"exp","pow");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(zu,r)}const Ai=W({pow_:xP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(e,t){if((Ds(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Ds(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return mm(e,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bP(e){const n={x:F(e,"x","sqrt","float32")};return V.runKernel(Zu,n)}const xe=W({sqrt_:bP});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yP(e){const t=F(e,"x","square"),n={};return V.runKernel("Square",{x:t},n)}const ie=W({square_:yP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wP(e,t=null,n=!1){let s=F(e,"x","sum");s.dtype==="bool"&&(s=ct(s,"int32"));const r={x:s},o={axis:t,keepDims:n};return V.runKernel(im,r,o)}const xt=W({sum_:wP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vP(e,t="euclidean",n=null,s=!1){e=F(e,"x","norm");const r=fS(e,t,n);let o=r.shape;if(s){const i=Lt(n,e.shape);o=Se(r.shape,i)}return U(r,o)}function fS(e,t,n=null){if(e.rank===0)return ze(e);if(e.rank!==1&&n===null)return fS(U(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return xt(ze(e),n);if(t===1/0)return Qs(ze(e),n);if(t===-1/0)return Zf(ze(e),n);if(t==="euclidean"||t===2)return xe(xt(Ai(ze(e),Nt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Qs(xt(ze(e),n[0]),n[1]-1);if(t===1/0)return Qs(xt(ze(e),n[1]),n[0]);if(t===-1/0)return Zf(xt(ze(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return xe(xt(ie(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ym=W({norm_:vP});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $P(e,t=null,n=!1){return ym(e,"euclidean",t,n)}const CP=W({euclideanNorm_:$P});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kP(e){const n={x:F(e,"x","exp")};return V.runKernel(ku,n)}const ps=W({exp_:kP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IP(e,t=0){const n=F(e,"x","expandDims","string_or_numeric");D(t<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:t};return V.runKernel(Tp,s,r)}const Tn=W({expandDims_:IP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SP(e){const n={x:F(e,"x","expm1")};return V.runKernel(Iu,n)}const NP=W({expm1_:SP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _P(e,t){const n=F(e,"x","tile","string_or_numeric");D(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const s={x:n},r={reps:t};return V.runKernel(nh,s,r)}const On=W({tile_:_P});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TP(e,t,n,s="float32"){t==null&&(t=e);const r=Ot([e,t],s),o=e<=t?e:t;for(let a=0;a<o;++a)r.set(1,a,a);const i=U(r.toTensor(),[e,t]);if(n==null)return i;if(n.length===1)return On(Tn(i,0),[n[0],1,1]);if(n.length===2)return On(Tn(Tn(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return On(Tn(Tn(Tn(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const dS=W({eye_:TP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EP(e){const n={x:F(e,"x","floor","float32")};return V.runKernel(Su,n)}const wm=W({floor_:EP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RP(e,t,n=0,s=0){const r=F(e,"x","gather"),o=F(t,"indices","gather","int32"),i={x:r,indices:o},a={axis:n,batchDims:s};return V.runKernel(Rp,i,a)}const Is=W({gather_:RP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(e,t){let n=F(e,"a","greater","string_or_numeric"),s=F(t,"b","greater","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Ap,r)}const xs=W({greater_:AP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DP(e,t){let n=F(e,"a","greaterEqual","string_or_numeric"),s=F(t,"b","greaterEqual","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(_u,r)}const ta=W({greaterEqual_:DP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MP(e){const n={input:F(e,"input","imag")};return V.runKernel(ob,n)}const Db=W({imag_:MP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FP(e){const n={x:F(e,"x","isFinite")};return V.runKernel(Eu,n)}const OP=W({isFinite_:FP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(e){const n={x:F(e,"x","isInf")};return V.runKernel(Ru,n)}const PP=W({isInf_:LP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zP(e){const n={x:F(e,"x","isNaN")};return V.runKernel(Au,n)}const BP=W({isNaN_:zP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(e,t=.2){const s={x:F(e,"x","leakyRelu")},r={alpha:t};return V.runKernel(Dp,s,r)}const Mb=W({leakyRelu_:VP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WP(e,t){let n=F(e,"a","less","string_or_numeric"),s=F(t,"b","less","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Mp,r)}const Qf=W({less_:WP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(e,t){let n=F(e,"a","lessEqual","string_or_numeric"),s=F(t,"b","lessEqual","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Fp,r)}const _c=W({lessEqual_:UP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Di(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:e,stop:t,num:n};return V.runKernel(ib,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(e,t=5,n=1,s=1,r=.5){const o=F(e,"x","localResponseNormalization");D(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),D(Ha(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=U(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={x:i},l={depthRadius:t,bias:n,alpha:s,beta:r},u=V.runKernel(zp,c,l);return a?U(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const HP=W({localResponseNormalization_:GP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(e){const n={x:F(e,"x","log","float32")};return V.runKernel(Du,n)}const Ms=W({log_:qP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(e){const n={x:F(e,"x","log1p")};return V.runKernel(Mu,n)}const Fb=W({log1p_:XP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jP(e,t){D(X0(e),()=>"The f passed in variableGrads(f) must be a function"),D(t==null||Array.isArray(t)&&t.every(l=>l instanceof Kf),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const l in V.registeredVariables)t.push(V.registeredVariables[l])}const s=n?t.filter(l=>!l.trainable):null,r=t.length;t=t.filter(l=>l.trainable),D(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=V.gradients(e,t,null,o);D(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),D(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const c={};return t.forEach((l,u)=>{a[u]!=null&&(c[l.name]=a[u])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:i,grads:c}}function Mi(e){return V.customGrad(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(e){const n={x:F(e,"x","neg")};return V.runKernel(qp,n)}const he=W({neg_:KP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(e){const n={x:F(e,"x","softplus")};return V.runKernel(Yu,n)}const oh=W({softplus_:YP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZP(e){const t=F(e,"x","logSigmoid");return Mi(s=>({value:he(oh(he(s))),gradFunc:i=>P(i,Nc(he(s)))}))(t)}const QP=W({logSigmoid_:ZP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JP(e,t){let n=F(e,"a","sub"),s=F(t,"b","sub");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(Ju,r)}const lt=W({sub_:JP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(e,t=-1){const n=F(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Mi((r,o)=>{const a=Qs(r,t,!0),c=lt(r,a),l=lt(ct(c,"float32"),Ms(xt(ps(c),t,!0)));return o([l]),{value:l,gradFunc:(h,f)=>{const[d]=f,p=!0,g=ps(d);return lt(h,P(xt(h,t,p),g))}}})(n)}const pS=W({logSoftmax_:tz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ez(e,t=null,n=!1){const s=F(e,"x","logSumExp"),r=Lt(t,s.shape),o=Qs(s,r,!0),i=lt(s,o),a=ps(i),c=xt(a,r),l=Ms(c),u=nt(U(o,l.shape),l);if(n){const h=Se(u.shape,r);return U(u,h)}return u}const Ob=W({logSumExp_:ez});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(e,t){const n=F(e,"a","logicalAnd","bool"),s=F(t,"b","logicalAnd","bool");Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Op,r)}const Yr=W({logicalAnd_:nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sz(e){const n={x:F(e,"x","logicalNot","bool")};return V.runKernel(Lp,n)}const Lb=W({logicalNot_:sz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(e,t){const n=F(e,"a","logicalOr","bool"),s=F(t,"b","logicalOr","bool");Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Pp,r)}const mS=W({logicalOr_:rz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(e,t){const n=F(e,"a","logicalXor","bool"),s=F(t,"b","logicalXor","bool");return Et(n.shape,s.shape),Yr(mS(e,t),Lb(Yr(e,t)))}const iz=W({logicalXor_:oz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(e,t,n,s,r){const o=F(e,"x","maxPool"),i=1;let a=o,c=!1;o.rank===3&&(c=!0,a=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),D(an(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Hn("maxPool",s,r);const l={x:a},u={filterSize:t,strides:n,pad:s,dimRoundingMode:r},h=V.runKernel(Vp,l,u);return c?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Pb=W({maxPool_:az});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(e,t=[1,1,1],n,s,r,o="NDHWC"){const i=F(e,"x","maxPool3d");let a=i,c=!1;i.rank===4&&(c=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),D(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Hn("maxPool3d",s,r);const l={x:a},u={filterSize:t,strides:n,pad:s,dimRoundingMode:r,dataFormat:o},h=V.runKernel(Wp,l,u);return c?U(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const lz=W({maxPool3d_:cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(e,t){let n=F(e,"a","maximum"),s=F(t,"b","maximum");[n,s]=Ie(n,s),n.dtype==="bool"&&(n=ct(n,"int32"),s=ct(s,"int32")),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Fu,r)}const Xo=W({maximum_:uz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(e,t=null,n=!1){const r={x:F(e,"x","mean")},o={axis:t,keepDims:n};return V.runKernel(Up,r,o)}const $e=W({mean_:hz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(e,t="float32"){if(so(e),t==="complex64"){const s=Re(e,"float32"),r=Re(e,"float32");return Xa(s,r)}const n=on(K(e),t);return V.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ts(e,t="float32"){if(so(e),t==="complex64"){const s=ts(e,"float32"),r=Re(e,"float32");return Xa(s,r)}const n=Dx(K(e),t);return V.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gS(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let s=F(e,"x","meshgrid",e instanceof ve?e.dtype:"float32");if(t===void 0)return[s];let r=F(t,"y","meshgrid",t instanceof ve?t.dtype:"float32");const o=K(s.shape),i=K(r.shape);return n==="xy"?(s=U(s,[1,-1]),r=U(r,[-1,1]),[Vt(ts([i,1],s.dtype),s),Vt(r,ts([1,o],r.dtype))]):(s=U(s,[-1,1]),r=U(r,[1,-1]),[Vt(s,ts([1,i],s.dtype)),Vt(ts([o,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(e,t){let n=F(e,"a","minimum"),s=F(t,"b","minimum");[n,s]=Ie(n,s),n.dtype==="bool"&&(n=ct(n,"int32"),s=ct(s,"int32")),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Ou,r)}const Ya=W({minimum_:fz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(e,t,n){D(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=F(e,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");D(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)D(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),D(t[a][0]>=0&&t[a][0]<=s.shape[a]-r&&t[a][1]>=0&&t[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:t,mode:n},i={x:s};return V.runKernel(Hp,i,o)}const pz=W({mirrorPad_:dz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(e,t){let n=F(e,"a","mod"),s=F(t,"b","mod");[n,s]=Ie(n,s);const r={a:n,b:s};return V.runKernel(Lu,r)}const gz=W({mod_:mz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(e,t=null,n=!1){e=F(e,"x","moments");const s=Lt(t,e.shape),r=$e(e,s,n);let o=r.shape;n||(o=Se(r.shape,s));const i=ie(lt(ct(e,"float32"),U(r,o))),a=$e(i,s,n);return{mean:r,variance:a}}const zb=W({moments_:xz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(e,t){let n=F(e,"a","notEqual","string_or_numeric"),s=F(t,"b","notEqual","string_or_numeric");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Xp,r)}const Ol=W({notEqual_:bz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(e,t,n=1,s=0,r="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const i={indices:F(e,"indices","oneHot","int32")},a={dtype:r,depth:t,onValue:n,offValue:s};return V.runKernel(Kp,i,a)}const xS=W({oneHot_:yz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(e){const n={x:F(e,"x","onesLike")};return V.runKernel(jp,n)}const Fs=W({onesLike_:wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(e,t,n=0){const s=F(e,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:n},o={x:s};return V.runKernel(Zp,o,r)}const Bb=W({pad_:vz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(e,t,n){const s=F(e,"x","spaceToBatchND");D(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),D(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),D(s.shape.reduce((i,a,c)=>c>0&&c<=t.length?i&&(a+n[c-1][0]+n[c-1][1])%t[c-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const r={x:s},o={blockShape:t,paddings:n};return V.runKernel(am,r,o)}const Vb=W({spaceToBatchND_:$z});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(e,t,n,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=F(e,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(an(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const u=Ps(c.shape,t,o,r,s),h=[u.dilationHeight,u.dilationWidth];let f;s==="same"?f=Iz([u.filterHeight,u.filterWidth],h):f=[[0,0],[0,0]];const d=h[0]===1&&h[1]===1,[p,g]=kz([u.inHeight,u.inWidth],h,f),m=d?s:"valid",x=d?c:Vb(c,h,p),w=(n==="avg"?()=>Nb(x,t,o,m,i):()=>Pb(x,t,o,m,i))(),y=d?w:_b(w,h,g);return l?U(y,[y.shape[1],y.shape[2],y.shape[3]]):y}function kz(e,t,n){const s=n.map(u=>u[0]),r=n.map(u=>u[1]),o=e.concat(s,r),i=t.map((u,h)=>(u-o[h]%u)%u),a=r.map((u,h)=>u+i[h]),c=t.map((u,h)=>[s[h],a[h]]),l=t.map((u,h)=>[0,i[h]]);return[c,l]}function Iz(e,t){const s=e.map((i,a)=>i+(i-1)*(t[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const Sz=W({pool_:Cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(e,t){const n=F(e,"x","prelu"),s=F(t,"alpha","prelu"),r={x:n,alpha:s};return V.runKernel(Qp,r)}const Wb=W({prelu_:Nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(e,t=null,n=!1){let s=F(e,"x","prod");s.dtype==="bool"&&(s=ct(s,"int32"));const r={x:s},o={axis:t,keepDims:n};return V.runKernel(Jp,r,o)}const Tz=W({prod_:_z});var kf={exports:{}},Ez=kf.exports,s2;function Rz(){return s2||(s2=1,function(e){(function(t,n,s){function r(c){var l=this,u=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(c),l.s0<0&&(l.s0+=1),l.s1-=u(c),l.s1<0&&(l.s1+=1),l.s2-=u(c),l.s2<0&&(l.s2+=1),u=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var u=new r(c),h=l&&l.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,u),f.state=function(){return o(u,{})}),f}function a(){var c=4022871197,l=function(u){u=String(u);for(var h=0;h<u.length;h++){c+=u.charCodeAt(h);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:this.alea=i})(Ez,e)}(kf)),kf.exports}var If={exports:{}},Az=If.exports,r2;function Dz(){return r2||(r2=1,function(e){(function(t,n,s){function r(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new r(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&o(u,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=i:this.xor128=i})(Az,e)}(If)),If.exports}var Sf={exports:{}},Mz=Sf.exports,o2;function Fz(){return o2||(o2=1,function(e){(function(t,n,s){function r(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,u==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new r(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&o(u,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=i:this.xorwow=i})(Mz,e)}(Sf)),Sf.exports}var Nf={exports:{}},Oz=Nf.exports,i2;function Lz(){return i2||(i2=1,function(e){(function(t,n,s){function r(a){var c=this;c.next=function(){var u=c.x,h=c.i,f,d;return f=u[h],f^=f>>>7,d=f^f<<24,f=u[h+1&7],d^=f^f>>>10,f=u[h+3&7],d^=f^f>>>3,f=u[h+4&7],d^=f^f<<7,f=u[h+7&7],f=f^f<<13,d^=f^f<<9,u[h]=d,c.i=h+1&7,d};function l(u,h){var f,d=[];if(h===(h|0))d[0]=h;else for(h=""+h,f=0;f<h.length;++f)d[f&7]=d[f&7]<<15^h.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],u.x=d,u.i=0,f=256;f>0;--f)u.next()}l(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,u&&(u.x&&o(u,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=i:this.xorshift7=i})(Oz,e)}(Nf)),Nf.exports}var _f={exports:{}},Pz=_f.exports,a2;function zz(){return a2||(a2=1,function(e){(function(t,n,s){function r(a){var c=this;c.next=function(){var u=c.w,h=c.X,f=c.i,d,p;return c.w=u=u+1640531527|0,p=h[f+34&127],d=h[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=h[f]=p^d,c.i=f,p+(u^u>>>16)|0};function l(u,h){var f,d,p,g,m,x=[],b=128;for(h===(h|0)?(d=h,h=null):(h=h+"\0",d=0,b=Math.max(b,h.length)),p=0,g=-32;g<b;++g)h&&(d^=h.charCodeAt((g+32)%h.length)),g===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,g>=0&&(m=m+1640531527|0,f=x[g&127]^=d+m,p=f==0?p+1:0);for(p>=128&&(x[(h&&h.length||0)&127]=-1),p=127,g=4*128;g>0;--g)d=x[p+34&127],f=x[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,x[p]=d^f;u.w=m,u.X=x,u.i=p}l(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,u&&(u.X&&o(u,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=i:this.xor4096=i})(Pz,e)}(_f)),_f.exports}var Tf={exports:{}},Bz=Tf.exports,c2;function Vz(){return c2||(c2=1,function(e){(function(t,n,s){function r(a){var c=this,l="";c.next=function(){var h=c.b,f=c.c,d=c.d,p=c.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-d|0,c.d=d<<16^f>>>16^p,c.a=p-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var u=0;u<l.length+20;u++)c.b^=l.charCodeAt(u)|0,c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new r(a),u=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(f+d)/(1<<21);while(p===0);return p},h.int32=l.next,h.quick=h,u&&(typeof u=="object"&&o(u,l),h.state=function(){return o(l,{})}),h}n&&n.exports?n.exports=i:this.tychei=i})(Bz,e)}(Tf)),Tf.exports}var Ef={exports:{}};const Wz={},Uz=Object.freeze(Object.defineProperty({__proto__:null,default:Wz},Symbol.toStringTag,{value:"Module"})),Gz=PO(Uz);var Hz=Ef.exports,l2;function qz(){return l2||(l2=1,function(e){(function(t,n,s){var r=256,o=6,i=52,a="random",c=s.pow(r,o),l=s.pow(2,i),u=l*2,h=r-1,f;function d(y,v,$){var I=[];v=v==!0?{entropy:!0}:v||{};var N=x(m(v.entropy?[y,w(n)]:y??b(),3),I),k=new p(I),S=function(){for(var C=k.g(o),A=c,R=0;C<l;)C=(C+R)*r,A*=r,R=k.g(1);for(;C>=u;)C/=2,A/=2,R>>>=1;return(C+R)/A};return S.int32=function(){return k.g(4)|0},S.quick=function(){return k.g(4)/4294967296},S.double=S,x(w(k.S),n),(v.pass||$||function(C,A,R,_){return _&&(_.S&&g(_,k),C.state=function(){return g(k,{})}),R?(s[a]=C,A):C})(S,N,"global"in v?v.global:this==s,v.state)}function p(y){var v,$=y.length,I=this,N=0,k=I.i=I.j=0,S=I.S=[];for($||(y=[$++]);N<r;)S[N]=N++;for(N=0;N<r;N++)S[N]=S[k=h&k+y[N%$]+(v=S[N])],S[k]=v;(I.g=function(C){for(var A,R=0,_=I.i,T=I.j,E=I.S;C--;)A=E[_=h&_+1],R=R*r+E[h&(E[_]=E[T=h&T+A])+(E[T]=A)];return I.i=_,I.j=T,R})(r)}function g(y,v){return v.i=y.i,v.j=y.j,v.S=y.S.slice(),v}function m(y,v){var $=[],I=typeof y,N;if(v&&I=="object")for(N in y)try{$.push(m(y[N],v-1))}catch{}return $.length?$:I=="string"?y:y+"\0"}function x(y,v){for(var $=y+"",I,N=0;N<$.length;)v[h&N]=h&(I^=v[h&N]*19)+$.charCodeAt(N++);return w(v)}function b(){try{var y;return f&&(y=f.randomBytes)?y=y(r):(y=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(y)),w(y)}catch{var v=t.navigator,$=v&&v.plugins;return[+new Date,t,$,t.screen,w(n)]}}function w(y){return String.fromCharCode.apply(0,y)}if(x(s.random(),n),e.exports){e.exports=d;try{f=Gz}catch{}}else s["seed"+a]=d})(typeof self<"u"?self:Hz,[],Math)}(Ef)),Ef.exports}var Gg,u2;function Xz(){if(u2)return Gg;u2=1;var e=Rz(),t=Dz(),n=Fz(),s=Lz(),r=zz(),o=Vz(),i=qz();return i.alea=e,i.xor128=t,i.xorwow=n,i.xorshift7=s,i.xor4096=r,i.tychei=o,Gg=i,Gg}var Ub=Xz();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bS{constructor(t,n,s,r,o){this.mean=t,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Ub.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let t,n,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class jz{constructor(t=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=Ub.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(e,t=0,n=1,s,r){if(so(e),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new bS(t,n,s,!1,r),i=Ot(e,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Oa=W({randomNormal_:Kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(e,t=0,n=1,s="float32",r){so(e);const o=Ot(e,s),i=new jz(t,n,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Zr=W({randomUniform_:Yz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ll(e,t,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:e,stop:t,step:n,dtype:s};return V.runKernel(db,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(e){const n={input:F(e,"input","real")};return V.runKernel(pb,n)}const Jf=W({real_:Zz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(e){const n={x:F(e,"x","reciprocal")};return V.runKernel(Bu,n)}const Jz=W({reciprocal_:Qz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(e){const n={x:F(e,"x","relu")};return V.runKernel(Vu,n)}const io=W({relu_:t6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(e){const n={x:F(e,"x","relu6")};return V.runKernel(Wu,n)}const yS=W({relu6_:e6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(e,t){const s={x:F(e,"x","reverse")},r={dims:t};return V.runKernel(sm,s,r)}const Fi=W({reverse_:n6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(e){const n={x:F(e,"x","round")};return V.runKernel(Uu,n)}const wS=W({round_:s6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(e){const n={x:F(e,"x","rsqrt","float32")};return V.runKernel(Gu,n)}const vS=W({rsqrt_:r6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(e){const n={x:F(e,"x","selu")};return V.runKernel(Hu,n)}const $S=W({selu_:o6});function i6(e,t,n,s,r,o=[1,1],i="NHWC"){const a=F(e,"x","separableConv2d"),c=F(t,"depthwiseFilter","separableConv2d"),l=F(n,"pointwiseFilter","separableConv2d");let u=a,h=!1;if(a.rank===3&&(h=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),D(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),D(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),D(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),D(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const f=c.shape[2],d=c.shape[3];D(l.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${l.shape[2]}.`);const p=Rb(u,c,s,r,i,o),m=Ri(p,l,1,"valid",i);return h?U(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const CS=W({separableConv2d_:i6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(e){const n={x:F(e,"x","sign")};return V.runKernel(ju,n)}const c6=W({sign_:a6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(e){const n={x:F(e,"x","sin","float32")};return V.runKernel(qu,n)}const kS=W({sin_:l6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(e){const n={x:F(e,"x","sinh")};return V.runKernel(Xu,n)}const IS=W({sinh_:u6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(e,t,n){const s=F(e,"x","slice1d");return D(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),se(s,[t],[n])}const Gb=W({slice1d_:h6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(e,t,n){const s=F(e,"x","slice2d");return D(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),se(s,t,n)}const SS=W({slice2d_:f6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(e,t,n){const s=F(e,"x","slice3d");return D(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),se(s,t,n)}const Hb=W({slice3d_:d6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(e,t,n){const s=F(e,"x","slice4d");return D(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),se(s,t,n)}const td=W({slice4d_:p6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(e,t=-1){const n=F(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const s={logits:n},r={dim:t};return V.runKernel(lm,s,r)}const qb=W({softmax_:m6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(e){D(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return V.runKernel(eb,t)}const NS=W({fft_:g6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(e){D(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return V.runKernel(rb,t)}const c1=W({ifft_:x6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(e){const t=e.shape[e.shape.length-1],n=e.size/t;let s;if(t<=2){const r=U(e,[n,t]);s=c1(r)}else{const r=[n,2*(t-1)],o=U(Jf(e),[n,t]),i=U(Db(e),[n,t]),a=Fi(se(o,[0,1],[n,t-2]),1),c=P(Fi(se(i,[0,1],[n,t-2]),1),Nt(-1)),l=Ze([o,a],1),u=Ze([i,c],1),h=U(Xa(l,u),[r[0],r[1]]);s=c1(h)}if(s=Jf(s),e.rank===3&&e.shape[0]!==0){const r=s,o=e.shape[0];s=U(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const y6=W({irfft_:b6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(e,t,n=0){const r={x:F(e,"x","split")},o={numOrSizeSplits:t,axis:n};return V.runKernel(cm,r,o)}const fs=W({split_:w6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(e,t){D(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const s=e.size/n;let r;if(t!=null&&t<n){const p=e.shape.map(m=>0),g=e.shape.map(m=>m);g[e.shape.length-1]=t,r=se(e,p,g),n=t}else if(t!=null&&t>n){const p=e.shape.map(g=>g);p[e.shape.length-1]=t-n,r=Ze([e,Re(p)],e.shape.length-1),n=t}else r=e;const o=Gt(r),i=U(Xa(r,o),[s,n]),a=NS(i),c=Math.floor(n/2)+1,l=Jf(a),u=Db(a),h=fs(l,[c,n-c],l.shape.length-1),f=fs(u,[c,n-c],u.shape.length-1),d=r.shape.slice();return d[r.shape.length-1]=c,U(Xa(h[0],f[0]),d)}const $6=W({rfft_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(e,t){let n=F(e,"a","squaredDifference"),s=F(t,"b","squaredDifference");[n,s]=Ie(n,s),Et(n.shape,s.shape);const r={a:n,b:s},o={};return V.runKernel(Qu,r,o)}const _S=W({squaredDifference_:C6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(e,t){const n=F(e,"x","squeeze","string_or_numeric");return U(n,Uo(n.shape,t).newShape)}const ih=W({squeeze_:k6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(e,t=0){const n=jI(e,"tensors","stack","string_or_numeric");D(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&D(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:t};return V.runKernel(Yp,s,r)}const vn=W({stack_:I6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(e,t=0){const s={x:F(e,"x","step")},r={alpha:t};return V.runKernel(sh,s,r)}const ah=W({step_:S6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(e,t,n,s,r=0,o=0,i=0,a=0,c=0){const u={x:F(e,"x","stridedSlice","string_or_numeric")},h={begin:t,end:n,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return V.runKernel(yb,u,h)}const _6=W({stridedSlice_:N6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(e){const n={x:F(e,"x","tan","float32")};return V.runKernel(th,n)}const E6=W({tan_:T6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function es(e,t){oI(e);const n=pm(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return mm(e,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hg(e,t,n){if(oI(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=pm(e,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return mm(e,t,s,n)}function TS(e,t,n){const s=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(o+` update.rank < ${r}. `);if(e.length<s+(n.rank-r))throw new Error(o+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+e.length-s)throw new Error(o+` update.rank != ${r+e.length-s}`);for(let i=0;i<r;++i)if(n.shape[i]!==t.shape[i])throw new Error(o+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<n.rank-r;++i)if(n.shape[i+r]!==e[i+s])throw new Error(o+` updates.shape[${i+r}] (${n.shape[i+r]}) != shape[${i+r}] (${e[i+r]})`)}function R6(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}TS(n,t,e)}function ea(e,t,n){const s=t.shape.length,r=s>1?t.shape[s-1]:1,o=n.length;let i=1;for(let h=r;h<o;++h)i*=n[h];const a=r<1?1:r,c=K(t.shape)/a,l=[...vt(n.slice(0,r)),1],u=K(n);return{sliceRank:r,numUpdates:c,sliceSize:i,strides:l,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(e,t=1,n=!0){const s=F(e,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${t}`);const o={x:s},i={k:t,sorted:n},[a,c]=V.runKernel(wb,o,i);return{values:a,indices:c}}const D6=W({topk_:A6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(e,t=0,n=1,s,r){if(so(e),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new bS(t,n,s,!0,r),i=Ot(e,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const ES=W({truncatedNormal_:M6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(e,t=0){const n=F(e,"x","unique","string_or_numeric");D(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:t},[o,i]=V.runKernel($b,s,r);return{values:o,indices:i}}const O6=W({unique_:F6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(e,t,n){const s=F(e,"x","unsortedSegmentSum"),r=F(t,"segmentIds","unsortedSegmentSum","int32");D(Ha(n),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:n};return V.runKernel(hm,o,i)}const RS=W({unsortedSegmentSum_:L6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6(e,t=0){const n=F(e,"x","unstack","string_or_numeric");D(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:t};return V.runKernel(um,s,r)}const Oi=W({unstack_:P6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6(e,t=!0,n,s){return V.makeVariable(e,t,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AS(e,t){const n=[];for(let o=0;o<t.length;o++)t[o]&&n.push(o);const s=Ot(e,"int32"),r=Ot([n.length,e.length],"int32");for(let o=0;o<n.length;o++){const i=s.indexToLoc(n[o]),a=o*e.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(e,t,n){const s=F(e,"x","transpose");if(t==null&&(t=s.shape.map((i,a)=>a).reverse()),D(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(i=>{D(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:t};return s.dtype==="complex64"?H(()=>{let i=Jf(s),a=Db(s);return i=V.runKernel(Ma,{x:i},o),a=V.runKernel(Ma,{x:a},o),n&&(a=he(a)),Xa(i,a)}):V.runKernel(Ma,r,o)}const Wt=W({transpose_:B6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(e,t){if(t==null)return e.shape.slice();if(Xt(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let s=0;s<e.shape.length;s++)t[s]==null&&e.shape[s]!=null?n.push(e.shape[s]):n.push(t[s]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(e,t,n,s){const r=F(e,"x","dropout");if(D(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),D(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof ve?r.clone():r;const o=V6(r,n),i=1-t,a=yt(wm(nt(Zr(o,0,1,"float32",s),i)),i);return P(r,a)}const U6=W({dropout_:W6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G6(e,t,n,s,r,o="NHWC",i){let a=e;e.rank===3&&(a=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;c.rank===3&&(c=U(t,[1,t.shape[0],t.shape[1],t.shape[2]])),D(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),D(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),D(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const l=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?c.shape[3]:c.shape[1];D(l===n[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`),D(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),Hn("conv2dDerFilter",r,i);const h={x:a,dy:c},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:n};return V.runKernel(Gx,h,f)}const Xb=W({conv2DBackpropFilter_:G6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jb(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return P(e,ah(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Kb(e,t){let n=t;const s=Oe(e.shape,t.shape);return s.length>0&&(n=xt(n,s)),U(n,e.shape)}function Yb(e,t,n,s){if(t==="linear")return e;if(t==="relu")return io(e);if(t==="elu")return bm(e);if(t==="relu6")return yS(e);if(t==="prelu")return Wb(e,n);if(t==="leakyrelu")return Mb(e,s);if(t==="sigmoid")return Nc(e);throw new Error(`Unknown fused activation ${t}.`)}const Zb=(e,t)=>!(e>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6({x:e,filter:t,strides:n,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:u}){if(c=c||"linear",Zb(V.state.gradientDepth,c)===!1){D(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Ri(e,t,n,s,r,o,i);return a!=null&&($=nt($,a)),Yb($,c,l,u)}const h=F(e,"x","conv2d","float32"),f=F(t,"filter","conv2d","float32");let d=h,p=!1;h.rank===3&&(p=!0,d=U(h,[1,h.shape[0],h.shape[1],h.shape[2]])),D(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),D(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Hn("fused conv2d",s,i);const g=r==="NHWC"?d.shape[3]:d.shape[1];D(f.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),D(an(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const m=Je(d.shape,f.shape,n,o,s,i);let x;a!=null&&(x=F(a,"bias","fused conv2d"),[x]=Ie(x,h),r==="NHWC"?Et(m.outShape,x.shape):(D(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),D(x.shape.length===0||x.shape[0]===m.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let b;if(l!=null){const $=l.shape;if(D($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)D($[0]===1||$[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${m.outChannels}).`);else if($.length===3)try{Et($,m.outShape)}catch{const N=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(N)}b=F(l,"prelu weights","fused conv2d")}const w=($,I)=>{D(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[N,k,S,C]=I,A=jb($,S,c);D(Ti(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const R=Tb(k.shape,A,N,n,s),_=Xb(k,A,N.shape,n,s),T=[R,_];if(C!=null){const E=Kb(C,A);T.push(E)}return T},y={x:d,filter:f,bias:x,preluActivationWeights:b},v={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:c,leakyreluAlpha:u};return a==null?Mi((I,N,k)=>{let S=V.runKernel(Xf,y,v);return k([N,I,S]),p&&(S=U(S,[S.shape[1],S.shape[2],S.shape[3]])),{value:S,gradFunc:w}})(d,f):Mi((I,N,k,S)=>{let C=V.runKernel(Xf,y,v);return S([N,I,C,k]),p&&(C=U(C,[C.shape[1],C.shape[2],C.shape[3]])),{value:C,gradFunc:w}})(d,f,x)}const q6=W({fusedConv2d_:H6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(e,t,n,s,r,o=[1,1],i){let a=e;e.rank===3&&(a=U(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;c.rank===3&&(c=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:c},u={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:n};return V.runKernel(Zx,l,u)}const j6=W({depthwiseConv2dNativeBackpropFilter_:X6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(e,t,n,s,r,o=[1,1],i){let a=t,c=!1;t.rank===3&&(c=!0,a=U(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:n},u={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:e},h=V.runKernel(Qx,l,u);return c?U(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Y6=W({depthwiseConv2dNativeBackpropInput_:K6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6({a:e,b:t,transposeA:n=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Zb(V.state.gradientDepth,o)===!1){let C=Vt(e,t,n,s);return r!=null&&(C=nt(C,r)),Yb(C,o,i,a)}let c=F(e,"a","fused matMul"),l=F(t,"b","fused matMul");[c,l]=Ie(c,l);const u=n?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],f=n?c.shape[c.rank-1]:c.shape[c.rank-2],d=s?l.shape[l.rank-2]:l.shape[l.rank-1],p=c.shape.slice(0,-2),g=l.shape.slice(0,-2),m=K(p),x=K(g);D(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${n} and transposeB=${s} must match.`);const w=Et(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([f,d]),y=n?U(c,[m,u,f]):U(c,[m,f,u]),v=s?U(l,[x,d,h]):U(l,[x,h,d]);let $;r!=null&&($=F(r,"bias","fused matMul"),[$]=Ie($,c),Et(w,$.shape));let I;i!=null&&(I=F(i,"prelu weights","fused matMul"));const N=(C,A)=>{const[R,_,T,E]=A,M=jb(U(C,T.shape),T,o);let O,L;if(!n&&!s?(O=Vt(M,_,!1,!0),L=Vt(R,M,!0,!1)):!n&&s?(O=Vt(M,_,!1,!1),L=Vt(M,R,!0,!1)):n&&!s?(O=Vt(_,M,!1,!0),L=Vt(R,M,!1,!1)):(O=Vt(_,M,!0,!0),L=Vt(M,R,!0,!0)),r!=null){const B=Kb(E,M);return[O,L,B]}else return[O,L]},k={a:y,b:v,bias:$,preluActivationWeights:I},S={transposeA:n,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?Mi((A,R,_)=>{const T=V.runKernel(qf,k,S);return _([A,R,T]),{value:U(T,w),gradFunc:N}})(y,v):Mi((A,R,_,T)=>{const E=V.runKernel(qf,k,S);return T([A,R,E,_]),{value:U(E,w),gradFunc:N}})(y,v,$)}const h2=W({fusedMatMul_:Z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(e,t,n,s,r="bilinear",o=0){const i=F(e,"image","cropAndResize"),a=F(t,"boxes","cropAndResize","float32"),c=F(n,"boxInd","cropAndResize","int32"),l=a.shape[0];D(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),D(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),D(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),D(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),D(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),D(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:i,boxes:a,boxInd:c},h={method:r,extrapolationValue:o,cropSize:s};return V.runKernel(jx,u,h)}const J6=W({cropAndResize_:Q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(e){const t=F(e,"image","flipLeftRight","float32");D(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return V.runKernel(sb,n,{})}const eB=W({flipLeftRight_:tB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(e){const t=F(e,"image","grayscaleToRGB"),n=t.rank-1,s=t.shape[n];D(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),D(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(t.rank);return r.fill(1,0,n),r[n]=3,On(t,r)}const sB=W({grayscaleToRGB_:nB});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(e){const t=F(e,"image","RGBToGrayscale"),n=t.rank-1,s=t.shape[n];D(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),D(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=t.dtype,o=ct(t,"float32"),i=es([.2989,.587,.114]);let a;switch(t.rank){case 2:a=Xc("ij,j->i",o,i);break;case 3:a=Xc("ijk,k->ij",o,i);break;case 4:a=Xc("ijkl,l->ijk",o,i);break;case 5:a=Xc("ijklm,m->ijkl",o,i);break;case 6:a=Xc("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Tn(a,-1),ct(a,r)}const oB=W({rgbToGrayscale_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(e,t,n=0,s=.5){const r=F(e,"image","rotateWithOffset","float32");D(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:t,fillValue:n,center:s};return V.runKernel(Cb,o,i)}const aB=W({rotateWithOffset_:iB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tc(e,t,n,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=e.shape[0];return n=Math.min(n,i),D(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),D(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),D(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),D(t.rank===1,()=>"scores must be a 1D tensor"),D(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),D(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(e,"boxes","nonMaxSuppression","float32"),i=F(t,"scores","nonMaxSuppression","float32"),a=Tc(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return V.runKernel(ub,{boxes:o,scores:i},c)}const lB=W({nonMaxSuppression_:cB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(e,t,n){const s=hB(e,t,n),r=s<0?-(s+1):s;e.splice(r,0,t)}function hB(e,t,n){return dB(e,t,n||fB)}function fB(e,t){return e>t?1:e<t?-1:0}function dB(e,t,n){let s=0,r=e.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=n(t,e[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qb(e,t,n,s,r){return ey(e,t,n,s,r,0)}function Jb(e,t,n,s,r,o){return ey(e,t,n,s,r,0,!1,o,!0)}function ty(e,t,n,s,r,o){return ey(e,t,n,s,r,o,!0)}function ey(e,t,n,s,r,o,i=!1,a=!1,c=!1){const l=[];for(let m=0;m<t.length;m++)t[m]>r&&l.push({score:t[m],boxIndex:m,suppressBeginIndex:0});l.sort(f2);const u=o>0?-.5/o:0,h=[],f=[];for(;h.length<n&&l.length>0;){const m=l.pop(),{score:x,boxIndex:b,suppressBeginIndex:w}=m;if(x<r)break;let y=!1;for(let v=h.length-1;v>=w;--v){const $=pB(e,b,h[v]);if($>=s){y=!0;break}if(m.score=m.score*mB(s,u,$),m.score<=r)break}m.suppressBeginIndex=h.length,y||(m.score===x?(h.push(b),f.push(m.score)):m.score>r&&uB(l,m,f2))}const d=h.length,p=n-d;a&&p>0&&(h.push(...new Array(p).fill(0)),f.push(...new Array(p).fill(0)));const g={selectedIndices:h};return i&&(g.selectedScores=f),c&&(g.validOutputs=d),g}function pB(e,t,n){const s=e.subarray(t*4,t*4+4),r=e.subarray(n*4,n*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),d=(a-o)*(c-i),p=(h-l)*(f-u);if(d<=0||p<=0)return 0;const g=Math.max(o,l),m=Math.max(i,u),x=Math.min(a,h),b=Math.min(c,f),w=Math.max(x-g,0)*Math.max(b-m,0);return w/(d+p-w)}function mB(e,t,n){const s=Math.exp(t*n*n);return n<=e?s:0}function f2(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gB(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(e,"boxes","nonMaxSuppressionAsync"),i=F(t,"scores","nonMaxSuppressionAsync"),a=Tc(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c=await Promise.all([o.data(),i.data()]),l=c[0],u=c[1],{selectedIndices:h}=Qb(l,u,n,s,r);return o!==e&&o.dispose(),i!==t&&i.dispose(),es(h,"int32")}const xB=gB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(e,"boxes","nonMaxSuppression"),a=F(t,"scores","nonMaxSuppression"),c=Tc(i,a,n,s,r,o);n=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l={boxes:i,scores:a},u={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},h=V.runKernel(fb,l,u);return{selectedIndices:h[0],selectedScores:h[1]}}const yB=W({nonMaxSuppressionWithScore_:bB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function wB(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(e,"boxes","nonMaxSuppressionAsync"),a=F(t,"scores","nonMaxSuppressionAsync"),c=Tc(i,a,n,s,r,o);n=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l=await Promise.all([i.data(),a.data()]),u=l[0],h=l[1],{selectedIndices:f,selectedScores:d}=ty(u,h,n,s,r,o);return i!==e&&i.dispose(),a!==t&&a.dispose(),{selectedIndices:es(f,"int32"),selectedScores:es(d)}}const vB=wB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(e,"boxes","nonMaxSuppression"),a=F(t,"scores","nonMaxSuppression"),c=Tc(i,a,n,s,r,null),l=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,f={boxes:i,scores:a},d={maxOutputSize:l,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:o},p=V.runKernel(hb,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}const CB=W({nonMaxSuppressionPadded_:$B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function kB(e,t,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(e,"boxes","nonMaxSuppressionAsync"),a=F(t,"scores","nonMaxSuppressionAsync"),c=Tc(i,a,n,s,r,null),l=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,[f,d]=await Promise.all([i.data(),a.data()]),{selectedIndices:p,validOutputs:g}=Jb(f,d,l,u,h,o);return i!==e&&i.dispose(),a!==t&&a.dispose(),{selectedIndices:es(p,"int32"),validOutputs:Nt(g,"int32")}}const IB=kB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(e,t,n=!1,s=!1){const r=F(e,"images","resizeBilinear");D(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),D(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),D(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:n,halfPixelCenters:s,size:t},l=V.runKernel(nm,a,c);return i?U(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const DS=W({resizeBilinear_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(e,t,n=!1,s=!1){const r=F(e,"images","resizeNearestNeighbor");D(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),D(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),D(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),D(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=U(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:n,halfPixelCenters:s,size:t},l=V.runKernel(em,a,c);return i?U(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const MS=W({resizeNearestNeighbor_:NB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(e,t="binary",n=!1,s=.5){const r=F(e,"image","threshold"),o=.2989,i=.587,a=.114,c=r.shape[0]*r.shape[1];let l=P(es([s]),255),u,h,f,d;if(D(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),D(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),D(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),D(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),r.shape[2]===3){[u,h,f]=fs(r,[1,1,1],-1);const m=P(u,o),x=P(h,i),b=P(f,a);d=nt(nt(m,x),b)}else d=e;if(t==="otsu"){const m=NL(ct(wS(d),"int32"),Zs([]),256);l=TB(m,c)}const p=n?_c(d,l):xs(d,l);return ct(P(p,255),"int32")}function TB(e,t){let n=es([-1]),s=es([0]),r=es([0]),o,i,a,c,l,u;for(let h=0;h<e.size-1;h++){o=se(e,0,h+1),i=se(e,h+1),l=yt(xt(o),t),u=yt(xt(i),t);const f=xt(P(o,Ll(0,o.size)));a=yt(f,xt(o));const d=ja(i.shape,o.size),p=nt(Ll(0,i.size),d),g=P(i,p);c=yt(xt(g),xt(i));const m=lt(a,c),x=lt(a,c),b=P(l,u);r=P(P(b,m),x);const w=xs(r,s);s=wn(w,r,s),n=wn(w,es([h]),n)}return n}const EB=W({threshold_:_B});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(e,t,n="nearest",s="constant",r=0,o){const i=F(e,"image","transform","float32"),a=F(t,"transforms","transform","float32");D(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),D(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),D(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const c={image:i,transforms:a},l={interpolation:n,fillMode:s,fillValue:r,outputShape:o};return V.runKernel(vb,c,l)}const AB=W({transform_:RB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(e,t,n){const s=F(e,"a","bandPart");D(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,c;typeof t=="number"?(D(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),D(t<=o,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${o}).`),a=F(t<0?o:t,"numLower","bandPart")):(D(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=wn(Qf(t,0),o,Ya(t,o))),typeof n=="number"?(D(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),D(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),c=F(n<0?i:n,"numUpper","bandPart")):(D(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=wn(Qf(n,0),i,Ya(n,i)));const l=U(Ll(0,o,1,"int32"),[-1,1]),u=Ll(0,i,1,"int32"),h=lt(l,u),f=Yr(_c(h,a),ta(h,he(c))),d=Re([o,i],s.dtype);return U(vn(Oi(U(s,[-1,o,i])).map(p=>wn(f,p,d))),r)}const MB=W({bandPart_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(e){let t;if(Array.isArray(e)){t=!1,D(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=e[0].shape[0];for(let o=1;o<e.length;++o)D(e[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[o].shape[0]} vs. ${r})`)}else t=!0,e=fs(e,e.shape[0],0).map(r=>ih(r,[0]));D(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],s=e;for(let r=0;r<e.length;++r)n.push(V.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=P(xt(P(n[i],o)),n[i]);o=lt(o,a)}return yt(o,ym(o,"euclidean"))}));return t?vn(n,0):n}const OB=W({gramSchmidt_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(e,t=!1){if(D(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return d2(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((c,l)=>c*l),s=Oi(U(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),r=[],o=[];s.forEach(c=>{const[l,u]=d2(c,t);r.push(l),o.push(u)});const i=U(vn(r,0),e.shape),a=U(vn(o,0),e.shape);return[i,a]}}function d2(e,t=!1){return V.tidy(()=>{D(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],s=e.shape[1];let r=dS(n),o=bi(e);const i=Hg([[1]],[1,1]);let a=bi(i);const c=n>=s?s:n;for(let l=0;l<c;++l){const u=o,h=a,f=r;[a,o,r]=V.tidy(()=>{const d=se(o,[l,l],[n-l,1]),p=ym(d),g=se(o,[l,l],[1,1]),m=wn(xs(g,0),Hg([[-1]]),Hg([[1]])),x=lt(g,P(m,p)),b=yt(d,x);b.shape[0]===1?a=bi(i):a=Ze([i,se(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const w=he(yt(Vt(m,x),p)),y=se(o,[l,0],[n-l,s]),v=P(w,a),$=Wt(a);if(l===0)o=lt(y,Vt(v,Vt($,y)));else{const k=lt(y,Vt(v,Vt($,y)));o=Ze([se(o,[0,0],[l,s]),k],0)}const I=Wt(v),N=se(r,[0,l],[n,r.shape[1]-l]);if(l===0)r=lt(N,Vt(Vt(N,a),I));else{const k=lt(N,Vt(Vt(N,a),I));r=Ze([se(r,[0,0],[n,l]),k],1)}return[a,o,r]}),zt([u,h,f])}return!t&&n>s&&(r=se(r,[0,0],[n,s]),o=se(o,[0,0],[s,s])),[r,o]})}const PB=W({qr_:LB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Mn;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mn||(Mn={}));function zB(e,t,n=Mn.SUM_BY_NONZERO_WEIGHTS){const s=F(e,"losses","computeWeightedLoss");let r=null;t!=null&&(r=F(t,"weights","computeWeightedLoss"));const o=r==null?s:P(s,r);if(n===Mn.NONE)return o;if(n===Mn.SUM)return xt(o);if(n===Mn.MEAN){if(r==null)return $e(o);{const i=s.size/r.size,a=yt(xt(o),xt(r));return i>1?yt(a,Nt(i)):a}}if(n===Mn.SUM_BY_NONZERO_WEIGHTS){if(r==null)return yt(xt(o),Nt(s.size));{const i=P(r,ts(s.shape)),a=ct(xt(Ol(i,Nt(0))),"float32");return yt(xt(o),a)}}throw Error(`Unknown reduction: ${n}`)}const ao=W({computeWeightedLoss_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(e,t,n,s=Mn.SUM_BY_NONZERO_WEIGHTS){const r=F(e,"labels","absoluteDifference"),o=F(t,"predictions","absoluteDifference");let i=null;n!=null&&(i=F(n,"weights","absoluteDifference")),Ls(r.shape,o.shape,"Error in absoluteDifference: ");const a=ze(lt(r,o));return ao(a,i,s)}const VB=W({absoluteDifference_:BB});function WB(e,t,n,s,r=Mn.SUM_BY_NONZERO_WEIGHTS){const o=F(e,"labels","cosineDistance"),i=F(t,"predictions","cosineDistance");let a=null;s!=null&&(a=F(s,"weights","cosineDistance")),Ls(o.shape,i.shape,"Error in cosineDistance: ");const c=Nt(1),l=lt(c,xt(P(o,i),n,!0));return ao(l,a,r)}const UB=W({cosineDistance_:WB});function GB(e,t,n,s=Mn.SUM_BY_NONZERO_WEIGHTS){let r=F(e,"labels","hingeLoss");const o=F(t,"predictions","hingeLoss");let i=null;n!=null&&(i=F(n,"weights","hingeLoss")),Ls(r.shape,o.shape,"Error in hingeLoss: ");const a=Nt(1);r=lt(P(Nt(2),r),a);const c=io(lt(a,P(r,o)));return ao(c,i,s)}const HB=W({hingeLoss_:GB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(e,t,n,s=1,r=Mn.SUM_BY_NONZERO_WEIGHTS){const o=F(e,"labels","huberLoss"),i=F(t,"predictions","huberLoss");let a=null;n!=null&&(a=F(n,"weights","huberLoss")),Ls(o.shape,i.shape,"Error in huberLoss: ");const c=Nt(s),l=ze(lt(i,o)),u=Ya(l,c),h=lt(l,u),f=nt(P(Nt(.5),ie(u)),P(c,h));return ao(f,a,r)}const XB=W({huberLoss_:qB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(e,t,n,s=1e-7,r=Mn.SUM_BY_NONZERO_WEIGHTS){const o=F(e,"labels","logLoss"),i=F(t,"predictions","logLoss");let a=null;n!=null&&(a=F(n,"weights","logLoss")),Ls(o.shape,i.shape,"Error in logLoss: ");const c=Nt(1),l=Nt(s),u=he(P(o,Ms(nt(i,l)))),h=P(lt(c,o),Ms(nt(lt(c,i),l))),f=lt(u,h);return ao(f,a,r)}const KB=W({logLoss_:jB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(e,t,n,s=Mn.SUM_BY_NONZERO_WEIGHTS){const r=F(e,"labels","meanSquaredError"),o=F(t,"predictions","meanSquaredError");let i=null;n!=null&&(i=F(n,"weights","meanSquaredError")),Ls(r.shape,o.shape,"Error in meanSquaredError: ");const a=_S(r,o);return ao(a,i,s)}const ZB=W({meanSquaredError_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(e,t){const n=F(e,"labels","sigmoidCrossEntropyWithLogits"),s=F(t,"logits","sigmoidCrossEntropyWithLogits");Ls(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=io(s),o=P(s,n),i=Fb(ps(he(ze(s))));return nt(lt(r,o),i)}function JB(e,t,n,s=0,r=Mn.SUM_BY_NONZERO_WEIGHTS){let o=F(e,"multiClassLabels","sigmoidCrossEntropy");const i=F(t,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=F(n,"weights","sigmoidCrossEntropy")),Ls(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),s>0){const l=Nt(s),u=Nt(1),h=Nt(.5);o=nt(P(o,lt(u,l)),P(h,l))}const c=QB(o,i);return ao(c,a,r)}const t5=W({sigmoidCrossEntropy_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Mi((r,o,i)=>{const c=Ob(o,[n],!0),l=lt(ct(o,"float32"),c);i([r,l]);const u=he(P(l,r));return{value:xt(u,[n]),gradFunc:(d,p)=>{const[g,m]=p,x=Se(d.shape,[n]);return[P(U(d,x),lt(ct(g,"float32"),ps(m))),P(U(d,x),lt(ps(m),ct(g,"float32")))]}}})(e,t)}function n5(e,t,n,s=0,r=Mn.SUM_BY_NONZERO_WEIGHTS){let o=F(e,"onehotLabels","softmaxCrossEntropy");const i=F(t,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=F(n,"weights","softmaxCrossEntropy")),Ls(o.shape,i.shape,"Error in softmaxCrossEntropy: "),s>0){const l=Nt(s),u=Nt(1),h=Nt(o.shape[1]);o=nt(P(o,lt(u,l)),yt(l,h))}const c=e5(o,i);return ao(c,a,r)}const s5=W({softmaxCrossEntropy_:n5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gr={flipLeftRight:eB,grayscaleToRGB:sB,resizeNearestNeighbor:MS,resizeBilinear:DS,rgbToGrayscale:oB,rotateWithOffset:aB,cropAndResize:J6,nonMaxSuppression:lB,nonMaxSuppressionAsync:xB,nonMaxSuppressionWithScore:yB,nonMaxSuppressionWithScoreAsync:vB,nonMaxSuppressionPadded:CB,nonMaxSuppressionPaddedAsync:IB,threshold:EB,transform:AB},r5={bandPart:MB,gramSchmidt:OB,qr:PB},FS={absoluteDifference:VB,computeWeightedLoss:ao,cosineDistance:UB,hingeLoss:HB,huberLoss:XB,logLoss:KB,meanSquaredError:ZB,sigmoidCrossEntropy:t5,softmaxCrossEntropy:s5};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5=new Map,i5=new Map;class Ec{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class Ns{constructor(){this.classNameMap={}}static getMap(){return Ns.instance==null&&(Ns.instance=new Ns),Ns.instance}static register(t){Ns.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function et(e,t,n){D(e.className!=null,()=>"Class being registered does not have the static className property defined."),D(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),D(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);const s=n,r=t+">"+s;return Ns.register(e),o5.set(r,e),i5.set(e,r),e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jo extends Ec{minimize(t,n=!1,s){const{value:r,grads:o}=this.computeGradients(t,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return zt(o),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return jP(t,n)}dispose(){this.iterations_!=null&&zt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Nt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(jo,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OS extends jo{static get className(){return"Adadelta"}constructor(t,n,s=null){super(),this.learningRate=t,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=V.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=V.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:H(()=>Gt(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:H(()=>Gt(o).variable(i))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;H(()=>{const u=nt(P(c,this.rho),P(ie(a),1-this.rho)),h=P(yt(xe(nt(l,this.epsilon)),xe(nt(c,this.epsilon))),a),f=nt(P(l,this.rho),P(ie(h),1-this.rho));c.assign(u),l.assign(f);const d=nt(P(h,-this.learningRate),o);o.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(zt(this.accumulatedGrads.map(t=>t.variable)),zt(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=t.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LS extends jo{static get className(){return"Adagrad"}constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=V.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:H(()=>ja(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(t)?t[r].tensor:t[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;H(()=>{const c=nt(a,ie(i));a.assign(c);const l=nt(P(yt(i,xe(nt(c,V.backend.epsilon()))),-this.learningRate),o);o.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&zt(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PS extends jo{static get className(){return"Adam"}constructor(t,n,s,r=null){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],H(()=>{this.accBeta1=Nt(n).variable(),this.accBeta2=Nt(s).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);H(()=>{const s=lt(1,this.accBeta1),r=lt(1,this.accBeta2);n.forEach((o,i)=>{const a=V.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:H(()=>Gt(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:H(()=>Gt(a).variable(c))});const l=Array.isArray(t)?t[i].tensor:t[o];if(l==null)return;const u=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,f=nt(P(u,this.beta1),P(l,1-this.beta1)),d=nt(P(h,this.beta2),P(ie(l),1-this.beta2)),p=yt(f,s),g=yt(d,r);u.assign(f),h.assign(d);const m=nt(P(yt(p,nt(xe(g),this.epsilon)),-this.learningRate),a);a.assign(m)}),this.accBeta1.assign(P(this.accBeta1,this.beta1)),this.accBeta2.assign(P(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&zt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&zt(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),H(()=>{this.accBeta1.assign(Ai(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ai(this.beta2,this.iterations_+1))});const n=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zS extends jo{static get className(){return"Adamax"}constructor(t,n,s,r=null,o=0){super(),this.learningRate=t,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],H(()=>{this.iteration=Nt(0).variable(),this.accBeta1=Nt(n).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);H(()=>{const s=lt(1,this.accBeta1),r=yt(-this.learningRate,nt(P(this.iteration,this.decay),1));n.forEach((o,i)=>{const a=V.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Gt(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Gt(a).variable(c)});const l=Array.isArray(t)?t[i].tensor:t[o];if(l==null)return;const u=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,f=nt(P(u,this.beta1),P(l,1-this.beta1)),d=P(h,this.beta2),p=ze(l),g=Xo(d,p);u.assign(f),h.assign(g);const m=nt(P(yt(r,s),yt(f,nt(g,this.epsilon))),a);a.assign(m)}),this.iteration.assign(nt(this.iteration,1)),this.accBeta1.assign(P(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&zt(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&zt(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ny extends jo{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=Array.isArray(t)?t[r].tensor:t[s];if(o==null)return;const i=V.registeredVariables[s];H(()=>{const a=nt(P(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=wr(Nt(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BS extends ny{static get className(){return"Momentum"}constructor(t,n,s=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Nt(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=V.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:H(()=>Gt(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[s];a!=null&&H(()=>{let c;const l=nt(P(this.m,i),a);this.useNesterov?c=nt(P(this.c,nt(a,P(l,this.m))),o):c=nt(P(this.c,l),o),i.assign(l),o.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&zt(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VS extends jo{static get className(){return"RMSProp"}constructor(t,n=.9,s=0,r=null,o=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=V.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const o=V.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:H(()=>Gt(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:H(()=>Gt(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:H(()=>Gt(o).variable(i))});const a=Array.isArray(t)?t[r].tensor:t[s];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;H(()=>{const u=nt(P(c,this.decay),P(ie(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,f=nt(P(h,this.decay),P(a,1-this.decay)),d=yt(P(a,this.learningRate),xe(lt(u,nt(ie(f),this.epsilon)))),p=nt(P(l,this.momentum),d);c.assign(u),h.assign(f),l.assign(p);const g=lt(o,p);o.assign(g)}else{const h=nt(P(c,this.decay),P(ie(a),1-this.decay)),f=nt(P(l,this.momentum),yt(P(a,this.learningRate),xe(nt(h,this.epsilon))));c.assign(h),l.assign(f);const d=lt(o,f);o.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&zt(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&zt(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&zt(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=t.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a5=[OS,LS,PS,zS,BS,VS,ny];function c5(){for(const e of a5)et(e)}function sy(e,t){const n=e.shape.length,s=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${n}`);if(K(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const r=t.shape,o=r[r.length-1];let i=1;for(let h=0;h<r.length-1;++h)i*=r[h];const a=e.shape,c=r.slice();c.pop();let l=1;for(let h=o;h<n;++h)l*=a[h],c.push(a[h]);const u=[...vt(e.shape).map(h=>h/l),1].slice(0,o);return[c,i,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l1=-2,l5=-1;function ry(e,t,n){const s=e.shape.length;D(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),D(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)D(t[r]+n[r]<=e.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${t[r]+n[r]}) would overflow input.shape[${r}] (${e.shape[r]})`)}function u5(e){const t=[];let n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function oy(e,t,n){const s=[];for(let r=0;r<e.length;r++)s[r]=Math.ceil((t[r]-e[r])/n[r]);return s}function WS(e,t,n,s){const r=[...e];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<n;o++)o===0?r[t]=1:(r.splice(t,0,1),r.pop());return r}function US(e,t,n){return n<=e?n:n-(t-1)}function GS(e,t){const n=[];for(let s=0;s<e;s++)n.push(t+s);return n}function h5(e,t,n,s,r,o,i,a,c){const l=e.length;let u=new Array(l),h=new Array(l),f=new Array(l);if(t.length&&n>0){const d=t[0],p=n+1;u=HS(i,d,p,s,e),h=qS(a,d,p,r,e),f=WS(o,d,p,e)}else for(let d=0;d<l;d++)u[d]=jS(i,s,o,e,d,c),h[d]=KS(a,r,o,e,d,c),f[d]=XS(o,d,c);return{begin:u,end:h,strides:f}}function HS(e,t,n,s,r){const o=[...r],i=GS(n,t);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const c=US(t,n,a);let l=s[c];e&1<<c&&(l=0),o[a]=l}return o}function qS(e,t,n,s,r){const o=[...r],i=GS(n,t);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const c=US(t,n,a);let l=s[c];e&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[a]=l}for(let a=0;a<o.length;a++){const c=r[a];o[a]<0&&(o[a]+=c),o[a]=Ii(0,o[a],r[a])}return o}function XS(e,t,n){let s=e[t];return(n&1<<t||s==null)&&(s=1),s}function jS(e,t,n,s,r,o){let i=t[r];const a=n[r]||1;(e&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),i=Ii(0,i,c-1),i}function KS(e,t,n,s,r,o){let i=t[r];const a=n[r]||1;(e&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),a>0?i=Ii(0,i,c):i=Ii(-1,i,c-1),i}function iy(e,t,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(t[r]>0||n[r]!==e[r])return!1;return!0}function ay(e,t){let n=e.length>0?e[e.length-1]:1;for(let s=0;s<e.length-1;s++)n+=e[s]*t[s];return n}function vm(e,t,n){let s;const r=e.shape.length;typeof t=="number"?s=[t,...new Array(r-1).fill(0)]:t.length<r?s=t.concat(new Array(r-t.length).fill(0)):s=t.slice(),s.forEach(i=>{D(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(r).fill(-1):typeof n=="number"?o=[n,...new Array(r-1).fill(-1)]:n.length<r?o=n.concat(new Array(r-n.length).fill(-1)):o=n,o=o.map((i,a)=>i>=0?i:(D(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),e.shape[a]-s[a])),[s,o]}function cy(e,t,n,s,r,o,i,a,c){let l;if(s==null?(l=new Array(t.length),l.fill(1)):l=s,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let w=0;w<h.dims;w++)u&&(1<<w&a)!==0&&h.numAddAxisAfterEllipsis++,1<<w&i&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};f5(h,f);let d=!0,p=!0,g=!0;const m=[],x=[];for(let w=0;w<e.length;++w){if(f.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const y=!!(f.shrinkAxisMask&1<<w),v=e[w];if(v===-1){m.push(y?1:-1);continue}const $=[f.beginMask&1<<w,f.endMask&1<<w],I=[f.strides[w]>0?0:-1,f.strides[w]>0?v:v-1];if(y&&f.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&f.strides[w]===1;const N=!!(f.beginMask&1<<w&&f.endMask&1<<w);if(f.beginValid&&f.endValid){if(y){const A=f.begin[w]<0?v+f.begin[w]:f.begin[w];if(f.begin[w]=A,f.end[w]=f.begin[w]+1,A<0||A>=v)throw Error(`slice index ${f.begin[w]} of dimension ${w} out of bounds.`)}else f.begin[w]=p2(f.begin[w],0,f.strides[w],v,$,I),f.end[w]=p2(f.end[w],1,f.strides[w],v,$,I);const C=f.strides[w]===1&&f.begin[w]===0&&f.end[w]===v;d=d&&C,p=p&&(w===0&&f.strides[w]===1||C)}else d=d&&f.strides[w]===1&&N,p=p&&(w===0&&f.strides[w]===1||N);let k,S=!1;if(f.beginValid&&f.endValid?(k=f.end[w]-f.begin[w],S=!0):y?(k=1,S=!0):N&&v>=0&&(f.strides[w]<0?k=-v:k=v,S=!0),S){let C;k===0||k<0!=f.strides[w]<0?C=0:C=Math.trunc(k/f.strides[w])+(k%f.strides[w]!==0?1:0),m.push(C)}else m.push(-1)}for(let w=0;w<f.finalShapeGatherIndices.length;++w){const y=f.finalShapeGatherIndices[w];y>=0?x.push(m[y]):y===l1&&x.push(1)}return{finalShapeSparse:x.filter((w,y)=>f.finalShapeGatherIndices[y]!==l1),finalShape:x,isIdentity:d,sliceDim0:p,isSimpleSlice:g,begin:f.begin,end:f.end,strides:f.strides}}function f5(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<e.dims;s++)if(1<<s&e.ellipsisMask){const r=Math.min(t.dims-(e.dims-s)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<r;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&e.newAxisMask)t.finalShapeGatherIndices.push(l1),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[s]),e.end!=null&&(t.end[n]=e.end[s]),t.strides[n]=e.strides[s],e.beginMask&1<<s&&(t.beginMask|=1<<n),e.endMask&1<<s&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(l5),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[n]=s,n++}}function p2(e,t,n,s,r,o){if(r[t])return n>0?o[t]:o[t+1&1];{const i=e<0?s+e:e;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const d5=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:ry,computeFlatOffset:ay,computeOutShape:oy,getNormalizedAxes:h5,isSliceContinous:iy,maskToAxes:u5,parseSliceParams:vm,sliceInfo:cy,startForAxis:jS,startIndicesWithElidedDims:HS,stopForAxis:KS,stopIndicesWithElidedDims:qS,stridesForAxis:XS,stridesWithElidedDims:WS},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p5{static sgd(t){return new ny(t)}static momentum(t,n,s=!1){return new BS(t,n,s)}static rmsprop(t,n=.9,s=0,r=null,o=!1){return new VS(t,n,s,r,o)}static adam(t=.001,n=.9,s=.999,r=null){return new PS(t,n,s,r)}static adadelta(t=.001,n=.95,s=null){return new OS(t,n,s)}static adamax(t=.002,n=.9,s=.999,r=null,o=0){return new zS(t,n,s,r,o)}static adagrad(t,n=.1){return new LS(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const go=p5;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function YS(){return new Promise(e=>m5(()=>e()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ly(e,t){const n=e[0].length;e.forEach((r,o)=>{D(r.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),D(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=e[0];e.forEach((r,o)=>{for(let i=0;i<n;i++)D(i===t||r[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function vr(e,t){const n=e[0].slice();for(let s=1;s<e.length;s++)n[t]+=e[s][t];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var qs;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(qs||(qs={}));function ZS(e,t,n){let s=new Array;if(n==null&&t==null)return s;if(t==null)for(;s.length<e+n.length;)s.push(-1);else s=t.slice();if(n==null)return s;if(e+n.length!==s.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const o=n[r],i=s[s.length-n.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${r+e}] = ${o} but shape[${r+e}] = ${a}`)}else s[i]=o}return s}function QS(e){const t={FIRST_DIM_SIZE:qs.FIRST_DIM_SIZE,VALUE_ROWIDS:qs.VALUE_ROWIDS,ROW_LENGTHS:qs.ROW_LENGTHS,ROW_SPLITS:qs.ROW_SPLITS,ROW_LIMITS:qs.ROW_LIMITS,ROW_STARTS:qs.ROW_STARTS},n=[];for(const s of e)if(s in t)n.push(t[s]);else break;return n}function JS(e){return e.length===0?0:e[0]===qs.FIRST_DIM_SIZE?e.length-1:e.length}function tN(e,t){if(e==null||t==null)return;const n=e.length,s=t.length;if(n>=s)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const o=e[r],i=t[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${r-e.length}] = ${o} but ragged tensor input.flatValues.shape[${r-e.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uy=30;function $m(e){return e<=uy?e:j0(e,Math.floor(Math.sqrt(e)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hy(e,t,n){const s=n*(typeof e=="number"?e:e[0]),r=t*(typeof e=="number"?e:e[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ch(e,t,n,s=!0){let r=[];if(s)r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const o=t.length;for(let i=0;i<o;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(o+1))}return r}function lh(e,t,n=!0){const s=[];if(n){s.push(t);for(let r=t+1;r<e;++r)r<=2*t?(s.push(r),s.push(r-(t+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<e;++i)i>=t*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function uh(e,t,n,s=!0){const r=[];s?r.push(e[0]/n):r.push(e[0]*n);for(let o=1;o<e.length;++o)o<=t.length?s?r.push(t[o-1]*e[o]):r.push(e[o]/t[o-1]):r.push(e[o]);return r}function fy(e,t){const n=[0];for(let s=0;s<t;++s)n.push(e[s][0]);return n}function dy(e,t,n){const s=e.slice(0,1);for(let r=0;r<n;++r)s.push(e[r+1]-t[r][0]-t[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cm=1.7580993408473768,km=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const py=.3275911,my=.254829592,gy=-.284496736,xy=1.421413741,by=-1.453152027,yy=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qr(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(e.length*2);for(let s=0;s<n.length;s+=2)n[s]=e[s/2],n[s+1]=t[s/2];return n}function eN(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s/2]=e[s],n[s/2]=e[s+1];return{real:t,imag:n}}function nN(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let r=0;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],s[Math.floor(r/4)]=e[r+1];return{real:n,imag:s}}function sN(e){const t=Math.floor(e.length/4),n=new Float32Array(t),s=new Float32Array(t);for(let r=2;r<e.length;r+=4)n[Math.floor(r/4)]=e[r],s[Math.floor(r/4)]=e[r+1];return{real:n,imag:s}}function wy(e,t){const n=e[t*2],s=e[t*2+1];return{real:n,imag:s}}function rN(e,t,n,s){e[s*2]=t,e[s*2+1]=n}function oN(e,t){const n=new Float32Array(e/2),s=new Float32Array(e/2);for(let r=0;r<Math.ceil(e/2);r++){const o=(t?2:-2)*Math.PI*(r/e);n[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:n,imag:s}}function iN(e,t,n){const s=(n?2:-2)*Math.PI*(e/t),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qg="->",g5=/->/g,m2=",",g2="...";function vy(e,t){e=e.replace(/\s/g,"");const n=(e.length-e.replace(g5,"").length)/qg.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${qg}").`);const[s,r]=e.split(qg);D(s.indexOf(g2)===-1,()=>`The ellipsis notation ("${g2}") is not supported yet.`);const o=s.split(m2),i=o.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const d=r[f];if(!o.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<s.length;++f){const d=s[f];a.indexOf(d)===-1&&d!==m2&&a.push(d)}const c=new Array(o.length);for(let f=0;f<i;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);c[f]=[];for(let d=0;d<o[f].length;++d)c[f].push(a.indexOf(o[f][d]))}const l=a.length,u=r.length,h=[];for(let f=u;f<l;++f)h.push(f);return{allDims:a,summedDims:h,idDims:c}}function $y(e,t){let n=new Array(e);n.fill(-1);for(let r=0;r<t.length;++r)n[t[r]]=r;const s=[];for(let r=0;r<e;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function Cy(e,t,n){const s=new Array(e);for(let r=0;r<n.length;++r){const o=n[r].shape;for(let i=0;i<t[r].length;++i)s[t[r][i]]===void 0?s[t[r][i]]=o[i]:D(s[t[r][i]]===o[i],()=>`Expected dimension ${s[t[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function ky(e,t){const n=e,s=[];let r=0;e.length===0&&n.push(-1),r=e.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<n.length;++i){const a=n[i],c=x5(t,a);for(const l of c)o.indexOf(l)===-1&&(s[i].push(l),o.push(l))}return{path:n,steps:s}}function Iy(e){return e.every((t,n)=>t===n)}function x5(e,t){const n=[];for(let s=0;s<e.length;++s)(e[s].length===0||e[s].indexOf(t)!==-1||t===-1)&&n.push(s);return n}function Sy(e,t,n=0){let s=[];if(typeof t=="number")D(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(e.shape[n]/t);else{const r=t.reduce((i,a)=>(a===-1&&(i+=1),i),0);D(r<=1,()=>"There should be only one negative value in split array.");const o=t.indexOf(-1);if(o!==-1){const i=t.reduce((a,c)=>c>0?a+c:a);t[o]=e.shape[n]-i}D(e.shape[n]===t.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function cN(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function lN(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uN(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function hN(e,t){return`size ${e} must be non-negative, not ${t}`}function fN(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function dN(e,t){const n=K(e),s=K(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${e} outputShape= ${t}`}function pN(e,t){const n=K(e),s=K(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${e} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u1(){return"segment ids must be >= 0"}function mN(){return"segment ids are not increasing"}function gN(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function xN(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(e,t){let n=!1,s;for(e<=uy?(s=e,n=!0):s=j0(e,Math.floor(Math.sqrt(e)));!n;)s>t||s===e?n=!0:s=j0(e,s+1);return s}function yN(e,t,n){const s=[],r=e.length;for(let o=0;o<r;o++)o!==t?s.push(e[o]):s.push(n);return s}function Ny(e,t,n,s){const r=t.shape.length,o=e.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(e.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${e.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);const i=e.shape[n],a=[];let c=1,l=1,u=1;for(let h=0;h<s;++h)a.push(e.shape[h]),c*=e.shape[h];for(let h=s;h<n;h++)a.push(e.shape[h]),l*=e.shape[h];for(let h=s;h<r;h++)a.push(t.shape[h]);for(let h=n+1;h<o;h++)a.push(e.shape[h]),u*=e.shape[h];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:i,outputShape:a}}const b5=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Ny,computeOutShape:yN,segOpComputeOptimalWindowSize:bN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jr(e){try{return e.map(t=>Ro(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function wN(e){return e.map(t=>No(t))}const y5=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:my,ERF_A2:gy,ERF_A3:xy,ERF_A4:by,ERF_A5:yy,ERF_P:py,PARALLELIZE_THRESHOLD:uy,get RowPartitionType(){return qs},SELU_SCALE:km,SELU_SCALEALPHA:Cm,applyActivation:Yb,assertAndGetBroadcastShape:Et,assertAxesAreInnerMostDims:tn,assertParamsConsistent:ly,assignToTypedArray:rN,axesAreInnerMostDims:Ab,calculateShapes:ea,checkEinsumDimSizes:Cy,checkPadOnDimRoundingMode:Hn,combineLocations:hS,combineRaggedTensorToTensorShapes:ZS,complexWithEvenIndex:nN,complexWithOddIndex:sN,computeConv2DInfo:Je,computeConv3DInfo:Ho,computeDefaultPad:Sb,computeDilation2DInfo:rh,computeOptimalWindowSize:$m,computeOutAndReduceShapes:He,computeOutShape:vr,computePool2DInfo:Ps,computePool3DInfo:ro,convertConv2DDataFormat:oo,decodeEinsumEquation:vy,eitherStridesOrDilationsAreOne:an,expandShapeToKeepDim:Se,exponent:iN,exponents:oN,fromStringArrayToUint8:wN,fromUint8ToStringArray:Jr,getAxesPermutation:me,getBroadcastDims:Ka,getComplexWithIndex:wy,getEinsumComputePath:ky,getEinsumPermutation:$y,getFusedBiasGradient:Kb,getFusedDyActivation:jb,getImageCenter:hy,getInnerMostAxes:Ne,getPermuted:lh,getRaggedRank:JS,getReductionAxes:Oe,getReshaped:ch,getReshapedPermuted:uh,getRowPartitionTypesHelper:QS,getSliceBeginCoords:fy,getSliceSize:dy,getSparseFillEmptyRowsIndicesDenseShapeMismatch:aN,getSparseFillEmptyRowsNegativeIndexErrorMessage:cN,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:lN,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:fN,getSparseReshapeInputOutputMismatchErrorMessage:pN,getSparseReshapeInputOutputMultipleErrorMessage:dN,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:uN,getSparseReshapeNegativeOutputDimErrorMessage:hN,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:xN,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:u1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:mN,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gN,getUndoAxesPermutation:qo,isIdentityPermutation:Iy,log:FO,mergeRealAndImagArrays:Qr,prepareAndValidate:sy,prepareSplitSize:Sy,segment_util:b5,shouldFuse:Zb,slice_util:d5,splitRealAndImagArrays:eN,stridesOrDilationsArePositive:Ei,tupleValuesAreOne:Ti,upcastType:ns,validateDefaultValueShape:tN,validateInput:R6,validateUpdateShape:TS,warn:ls},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */c5();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vN={kernelName:dp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,ah(ct(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w5={kernelName:lu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=ie(ct(n,"float32")),r=xe(lt(Nt(1),s));return he(yt(e,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v5={kernelName:uu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=xe(lt(ie(ct(n,"float32")),1));return yt(e,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $5={kernelName:Ic,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{let a=e;const c=Oe(n.shape,r);return c.length>0&&(a=xt(a,c)),U(a,n.shape)},b:()=>{let a=e;const c=Oe(s.shape,r);return c.length>0&&(a=xt(a,c)),U(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C5={kernelName:Ox,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((s,r)=>{n[r]=()=>e.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k5={kernelName:pp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Gt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I5={kernelName:mp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Gt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5={kernelName:hu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,xe(lt(Nt(1),ie(ct(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5={kernelName:fu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=xe(nt(Nt(1),ie(ct(n,"float32"))));return yt(e,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _5={kernelName:mu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{const a=nt(ie(n),ie(s));let c=P(e,yt(s,a));const l=Oe(n.shape,r);return l.length>0&&(c=xt(c,l)),U(c,n.shape)},b:()=>{const a=nt(ie(n),ie(s));let c=he(P(e,yt(n,a)));const l=Oe(s.shape,r);return l.length>0&&(c=xt(c,l)),U(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T5={kernelName:du,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,nt(ie(ct(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E5={kernelName:pu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,lt(Nt(1),ie(ct(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(e,t,n,s,r,o){const i=F(e,"dy","avgPool3dGrad"),a=F(t,"input","avgPool3dGrad");let c=i,l=a,u=!1;a.rank===4&&(u=!0,c=U(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),D(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),D(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Hn("avgPool3dGrad",r,o);const h={dy:c,input:l},f={filterSize:n,strides:s,pad:r,dimRoundingMode:o},d=V.runKernel(Bx,h,f);return u?U(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const A5=W({avgPool3dGrad_:R5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D5={kernelName:xp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=n;return{x:()=>A5(e,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(e,t,n,s,r){const o=F(e,"dy","avgPoolGrad"),i=F(t,"input","avgPoolGrad");D(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,c=o,l=!1;i.rank===3&&(l=!0,a=U(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=U(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),D(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:c,input:a},h={filterSize:n,strides:s,pad:r},f=V.runKernel(zx,u,h);return l?U(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const F5=W({avgPoolGrad_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O5={kernelName:gp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{filterSize:r,strides:o,pad:i}=n;return{x:()=>F5(e,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L5={kernelName:bp,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[s,r]=t,{transposeA:o,transposeB:i}=n;return!o&&!i?{a:()=>Vt(e,r,!1,!0),b:()=>Vt(s,e,!0,!1)}:!o&&i?{a:()=>Vt(e,r,!1,!1),b:()=>Vt(e,s,!0,!1)}:o&&!i?{a:()=>Vt(r,e,!1,!0),b:()=>Vt(s,e,!1,!1)}:{a:()=>Vt(r,e,!0,!0),b:()=>Vt(e,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P5={kernelName:yp,gradFunc:(e,t,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Vb(e,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z5={kernelName:RO,gradFunc:(e,t,n)=>{const s=n,r=s.inputShape,o=s.shape,i=Array.from(o);for(let c=r.length-1;c>=0;c--)if(r[c]===o[c])i[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>xt(e,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B5={kernelName:gu,gradFunc:e=>({x:()=>e.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5={kernelName:xu,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5={kernelName:bu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{clipValueMin:r,clipValueMax:o}=n;return{x:()=>wn(Yr(ta(s,r),_c(s,o)),e,Gt(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5={kernelName:wp,inputsToSave:["x"],gradFunc:vN.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5={kernelName:vp,saveAllInputs:!0,gradFunc:(e,t,n)=>{const s=t.map(c=>c.shape),{axis:r}=n,o=Lt(r,t[0].shape)[0],i=s.map(c=>c[o]);return fs(e,i,o).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H5={kernelName:$p,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[s,r]=t,{dilations:o,strides:i,pad:a,dataFormat:c}=n;return D(Ti(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>Tb(s.shape,e,r,i,a,c),filter:()=>Xb(s,e,r.shape,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q5={kernelName:Cp,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[s,r]=t,{strides:o,pad:i,dataFormat:a,dimRoundingMode:c}=n;return{dy:()=>Ri(e,r,o,i,a,1,c),filter:()=>Xb(e,s,r.shape,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(e,t,n,s,r){let o=e;e.rank===4&&(o=U(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let i=t;i.rank===4&&(i=U(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),D(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),D(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),D(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),D(o.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`),D(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:o,dy:i},c={strides:s,pad:r,filterShape:n};return V.runKernel(Hx,a,c)}const j5=W({conv3DBackpropFilter_:X5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K5={kernelName:kp,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:s,strides:r,pad:o}=n;D(Ti(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=t;return{x:()=>aS(i.shape,e,a,r,o),filter:()=>j5(i,e,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5={kernelName:yu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(he(kS(ct(n,"float32"))),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z5={kernelName:wu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(IS(ct(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q5={kernelName:Ip,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:r,exclusive:o,reverse:i}=n;return{x:()=>{const a=me([r],s.rank);let c=lS(e,r,o,!i);return a!=null&&(c=Wt(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J5={kernelName:Sp,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=n,a=s??[1,1];D(Ti(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=t;return D(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),D(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),D(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),D(an(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Hn("depthwiseConv2d",o,i),{x:()=>Y6(c.shape,e,l,r,o,a,i),filter:()=>j6(c,e,l.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:Np,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[s,r]=t,o={x:s,filter:r,dy:e},i={x:s,filter:r,dy:e};return{x:()=>V.runKernel(K0,o,n),filter:()=>V.runKernel(Y0,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:$u,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,s={dy:e,y:n};return{x:()=>V.runKernel(tb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8={kernelName:Cu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,s=P(ps(he(ie(n))),2/Math.sqrt(Math.PI));return{x:()=>P(e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:ku,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:Tp,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>U(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o8={kernelName:Iu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,ps(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8={kernelName:Su,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8={kernelName:Nu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{const a=yt(e,ct(s,"float32")),c=Oe(n.shape,r);return c.length>0?U(xt(a,c),n.shape):a},b:()=>{let a=P(e,ct(n,"float32"));const c=Oe(s.shape,r);c.length>0&&(a=U(xt(a,c),s.shape));const l=ie(s);return he(yt(a,ct(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:Ep,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:s}=n,[r,o,i,a]=t,c=a??Nt(1),l=Oe(o.shape,r.shape),u=[];if(o.rank===1){for(let y=0;y<r.shape.length-1;++y)u.push(r.shape[y]);u.push(1)}const h=lt(r,o),f=P(e,c),d=vS(nt(i,Nt(s))),p=P(P(P(d,d),d),Nt(-.5));return{x:()=>o.rank===1?U(P(P(e,On(U(d,[1,1,1,o.shape[0]]),u)),c),r.shape):U(P(P(e,d),c),r.shape),mean:()=>{let y=P(P(d,Nt(-1)),f);return o.rank===1&&(y=xt(y,l)),U(y,o.shape)},variance:()=>{let y=P(P(p,h),f);return o.rank===1&&(y=xt(y,l)),U(y,o.shape)},scale:()=>{const y=P(h,d);let v=P(e,y);return o.rank===1&&(v=xt(v,l)),U(v,o.shape)},offset:()=>{let y=e;return o.rank===1&&(y=xt(y,l)),U(y,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8={kernelName:Rp,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[s,r]=t,{axis:o,batchDims:i}=n,a=Lt(o,s.shape)[0],c=(l,u,h)=>()=>{const f=l.shape,d=u.size,p=f.slice(0,a),g=p.length,m=f.slice(o,f.length).slice(1),x=m.length,b=x2(0,g),w=x2(g+1,g+1+x),y=b2([p,[d],m]),v=U(h,y),$=U(u,[d]),I=b2([[g],b,w]),N=Wt(v,I);let k=RS(N,$,l.shape[a]);const S=qo(I);return k=Wt(k,S),k};if(i===1){const l=s.shape[0],u=s.split(l,0);return{x:()=>vn(u.map((d,p)=>c(d,r.slice(p,1),e.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,e),indices:()=>r}}};function x2(e,t){const n=[];for(let s=e;s<t;++s)n.push(s);return n}function b2(e){const t=[];for(let n=0;n<e.length;++n)for(let s=0;s<e[n].length;++s)t.push(e[n][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8={kernelName:_u,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>Gt(n),b:()=>Gt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8={kernelName:Tu,gradFunc:e=>({x:()=>ct(e,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8={kernelName:Eu,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8={kernelName:Ru,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8={kernelName:Au,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:Dp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{alpha:r}=n,o=xs(s,0);return{x:()=>wn(o,e,P(e,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8={kernelName:Mu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,nt(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8={kernelName:Du,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,ct(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8={kernelName:DO,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s]=t,{axis:r}=n;return{logits:()=>{const i=ps(s);return lt(e,P(xt(e,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(e,t,n,s=5,r=1,o=1,i=.5){const a={x:e,y:t,dy:n},c={depthRadius:s,bias:r,alpha:o,beta:i};return V.runKernel(ab,a,c)}const w8=W({localResponseNormalizationBackprop_:y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8={kernelName:zp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,r]=t,{depthRadius:o,bias:i,alpha:a,beta:c}=n;return{x:()=>w8(s,r,e,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(e,t,n,s){return t.rank<n.rank&&(t=U(t,Se(t.shape,s))),e.rank<n.rank&&(e=U(e,Se(e.shape,s))),{x:()=>P(e,ct(Ir(n,t),e.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y2={kernelName:Bp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const s=n,{reductionIndices:r}=s,o=t[0],i=t[1],a=Lt(r,o.shape),c=$N(e,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $8={kernelName:Fu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>P(e,ct(ta(n,s),"float32")),b:()=>P(e,ct(Qf(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(e,t,n,s,r,o,i){const a=F(e,"dy","maxPool3dGrad"),c=F(t,"input","maxPool3dGrad"),l=F(n,"output","maxPool3dGrad");let u=a,h=c,f=l,d=!1;c.rank===4&&(d=!0,u=U(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=U(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=U(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),D(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),D(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),D(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),Hn("maxPool3dGrad",o,i);const p={dy:u,input:h,output:f},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},m=V.runKernel(lb,p,g);return d?U(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const k8=W({maxPool3dGrad_:C8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8={kernelName:Wp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,r]=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=n;return{x:()=>k8(e,s,r,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(e,t,n,s,r,o,i){const a=F(e,"dy","maxPoolGrad"),c=F(t,"input","maxPoolGrad"),l=F(n,"output","maxPoolGrad");D(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),D(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),D(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),Hn("maxPoolGrad",o,i);const u={dy:a,input:c,output:l},h={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return V.runKernel(cb,u,h)}const N8=W({maxPoolGrad_:S8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8={kernelName:Vp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s,r]=t,{filterSize:o,strides:i,pad:a}=n;return{x:()=>N8(e,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8={kernelName:Up,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:r}=n,o=Lt(r,s.shape),a=He(s.shape,o)[1],c=K(a);return{x:()=>{const u=s.shape.slice();o.forEach(d=>{u[d]=1});const h=U(e,u);return yt(P(h,ts(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8={kernelName:Gp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const s=n,{axis:r}=s,[o,i]=t,a=Lt(r,o.shape),c=$N(e,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8={kernelName:Ou,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t;return{a:()=>P(e,ct(_c(n,s),"float32")),b:()=>P(e,ct(xs(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A8={kernelName:Hp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const s=t[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>se(e,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8={kernelName:Lu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{const a=Oe(n.shape,r);return a.length>0?U(xt(e,a),n.shape):e},b:()=>{const a=P(e,he(wm(yt(n,s)))),c=Oe(s.shape,r);return c.length>0?U(xt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8={kernelName:Pu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{const a=P(e,ct(s,"float32")),c=Oe(n.shape,r);return c.length>0?U(xt(a,c),n.shape):a},b:()=>{const a=P(e,ct(n,"float32")),c=Oe(s.shape,r);return c.length>0?U(xt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8={kernelName:qp,gradFunc:e=>({x:()=>he(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8={kernelName:Kp,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>Re(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8={kernelName:jp,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8={kernelName:Yp,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:s}=n;return Oi(e,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2={kernelName:Zp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const s=t[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>se(e,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8={kernelName:zu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,s,r]=t,o=n,i=s,a=Et(o.shape,i.shape);return{a:()=>{const u=ct(i,"float32");let h=P(e,P(u,Ai(o,lt(u,Nt(1)))));const f=Oe(o.shape,a);return f.length>0&&(h=xt(h,f)),U(h,o.shape)},b:()=>{const u=xs(o,0),h=wn(u,Ms(o),Gt(o));let f=P(e,P(r,h));const d=Oe(i.shape,a);return d.length>0&&(f=xt(f,d)),U(f,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8={kernelName:Qp,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,s]=t,r=xs(n,0);return{x:()=>wn(r,e,P(e,s)),alpha:()=>{let o=wn(r,Gt(e),P(e,n));const i=Oe(s.shape,e.shape);return i.length>0&&(o=xt(o,i)),U(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(e,t,n){const s=e.shape.slice();s[n]=1;const r=U(t,s),o=Yf(e,n,!0,!1),i=Yf(e,n,!0,!0),a=P(o,i);return P(r,a)}function W8(e,t,n){const s=e.shape.length,r=s-n.length,o=me(n,s);let i=e;o!=null&&(i=Wt(e,o));const a=i.shape.slice(),l=a.splice(s-n.length,n.length).reduce((f,d)=>f*d,1);a.push(l);const u=i.reshape(a);let h=V8(u,t,r);if(h=h.reshape(i.shape),o!=null){const f=qo(o);h=Wt(h,f)}return h}const U8={kernelName:Jp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{axis:r}=n;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>W8(s,e,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8={kernelName:vu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{const a=yt(e,ct(s,"float32")),c=Oe(n.shape,r);return c.length>0?U(xt(a,c),n.shape):a},b:()=>{let a=P(e,ct(n,"float32"));const c=Oe(s.shape,r);c.length>0&&(a=U(xt(a,c),s.shape));const l=ie(s);return he(yt(a,ct(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8={kernelName:Bu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,he(ie(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8={kernelName:Wu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,s=P(_c(n,6),ah(n));return{x:()=>P(e,ct(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8={kernelName:Vu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,ct(ah(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8={kernelName:tm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>U(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8={kernelName:nm,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[s]=t,r={dy:e,images:s};return{images:()=>V.runKernel(gb,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8={kernelName:em,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[s]=t,r={dy:e,images:s};return{images:()=>V.runKernel(mb,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8={kernelName:sm,gradFunc:(e,t,n)=>{const{dims:s}=n,r=Lt(s,e.shape);return{x:()=>Fi(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8={kernelName:Uu,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8={kernelName:Gu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>he(yt(e,P(Ai(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tV={kernelName:rm,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>ct(Gt(n),"float32"),t:()=>P(e,ct(n,e.dtype)),e:()=>P(e,ct(Lb(n),e.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eV={kernelName:Hu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const s=xs(n,Nt(0)),r=Nt(Cm),o=Nt(km),i=P(e,o),a=P(P(e,r),ps(ct(n,"float32")));return wn(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nV={kernelName:Ku,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,P(n,lt(Nt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sV={kernelName:ju,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rV={kernelName:qu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(Eb(ct(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oV={kernelName:Xu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(cS(ct(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iV={kernelName:om,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{begin:r,size:o}=n,i=s.shape,[a,c]=vm(s,r,o),l=[];for(let u=0;u<e.rank;u++)l.push([a[u],i[u]-a[u]-c[u]]);return{x:()=>Bb(e,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aV={kernelName:lm,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[s]=t,{dim:r}=n,o=!0,i=P(e,s);return{logits:()=>lt(i,P(xt(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cV={kernelName:Yu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,Nc(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v2={kernelName:am,gradFunc:(e,t,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>_b(e,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $2={kernelName:cm,gradFunc:(e,t,n)=>{const{axis:s}=n;return{x:()=>Ze(e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lV={kernelName:Zu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,P(xe(ct(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uV={kernelName:xb,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(e,P(ct(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hV={kernelName:Qu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Nt(2);return{a:()=>P(e,P(r,lt(n,s))),b:()=>P(e,P(r,lt(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV={kernelName:sh,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dV={kernelName:Ju,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,s]=t,r=Et(n.shape,s.shape);return{a:()=>{let a=e;const c=Oe(n.shape,r);return c.length>0&&(a=xt(a,c)),U(a,n.shape)},b:()=>{let a=e;const c=Oe(s.shape,r);return c.length>0&&(a=xt(a,c)),U(he(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pV={kernelName:im,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,r=s.shape.slice(),{axis:o}=n;Lt(o,s.shape).forEach(l=>{r[l]=1});const a=U(e,r),c=P(a,ts(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mV={kernelName:th,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>yt(e,ie(Eb(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gV={kernelName:eh,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>P(lt(Nt(1),ie(n)),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xV={kernelName:nh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[s]=t,{reps:r}=n;return{x:()=>{let i=Gt(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=nt(i,se(e,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)i=nt(i,se(e,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)i=nt(i,se(e,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)for(let u=0;u<r[3];++u)i=nt(i,se(e,[a*s.shape[0],c*s.shape[1],l*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV={kernelName:Ma,gradFunc:(e,t,n)=>{const s=n,{perm:r}=s,o=qo(r);return{x:()=>Wt(e,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yV={kernelName:um,gradFunc:(e,t,n)=>{const s=n,{axis:r}=s;return{value:()=>vn(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wV={kernelName:hm,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>vV(e,n)}}};function vV(e,t){const n=Xo(t,Gt(t)),s=Is(e,n);let r=ta(t,Nt(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=Tn(r,a+1);r=Yr(r,ts(s.shape,"bool"));const i=Gt(s);return wn(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V={kernelName:fm,gradFunc:e=>({x:()=>Gt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CV=[vN,w5,v5,$5,C5,k5,I5,S5,N5,_5,T5,E5,D5,O5,L5,P5,z5,B5,V5,W5,U5,G5,q5,H5,K5,Y5,Z5,Q5,J5,t8,G8,e8,n8,s8,r8,o8,a8,i8,c8,l8,u8,h8,f8,d8,p8,m8,g8,x8,b8,v8,y2,y2,$8,I8,_8,T8,E8,R8,A8,D8,M8,F8,O8,L8,P8,w2,w2,z8,B8,U8,H8,q8,X8,j8,K8,Y8,Z8,Q8,J8,tV,eV,nV,sV,rV,oV,iV,aV,cV,v2,v2,$2,$2,lV,hV,uV,fV,dV,pV,mV,gV,xV,bV,yV,wV,$V];for(const e of CV)OO(e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.abs=function(){return this.throwIfDisposed(),ze(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.acos=function(){return this.throwIfDisposed(),B4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.acosh=function(){return this.throwIfDisposed(),W4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.add=function(e){return this.throwIfDisposed(),nt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.all=function(e,t){return this.throwIfDisposed(),rS(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.any=function(e,t){return this.throwIfDisposed(),i1(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.argMax=function(e){return this.throwIfDisposed(),Dl(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.argMin=function(e){return this.throwIfDisposed(),X4(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.asScalar=function(){return this.throwIfDisposed(),D(this.size===1,()=>"The array must have only 1 element."),U(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.asType=function(e){return this.throwIfDisposed(),ct(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.as1D=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.as2D=function(e,t){return this.throwIfDisposed(),U(this,[e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),U(this,[e,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.as4D=function(e,t,n,s){return this.throwIfDisposed(),U(this,[e,t,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.as5D=function(e,t,n,s,r){return this.throwIfDisposed(),U(this,[e,t,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.asin=function(){return this.throwIfDisposed(),K4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.asinh=function(){return this.throwIfDisposed(),Z4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.atan=function(){return this.throwIfDisposed(),J4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.atan2=function(e){return this.throwIfDisposed(),eL(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.atanh=function(){return this.throwIfDisposed(),sL(this)};j().prototype.avgPool=function(e,t,n,s){return this.throwIfDisposed(),Nb(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),_b(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.batchNorm=function(e,t,n,s,r){return this.throwIfDisposed(),xm(this,e,t,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Cl(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.cast=function(e){return this.throwIfDisposed(),ct(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.ceil=function(){return this.throwIfDisposed(),EL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ds(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof ve&&(e=[e]),Ze([this,...e],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.conv1d=function(e,t,n,s,r,o){return this.throwIfDisposed(),oS(this,e,t,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.conv2dTranspose=function(e,t,n,s,r){return this.throwIfDisposed(),iS(this,e,t,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.conv2d=function(e,t,n,s,r,o){return this.throwIfDisposed(),Ri(this,e,t,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.cos=function(){return this.throwIfDisposed(),Eb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.cosh=function(){return this.throwIfDisposed(),cS(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Yf(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),lS(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),eP(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.depthwiseConv2d=function(e,t,n,s,r,o){return this.throwIfDisposed(),Rb(this,e,t,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.dilation2d=function(e,t,n,s,r){return this.throwIfDisposed(),rP(this,e,t,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.divNoNan=function(e){return this.throwIfDisposed(),lP(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.div=function(e){return this.throwIfDisposed(),yt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.dot=function(e){return this.throwIfDisposed(),hP(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.elu=function(){return this.throwIfDisposed(),bm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.equal=function(e){return this.throwIfDisposed(),Ir(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.erf=function(){return this.throwIfDisposed(),uS(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),CP(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.exp=function(){return this.throwIfDisposed(),ps(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.expandDims=function(e){return this.throwIfDisposed(),Tn(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.expm1=function(){return this.throwIfDisposed(),NP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.fft=function(){return this.throwIfDisposed(),NS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.flatten=function(){return this.throwIfDisposed(),U(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.floor=function(){return this.throwIfDisposed(),wm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.floorDiv=function(e){return this.throwIfDisposed(),sS(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Is(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.greaterEqual=function(e){return this.throwIfDisposed(),ta(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.greater=function(e){return this.throwIfDisposed(),xs(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.ifft=function(){return this.throwIfDisposed(),c1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.irfft=function(){return this.throwIfDisposed(),y6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.isFinite=function(){return this.throwIfDisposed(),OP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.isInf=function(){return this.throwIfDisposed(),PP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.isNaN=function(){return this.throwIfDisposed(),BP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Mb(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.lessEqual=function(e){return this.throwIfDisposed(),_c(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.less=function(e){return this.throwIfDisposed(),Qf(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.localResponseNormalization=function(e,t,n,s){return this.throwIfDisposed(),HP(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logSigmoid=function(){return this.throwIfDisposed(),QP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logSoftmax=function(e){return this.throwIfDisposed(),pS(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Ob(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.log=function(){return this.throwIfDisposed(),Ms(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.log1p=function(){return this.throwIfDisposed(),Fb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Yr(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logicalNot=function(){return this.throwIfDisposed(),Lb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logicalOr=function(e){return this.throwIfDisposed(),mS(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.logicalXor=function(e){return this.throwIfDisposed(),iz(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Vt(this,e,t,n)};j().prototype.maxPool=function(e,t,n,s){return this.throwIfDisposed(),Pb(this,e,t,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.max=function(e,t){return this.throwIfDisposed(),Qs(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.maximum=function(e){return this.throwIfDisposed(),Xo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.mean=function(e,t){return this.throwIfDisposed(),$e(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.min=function(e,t){return this.throwIfDisposed(),Zf(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.minimum=function(e){return this.throwIfDisposed(),Ya(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),pz(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.mod=function(e){return this.throwIfDisposed(),gz(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.mul=function(e){return this.throwIfDisposed(),P(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.neg=function(){return this.throwIfDisposed(),he(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.norm=function(e,t,n){return this.throwIfDisposed(),ym(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.notEqual=function(e){return this.throwIfDisposed(),Ol(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),xS(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.onesLike=function(){return this.throwIfDisposed(),Fs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.pad=function(e,t){return this.throwIfDisposed(),Bb(this,e,t)};j().prototype.pool=function(e,t,n,s,r,o){return this.throwIfDisposed(),Sz(this,e,t,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.pow=function(e){return this.throwIfDisposed(),Ai(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.prelu=function(e){return this.throwIfDisposed(),Wb(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.prod=function(e,t){return this.throwIfDisposed(),Tz(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.reciprocal=function(){return this.throwIfDisposed(),Jz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.relu=function(){return this.throwIfDisposed(),io(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.relu6=function(){return this.throwIfDisposed(),yS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.reshapeAs=function(e){return this.throwIfDisposed(),U(this,e.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.reshape=function(e){return this.throwIfDisposed(),U(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),DS(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),MS(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.reverse=function(e){return this.throwIfDisposed(),Fi(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.rfft=function(){return this.throwIfDisposed(),$6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.round=function(){return this.throwIfDisposed(),wS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.rsqrt=function(){return this.throwIfDisposed(),vS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.selu=function(){return this.throwIfDisposed(),$S(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.separableConv2d=function(e,t,n,s,r,o){return this.throwIfDisposed(),CS(this,e,t,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sigmoid=function(){return this.throwIfDisposed(),Nc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sign=function(){return this.throwIfDisposed(),c6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sin=function(){return this.throwIfDisposed(),kS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sinh=function(){return this.throwIfDisposed(),IS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.slice=function(e,t){return this.throwIfDisposed(),se(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.softmax=function(e){return this.throwIfDisposed(),qb(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.softplus=function(){return this.throwIfDisposed(),oh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Vb(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.split=function(e,t){return this.throwIfDisposed(),fs(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sqrt=function(){return this.throwIfDisposed(),xe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.square=function(){return this.throwIfDisposed(),ie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.squaredDifference=function(e){return this.throwIfDisposed(),_S(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.squeeze=function(e){return this.throwIfDisposed(),ih(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof ve?[this,e]:[this,...e];return vn(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.step=function(e){return this.throwIfDisposed(),ah(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.stridedSlice=function(e,t,n,s,r,o,i,a){return this.throwIfDisposed(),_6(this,e,t,n,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sub=function(e){return this.throwIfDisposed(),lt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.sum=function(e,t){return this.throwIfDisposed(),xt(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.tan=function(){return this.throwIfDisposed(),E6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.tanh=function(){return this.throwIfDisposed(),gm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.tile=function(e){return this.throwIfDisposed(),On(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.toBool=function(){return this.throwIfDisposed(),ct(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.toFloat=function(){return this.throwIfDisposed(),ct(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.toInt=function(){return this.throwIfDisposed(),ct(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.topk=function(e,t){return this.throwIfDisposed(),D6(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.transpose=function(e){return this.throwIfDisposed(),Wt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.unique=function(e){return this.throwIfDisposed(),O6(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),RS(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.unstack=function(e){return this.throwIfDisposed(),Oi(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.where=function(e,t){return this.throwIfDisposed(),wn(e,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */j().prototype.zerosLike=function(){return this.throwIfDisposed(),Gt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,hr.prototype)}}class Ts extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ts.prototype)}}class z extends Error{constructor(t){super(t),Object.setPrototypeOf(this,z.prototype)}}class Mt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Mt.prototype)}}class _y extends Error{constructor(t){super(t),Object.setPrototypeOf(this,_y.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CN{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Li(e,t){if(Array.isArray(e)){let n=[];for(let s=0;s<t;s++)n=n.concat(e);return n}else{const n=new Array(t);return n.fill(e),n}}function fr(e,t){if(!e)throw new _y(t)}function C2(e,t){let n=0;for(const s of e)s===t&&n++;return n}function En(e){return e.length===1?e[0]:e}function Yt(e){return Array.isArray(e)?e:[e]}function Br(e){const n=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function hi(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let ys={};function Ty(e){if(e==null)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function h1(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>h1(t));else{const t=Object.keys(e);for(const n of t){const s=e[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?e[n]=s.value:h1(s))}}}function hh(e,t={},n={},s="object",r=!1){if(typeof e=="string"){const o=e;let i;if(o in n)i=n[o];else if(o in ys)i=ys[o];else if(i=t[o],i==null)throw new z(`Unknown ${s}: ${e}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=e;if(o.className==null||o.config==null)throw new z(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,c;if(i in n?[a,c]=n[i]:i in ys?[a,c]=ys.className:i in t&&([a,c]=t[i]),a==null)throw new z(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const d of Object.keys(ys))l[d]=ys[d];for(const d of Object.keys(n))l[d]=n[d];const u=o.config;u.customObjects=l;const h=Object.assign({},ys);for(const d of Object.keys(n))ys[d]=n[d];h1(o.config);const f=c(a,o.config,n,r);return ys=Object.assign({},h),f}else{const l=Object.assign({},ys);for(const h of Object.keys(n))ys[h]=n[h];const u=new a(o.config);return ys=Object.assign({},l),u}}}function kV(e,t){return e<t?-1:e>t?1:0}function Vh(e,t){return-1*kV(e,t)}function _o(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)===-1&&t.push(n);return t}function IV(e){if(e==null)throw new z(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function na(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new z(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function Ey(e,t,n=0,s=1/0){return fr(n>=0),fr(s>=n),Array.isArray(e)&&e.length>=n&&e.length<=s&&e.every(r=>typeof r===t)}function We(e,t){Array.isArray(e)?(D(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,s)=>We(n,`element ${s+1} of ${t}`))):D(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${kN(e)}.`)}function kN(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>kN(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function SV(e,t,n){let s=n!=null?n():_n(),r;return(...i)=>{const a=n!=null?n():_n();return a-s<t||(s=a,r=e(...i)),r}}function IN(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let NV=0;function SN(){return NV++}const Wh={};function Im(e=""){return e in Wh||(Wh[e]=0),Wh[e]+=1,e+Wh[e].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _V=["channelsFirst","channelsLast"],TV=["nearest","bilinear"],EV=["valid","same","causal"],RV=["max","avg"],AV=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const pa=new Map;function _e(e){na(_V,"DataFormat",e)}function DV(e){na(TV,"InterpolationFormat",e)}function bs(e){na(EV,"PaddingMode",e)}function NN(e){na(RV,"PoolMode",e)}const kl=[],k2="/";function yi(e,t){kl.push(e);try{const n=t();return kl.pop(),n}catch(n){throw kl.pop(),n}}function MV(){return kl.length===0?"":kl.join(k2)+k2}function _N(e){if(!EN(e))throw new Error("Not a valid tensor name: '"+e+"'");return MV()+e}function TN(e){if(!EN(e))throw new Error("Not a valid tensor name: '"+e+"'");pa.has(e)||pa.set(e,0);const t=pa.get(e);if(pa.set(e,pa.get(e)+1),t>0){const n=`${e}_${t}`;return pa.set(n,1),n}else return e}const FV=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function EN(e){return!!e.match(FV)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OV(e){return e===parseInt(e.toString(),10)}function To(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let s=1;for(let r=t;r<n;++r)s*=e[r];return s}function Za(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n];s<t&&(t=s)}return t}function Ao(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n];s>t&&(t=s)}return t}function er(e,t){if(t<e)throw new z(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let s=e;s<t;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Xg;function Ae(){return Xg==null&&(Xg=u4().epsilon()),Xg}function nr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $r(e,t){return ct(e,t)}function fh(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),U(e,n)}function LV(e,t){return H(()=>{if(e.shape.length!==2)throw new z(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);const n=fh(e,1);return f1(n,[1,t,1])})}function PV(e){const t=[To(e.shape)];return U(e,t)}function zV(e){if(e.rank<=1)throw new z(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],To(e.shape,1)];return U(e,t)}function wi(e,t,n){return H(()=>{switch(e.rank){case 1:return Gb(e,t,n);case 2:return SS(e,[t,0],[n,e.shape[1]]);case 3:return Hb(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return td(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return se(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return se(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new z(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function jg(e,t,n){return H(()=>{switch(e.rank){case 1:return Gb(e,t,n);case 2:return SS(e,[0,t],[e.shape[0],n]);case 3:return Hb(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return td(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Uh(e,t,n,s){return H(()=>{switch(e.rank){case 1:return Gb(e,t,n);case 2:switch(s){case 1:return wi(e,t,n);case 2:return jg(e,t,n);default:throw new z(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return wi(e,t,n);case 2:return Hb(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return jg(e,t,n);default:throw new z(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return wi(e,t,n);case 2:return td(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return td(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return jg(e,t,n);default:throw new z(`The axis is not within the rank of the tensor ${s}`)}default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Ry(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),Ze(e,t)}function I2(e,t){switch(e.rank){case 1:return DL([e,t]);case 2:return FL([e,t],0);case 3:return LL([e,t],0);case 4:return zL([e,t],0);default:throw new z(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function f1(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new z(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return On(e,t)}function Sm(e,t=0,n=1,s,r){return Oa(e,t,n,s,r)}function Cr(e,t,n,s){if(e.rank<2||t.rank<2)throw new Mt(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){const r=e.shape.slice(-1)[0],o=t.shape.slice(-2)[0];if(r!==o)throw new Mt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return h2({a:e,b:t,transposeA:!1,transposeB:!1,bias:s?d1(e.rank,s,nr()):null,activation:n});{const r=e.shape.slice(),o=r.pop();e=U(e,[-1,o]);const i=t.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],u=Array.from({length:t.rank},(p,g)=>g===0?t.rank-2:g<=t.rank-2?g-1:g);t=U(Wt(t,u),[c,-1]);const h=[...r,...l];return U(h2({a:e,b:t,transposeA:!1,transposeB:!1,bias:s?d1(e.rank,s,nr()):null,activation:n}),h)}}function RN(e,t,n){return H(()=>(Array.isArray(t)?t=es(t,"int32"):t=ct(t,"int32"),Is(e,t,n)))}function dh(e){return P(e,e)}function d1(e,t,n){const s=t.shape;if(t.rank!==1&&t.rank!==e)throw new z(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return s.length===1?U(t,[1,s[0],1,1,1]):U(t,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?U(t,[1,1,1,1,s[0]]):U(t,[1].concat(s))}else if(e===4){if(n==="channelsFirst")return s.length===1?U(t,[1,s[0],1,1]):U(t,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?U(t,[1,1,1,s[0]]):U(t,[1].concat(s))}else if(e===3){if(n==="channelsFirst")return s.length===1?U(t,[1,s[0],1]):U(t,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?U(t,[1,1,s[0]]):U(t,[1].concat(s))}else if(e<3)return t;throw new z(`Unsupported input rank by biasAdd: ${t.rank}`)}function ar(e,t,n){return H(()=>(n==null&&(n=nr()),_e(n),nt(e,d1(e.rank,t,n))))}function BV(e,t=1){if(t!==1)throw new Mt(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return bm(e)}function VV(e){return H(()=>yt(e,nt(ze(e),1)))}function AN(e,t,n,s){return H(()=>U6(e,t,n,s))}function WV(e){return H(()=>{const t=nt(.5,P(.2,e));return ds(t,0,1)})}function ph(e,t,n=!1){return n?e():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const UV=["fanIn","fanOut","fanAvg"],GV=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function HV(e){na(UV,"FanMode",e)}function qV(e){na(GV,"Distribution",e)}class zs extends Ec{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class DN extends zs{apply(t,n){return Re(t,n)}}DN.className="Zeros";et(DN);class Ay extends zs{apply(t,n){return ts(t,n)}}Ay.className="Ones";et(Ay);class MN extends zs{constructor(t){if(super(),typeof t!="object")throw new z(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new z(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return H(()=>P(Nt(this.value),ts(t,n)))}getConfig(){return{value:this.value}}}MN.className="Constant";et(MN);class FN extends zs{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return Zr(t,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}FN.className="RandomUniform";et(FN);class ON extends zs{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Mt(`randomNormal does not support dType ${n}.`);return Sm(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}ON.className="RandomNormal";et(ON);class LN extends zs{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Mt(`truncatedNormal does not support dType ${n}.`);return ES(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}LN.className="TruncatedNormal";et(LN);class PN extends zs{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return H(()=>{if(t.length!==2||t[0]!==t[1])throw new z("Identity matrix initializer can only be used for 2D square matrices.");return P(this.gain,dS(t[0]))})}getConfig(){return{gain:this.gain}}}PN.className="Identity";et(PN);function XV(e,t="channelsLast"){let n,s;if(_e(t),e.length===2)n=e[0],s=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){const r=To(e,2);n=e[1]*r,s=e[0]*r}else if(t==="channelsLast"){const r=To(e,0,e.length-2);n=e[e.length-2]*r,s=e[e.length-1]*r}}else{const r=To(e);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class ss extends zs{constructor(t){if(super(),t.scale<0)throw new z(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,HV(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,qV(this.distribution),this.seed=t.seed}apply(t,n){const s=XV(t),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Mt(`${this.getClassName()} does not support dType ${n}.`);return ES(t,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return Zr(t,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}ss.className="VarianceScaling";et(ss);class Dy extends ss{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ss.className}}Dy.className="GlorotUniform";et(Dy);class My extends ss{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ss.className}}My.className="GlorotNormal";et(My);class Fy extends ss{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ss.className}}Fy.className="HeNormal";et(Fy);class Oy extends ss{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ss.className}}Oy.className="HeUniform";et(Oy);class Ly extends ss{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ss.className}}Ly.className="LeCunNormal";et(Ly);class Py extends ss{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ss.className}}Py.className="LeCunUniform";et(Py);class zN extends zs{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,n){return H(()=>{if(t.length<2)throw new Mt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=K(t.slice(0,-1)),r=t[t.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=Sm(i,0,1,n,this.seed),c=r5.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=P(l,h.sign()),s<r&&(l=l.transpose()),P(Nt(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}zN.className="Orthogonal";et(zN);const S2={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function N2(e,t={}){return hh(e,Ns.getMap().classNameMap,t,"initializer")}function pe(e){return Ty(e)}function le(e){if(typeof e=="string"){const t=e in S2?S2[e]:e;if(t==="GlorotNormal")return new My;if(t==="GlorotUniform")return new Dy;if(t==="HeNormal")return new Fy;if(t==="HeUniform")return new Oy;if(t==="LeCunNormal")return new Ly;if(t==="LeCunUniform")return new Py;{const n={};return n.className=t,n.config={},N2(n)}}else return e instanceof zs?e:N2(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function p1(e){return Array.isArray(e)&&Array.isArray(e[0])}function ed(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function St(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new z(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function qt(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new z(`Expected exactly 1 Shape; got ${e.length}`)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nd(e){let t=0;for(const n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((s,r)=>s*r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _2="Variable";class jV{constructor(t,n="float32",s=_2,r=!0,o=null){this.dtype=n??"float32",this.shape=t.shape,this.id=SN(),s=s??_2,this.originalName=_N(s),this.name=TN(this.originalName),this.trainable_=r,this.constraint=o,this.val=z6(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),KV(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function KV(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function m1(e){return e.map(t=>t.read())}function zy(e){e.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class De{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Sr{constructor(t,n,s,r,o,i,a){this.dtype=t,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=SN(),i!=null&&(this.originalName=_N(i),this.name=TN(this.originalName)),this.rank=n.length}}let YV=0,Nm=class{constructor(t,n){this.callArgs=n,this.id=YV++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},ZV=0;class Pt extends Ec{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=ZV++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const s=this.getClassName();n=Br(s)+"_"+Im(s)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let o=null;t.batchSize!=null&&(o=t.batchSize),s=[o].concat(t.inputShape)}this.batchInputShape=s;let r=t.dtype;r==null&&(r=t.inputDType),r==null&&(r="float32"),this.dtype=r}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new Ts(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new z(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return En(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return En(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new hr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new hr(`Layer ${this.name} is not connected, no input to return.`);return En(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new hr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new hr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return En(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const n=Yt(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Yt(this.inputSpec);if(n.length!==s.length)throw new z(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${t}`);for(let r=0;r<n.length;r++){const o=n[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new z(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new z(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new z(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new z(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const c=o.shape;for(const l in i.axes){const u=Number(l),h=i.axes[l],f=u>=0?c[u]:c[c.length+u];if(h!=null&&[h,null].indexOf(f)===-1)throw new z(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${h} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){const l=i.shape[c],u=o.shape[c];if(l!=null&&u!=null&&l!==u)throw new z(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const s=Yt(t),r=tW(t),o=eW(t);if(r===o)throw new z("Arguments to apply() must be all SymbolicTensors or all Tensors");return yi(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const i=[];for(const a of Yt(t))i.push(a.shape);this.build(En(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(t),o){let i=this.call(t,n);this.supportsMasking&&this.setMaskMetadata(t,i);const a=Yt(i),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=En(c),this.activityRegularizer!=null)throw new Mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=QV(t),a=this.computeOutputShape(i);let c;const l=JV(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((u,h)=>new Sr(l,u,this,Yt(t),n,this.name,h)):c=new Sr(l,a,this,Yt(t),n,this.name),this.addInboundNode(t,c,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new Mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&t[r]!=null&&t[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new hr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new hr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ts(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return nd(this.weights)}build(t){this.built=!0}getWeights(t=!1){return m1(t?this.trainableWeights:this.weights)}setWeights(t){H(()=>{const n=this.weights;if(n.length!==t.length)throw new z(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const s=[],r=m1(n);for(let o=0;o<r.length;++o){const i=r[o],a=n[o],c=t[o];if(!Xt(i.shape,c.shape))throw new z(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}zy(s)})}addWeight(t,n,s,r,o,i,a,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new z(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():le("zeros"));const l=r.apply(n,s),u=new jV(l,s,t,i,a);return l.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=Yt(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(t,n,s){if(!this.supportsMasking)return;const r=this.computeMask(t,s),o=Yt(n),i=Yt(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(t,n,s,r,o,i,a=null){const c=Yt(t);n=Yt(n),s=Yt(s),r=Yt(r),o=ed(o),i=ed(i);const l=[],u=[],h=[];for(const f of c)l.push(f.sourceLayer),u.push(f.nodeIndex),h.push(f.tensorIndex);new Nm({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:h,inputTensors:c,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let f=0;f<n.length;f++)n[f].sourceLayer=this,n[f].nodeIndex=this.inboundNodes.length-1,n[f].tensorIndex=f}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function QV(e){e=Yt(e);const t=[];for(const n of e)t.push(n.shape);return En(t)}function JV(e){return"float32"}function BN(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{const s=t.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],c=s.nodeIndices[o],l=BN(i,a,c);for(const u of l)r.indexOf(u)===-1&&r.push(u)}return r}}}function tW(e){let t=!0;for(const n of Yt(e))if(!(n instanceof Sr)){t=!1;break}return t}function eW(e){let t=!0;for(const n of Yt(e))if(n instanceof Sr){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mh extends Pt{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:Im("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new Sr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Nm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new z(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}mh.className="InputLayer";et(mh);function nW(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new mh({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sW(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return ct(t,e.dtype)}catch{throw new z(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}class vo{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof vo)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=sW(t,n),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new z(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Sr){if(this.id2Value[t.id]==null)throw new z(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new z(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof Sr){if(this.id2Value[t.id]==null)throw new z(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new z(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&zt(this.id2Mask)}}const sd=new CN,rd=new CN;function rW(e){sd!=null&&sd.setMaxEntries(e),rd!=null&&rd.setMaxEntries(e)}function il(e,t,n,s){const r=n==null?!1:n.training,o=Array.isArray(e),i=o?e:[e],a=i.map(p=>p.name),c=[],l=t.names();for(const p of a)l.indexOf(p)!==-1?c.push(t.getValue(p)):c.push(null);const u=a.join(",")+"|"+t.names().sort().join(",");let h=sd.get(u),f;if(h==null){const p=oW(i,t);h=p.sorted,f=p.recipientCounts,sd.put(u,h),rd.put(u,f)}f={},r||Object.assign(f,rd.get(u));const d=new vo(t);for(let p=0;p<h.length;++p){const g=h[p],m=g.sourceLayer;if(m instanceof mh)continue;const x=[],b=[],w=[];let y=!1;for(const k of g.inputs){const S=d.getValue(k),C=d.getMask(k);x.push(S),b.push(C),C!=null&&(y=!0),r||(f[k.name]--,f[k.name]===0&&!t.hasKey(k)&&a.indexOf(k.name)===-1&&!S.isDisposed&&k.sourceLayer.stateful!==!0&&w.push(S))}y&&(n=n||{},n.mask=b[0]);const v=Yt(m.apply(x,n));let $=null;m.supportsMasking&&($=m.computeMask(x,b));const I=aW(g),N=Array.isArray(I)?I:[I];for(let k=0;k<N.length;++k){d.hasKey(N[k])||d.add(N[k],v[k],Array.isArray($)?$[0]:$);const S=a.indexOf(N[k].name);S!==-1&&(c[S]=v[k])}r||zt(w)}return d.disposeMasks(),o?c:c[0]}function oW(e,t){D(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(e.length===1){const r=T2(e[0],t);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of e){const{sorted:i,recipientMap:a}=T2(o,t);for(const c of i)r.has(c.name)||(n.push(c),r.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:n,recipientCounts:iW(s)}}function iW(e){const t={};for(const n in e)t[n]=e[n].size;return t}function T2(e,t){const n=new Set,s=[],r={};for(const a of t.names())n.add(a);const o=[],i=[];for(o.push(e);o.length>0;){const a=o[o.length-1];if(n.has(a.name)){o.pop();continue}const c=i[i.length-1]===o.length-1;if(a.inputs.length===0||c)o.pop(),s.push(a),n.add(a.name),c&&i.pop();else{i.push(o.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!n.has(l.name)&&o.push(l)}}return{sorted:s,recipientMap:r}}function aW(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let s=0;s<e.sourceLayer.inboundNodes.length;++s)for(const r of e.sourceLayer.inboundNodes[s].outputTensors)if(r.id===e.id){n=s;break}t=e.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cW=X();cW.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,rW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function By(e,t){return H(()=>xe(xt(P(e,e),t,!0)))}class gh extends Ec{getConfig(){return{}}}class VN extends gh{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return H(()=>{const n=By(t,this.axis),s=ds(n,0,this.maxValue);return P(t,yt(s,nt(Ae(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}VN.className="MaxNorm";et(VN);class WN extends gh{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return H(()=>yt(t,nt(Ae(),By(t,this.axis))))}getConfig(){return{axis:this.axis}}}WN.className="UnitNorm";et(WN);class UN extends gh{apply(t){return io(t)}}UN.className="NonNeg";et(UN);class GN extends gh{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return H(()=>{const n=By(t,this.axis),s=nt(P(this.rate,ds(n,this.minValue,this.maxValue)),P(1-this.rate,n));return P(t,yt(s,nt(Ae(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}GN.className="MinMaxNorm";et(GN);const E2={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Me(e){return Ty(e)}function R2(e,t={}){return hh(e,Ns.getMap().classNameMap,t,"constraint")}function Fe(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in E2?E2[e]:e,config:{}};return R2(n)}else return e instanceof gh?e:R2(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function si(e){if(e==null)return;const t=[],n=[],s=[];for(const r in e){const o=e[r];if(typeof o!="number"){const i=o;t.push(i.data()),n.push(r),s.push(i)}}if(t.length>0){const r=await Promise.all(t);for(let o=0;o<r.length;++o)e[n[o]]=r[o][0];zt(s)}}function HN(e){if(e!=null)for(const t in e){const n=e[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var A2;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(A2||(A2={}));const lW=125;class Pl{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class uW{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class hW extends Pl{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const o=n[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=H(()=>nt(this.totals[r],P(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:H(()=>{const r=P(yt(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),wr(n[s])}))}}class fW extends Pl{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const t=[],n=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const c=i[a];t.push(c.data()),n.push(o),s.push(a)}}const r=await Promise.all(t);for(let o=0;o<r.length;++o)this.history[n[o]][s[o]].dispose(),this.history[n[o]][s[o]]=r[o][0]}}class dW extends Pl{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||YS,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=lW),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");q0(this.yieldEvery)&&(this.maybeWait=SV(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,s){const r=[];this.yield!=null&&(await si(s),r.push(this.yield(t,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await si(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const s=[];this.epochEnd!=null&&(await si(n),s.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,n){this.batchBegin!=null&&(await si(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const s=[];this.batchEnd!=null&&(await si(n),s.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):q0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await si(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await si(t),await this.trainEnd(t))}}function qN(e,t){return e==null&&(e={}),e instanceof Pl?[e]:Array.isArray(e)&&e[0]instanceof Pl?e:Yt(e).map(s=>new dW(s,t))}class Cs{constructor(){}static registerCallbackConstructor(t,n){D(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Cs.checkForDuplicate(n),Cs.constructors[t]==null&&(Cs.constructors[t]=[]),Cs.constructors[t].push(n)}static checkForDuplicate(t){for(const n in Cs.constructors)Cs.constructors[+n].forEach(r=>{if(r===t)throw new z("Duplicate callback constructor.")})}static clear(){Cs.constructors={}}static createCallbacks(t){const n=[];for(const s in Cs.constructors){const r=+s;t>=r&&n.push(...Cs.constructors[r])}return n.map(s=>new s)}}Cs.constructors={};function XN(e,t,n,s,r,o,i,a,c){const l=new fW,u=[new hW,...Cs.createCallbacks(t)];e!=null&&u.push(...e),u.push(l);const h=new uW(u);return h.setParams({epochs:n,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:t,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jr(e,t={},n=!1){return hh(e,Ns.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function od(e,t){return H(()=>{e.dtype!=="float32"&&(e=ct(e,"float32"));const n=xt(dh(e),t,!0),s=ja(n.shape,Ae()),r=xe(Xo(n,s));return yt(e,r)})}function _m(e,t){return H(()=>$e(dh(lt(t,e)),-1))}function Vy(e,t){return H(()=>$e(ze(lt(t,e)),-1))}function Wy(e,t){return H(()=>{const n=lt(e,t),s=ds(ze(e),Ae(),Number.MAX_VALUE),r=ze(yt(n,s));return P(100,$e(r,-1))})}function pW(e,t){return H(()=>{const n=ds(t,Ae(),Number.MAX_VALUE),s=Ms(nt(1,n)),r=ds(e,Ae(),Number.MAX_VALUE),o=Ms(nt(1,r));return $e(dh(lt(s,o)),-1)})}function mW(e,t){return H(()=>{const n=Xo(0,lt(1,P(e,t)));return $e(dh(n),-1)})}function gW(e,t){return H(()=>{const n=Xo(0,lt(1,P(e,t)));return $e(n,-1)})}function xW(e,t){return H(()=>{const n=xt(P(e,t),-1),s=Qs(P(lt(1,e),t),-1);return Xo(0,nt(1,lt(s,n)))})}function bW(e,t){return H(()=>{const n=Math.log(2),s=lt(t,e),r=lt(nt(s,oh(P(-2,s))),n);return $e(r,-1)})}function zl(e,t,n=!1){return H(()=>{if(n)t=qb(t);else{const s=xt(t,t.shape.length-1,!0);t=yt(t,s)}return t=ds(t,Ae(),1-Ae()),he(xt(P(ct(e,"float32"),Ms(t)),t.shape.length-1))})}function id(e,t,n=!1){return H(()=>{const s=ct(wm(PV(e)),"int32");t=ds(t,Ae(),1-Ae());const r=t.shape,o=U(xS(s,r[r.length-1]),r);return zl(o,t,n)})}function yW(e,t){if(!Xt(e.shape,t.shape))throw new z(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return H(()=>{const n=io(t),s=he(ze(t));return nt(lt(n,P(t,e)),Fb(ps(s)))})}function Tm(e,t){return H(()=>{let n;return n=ds(t,Ae(),1-Ae()),n=Ms(yt(n,lt(1,n))),$e(yW(e,n),-1)})}function wW(e,t){return H(()=>{const n=ds(e,Ae(),1),s=ds(t,Ae(),1);return xt(P(e,Ms(yt(n,s))),-1)})}function vW(e,t){return H(()=>{const n=Ms(nt(Ae(),t));return $e(lt(t,P(e,n)),-1)})}function jN(e,t){return H(()=>{const n=od(e,-1),s=od(t,-1),r=P(n,s);return he(xt(r,-1))})}const ad={meanSquaredError:_m,meanAbsoluteError:Vy,meanAbsolutePercentageError:Wy,meanSquaredLogarithmicError:pW,squaredHinge:mW,hinge:gW,categoricalHinge:xW,logcosh:bW,categoricalCrossentropy:zl,sparseCategoricalCrossentropy:id,binaryCrossentropy:Tm,kullbackLeiblerDivergence:wW,poisson:vW,cosineProximity:jN};function Kg(e){if(typeof e=="string"){if(e in ad)return ad[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new z(t)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KN(e,t){return H(()=>{const n=P(.5,Fs(t)),s=$r(xs(t,n),e.dtype);return $e(Ir(e,s),-1)})}function YN(e,t){return H(()=>$r(Ir(Dl(e,-1),Dl(t,-1)),"float32"))}function $W(e,t){return H(()=>ct(xt(Yr(Ir(e,1),Ir(t,1))),"float32"))}function CW(e,t){return H(()=>ct(xt(Yr(Ir(e,0),Ir(t,1))),"float32"))}function kW(e,t){return H(()=>{const n=$W(e,t),s=CW(e,t),r=nt(n,s);return ct(wn(xs(r,0),yt(n,r),0),"float32")})}function IW(e,t){return Tm(e,t)}function SW(e,t){return e.rank===t.rank&&(e=ih(e,[e.rank-1])),t=Dl(t,-1),t.dtype!==e.dtype&&(t=ct(t,e.dtype)),ct(Ir(e,t),"float32")}const NW=_m,_W=_m,TW=Vy,EW=Vy,RW=Wy,AW=Wy,ZN=zl,DW=jN,QN=id,cd={binaryAccuracy:KN,categoricalAccuracy:YN,precision:kW,categoricalCrossentropy:ZN,sparseCategoricalCrossentropy:QN,mse:NW,MSE:_W,mae:TW,MAE:EW,mape:RW,MAPE:AW,cosine:DW};function MW(e){if(typeof e=="string"&&e in cd)return cd[e];if(typeof e!="string"&&e!=null)return e;throw new z(`Unknown metric ${e}`)}function Gh(e){if(fr(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(const n of Object.keys(ad))if(ad[n]===e){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(cd))if(cd[n]===e){t=n;break}return t!==void 0?t:e.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FW(e){const t={Adagrad:()=>go.adagrad(.01),Adadelta:()=>go.adadelta(1,.95,Ae()),Adam:()=>go.adam(.001,.9,.999,Ae()),Adamax:()=>go.adamax(.002,.9,.999,Ae(),0),RMSProp:()=>go.rmsprop(.001,.9,0,Ae()),SGD:()=>go.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new z(`Unknown Optimizer ${e}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const D2=1*1024*1024;function M2(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!g1(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(e);s.length>D2&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${D2}.`)}}function g1(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if(typeof n!="string"||!g1(e[n]))return!1;return!0}else if(Array.isArray(e)){for(const t of e)if(!g1(t))return!1;return!0}else return!1;else{const t=typeof e;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OW(e,t,n,s=console.log){const r=PW(e),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(t*u)));let i;if(!r){o.push("Receives inputs"),i=[];for(const u in e.nodesByDepth)i.push(...e.nodesByDepth[u])}s("_".repeat(t)),ld(o,n,s),s("=".repeat(t));const a=e.layers;for(let u=0;u<a.length;++u)r?zW(a[u],n,s):BW(a[u],n,i,s),s((u===a.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const c=LW(e),l=nd(e.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(t))}function LW(e){let t;return e.collectedTrainableWeights!=null?t=nd(e.collectedTrainableWeights):t=nd(e.trainableWeights),t}function PW(e){let t=!0;const n=[],s=[];for(const r in e.nodesByDepth)n.push(e.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){t=!1;break}s.push(...r)}if(t)for(const r of e.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){t=!1;break}else o=!0;if(!t)break}return t}function ld(e,t,n=console.log){let s="";for(let r=0;r<e.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=e[r],s=s.slice(0,t[r]),s+=" ".repeat(t[r]-s.length);n(s)}function zW(e,t,n){let s,r;try{r=e.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(e.outputShape)}catch{s="multiple"}const o=e.name,i=e.getClassName(),a=[`${o} (${i})`,r,s,e.countParams().toString()];ld(a,t,n)}function BW(e,t,n,s){let r,o;try{o=e.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}const i=[];for(const h of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){const d=h.inboundLayers[f].name,p=h.nodeIndices[f],g=h.tensorIndices[f];i.push(`${d}[${p}][${g}]`)}const a=e.name,c=e.getClassName(),l=i.length===0?"":i[0],u=[`${a} (${c})`,o,r,e.countParams().toString(),l];ld(u,t,s);for(let h=1;h<i.length;++h)ld(["","","","",i[h]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JN(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function x1(e,t){if(e===null)return null;if(typeof e=="string")return hi(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],s=e.length;for(let r=0;r<s;++r){const o=e[r];JN(t,r,o)?n.push(o):n.push(x1(o,t))}return n}else{const n={};for(const s of Object.keys(e)){const r=e[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const o=hi(s);n[o]=x1(r,o)}}return n}}function b1(e,t){if(e==null)return null;if(typeof e=="string")return Br(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],s=e.length;for(let r=0;r<s;++r){const o=e[r];JN(t,r,o)?n.push(o):n.push(b1(o,t))}return n}else{const n={};for(const s of Object.keys(e)){const r=e[s],o=Br(s);(s==="name"||s==="className")&&typeof r=="string"?n[o]=r:n[o]=b1(r,s)}return n}}/** @license See the LICENSE file. */const t_="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const VW=e=>{const t=Object.keys(e);if(t.length===0)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Gs extends Pt{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Im(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],_o(this.inputs).length!==this.inputs.length)throw new z(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);_o(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const w=b.sourceLayer,y=b.nodeIndex,v=b.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(y),this.outputLayersTensorIndices.push(v)}for(const b of this.inputs){const w=b.sourceLayer,y=b.nodeIndex,v=b.tensorIndex;fr(y===0,"input layer has >1 nodes"),fr(v===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(y),this.inputLayersTensorIndices.push(v)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const w=this.inputLayers[b];if(!(w instanceof mh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},s={},r={},o={},i={},a=[],c=(b,w,y,v,$,I)=>{(v==null||$==null||I==null)&&(v=b.sourceLayer,$=b.nodeIndex,I=b.tensorIndex);const N=v.inboundNodes[$];if(y.indexOf(N)!==-1)throw new Ts(`The tensor ${b.name} at layer "${v.name}" is part of a cycle.`);if(w.indexOf(N)!==-1)return;this.containerNodes.add(Gs.nodeKey(v,$)),v.id in i||(i[v.id]=Object.keys(i).length),y.indexOf(N)===-1&&y.push(N);const k=N.inboundLayers.length;for(let S=0;S<k;S++){const C=N.inputTensors[S],A=N.inboundLayers[S],R=N.nodeIndices[S],_=N.tensorIndices[S];c(C,w,y,A,R,_)}for(w.push(N);y.indexOf(N)>=0;)y.splice(y.indexOf(N),1);a.push(N)},l=[],u=[];for(const b of this.outputs)c(b,l,u);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in n||(n[b.id]=0);let w=n[b.id];const y=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];w=Math.max(w,y),r[b.outboundLayer.id]=w,o[b.outboundLayer.id]=b.outboundLayer,n[b.id]=w;for(let v=0;v<b.inboundLayers.length;v++){const $=b.inboundLayers[v],I=b.nodeIndices[v],N=$.inboundNodes[I],k=n[N.id]==null?0:n[N.id];n[N.id]=Math.max(w+1,k),s[N.id]=N}}const f={};for(const b in n){const w=n[b];w in f||(f[w]=[]),f[w].push(s[b])}const d={};for(const b in r){const w=r[b];w in d||(d[w]=[]),d[w].push(o[b])}let p=Object.keys(d).map(b=>parseInt(b,10)).sort(Vh);this.layers=[];for(const b of p){const w=d[b];w.sort((y,v)=>{const $=i[y.id],I=i[v.id];return $<I?-1:$>I?1:0});for(const y of w)y instanceof Gs&&this.internalContainerRefs.push(y),this.layers.push(y)}this.layersByDepth=d,p=Object.keys(f).map(b=>parseInt(b,10)).sort(Vh);const g=this.inputs.slice(),m=[];for(const b of p)for(const w of f[b]){const y=w.outboundLayer;if(y!=null){for(const v of w.inputTensors)if(g.indexOf(v)===-1)throw new Ts(`Graph disconnected: cannot obtain value for tensor ${v} at layer "${y.name}". The following previous layers were accessed without issue: ${m}`);for(const v of w.outputTensors)g.push(v);m.push(y.name)}}this.nodesByDepth=f;const x=this.layers.map(b=>b.name);for(const b of x){const w=x.filter(y=>y===b).length;if(w!==1)throw new Ts(`The name "${b}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new Nm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const s={};let r=0;const o=VW(t);o&&this.parseWeights(t);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const u=o?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[u]!=null)throw new z(`Duplicate weight name: ${u}`);s[u]=l,r++}const i=[];for(const a in t){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)i.push([s[c],t[a]]);else if(n)throw new z(`Provided weight data has no target variable: ${a}`);delete s[c]}if(n){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new z(`${a.length} of ${r} weights are not set: ${a}`)}zy(i)}parseWeights(t){for(const n in Object.keys(t)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==n&&(t[o]=t[n],delete t[n])}}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${t_}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const s=b1(this.updatedConfig());return n?JSON.stringify(s):s}call(t,n){return H(()=>{t=Yt(t);const s=new vo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],t[r]);return il(this.outputs,s,n)})}computeMask(t,n){return H(()=>{t=Yt(t);let s;return n==null?s=Li(null,t.length):s=Yt(n),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const n=ed(t);if(n.length!==this.inputLayers.length)throw new z(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const c=this.inputLayers[a],l=n[a],u=c.name+"_0_0";s[u]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Vh);if(r.length>1)for(const a of r){const c=this.nodesByDepth[a];for(const l of c){const u=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(u.id)!==-1)continue;const h=[];for(let g=0;g<l.inboundLayers.length;g++){const m=l.inboundLayers[g],x=l.nodeIndices[g],b=l.tensorIndices[g],w=`${m.name}_${x}_${b}`,y=s[w];h.push(y)}const f=u.computeOutputShape(En(h)),d=ed(f),p=u.inboundNodes.indexOf(l);for(let g=0;g<d.length;g++){const m=`${u.name}_${p}_${g}`;s[m]=d[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${u}`;i.push(h)}for(let a=0;a<i.length;a++){const c=i[a];fr(c in s),o.push(s[c])}return En(o)}runInternalGraph(t,n){n==null&&(n=Li(null,t.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],u=t[c],h=n[c];s[l.id]=[u,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Vh);for(const c of r){const l=this.nodesByDepth[c];for(const u of l){const h=u.outboundLayer,f=u.inputTensors,d=u.outputTensors,p=new Array;for(const g of f)g.id in s&&p.push(s[g.id]);if(p.length===f.length){let g={},m,x,b,w;if(u.callArgs!=null&&(g=u.callArgs),p.length===1){const[y,v]=p[0];g.mask==null&&(g.mask=v),b=Yt(h.call(y,g)),w=Yt(h.computeMask(y,v)),m=[y],x=[v]}else m=p.map(y=>y[0]),x=p.map(y=>y[1]),g.mask==null&&(g.mask=x),b=Yt(h.call(m,g)),w=Yt(h.computeMask(m,x));if(h.activityRegularizer)throw new Mt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let y=0;y<d.length;++y){const v=d[y],$=b[y],I=w[y];s[v.id]=[$,I]}}}}const o=[],i=[],a=[];for(const c of this.outputs){fr(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,u]=s[c.id];a.push(l.shape),o.push(l),i.push(u)}return[o,i,a]}buildNodeConversionMap(t){const n={};let s;for(const r of this.layers){s=r instanceof Gs?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=Gs.nodeKey(r,o);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new z("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new z(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new z(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return H(()=>{const t=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=Gs.nodeKey(n,s);this.containerNodes.has(r)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),c=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const f=i.inboundNodes[h],d=Gs.nodeKey(i,h);let p={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),p=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(f.inboundLayers.length>0){const g=[];for(let m=0;m<f.inboundLayers.length;m++){const x=f.inboundLayers[m],b=f.nodeIndices[m],w=f.tensorIndices[m],y=Gs.nodeKey(x,b);let v=n[y];v==null&&(v=0),g.push([x.name,v,w,p])}l.push(g)}}}const u={};u.name=i.name,u.className=a,u.config=c,u.inboundNodes=l,s.push(u)}t.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=Gs.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=n[l];u==null&&(u=0);const h=this.inputLayersTensorIndices[i];r.push([a.name,u,h])}t.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=Gs.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=n[l];u==null&&(u=0);const h=this.outputLayersTensorIndices[i];o.push([a.name,u,h])}return t.outputLayers=o,t}static fromConfig(t,n,s={},r=!1){const o={},i={};function a(m,x){m.name in i?i[m.name].push(x):i[m.name]=[x]}function c(m,x){const b=[];let w;for(const y of x){const v=y[0],$=y[1],I=y[2];if(w=y[3]==null?{}:y[3],!(v in o)){a(m,x);return}const N=o[v];if(N.inboundNodes.length<=$){a(m,x);return}const k=N.inboundNodes[$];b.push(k.outputTensors[I])}b.length>0&&m.apply(En(b),w)}function l(m){const x=m.name,b=jr(m,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(r),o[x]=b,m.inboundNodes.forEach(y=>{if(!(y instanceof Array))throw new z(`Corrupted configuration, expected array for nodeData: ${y}`);a(b,y)})}const u=n.name,h=n.layers;for(const m of h)l(m);for(;!IV(i);)for(const m of h){const x=o[m.name];if(x.name in i){const b=i[x.name];delete i[x.name];for(const w of b)c(x,w)}}const f=[],d=[],p=n.inputLayers;for(const m of p){const x=m[0],b=m[1],w=m[2];fr(x in o);const v=o[x].inboundNodes[b].outputTensors;f.push(v[w])}const g=n.outputLayers;for(const m of g){const x=m[0],b=m[1],w=m[2];fr(x in o);const v=o[x].inboundNodes[b].outputTensors;d.push(v[w])}return new t({inputs:f,outputs:d,name:u})}get stateful(){if(this._stateful)throw new z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){H(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WW(e,t,n){const s=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>null);if(s===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==s)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){const r=[];return t.forEach(o=>{o in e?r.push(e[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function e_(e,t){return WW(e,t,"classWeight")}async function n_(e,t,n,s){if(n!=null){const r=H(()=>{if(e.shape.length===1)return bi(e);if(e.shape.length===2){if(e.shape[1]>1)return Dl(e,1);if(e.shape[1]===1)return U(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());zt(r);const i=[];return o.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),es(i,"float32")}else return null}function UW(e,t){return P(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const GW=32;function s_(e,t){let n,s;const r=t;n=r.xs,s=r.ys,D(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const o=F2("input",e.inputNames,n),i=F2("output",e.outputNames,s),a=o[0].shape[0];D(o.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),D(i.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let c=0;c<o.length;c++)D(o[c].shape[0]===a,()=>`Batch size mismatch: input ${e.inputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);for(let c=0;c<i.length;c++)D(i[c].shape[0]===a,()=>`Batch size mismatch: output ${e.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);return{xs:o,ys:i}}function F2(e,t,n){if(n instanceof ve)return[n];if(Array.isArray(n))return D(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const s=[];for(const r of t){if(n[r]==null)throw new z(`The feature data generated by the dataset lacks the required ${e} key '${r}'.`);s.push(n[r])}return s}}function HW(e){if(e.length===3)throw new Mt("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function qW(e,t,n){const s=n.batchesPerEpoch!=null;if(D(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),D(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),D(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),D(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),D(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const r=n.validationData!=null;let o,i;if(r)if(O2(n.validationData))D(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const m=HW(n.validationData);o=m.xs,i=m.ys}const a=e.makeTrainFunction(),c=e.getDedupedMetricsNames();let l;r?l=c.slice().concat(c.map(m=>"val_"+m)):l=c.slice();const u=qN(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:f,history:d}=XN(u,h,n.epochs,null,null,XW(t,n),null,r,l);f.setModel(e),e.history=d,await f.onTrainBegin(),e.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,g=await t.iterator();for(;p<n.epochs;){const m={};await f.onEpochBegin(p);let x=0,b=0;for(s||(g=await t.iterator());!s||x<n.batchesPerEpoch;){const w=await g.next();if(s&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:y,ys:v}=s_(e,w.value),$={};$.batch=b,$.size=y[0].shape[0],await f.onBatchBegin(b,$);const I=[];if(n.classWeight!=null){const S=e_(n.classWeight,e.outputNames);for(let C=0;C<S.length;++C)I.push(await n_(v[C],null,S[C]))}const N=y.concat(v).concat(I),k=a(N);zt(N);for(let S=0;S<c.length;++S){const C=c[S],A=k[S];$[C]=A,wr(A)}await f.onBatchEnd(b,$),HN($),b++,x++}if(s?x>=n.batchesPerEpoch:w.done){if(r){let y;O2(n.validationData)?y=Yt(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):y=Yt(e.evaluate(o,i,{batchSize:n.validationBatchSize==null?GW:n.validationBatchSize,verbose:0}));for(let v=0;v<e.metricsNames.length;++v)m[`val_${e.metricsNames[v]}`]=y[v]}break}if(e.stopTraining_)break}if(await f.onEpochEnd(p,m),p++,e.stopTraining_)break}return await f.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function XW(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function O2(e){return typeof e.iterator=="function"}function jW(e){return typeof e.next=="function"}async function KW(e,t,n){n=n||{};const s=n.batches!=null,r=e.testFunction;let o=[];if(n.verbose>0)throw new Mt("Verbose mode is not implemented yet.");D(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=jW(t)?t:await t.iterator();let a=0,c=0;for(;!s||c<n.batches;){const l=await i.next();if(o=H(()=>{if(l.value){const{xs:u,ys:h}=s_(e,l.value),f=u.concat(h),d=H(()=>r(f));if(zt(f),c===0)for(let g=0;g<d.length;++g)o.push(Nt(0));const p=f[0].shape[0];for(let g=0;g<d.length;++g){const m=d[g],x=o[g];o[g]=H(()=>nt(o[g],P(p,m))),c>0&&zt(x)}zt(d),a+=p,++c}return o}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<o.length;++l){const u=o[l];o[l]=yt(o[l],a),zt(u)}return En(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yg(e){D(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function jc(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(s=>wi(s,t,n-t)):wi(e,t,n-t)}function y1(e,t){return H(()=>e==null?null:Array.isArray(e)?e.map(n=>y1(n,t)):RN(e,t.dtype==="int32"?t:ct(t,"int32")))}function Zg(e,t){const n=[];let s=0,r=null;for(;s<e;)r=s+t,r>=e&&(r=e),n.push([s,r]),s=r;return n}function r_(e){const t=[];e instanceof ve&&(e=[e]);for(let n=0;n<e.length;++n){const s=e[n];if(s.rank===1)t.push(fh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function Us(e,t){if(e==null)return;const n=[];if(t instanceof ve)n.push(t.id);else if(Array.isArray(t))t.forEach(r=>n.push(r.id));else if(t!=null)for(const r in t){const o=t[r];n.push(o.id)}const s=[];if(e instanceof ve)n.indexOf(e.id)===-1&&s.push(e);else if(Array.isArray(e))e.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(e!=null)for(const r in e){const o=e[r];n.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YW(e){return e instanceof ve}function w1(e){return Array.isArray(e)}function L2(e){return!YW(e)&&!w1(e)}function P2(e,t,n,s=!0,r=""){if(t==null||t.length===0){if(e!=null){let i=!1;if(w1(e)&&e.length>0)i=!0;else if(L2(e)){for(const a in e)if(e.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new z(`Error when checking model ${r} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(i=>null);let o;if(L2(e)){e=e,o=[];for(const i of t){if(e[i]==null)throw new z(`No data provided for "${i}". Need data for each key in: ${t}`);o.push(e[i])}}else if(w1(e)){if(e=e,e.length!==t.length)throw new z(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);o=e}else{if(e=e,t.length>1)throw new z(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);o=[e]}if(o=r_(o),n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new z(`Error when checking ${r}: expected ${t[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<n[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],u=n[i][c];if(u!=null&&u>=0&&l!==u)throw new z(`${r} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function ZW(e,t,n){const s=_o(e.map(o=>o.shape[0]));s.sort();const r=_o(t.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new z(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(r.length>1)throw new z(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!Xt(s,r))throw new z(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function QW(e,t,n){const s=[_m,Tm,zl];for(let r=0;r<e.length;++r){const o=e[r],i=t[r],a=n[r];if(i!=null){if(i===zl&&o.shape[o.shape.length-1]===1)throw new z(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const c=o.shape.slice(1),l=a.slice(1);for(let u=0;u<c.length;++u){const h=c[u],f=l[u];if(f!=null&&h!==f)throw new z(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function z2(e,t,n,s=!0,r=""){let o;if(Array.isArray(e)){if(e.length!==t.length)throw new z(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);o=e}else{if(t.length>1)throw new z(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);o=[e]}if(n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new z(`Error when checking ${r}: expected ${t[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<n[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],u=n[i][c];if(u!=null&&u!==l)throw new z(`Error when checking ${r}: expected ${t[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function JW(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(s=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(s=>n);{const s=[];for(const r of t){let o=n.hasOwnProperty(r)?n[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const tU="layers-model";class La extends Gs{constructor(t){super(t),this.isTraining=!1}summary(t,n,s=console.log){if(!this.built)throw new z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");OW(this,t,n,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=FW(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof jo))throw new z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const i in t.loss)if(this.outputNames.indexOf(i)===-1)throw new z(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)t.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push(Kg(t.loss[i]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new z(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(a=>Kg(a))}else{const i=Kg(t.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],c=this.outputNames[i];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],yi("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=JW(t.metrics,this.outputNames),o=(i,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,i])};yi("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(l=>{const u="";let h,f,d;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const m=this.internalOutputShapes[i];m[m.length-1]===1||this.lossFunctions[i]===Tm?["accuracy","acc"].indexOf(p)!==-1?f=KN:["crossentropy","ce"].indexOf(p)!==-1&&(f=IW):this.lossFunctions[i]===id?["accuracy","acc"].indexOf(p)!==-1?f=SW:["crossentropy","ce"].indexOf(p)!==-1&&(f=QN):["accuracy","acc"].indexOf(p)!==-1?f=YN:["crossentropy","ce"].indexOf(p)!==-1&&(f=ZN);let x;["accuracy","acc"].indexOf(p)!==-1?x="acc":["crossentropy","ce"].indexOf(p)!==-1&&(x="ce"),d=f,h=u+x}else d=MW(p),h=u+Gh(p);let g;yi(h,()=>{g=d}),o(i,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,s={}){const r=s.batchSize==null?32:s.batchSize;Yg(r);const i=this.standardizeUserDataXY(t,n,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,r,s.verbose,s.steps);return En(l)}finally{Us(i[0],t),Us(i[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),KW(this,t,n)}checkNumSamples(t,n,s,r="steps"){let o;if(s!=null){if(o=null,n!=null)throw new z(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new z(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new z("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],o=this.retrieveSymbolicTensors(r),i=new vo;if(t instanceof ve&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new z(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)i.add(this.inputs[c],t[c])}else for(const c of this.inputs){const l=t[c.name];if(l==null)throw new z(`No value is provided for the model's input ${c.name}`);i.add(c,l)}const a=il(o,i);return s?a:a[0]}retrieveSymbolicTensors(t){const n=Li(null,t.length);let s=t.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<t.length;++a){const c=i.indexOf(t[a]);if(c!==-1&&(n[a]=o[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((o,i)=>{o==null&&r.push(t[i])}),new z(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(t,n=32,s=!1){return H(()=>{const r=this.checkNumSamples(t);if(s)throw new Mt("Verbose predictLoop() is not implemented yet.");const o=Zg(r,n),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)H(()=>{const l=o[a][0],u=o[a][1],h=jc(t,l,u),f=[];if(Array.isArray(h))for(let p=0;p<h.length;++p)f.push({key:this.inputs[p],value:h[p]});else f.push({key:this.inputs[0],value:h});const d=new vo(f);return il(this.outputs,d)}).forEach((l,u)=>i[u].push(l));return En(i.map(a=>Ze(a,0)))})}predict(t,n={}){const s=r_(t);z2(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Yg(r),this.predictLoop(s,r)}finally{Us(s,t)}}predictOnBatch(t){z2(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,s=!0,r){if(this.optimizer_==null)throw new Ts("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===id?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(t=P2(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=P2(n,this.feedOutputNames,o,!1,"target"),ZW(t,n),QW(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&t[0].shape[0]%r!==0)throw new z(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,s,r,o=!0,i){const[a,c]=this.standardizeUserDataXY(t,n,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const u=e_(r,this.outputNames);l=[];for(let h=0;h<u.length;++h)l.push(await n_(c[h],null,u[h]))}return[a,c,l]}testLoop(t,n,s,r=0,o){return H(()=>{const i=this.checkNumSamples(n,s,o,"steps"),a=[];if(r>0)throw new Mt("Verbose mode is not implemented yet.");if(o!=null)throw new Mt("steps mode in testLoop() is not implemented yet");{const c=Zg(i,s),l=es(er(0,i));for(let u=0;u<c.length;++u){const h=c[u][0],f=c[u][1],d=wi(l,h,f-h),p=y1(n,d),g=t(p);if(u===0)for(let m=0;m<g.length;++m)a.push(Nt(0));for(let m=0;m<g.length;++m){const x=g[m];a[m]=nt(a[m],P(f-h,x))}}for(let u=0;u<a.length;++u)a[u]=yt(a[u],i)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let s=0;s<t.length;++s){const r=t[s];let o=r;if(C2(t,r)>1){const i=C2(t.slice(0,s),r);o+=`_${i}`}n.push(o)}return n}makeTrainFunction(){return t=>{const n=[],s=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const f=new vo(h),d=il(this.outputs,f,{training:!0});let p;for(let g=0;g<this.lossFunctions.length;++g){const m=this.lossFunctions[g];let x=m(r[g],d[g]);o[g]!=null&&(x=UW(x,o[g]));const b=$e(x);n.push(b),g===0?p=x:p=nt(p,x)}for(let g=0;g<this.metricsTensors.length;++g){let m;if(this.outputs.length>1&&g<this.outputs.length)m=n[g];else{const x=this.metricsTensors[g][0],b=this.metricsTensors[g][1];m=$e(x(r[b],d[b]))}wr(m),i.push(m)}return p=$e(p),this.calculateLosses().forEach(g=>{p=nt(p,g)}),p},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,c)].concat(i)}}makeTestFunction(){this.testFunction=t=>H(()=>{const n=[];let s;const r=t.slice(0,this.inputs.length),o=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:r[l]});const a=new vo(i),c=il(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const u=this.lossFunctions[l],h=$e(u(o[l],c[l]));l===0?s=h:s=nt(s,h),n.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const u=this.metricsTensors[l][0],h=this.metricsTensors[l][1],f=$e(u(o[h],c[h]));n.push(f)}return n})}async fit(t,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,c,l,u,h,f;try{const d=s.batchSize==null?32:s.batchSize;Yg(d);const g=await this.standardizeUserData(t,n,s.sampleWeight,s.classWeight,!1,d);r=g[0],o=g[1],f=g[2];let m=!1,x;if(s.validationData!=null&&s.validationData.length>0){if(m=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new Mt("validationData including sample weights is not supported yet."):new z(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const S=await this.standardizeUserData(c,l,null,null,!0,d);u=S[0],h=S[1],x=u.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){m=!0;const k=Math.floor(r[0].shape[0]*(1-s.validationSplit)),S=r[0].shape[0];u=jc(r,k,S),i=r,r=jc(r,0,k),h=jc(o,k,S),a=o,o=jc(o,0,k),x=u.concat(h)}else s.validationSteps!=null&&(m=!0);const b=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),y=this.getDedupedMetricsNames();let v,$;m?(this.makeTestFunction(),v=this.testFunction,$=y.slice().concat(y.map(k=>"val_"+k))):(v=null,x=[],$=y.slice());const I=qN(s.callbacks,s.yieldEvery);return await this.fitLoop(w,b,y,d,s.epochs,s.verbose,I,v,x,s.shuffle,$,s.initialEpoch,null,null)}finally{this.isTraining=!1,Us(r,t),Us(o,n),Us(i,t),Us(a,n),Us(u,c),Us(h,l),f!=null&&zt(f)}}async fitLoop(t,n,s,r,o,i,a,c,l,u,h,f,d,p){r==null&&(r=32),o==null&&(o=1),u==null&&(u=!0),f==null&&(f=0);let g=!1;if(c!=null&&l!=null&&(g=!0),p!=null&&(g=!0,d==null))throw new z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(n,r,d,"steps_per_epoch");let x;m!=null&&(x=er(0,m)),i==null&&(i=1);const{callbackList:b,history:w}=XN(a,i,o,f,m,d,r,g,h);b.setModel(this),this.history=w,await b.onTrainBegin(),this.stopTraining_=!1;for(let y=f;y<o;++y){await b.onEpochBegin(y);const v={};if(d!=null)throw new Mt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Mt("batch shuffling is not implemneted yet");u&&bO(x);const $=es(x),I=Zg(m,r);for(let N=0;N<I.length;++N){const k={};if(await b.onBatchBegin(N,k),H(()=>{const S=I[N][0],C=I[N][1],A=wi($,S,C-S);k.batch=N,k.size=C-S;const R=y1(n,A),_=t(R);for(let T=0;T<s.length;++T){const E=s[T],M=_[T];k[E]=M,wr(M)}if(N===I.length-1&&g){const T=this.testLoop(c,l,r);for(let E=0;E<s.length;++E){const M=s[E],O=T[E];wr(O),v["val_"+M]=O}}}),await b.onBatchEnd(N,k),HN(k),this.stopTraining_)break}$.dispose()}if(await b.onEpochEnd(y,v),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,n){return qW(this,t,n)}async trainOnBatch(t,n){const s=await this.standardizeUserData(t,n),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),c=[];for(const l of a){const u=await l.data();c.push(u[0])}return zt(a),Us(s[0],t),Us(s[1],n),En(c)}getNamedWeights(t){const n=[],s=t!=null&&t.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||n.push({name:r[i].originalName,tensor:o[i]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=Zv().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-Zv().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Br(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Br(n))}else{const n=Object.keys(this.loss);t={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")t[r]=Br(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Br(Gh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Br(Gh(t)));{const t={};for(const n in this.metrics)t[n]=Br(Gh(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=x1(t.optimizer_config),s=jr(n);let r;if(typeof t.loss=="string")r=hi(t.loss);else if(Array.isArray(t.loss))r=t.loss.map(i=>hi(i));else if(t.loss!=null){r={};for(const i in t.loss)r[i]=hi(t.loss[i])}let o;if(Array.isArray(t.metrics))o=t.metrics.map(i=>hi(i));else if(t.metrics!=null){o={};for(const i in t.metrics)o[i]=hi(t.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(t,n){if(typeof t=="string"){const l=m4(t);if(l.length===0)throw new z(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new z(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Jv(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:tU,generatedBy:`TensorFlow.js tfjs-layers v${t_}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:u,specs:h}=await Jv(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=p4([s.data,u])}return this.userDefinedMetadata!=null&&(M2(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,t.save(a)}setUserDefinedMetadata(t){M2(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}La.className="Model";et(La);class o_ extends La{}o_.className="Functional";et(o_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Qa extends La{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:Im("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new z(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof Qa||t instanceof La;let s;if(n){if(s=t,s.outputs.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=nW({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new z(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=BN(this.outputs[0])}this.inboundNodes=[],new Nm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Li(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=t.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(qt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new La({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,s=console.log){this.built||this.build(),super.summary(t,n,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,s={}){if(!this.built)throw new Ts("The model needs to be compiled before being used.");return this.model.evaluate(t,n,s)}async evaluateDataset(t,n){if(!this.built)throw new Ts("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,s={}){if(!this.built)throw new Ts("The model needs to be compiled before being used.");return this.model.fit(t,n,s)}async fitDataset(t,n){if(!this.built)throw new Ts("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,s={},r=!1){let o,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new z("Legacy serialization format not supported yet.");o=n}else D(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=n.layers,delete n.layers,i=n;const a=new t(i);if(!(a instanceof Qa))throw new Mt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of o){const u=jr(c,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(t){if(this.model==null)throw new z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),t.push(s)}return{name:this.name,layers:t}}}Qa.className="Sequential";et(Qa);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eU(e){return new Qa(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let cn=class extends Ec{getConfig(){return{}}};class i_ extends cn{apply(t,n=1){return BV(t,n)}}i_.className="elu";et(i_);class a_ extends cn{apply(t){return $S(t)}}a_.className="selu";et(a_);class c_ extends cn{apply(t){return io(t)}}c_.className="relu";et(c_);class l_ extends cn{apply(t){return H(()=>Ya(6,io(t)))}}l_.className="relu6";et(l_);let u_=class extends cn{apply(t){return t}};u_.className="linear";et(u_);class h_ extends cn{apply(t){return Nc(t)}}h_.className="sigmoid";et(h_);class f_ extends cn{apply(t){return WV(t)}}f_.className="hardSigmoid";et(f_);class d_ extends cn{apply(t){return oh(t)}}d_.className="softplus";et(d_);class p_ extends cn{apply(t){return VV(t)}}p_.className="softsign";et(p_);class m_ extends cn{apply(t){return gm(t)}}m_.className="tanh";et(m_);let Uy=class extends cn{apply(t,n=-1){return qb(t,n)}};Uy.className="softmax";et(Uy);class g_ extends cn{apply(t,n=-1){return pS(t,n)}}g_.className="logSoftmax";et(g_);class x_ extends cn{apply(t){return H(()=>H(()=>{const n=Math.sqrt(2),s=P(.5,nt(1,uS(yt(t,n))));return P(t,s)}))}}x_.className="gelu";et(x_);class b_ extends cn{apply(t){return H(()=>P(.5,P(t,nt(1,gm(P(xe(yt(2,Math.PI)),nt(t,P(.044715,Ai(t,3)))))))))}}b_.className="gelu_new";et(b_);class y_ extends cn{apply(t){return H(()=>P(t,gm(oh(t))))}}y_.className="mish";et(y_);class w_ extends cn{apply(t,n=1){return H(()=>P(Nc(P(t,n)),t))}}w_.className="swish";et(w_);function Do(e){return e.getClassName()}function Qg(e,t={}){return hh(e,Ns.getMap().classNameMap,t,"activation")}function Mo(e){if(e==null){const t={};return t.className="linear",t.config={},Qg(t)}if(typeof e=="string"){const t={};return t.className=e,t.config={},Qg(t)}else return e instanceof cn?e:Qg(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nU(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}class v_ extends Ec{}class $_ extends v_{constructor(t){super(),nU(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return H(()=>{let n=Re([1]);return this.hasL1&&(n=nt(n,xt(P(this.l1,ze(t))))),this.hasL2&&(n=nt(n,xt(P(this.l2,dh(t))))),U(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}$_.className="L1L2";et($_);const B2={l1l2:"L1L2"};function te(e){return Ty(e)}function V2(e,t={}){return hh(e,Ns.getMap().classNameMap,t,"regularizer")}function fe(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in B2?B2[e]:e,config:{}};return V2(n)}else return e instanceof v_?e:V2(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class C_ extends Pt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=St(t);let s=io(t);return this.maxValue!=null&&(s=ds(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}C_.className="ReLU";et(C_);class k_ extends Pt{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const s=St(t);return Mb(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}k_.className="LeakyReLU";et(k_);class I_ extends Pt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=le(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=fe(t.alphaRegularizer),this.alphaConstraint=Fe(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new z(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=qt(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<t.length;++r)s[r]=t[r];this.inputSpec=[new De({ndim:t.length,axes:s})],this.built=!0}call(t,n){return t=St(t),Wb(t,this.alpha.read())}getConfig(){const t={alphaInitializer:pe(this.alphaInitializer),alphaRegularizer:te(this.alphaRegularizer),alphaConstraint:Me(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}I_.className="PReLU";et(I_);let S_=class extends Pt{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new Mt(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const s=St(t);return bm(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}};S_.className="ELU";et(S_);class N_ extends Pt{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const s=St(t);return P(s,ct(xs(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}N_.className="ThresholdedReLU";et(N_);class __ extends Pt{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new Uy().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){return H(()=>{let s=St(t);const r=n.mask;if(r!=null){const o=P(lt(ts(s.shape),ct(r,s.dtype)),Nt(-1e9));s=nt(s,o)}return this.axis instanceof Array?this.axis.length>1?ps(lt(s,Ob(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}__.className="Softmax";et(__);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pa(e,t,n){if(typeof e=="number")return Li(e,t);if(e.length!==t)throw new z(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let s=0;s<t;++s){const r=e[s];if(!OV(r))throw new z(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${r}`)}return e}function Js(e,t,n,s,r=1){if(e==null)return e;const o=t+(t-1)*(r-1);let i;return n==="same"?i=e:i=e-o+1,Math.floor((i+s-1)/s)}function dr(e,t,n,s){if(e==null)return null;if(s==="valid")e=e*t+Ao([n-t,0]);else if(s==="same")e=e*t;else throw new z(`Unsupport padding mode: ${s}.`);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gy(e,t){return H(()=>(_e(t),t==="channelsFirst"?Wt(e,[0,2,3,1]):e))}function T_(e,t){return H(()=>(_e(t),t==="channelsFirst"?Wt(e,[0,2,3,4,1]):e))}function sU(e,t,n,s=1,r="valid",o,i=1){return H(()=>{if(o==null&&(o=nr()),_e(o),e.shape.length!==3)throw new z(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new z(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new z(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(o==="channelsFirst"&&(e=Wt(e,[0,2,1])),r==="causal")throw new Mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=oS(e,t,s,r==="same"?"same":"valid","NWC",i);return n!=null&&(a=ar(a,n)),a})}function W2(e,t,n,s=[1,1],r="valid",o,i,a=null){return H(()=>{if(o==null&&(o=nr()),_e(o),e.rank!==3&&e.rank!==4)throw new z(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new z(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let c=Gy(e,o);if(r==="causal")throw new Mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=q6({x:c,filter:t,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),o==="channelsFirst"&&(c=Wt(c,[0,3,1,2])),c})}function rU(e,t,n,s=[1,1,1],r="valid",o,i){return H(()=>{if(o==null&&(o=nr()),_e(o),e.rank!==4&&e.rank!==5)throw new z(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new z(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let a=T_(e,o);if(r==="causal")throw new Mt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=HL(a,t,s,r==="same"?"same":"valid","NDHWC",i),n!=null&&(a=ar(a,n)),o==="channelsFirst"&&(a=Wt(a,[0,4,1,2,3])),a})}class Em extends Pt{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Em.verifyArgs(n),this.rank=t,We(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Mt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Pa(n.kernelSize,t,"kernelSize"),this.strides=Pa(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,bs(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,_e(this.dataFormat),this.activation=Mo(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=le(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Fe(n.biasConstraint),this.biasRegularizer=fe(n.biasRegularizer),this.activityRegularizer=fe(n.activityRegularizer),this.dilationRate=Pa(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new z(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new z(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new z(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(fr("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Ey(t.kernelSize,"number",1,3))throw new z(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Do(this.activation),useBias:this.useBias,biasInitializer:pe(this.biasInitializer),biasRegularizer:te(this.biasRegularizer),activityRegularizer:te(this.activityRegularizer),biasConstraint:Me(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class Rc extends Em{constructor(t,n){super(t,n),this.kernel=null,Rc.verifyArgs(n),this.filters=n.filters,We(this.filters,"filters"),this.kernelInitializer=le(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Fe(n.kernelConstraint),this.kernelRegularizer=fe(n.kernelRegularizer)}build(t){t=qt(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new z(`The channel dimension of the input should be defined. Found ${t[n]}`);const s=t[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(t,n){return H(()=>{t=St(t);let s;const r=this.bias==null?null:this.bias.read(),o=IN(this.activation.getClassName());if(o!=null&&this.rank===2)s=W2(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=sU(t,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=W2(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=rU(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Mt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=qt(t);const n=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let o=0;o<s.length;++o){const i=Js(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(i)}let r=[t[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const t={filters:this.filters,kernelInitializer:pe(this.kernelInitializer),kernelRegularizer:te(this.kernelRegularizer),kernelConstraint:Me(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new z(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class xh extends Rc{constructor(t){super(2,t),xh.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!Ey(t.kernelSize,"number",1,2))throw new z(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}xh.className="Conv2D";et(xh);class bh extends Rc{constructor(t){super(3,t),bh.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new z(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}bh.className="Conv3D";et(bh);class E_ extends xh{constructor(t){if(super(t),this.inputSpec=[new De({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=qt(t),t.length!==4)throw new z("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");const s=t[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new De({ndim:4,axes:{[n]:s}})],this.built=!0}call(t,n){return H(()=>{let s=St(t);if(s.shape.length!==4)throw new z(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const c=r[i],l=r[a],u=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],d=this.strides[1],p=dr(c,f,u,this.padding),g=dr(l,d,h,this.padding),m=[o,p,g,this.filters];this.dataFormat!=="channelsLast"&&(s=Wt(s,[0,2,3,1]));let x=iS(s,this.kernel.read(),m,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Wt(x,[0,3,1,2])),this.bias!=null&&(x=ar(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(t){t=qt(t);const n=t.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return n[s]=this.filters,n[r]=dr(n[r],c,i,this.padding),n[o]=dr(n[o],l,a,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}E_.className="Conv2DTranspose";et(E_);class R_ extends bh{constructor(t){if(super(t),this.inputSpec=[new De({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=qt(t),t.length!==5)throw new z("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");const s=t[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new De({ndim:5,axes:{[n]:s}})],this.built=!0}call(t,n){return H(()=>{let s=St(t);if(s.shape.length!==5)throw new z(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,c;this.dataFormat==="channelsFirst"?(c=2,i=3,a=4):(c=1,i=2,a=3);const l=r[c],u=r[i],h=r[a],f=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],g=this.strides[0],m=this.strides[1],x=this.strides[2],b=dr(l,g,f,this.padding),w=dr(u,m,d,this.padding),y=dr(h,x,p,this.padding),v=[o,b,w,y,this.filters];this.dataFormat!=="channelsLast"&&(s=Wt(s,[0,2,3,4,1]));let $=jL(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=Wt($,[0,4,1,2,3])),this.bias!==null&&($=ar($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(t){t=qt(t);const n=t.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],u=this.strides[0],h=this.strides[1],f=this.strides[2];return n[s]=this.filters,n[r]=dr(n[r],u,a,this.padding),n[o]=dr(n[o],h,c,this.padding),n[i]=dr(n[i],f,l,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}R_.className="Conv3DTranspose";et(R_);class A_ extends Rc{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new z(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=le(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=fe(n.depthwiseRegularizer),this.depthwiseConstraint=Fe(n.depthwiseConstraint),this.pointwiseInitializer=le(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=fe(n.pointwiseRegularizer),this.pointwiseConstraint=Fe(n.pointwiseConstraint)}build(t){if(t=qt(t),t.length<this.rank+2)throw new z(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new z(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const s=t[n],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new De({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(t,n){return H(()=>{t=St(t);let s;if(this.rank===1)throw new Mt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=Wt(t,[0,2,3,1])),s=CS(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=ar(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Wt(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=pe(this.depthwiseInitializer),t.pointwiseInitializer=pe(this.pointwiseInitializer),t.depthwiseRegularizer=te(this.depthwiseRegularizer),t.pointwiseRegularizer=te(this.pointwiseRegularizer),t.depthwiseConstraint=Me(this.depthwiseConstraint),t.pointwiseConstraint=Me(this.pointwiseConstraint),t}}A_.className="SeparableConv";class D_ extends A_{constructor(t){super(2,t)}}D_.className="SeparableConv2D";et(D_);class Rm extends Rc{constructor(t){super(1,t),Rm.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!Ey(t.kernelSize,"number",1,1))throw new z(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Rm.className="Conv1D";et(Rm);class M_ extends Pt{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return H(()=>{if(t=St(t),this.dataFormat==="channelsLast"){const s=Uh(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Uh(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Uh(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Uh(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}M_.className="Cropping2D";et(M_);class F_ extends Pt{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_e(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,DV(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,s]}else{const n=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],n,s,t[3]]}}call(t,n){return H(()=>{let s=St(t);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Wt(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?Gr.resizeNearestNeighbor(s,[o,i]):Gr.resizeBilinear(s,[o,i]);return Wt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?Gr.resizeNearestNeighbor(s,[o,i]):Gr.resizeBilinear(s,[o,i])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}F_.className="UpSampling2D";et(F_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oU(e,t,n=[1,1],s="valid",r,o){return H(()=>{r==null&&(r=nr()),_e(r);let i=Gy(e,r);if(e.rank!==4)throw new z(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new z(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=Rb(i,t,n,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=Wt(i,[0,3,1,2])),i})}class O_ extends Em{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=le(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Fe(t.depthwiseConstraint),this.depthwiseRegularizer=fe(t.depthwiseRegularizer)}build(t){if(t=qt(t),t.length<4)throw new z(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new z(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const s=t[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return H(()=>{t=St(t);let s=oU(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=ar(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=qt(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=Js(n,this.kernelSize[0],this.padding,this.strides[0]),i=Js(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],r,o,i]:[t[0],o,i,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=pe(this.depthwiseInitializer),t.depthwiseRegularizer=te(this.depthwiseRegularizer),t.depthwiseConstraint=Me(this.depthwiseRegularizer),t}}O_.className="DepthwiseConv2D";et(O_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L_(e,t,n,s){if(Array.isArray(e)){if(t!=null||n!=null)throw new z("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=e.slice(e.length-s,e.length),e=e.slice(0,e.length-s)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return t=r(t),n=r(n),{inputs:e,initialState:t,constants:n}}function P_(e,t,n,s=!1,r,o,i=!1,a=!1){return H(()=>{const c=t.shape.length;if(c<3)throw new z(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(er(2,c));t=Wt(t,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ct(ct(r,"bool"),"float32"),r.rank===c-1&&(r=Tn(r,-1)),r=Wt(r,l)),s&&(t=Fi(t,0),r!=null&&(r=Fi(r,0)));const u=[];let h,f=n;const d=t.shape[0],p=Oi(t);let g;r!=null&&(g=Oi(r));for(let x=0;x<d;++x){const b=p[x],w=H(()=>e(b,f));if(r==null)h=w[0],f=w[1];else{const y=H(()=>{const v=g[x],$=lt(Fs(v),v),I=nt(P(w[0],v),P(f[0],$)),N=f.map((k,S)=>nt(P(w[1][S],v),P(k,$)));return{output:I,newStates:N}});h=y.output,f=y.newStates}a&&u.push(h)}let m;return a&&(m=vn(u,1)),[h,m,f]})}class Ko extends Pt{constructor(t){super(t);let n;if(t.cell==null)throw new z("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new Xy({cells:t.cell}):n=t.cell,n.stateSize==null)throw new z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new De({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return er(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){p1(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[t[0],t[1],s]:r=[t[0],s],this.returnState){const o=[];for(const i of n)o.push([t[0],i]);return[r].concat(o)}else return r}computeMask(t,n){return H(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<t;++s)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new Mt("Constants support is not implemented in RNN yet.");p1(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new De({shape:[n,null,...s]});const r=[t[0]].concat(t.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Xt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new z(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new De({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){H(()=>{if(!this.stateful)throw new hr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Re([s,r])):this.states_=[Re([s,this.cell.stateSize])];else if(t==null)zt(this.states_),this.keptStates!=null&&(zt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Re([s,r])):this.states_[0]=Re([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):zt(this.states_);for(let r=0;r<this.states_.length;++r){const o=t[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!Xt(o.shape,a))throw new z(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>wr(r.clone()))})}apply(t,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=L_(t,s,r,this.numConstants);t=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new De({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Sr){const l=[t].concat(i),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(l,n);return this.inputSpec=h,f}else return super.apply(t,n)}call(t,n){return H(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let o=n==null?null:n.initialState;t=St(t),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(t));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new z(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=P_((p,g)=>{const m=this.cell.call([p].concat(g),a);return[m[0],m.slice(1)]},t,o,this.goBackwards,s,null,this.unroll,this.returnSequences),u=l[0],h=l[1],f=l[2];this.stateful&&this.resetStates(f,r);const d=this.returnSequences?h:u;return this.returnState?[d].concat(f):d})}getInitialState(t){return H(()=>{let n=Re(t.shape);return n=xt(n,[1,2]),n=fh(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?f1(n,[1,s]):n):this.cell.stateSize>1?[f1(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ko.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),n)}static fromConfig(t,n,s={}){const r=n.cell,o=jr(r,s);return new t(Object.assign(n,{cell:o}))}}Ko.className="RNN";et(Ko);class Am extends Pt{}class Hy extends Am{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,We(this.units,"units"),this.activation=Mo(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=le(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=le(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=le(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fe(t.kernelRegularizer),this.recurrentRegularizer=fe(t.recurrentRegularizer),this.biasRegularizer=fe(t.biasRegularizer),this.kernelConstraint=Fe(t.kernelConstraint),this.recurrentConstraint=Fe(t.recurrentConstraint),this.biasConstraint=Fe(t.biasConstraint),this.dropout=Za([1,Ao([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Za([1,Ao([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=qt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return H(()=>{if(t=t,t.length!==2)throw new z(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fo({ones:()=>Fs(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fo({ones:()=>Fs(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Cr(P(t,i),this.kernel.read()):o=Cr(t,this.kernel.read()),this.bias!=null&&(o=ar(o,this.bias.read())),a!=null&&(s=P(s,a));let c=nt(o,Cr(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Do(this.activation),useBias:this.useBias,kernelInitializer:pe(this.kernelInitializer),recurrentInitializer:pe(this.recurrentInitializer),biasInitializer:pe(this.biasInitializer),kernelRegularizer:te(this.kernelRegularizer),recurrentRegularizer:te(this.recurrentRegularizer),biasRegularizer:te(this.biasRegularizer),activityRegularizer:te(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}Hy.className="SimpleRNNCell";et(Hy);class z_ extends Ko{constructor(t){t.cell=new Hy(t),super(t)}call(t,n){return H(()=>{this.cell.dropoutMask!=null&&(zt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(zt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,n){return new t(n)}}z_.className="SimpleRNN";et(z_);class qy extends Am{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new z("GRUCell does not support reset_after parameter set to true.");this.units=t.units,We(this.units,"units"),this.activation=Mo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Mo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=le(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=le(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=le(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=fe(t.kernelRegularizer),this.recurrentRegularizer=fe(t.recurrentRegularizer),this.biasRegularizer=fe(t.biasRegularizer),this.kernelConstraint=Fe(t.kernelConstraint),this.recurrentConstraint=Fe(t.recurrentConstraint),this.biasConstraint=Fe(t.biasConstraint),this.dropout=Za([1,Ao([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Za([1,Ao([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=qt(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return H(()=>{if(t=t,t.length!==2)throw new z(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=n.training==null?!1:n.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fo({ones:()=>Fs(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fo({ones:()=>Fs(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(t=P(t,o[0]));let u=Cr(t,this.kernel.read());this.useBias&&(u=ar(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=P(r,i[0]));const h=this.recurrentKernel.read(),[f,d]=fs(h,[2*this.units,this.units],h.rank-1),p=Cr(r,f),[g,m,x]=fs(u,3,u.rank-1),[b,w]=fs(p,2,p.rank-1);a=this.recurrentActivation.apply(nt(g,b)),c=this.recurrentActivation.apply(nt(m,w));const y=Cr(P(c,r),d);l=this.activation.apply(nt(x,y));const v=nt(P(a,r),P(nt(1,he(a)),l));return[v,v]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Do(this.activation),recurrentActivation:Do(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pe(this.kernelInitializer),recurrentInitializer:pe(this.recurrentInitializer),biasInitializer:pe(this.biasInitializer),kernelRegularizer:te(this.kernelRegularizer),recurrentRegularizer:te(this.recurrentRegularizer),biasRegularizer:te(this.biasRegularizer),activityRegularizer:te(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}qy.className="GRUCell";et(qy);class B_ extends Ko{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new qy(t),super(t)}call(t,n){return H(()=>{this.cell.dropoutMask!=null&&(zt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(zt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}B_.className="GRU";et(B_);class Dm extends Am{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,We(this.units,"units"),this.activation=Mo(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Mo(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=le(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=le(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=le(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=fe(t.kernelRegularizer),this.recurrentRegularizer=fe(t.recurrentRegularizer),this.biasRegularizer=fe(t.biasRegularizer),this.kernelConstraint=Fe(t.kernelConstraint),this.recurrentConstraint=Fe(t.recurrentConstraint),this.biasConstraint=Fe(t.biasConstraint),this.dropout=Za([1,Ao([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Za([1,Ao([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=qt(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(n=class extends zs{apply(c,l){const u=o.apply([i]),h=new Ay().apply([i]),f=o.apply([i*2]);return I2(I2(u,h),f)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return H(()=>{const s=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new z(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const o=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fo({ones:()=>Fs(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fo({ones:()=>Fs(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,u,h;0<this.dropout&&this.dropout<1&&(t=P(t,i[0]));let f=Cr(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=P(r,a[0])),f=nt(f,Cr(r,this.recurrentKernel.read())),this.useBias&&(f=ar(f,this.bias.read()));const[d,p,g,m]=fs(f,4,f.rank-1);c=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),u=nt(P(l,o),P(c,this.activation.apply(g))),h=this.recurrentActivation.apply(m);const x=P(h,this.activation.apply(u));return[x,x,u]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Do(this.activation),recurrentActivation:Do(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pe(this.kernelInitializer),recurrentInitializer:pe(this.recurrentInitializer),biasInitializer:pe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:te(this.kernelRegularizer),recurrentRegularizer:te(this.recurrentRegularizer),biasRegularizer:te(this.biasRegularizer),activityRegularizer:te(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),recurrentConstraint:Me(this.recurrentConstraint),biasConstraint:Me(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}Dm.className="LSTMCell";et(Dm);class V_ extends Ko{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Dm(t),super(t)}call(t,n){return H(()=>{this.cell.dropoutMask!=null&&(zt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(zt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}V_.className="LSTM";et(V_);class Xy extends Am{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return H(()=>{t=t;let s=t.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=r[a],a===0?i=[t[0]].concat(s):i=[i[0]].concat(s),i=c.call(i,n),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(t){p1(t)&&(t=t[0]),t=t;let n;this.cells.forEach((s,r)=>{yi(`RNNCell_${r}`,()=>{s.build(t),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),r)}static fromConfig(t,n,s={}){const r=[];for(const o of n.cells)r.push(jr(o,s));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return m1(t)}setWeights(t){const n=[];for(const s of this.cells){const r=s.weights.length,o=t.splice(r);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],o[i]])}zy(n)}}Xy.className="StackedRNNCells";et(Xy);function Fo(e){const{ones:t,rate:n,training:s=!1,count:r=1,dropoutFunc:o}=e,i=()=>o!=null?o(t(),n):AN(t(),n),a=()=>ph(i,t,s);return!r||r<=1?wr(a().clone()):Array(r).fill(void 0).map(a).map(l=>wr(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var iU=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]]);return n};class W_ extends Ko{constructor(t){if(t.unroll)throw new Mt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Mt("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new De({ndim:5})]}call(t,n){return H(()=>{if(this.cell.dropoutMask!=null&&(zt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(zt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new z("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(t,{mask:s,training:r,initialState:o})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return H(()=>{const{stateSize:n}=this.cell,s=t.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Re(o);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(t,n=!1){H(()=>{if(!this.stateful)throw new hr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Re(o)):this.states_=[Re(o)];else if(t==null)zt(this.states_),this.keptStates!=null&&(zt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Re(o)):this.states_[0]=Re(o);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):zt(this.states_);for(let a=0;a<this.states_.length;++a){const c=t[a],l=o;if(!Xt(c.shape,l))throw new z(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>wr(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,c=n==="channelsFirst",l=t[c?3:2],u=t[c?4:3],h=Js(l,r[0],o,i[0],a[0]),f=Js(u,r[1],o,i[1],a[1]);return[...t.slice(0,2),...c?[s,h,f]:[h,f,s]]}}W_.className="ConvRNN2D";class jy extends Dm{constructor(t){const{filters:n,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,We(this.filters,"filters"),this.kernelSize=Pa(s,2,"kernelSize"),this.kernelSize.forEach(c=>We(c,"kernelSize")),this.strides=Pa(r||1,2,"strides"),this.strides.forEach(c=>We(c,"strides")),this.padding=o||"valid",bs(this.padding),this.dataFormat=i||"channelsLast",_e(this.dataFormat),this.dilationRate=Pa(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>We(c,"dilationRate"))}build(t){var n;t=qt(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new z(`The channel dimension of the input should be defined. Found ${t[s]}`);const r=t[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,u=this.filters;c=new(n=class extends zs{apply(f,d){const p=l.apply([u]),g=ts([u]),m=l.apply([u*2]);return Ry([p,g,m])}},n.className="CustomInit",n)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return H(()=>{if(t.length!==3)throw new z(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=n.training||!1,r=t[0],o=t[1],i=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fo({ones:()=>Fs(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(B,G,q)=>!G||!G[q]?B:P(G[q],B);let u=l(r,c,0),h=l(r,c,1),f=l(r,c,2),d=l(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fo({ones:()=>Fs(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let g=l(o,p,0),m=l(o,p,1),x=l(o,p,2),b=l(o,p,3);const w=3,[y,v,$,I]=fs(this.kernel.read(),a,w),[N,k,S,C]=this.useBias?fs(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,y,N,this.padding),h=this.inputConv(h,v,k,this.padding),f=this.inputConv(f,$,S,this.padding),d=this.inputConv(d,I,C,this.padding);const[A,R,_,T]=fs(this.recurrentKernel.read(),a,w);g=this.recurrentConv(g,A),m=this.recurrentConv(m,R),x=this.recurrentConv(x,_),b=this.recurrentConv(b,T);const E=this.recurrentActivation.apply(nt(u,g)),M=this.recurrentActivation.apply(nt(h,m)),O=nt(P(M,i),P(E,this.activation.apply(nt(f,x)))),L=P(this.recurrentActivation.apply(nt(d,b)),this.activation.apply(O));return[L,L,O]})}getConfig(){const t=super.getConfig(),{units:n}=t,s=iU(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(t,n,s,r){const o=Ri(t,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?ar(o,s,this.dataFormat):o}recurrentConv(t,n){return Ri(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}jy.className="ConvLSTM2DCell";et(jy);class U_ extends W_{constructor(t){const n=new jy(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}U_.className="ConvLSTM2D";et(U_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ky extends Pt{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,o=this.getNoiseShape(s);return ph(()=>AN(s,this.rate,o,this.seed),()=>s,r)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}Ky.className="Dropout";et(Ky);class G_ extends Ky{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}G_.className="SpatialDropout1D";et(G_);class Yy extends Pt{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,We(this.units,"units"),this.activation=Mo(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=le(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=le(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Fe(t.kernelConstraint),this.biasConstraint=Fe(t.biasConstraint),this.kernelRegularizer=fe(t.kernelRegularizer),this.biasRegularizer=fe(t.biasRegularizer),this.activityRegularizer=fe(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=qt(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=qt(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t),r=IN(this.activation.getClassName());let o;return r!=null?o=Cr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Cr(s,this.kernel.read()),this.bias!=null&&(o=ar(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const t={units:this.units,activation:Do(this.activation),useBias:this.useBias,kernelInitializer:pe(this.kernelInitializer),biasInitializer:pe(this.biasInitializer),kernelRegularizer:te(this.kernelRegularizer),biasRegularizer:te(this.biasRegularizer),activityRegularizer:te(this.activityRegularizer),kernelConstraint:Me(this.kernelConstraint),biasConstraint:Me(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}Yy.className="Dense";et(Yy);class H_ extends Pt{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=qt(t);for(const n of t.slice(1))if(n==null)throw new z(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],To(t,1)]}call(t,n){return H(()=>{this.invokeCallHook(t,n);let s=St(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=Wt(s,r)}return zV(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}}H_.className="Flatten";et(H_);class q_ extends Pt{constructor(t){super(t),this.supportsMasking=!0,this.activation=Mo(t.activation)}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t);return this.activation.apply(s)})}getConfig(){const t={activation:Do(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}q_.className="Activation";et(q_);class X_ extends Pt{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return H(()=>(t=St(t),LV(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}X_.className="RepeatVector";et(X_);class j_ extends Pt{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const s="Total size of new array must be unchanged.",r=n.slice();let o=1,i=null;for(let c=0;c<r.length;++c){const l=r[c];if(this.isUnknown(l))if(i===null)i=c;else throw new z("Can only specifiy one unknown dimension.");else o*=l}const a=To(t);if(i!==null){if(o===0||a%o!==0)throw new z(s);r[i]=a/o}else if(a!==o)throw new z(s);return r}computeOutputShape(t){let n=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return U(s,o)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}j_.className="Reshape";et(j_);class K_ extends Pt{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=er(1,t.dims.length+1);if(!Xt(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new De({ndim:this.dims.length+1})]}computeOutputShape(t){t=qt(t);const n=t.slice();return this.dims.forEach((s,r)=>{n[r+1]=t[s]}),n}call(t,n){return Wt(St(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}K_.className="Permute";et(K_);class Y_ extends Pt{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const s=St(t);return i1(Ol(s,this.maskValue),-1)}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t),i=i1(Ol(s,this.maskValue),-1,!0);return P(s,ct(i,s.dtype))})}}Y_.className="Masking";et(Y_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Z_ extends Pt{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Yt(t.inputLength))}this.inputDim=t.inputDim,We(this.inputDim,"inputDim"),this.outputDim=t.outputDim,We(this.outputDim,"outputDim"),this.embeddingsInitializer=le(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=fe(t.embeddingsRegularizer),this.activityRegularizer=fe(t.activityRegularizer),this.embeddingsConstraint=Fe(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return H(()=>this.maskZero?(t=St(t),Ol(t,Gt(t))):null)}computeOutputShape(t){if(t=qt(t),this.inputLength==null)return[...t,this.outputDim];const n=Yt(this.inputLength);if(n.length!==t.length-1)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let r=0;r<n.length;++r){const o=n[r],i=t[r+1];if(o!=null&&i!=null&&o!==i)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);o==null&&(n[s]=i),s++}}return[t[0],...n,this.outputDim]}call(t,n){return H(()=>{this.invokeCallHook(t,n);let s=St(t);s.dtype!=="int32"&&(s=$r(s,"int32"));const r=RN(this.embeddings.read(),U(s,[s.size]));return U(r,qt(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:pe(this.embeddingsInitializer),embeddingsRegularizer:te(this.embeddingsRegularizer),activityRegularizer:te(this.activityRegularizer),embeddingsConstraint:Me(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}Z_.className="Embedding";et(Z_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sa extends Pt{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Mt}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const s=t.slice(0,t.length-n.length);for(let r=0;r<n.length;++r){const o=t[t.length-n.length+r],i=n[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new z("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));s.push(o)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[qt(t)]),t=t,t.length<2)throw new z(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const o of t)o!=null&&o[0]!==null&&n.push(o[0]);if(n=_o(n),n.length>1)throw new z(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let o=1;o<t.length;++o){const i=t[o]==null?null:t[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=t.map(o=>o.length);t.indexOf(null)===-1&&_o(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return H(()=>{if(t=t,this.reshapeRequired){const s=[],r=t.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Ao(r);for(let i of t){const a=i.rank;for(let c=0;c<o-a;++c)i=fh(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const c of t){const l=c.rank;if(l==null){const u=c.shape,h=u[0],f=u.slice(1).concat([h]);let d=U(c,[h].concat(To(u.slice(1))));d=Wt(d,[1,0]),d=U(d,f),s.push(d),o=!0}else if(l>1){const u=er(1,l).concat([0]);s.push(Wt(c,u)),o=!0}else s.push(c)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const c=i.shape,l=c.length,u=c[l-1],h=[u].concat(c.slice(0,c.length-1));i=U(Wt(U(i,[-1,u]),[1,0]),h)}else if(a>1){const c=[a-1].concat(er(0,a-1));i=Wt(i,c)}}return i}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let r=1;r<t.length;++r){const o=t[r]==null?null:t[r].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}let s=[];for(const r of t)r!=null&&r[0]!==null&&s.push(r[0]);return s=_o(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(t,n){return H(()=>{if(n==null)return null;if(!Array.isArray(n))throw new z("`mask` should be an Array");if(!Array.isArray(t))throw new z("`inputs` should be an Array");if(n.length!==t.length)throw new z(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Tn(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=Yr(s,n[r]);return s})}}class Q_ extends sa{constructor(t){super(t)}mergeFunction(t){return H(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=nt(n,t[s]);return n})}}Q_.className="Add";et(Q_);class J_ extends sa{constructor(t){super(t)}mergeFunction(t){return H(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=P(n,t[s]);return n})}}J_.className="Multiply";et(J_);class tT extends sa{constructor(t){super(t)}mergeFunction(t){return H(()=>{let n=t[0].clone();for(let s=1;s<t.length;++s)n=nt(n,t[s]);return P(1/t.length,n)})}}tT.className="Average";et(tT);class eT extends sa{constructor(t){super(t)}mergeFunction(t){return H(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=Xo(n,t[s]);return n})}}eT.className="Maximum";et(eT);class nT extends sa{constructor(t){super(t)}mergeFunction(t){return H(()=>{let n=t[0];for(let s=1;s<t.length;++s)n=Ya(n,t[s]);return n})}}nT.className="Minimum";et(nT);class sT extends sa{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new z("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const r of t)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<t.length;++r){const o=t[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(Xt(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return H(()=>Ry(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new z("A `Concatenate` layer should be called on a list of inputs.");const n=t,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of n.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new z("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new z("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new z(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return H(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<t.length;++i)n[i]==null?r.push(ct(Fs(t[i]),"bool")):n[i].rank<t[i].rank?r.push(Tn(n[i],-1)):r.push(n[i]);const o=Ze(r,this.axis);return rS(o,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}sT.className="Concatenate";et(sT);function Kc(e,t){for(;e<0;)e+=t;return e}function aU(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Mt("batchDot is not implemented for tensors of 4D or higher rank yet");if(D(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),D(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new Mt("batchDot is not implemented for complex64-type Tensors yet.");const s=e.shape.length,r=t.shape.length;n==null&&(n=[s-1,r-2]);const o=n;return H(()=>{let i;if(s>r){i=s-r;const c=[];for(let l=0;l<i;++l)c.push(1);t=U(t,t.shape.concat(c))}else if(r>s){i=r-s;const c=[];for(let l=0;l<i;++l)c.push(1);e=U(e,e.shape.concat(c))}else i=0;let a;if(e.shape.length===2&&t.shape.length===2)o[0]===o[1]?a=xt(P(e,t),o[0]):a=xt(P(Wt(e,[1,0]),t),o[1]);else{const c=o[0]!==e.shape.length-1,l=o[1]===t.shape.length-1;a=Vt(e,t,c,l)}if(i>0){let c;s>r?c=s+r-3:c=s-1;const l=[];for(let u=c;u<c+i;++u)l.push(u);a=ih(a,l)}return a.shape.length===1&&(a=Tn(a,1)),a})}class rT extends sa{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){D(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],s=t[1];if(n.length>3||s.length>3)throw new Mt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new z(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(t){if(t.length!==2)throw new z(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],s=t[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>Kc(o,t[i].shape.length)):r=[Kc(this.axes,n.shape.length),Kc(this.axes,s.shape.length)],this.normalize&&(n=od(n,r[0]),s=od(s,r[1])),aU(n,s,r)}interpretAxes(t,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[Kc(this.axes,t.length),Kc(this.axes,n.length)],s}computeOutputShape(t){D(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),s=t[1].slice();if(n.length>3||s.length>3)throw new Mt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=n.concat(s);return o.length===1&&o.push(1),o}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}rT.className="Dot";et(rT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oT extends Pt{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t);return ph(()=>nt(Sm(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}oT.className="GaussianNoise";et(oT);class iT extends Pt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return H(()=>{this.invokeCallHook(t,n);const s=St(t);return this.rate>0&&this.rate<1?ph(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return P(s,Sm(s.shape,1,o))},()=>s,n.training||!1):s})}}iT.className="GaussianDropout";et(iT);class aT extends Pt{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||St(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return H(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return ph(()=>{const o=St(t),a=-1.6732632423543772*1.0507009873554805;let c=ta(Zr(s),this.rate);c=$r(c,"float32");const l=((1-this.rate)*(1+this.rate*a**2))**-.5,u=-l*a*this.rate,h=nt(P(o,c),P(nt(c,-1),a));return nt(P(h,l),u)},()=>St(t),n.training||!1)}return t})}}aT.className="AlphaDropout";et(aT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bl(e,t,n,s,r,o=.001){let i;if(e.rank===2)i=vL(e,t,n,s,r,o);else if(e.rank===3)i=CL(e,t,n,s,r,o);else if(e.rank===4)i=IL(e,t,n,s,r,o);else throw new Mt(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return i}function cU(e,t,n,s,r=.001){return H(()=>{const o=zb(e,s),i=o.mean,a=o.variance;return[Bl(e,i,a,n,t,r),i,a]})}function lU(e,t,n,s,r=.001){return H(()=>{const o=zb(e,s),i=o.mean,a=o.variance,c=[];for(const p of er(0,e.rank))s.indexOf(p)!==-1?c.push(1):c.push(e.shape[p]);const l=U(i,c),u=U(a,c),h=t==null?null:U(t,c),f=n==null?null:U(n,c);return[Bl(e,l,u,f,h,r),i,a]})}function uU(e,t,n,s,r=.001){return Xt(s.slice().sort(),er(0,e.rank-1))?cU(e,t,n,s,r):lU(e,t,n,s,r)}class cT extends Pt{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=le(t.betaInitializer||"zeros"),this.gammaInitializer=le(t.gammaInitializer||"ones"),this.movingMeanInitializer=le(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=le(t.movingVarianceInitializer||"ones"),this.betaConstraint=Fe(t.betaConstraint),this.gammaConstraint=Fe(t.gammaConstraint),this.betaRegularizer=fe(t.betaRegularizer),this.gammaRegularizer=fe(t.gammaRegularizer)}build(t){t=qt(t);const n=this.axis>=0?this.axis:this.axis+t.length,s=t[n];if(s==null)throw new z(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new De({ndim:t.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return H(()=>{const s=n.training==null?!1:n.training,r=St(t),o=r.shape,i=o.length,a=er(0,i),c=this.axis>=0?this.axis:this.axis+i;a.splice(c,1);const l=Li(1,i);l[c]=o[c];const u=a.slice();u.sort();const h=!Xt(u,er(0,i).slice(0,i-1)),f=()=>{if(h){const b=U(this.movingMean.read(),l),w=U(this.movingVariance.read(),l),y=this.center?U(this.beta.read(),l):null,v=this.scale?U(this.gamma.read(),l):null;return Bl(r,b,w,y,v,this.epsilon)}else return Bl(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[d,p,g]=uU(r,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(b,w,y)=>{H(()=>{const v=1-y,$=b.read(),I=P(lt($,w),v);b.write(lt($,I))})};return(()=>{m(this.movingMean,p,this.momentum),m(this.movingVariance,g,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pe(this.betaInitializer),gammaInitializer:pe(this.gammaInitializer),movingMeanInitializer:pe(this.movingMeanInitializer),movingVarianceInitializer:pe(this.movingVarianceInitializer),betaRegularizer:te(this.betaRegularizer),gammaRegularizer:te(this.gammaRegularizer),betaConstraint:Me(this.betaConstraint),gammaConstraint:Me(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}cT.className="BatchNormalization";et(cT);class lT extends Pt{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=le(t.betaInitializer||"zeros"),this.gammaInitializer=le(t.gammaInitializer||"ones"),this.betaRegularizer=fe(t.betaRegularizer),this.gammaRegularizer=fe(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=qt(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=n);for(const o of this.axis)if(o<0||o>=n)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==_o(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>t[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(t,n){const s=St(t),r=s.shape,o=r.length;return H(()=>{let{mean:a,variance:c}=zb(s,this.axis,!0);const l=Li(1,o);for(const g of this.axis)l[g]=r[g];const u=g=>g!=null&&g.shape.length!==o?U(g,l):g;let h=this.scale?u(this.gamma.read()):null,f=this.center?u(this.beta.read()):null;const d=[],p=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(d.push(r[g]),p.push(1)):(d.push(1),p.push(r[g]));return a=On(a,d),c=On(c,d),h!=null&&(h=On(h,p)),f!=null&&(f=On(f,p)),Bl(s,a,c,f,h,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pe(this.betaInitializer),gammaInitializer:pe(this.gammaInitializer),betaRegularizer:te(this.betaRegularizer),gammaRegularizer:te(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}lT.className="LayerNormalization";et(lT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hU(e,t,n){return H(()=>{if(e.rank!==4)throw new z(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=nr()),n!=="channelsLast"&&n!=="channelsFirst")throw new z(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],Bb(e,s)})}class uT extends Pt{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?nr():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new z(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,s;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new z(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new z(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[n,s]}this.inputSpec=[new De({ndim:4})]}computeOutputShape(t){t=qt(t);let n,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],n,s]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],n,s,t[3]])}call(t,n){return H(()=>hU(St(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}uT.className="ZeroPadding2D";et(uT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mm(e,t,n,s,r,o){return H(()=>{_e(r),NN(o),bs(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=nr()),o==null&&(o="max"),e=Gy(e,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=Pb(e,t,n,a):i=Nb(e,t,n,a),r==="channelsFirst"&&(i=Wt(i,[0,3,1,2])),i})}function hT(e,t,n,s,r,o){return H(()=>{_e(r),NN(o),bs(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=nr()),o==null&&(o="max"),e=T_(e,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=lz(e,t,n,a):i=hL(e,t,n,a),r==="channelsFirst"&&(i=Wt(i,[0,4,1,2,3])),i})}class fT extends Pt{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new z(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(We(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new z(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);We(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,bs(this.padding),this.inputSpec=[new De({ndim:3})]}computeOutputShape(t){t=qt(t);const n=Js(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return H(()=>{this.invokeCallHook(t,n),t=fh(St(t),2);const s=this.poolingFunction(St(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ih(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class dT extends fT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),Mm(t,n,s,r,o,"max")}}dT.className="MaxPooling1D";et(dT);class pT extends fT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),Mm(t,n,s,r,o,"avg")}}pT.className="AveragePooling1D";et(pT);class mT extends Pt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new z(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];We(this.poolSize,"poolSize"),We(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_e(this.dataFormat),bs(this.padding),this.inputSpec=[new De({ndim:4})]}computeOutputShape(t){t=qt(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Js(n,this.poolSize[0],this.padding,this.strides[0]),s=Js(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s]:[t[0],n,s,t[3]]}call(t,n){return H(()=>(this.invokeCallHook(t,n),this.poolingFunction(St(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class gT extends mT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),Mm(t,n,s,r,o,"max")}}gT.className="MaxPooling2D";et(gT);class xT extends mT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),Mm(t,n,s,r,o,"avg")}}xT.className="AveragePooling2D";et(xT);class bT extends Pt{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new z(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];We(this.poolSize,"poolSize"),We(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_e(this.dataFormat),bs(this.padding),this.inputSpec=[new De({ndim:5})]}computeOutputShape(t){t=qt(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Js(n,this.poolSize[0],this.padding,this.strides[0]),s=Js(s,this.poolSize[1],this.padding,this.strides[1]),r=Js(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,s,r]:[t[0],n,s,r,t[4]]}call(t,n){return H(()=>(this.invokeCallHook(t,n),this.poolingFunction(St(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class yT extends bT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),hT(t,n,s,r,o,"max")}}yT.className="MaxPooling3D";et(yT);class wT extends bT{constructor(t){super(t)}poolingFunction(t,n,s,r,o){return _e(o),bs(r),hT(t,n,s,r,o,"avg")}}wT.className="AveragePooling3D";et(wT);class vT extends Pt{constructor(t){super(t),this.inputSpec=[new De({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new Mt}}class $T extends vT{constructor(t){super(t||{})}call(t,n){return H(()=>{const s=St(t);return $e(s,1)})}}$T.className="GlobalAveragePooling1D";et($T);class CT extends vT{constructor(t){super(t||{})}call(t,n){return H(()=>{const s=St(t);return Qs(s,1)})}}CT.className="GlobalMaxPooling1D";et(CT);class kT extends Pt{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_e(this.dataFormat),this.inputSpec=[new De({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new Mt}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class IT extends kT{call(t,n){return H(()=>{const s=St(t);return this.dataFormat==="channelsLast"?$e(s,[1,2]):$e(s,[2,3])})}}IT.className="GlobalAveragePooling2D";et(IT);class ST extends kT{call(t,n){return H(()=>{const s=St(t);return this.dataFormat==="channelsLast"?Qs(s,[1,2]):Qs(s,[2,3])})}}ST.className="GlobalMaxPooling2D";et(ST);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NT extends Pt{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,s={}){const r=n.layer,o=jr(r,s);delete n.layer;const i={layer:o};return Object.assign(i,n),new t(i)}}class _T extends NT{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=qt(t),t.length<3)throw new z(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=qt(t);const n=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(n),r=t[1];return[s[0],r].concat(s.slice(1))}call(t,n){return H(()=>(t=St(t),P_((i,a)=>[St(this.layer.call(i,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}_T.className="TimeDistributed";et(_T);function fU(e){na(AV,"BidirectionalMergeMode",e)}const dU="concat";class TT extends NT{constructor(t){super(t);const n=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=n,this.forwardLayer=jr(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=t.layer.getClassName(),r.config=n,this.backwardLayer=jr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?dU:t.mergeMode,fU(this.mergeMode),t.weights)throw new Mt("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,s=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,o;return this.returnState&&(o=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):En(r)}apply(t,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=L_(t,s,r,this.numConstants);if(t=o.inputs,s=o.initialState,r=o.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&r==null)return super.apply(t,n);const i=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const u=s.map(h=>new De({shape:h.shape}));this.forwardLayer.stateSpec=u.slice(0,l/2),this.backwardLayer.stateSpec=u.slice(l/2),a.push(...u)}if(r!=null)throw new Mt("Support for constants in Bidirectional layers is not implemented yet.");const c=i[0]instanceof Sr;for(const l of i)if(l instanceof Sr!==c)throw new z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[t].concat(i),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const f=super.apply(l,n);return this.inputSpec=h,f}else return super.apply(t,n)}call(t,n){return H(()=>{const s=n.initialState;let r,o;if(s==null)r=this.forwardLayer.call(t,n),o=this.backwardLayer.call(t,n);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(t,Object.assign(n,{initialState:c})),o=this.backwardLayer.call(t,Object.assign(n,{initialState:l}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Fi(o,1));let a;return this.mergeMode==="concat"?a=Ry([r,o]):this.mergeMode==="sum"?a=nt(r,o):this.mergeMode==="ave"?a=P(.5,nt(r,o)):this.mergeMode==="mul"?a=P(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){yi(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),yi(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const s=jr(n.layer);if(delete n.layer,n.numConstants!=null)throw new Mt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new t(r)}}TT.className="Bidirectional";et(TT);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ET extends Pt{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return H(()=>(t=St(t),t.dtype!=="float32"&&(t=$r(t,"float32")),nt(P(t,this.scale),this.offset)))}}ET.className="Rescaling";et(ET);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:pU,cropAndResize:mU}=Gr;class RT extends Pt{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,s,r,o,i,a,c){return H(()=>{let l,u=!1;const h=n/i,f=s/a,d=(r+n)/i,p=(o+s)/a,g=[h,f,d,p],m=[];t.rank===3?(u=!0,l=vn([t])):l=t;for(let v=0;v<l.shape[0];v++)m.push(g);const x=Zs(m,[m.length,4]),b=Ll(0,m.length,1,"int32"),y=mU(l,x,b,[r,o],"nearest");return $r(u?St(Oi(y)):y,c)})}upsize(t,n,s,r){return H(()=>{const o=pU(t,[n,s]);return $r(o,r)})}call(t,n){return H(()=>{const s=St(t),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let c=0;i!==this.height&&(c=Math.floor((i-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,i,a,r):this.upsize(t,this.height,this.width,r)})}getConfig(){const t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=qt(t);const n=t.length-3,s=t.length-2;return t[n]=this.height,t[s]=this.width,t}}RT.className="CenterCrop";et(RT);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gU(e,t,n,s){let r=St(e);if(r.dtype!=="int32"&&(r=$r(r,"int32")),t==="int")return r;const o=r.shape;if(r.rank===0&&(r=Tn(r,-1)),t==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Tn(r,-1)),r.rank>2)throw new z(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(t),a=r;let c;if(typeof s<"u"&&t==="count"?c=n2(a,s,n,i):c=n2(a,[],n,i),t!=="tfIdf")return c;if(s)return P(c,s);throw new z("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AT extends Pt{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=qt(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return H(()=>{t=St(t),t.dtype!=="int32"&&(t=$r(t,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new z(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=St(n.countWeights)}const r=Qs(t),o=Zf(t),i=xs(this.numTokens,r).bufferSync().get(0),a=ta(o,0).bufferSync().get(0);if(!(i&&a))throw new z(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return gU(t,this.outputMode,this.numTokens,s)})}}AT.className="CategoryEncoding";et(AT);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xU=["bilinear","nearest"],U2=new Set(xU);class DT extends Pt{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(U2.has(t.interpolation))this.interpolation=t.interpolation;else throw new z(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=qt(t);const n=t[2];return[this.height,this.width,n]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return H(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Gr.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Gr.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...U2]} are supported`)})}}DT.className="Resizing";et(DT);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class MT{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}MT.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FT extends Pt{constructor(t){super(t),this.randomGenerator=new MT(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(t,n),t}}FT.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bU=["bilinear","nearest"],G2=new Set(bU);class OT extends FT{constructor(t){super(t);const{factor:n,interpolation:s="bilinear"}=t;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new z(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new z(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new z(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(G2.has(s))this.interpolation=s;else throw new z(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=qt(t);const n=t[2];return[this.imgHeight,-1,n]}call(t,n){return H(()=>{const s=St(t);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Zr([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Gr.resizeBilinear(t,i);case"nearest":return Gr.resizeNearestNeighbor(t,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...G2]} are supported`)}})}}OT.className="RandomWidth";et(OT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hh(e){return new Yy(e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU=X();yU.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var H2;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(H2||(H2={}));var q2;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(q2||(q2={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var X2;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(X2||(X2={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gt(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&D(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU=AS;class Fm extends Rx{nextDataId(){return Fm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new rI(this,lr())}write(t,n,s){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&ls(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:s,refCount:1}),r}makeTensorInfo(t,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&cu(s[0])){const o=s.map(i=>No(i));r=this.write(o,t,n)}else r=this.write(s,t,n);return{dataId:r,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,s,r,o){this.data.set(t,{values:n,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:s}=this.data.get(t);if(n==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return Qr(r,o)}return kO(this.data.get(t).values,n)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const s=n.map(r=>Ro(r));return Ot(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(t.shape,t.dtype,n)}makeOutput(t,n,s){return lr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=_n();return t(),{kernelMs:_n()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){gt([t],"where");const n=this.readSync(t.dataId);return wU(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Fm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const vU=e=>{const{x:t}=e.inputs,n=e.backend;gt(t,"abs");let s=new Float32Array(K(t.shape));const r=n.data.get(t.dataId).values;return s=LT(r),n.makeOutput(s,t.shape,t.dtype)},$U={kernelName:dp,backendName:"cpu",kernelFunc:vU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(e){return(t,n,s,r,o)=>{const i=Et(t,n),a=i.length,c=vt(i),l=K(i),u=rn(o,l),h=t.length,f=n.length,d=vt(t),p=vt(n),g=Ka(t,i),m=Ka(n,i);if(g.length+m.length===0)for(let x=0;x<u.length;++x)u[x]=e(s[x%s.length],r[x%r.length]);else for(let x=0;x<u.length;++x){const b=kc(x,a,c),w=b.slice(-h);g.forEach(I=>w[I]=0);const y=yr(w,h,d),v=b.slice(-f);m.forEach(I=>v[I]=0);const $=yr(v,f,p);u[x]=e(s[y],r[$])}return[u,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jn(e){const{inputs:t,backend:n}=e,{real:s,imag:r}=t,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),c=n.data.get(a.dataId);return c.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",o),imag:n.makeTensorInfo(r.shape,"float32",i)},a}const CU={kernelName:Ux,backendName:"cpu",kernelFunc:Jn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ud(e,t,n="float32"){if(n==="complex64"){const r=ud(e,t,"float32"),o=ud(e,t,"float32");return Jn({inputs:{real:r,imag:o},backend:e})}const s=on(K(t),n);return e.makeTensorInfo(t,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nr(e){const{inputs:t,backend:n}=e,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const kU={kernelName:Tu,backendName:"cpu",kernelFunc:Nr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pi(e){const{inputs:t,backend:n}=e,{input:s}=t,r=n.data.get(s.dataId).complexTensorInfos.real,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const IU={kernelName:pb,backendName:"cpu",kernelFunc:Pi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(e,t,n,s){if(s==="int32"){const r=Int32Array.from(e);return[t,"int32",r]}if(s==="bool"){const r=Ji([0],n),[o,i]=Te((a,c)=>a!==c?1:0)(t,[],e,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Oo(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Nr({inputs:{x:r},backend:n});const u=ud(n,r.shape,r.dtype),h=Oo({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),f=Jn({inputs:{real:h,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),f}if(r.dtype==="complex64"){const u=Pi({inputs:{input:r},backend:n}),h=Oo({inputs:{x:u},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(u),h}if(!aI(r.dtype,o)){const u=Nr({inputs:{x:r},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:o}}const i=n.data.get(r.dataId).values,[a,c,l]=PT(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,c,l)}const SU={kernelName:gu,backendName:"cpu",kernelFunc:Oo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(e,t,n,s){return n==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;gt([i,a],e);const l=c.data.get(i.dataId).values,u=c.data.get(a.dataId).values,h=i.dtype==="string"?Jr(l):l,f=i.dtype==="string"?Jr(u):u,d=s||i.dtype,[p,g]=t(i.shape,a.shape,h,f,d);return c.makeTensorInfo(g,d,p)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const l=Oo({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),u=c.data.get(l.dataId),h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,d=c.data.get(h.dataId).values,p=c.data.get(f.dataId).values,g=Oo({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),m=c.data.get(g.dataId),x=m.complexTensorInfos.real,b=m.complexTensorInfos.imag,w=c.data.get(x.dataId).values,y=c.data.get(b.dataId).values,[v,$,I]=n(i.shape,a.shape,d,p,w,y),N=c.makeTensorInfo(I,"float32",v),k=c.makeTensorInfo(I,"float32",$),S=Jn({inputs:{real:N,imag:k},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(N),c.disposeIntermediateTensorInfo(k),S}else{const l=c.data.get(i.dataId).values,u=c.data.get(a.dataId).values,h=s||i.dtype,[f,d]=t(i.shape,a.shape,l,u,h);return c.makeTensorInfo(d,h,f)}}}function Zy(e){return(t,n,s,r,o,i)=>{const a=Et(t,n),c=K(a),l=a.length,u=vt(a),h=rn("float32",c),f=rn("float32",c),d=Ka(t,a),p=Ka(n,a),g=Qr(s,r),m=Qr(o,i),x=t.length,b=vt(t),w=n.length,y=vt(n);if(d.length+p.length===0)for(let v=0;v<h.length;v++){const $=v%g.length,I=v%m.length,N=e(g[$*2],g[$*2+1],m[I*2],m[I*2+1]);h[v]=N.real,f[v]=N.imag}else for(let v=0;v<h.length;v++){const $=kc(v,l,u),I=$.slice(-x);d.forEach(A=>I[A]=0);const N=yr(I,x,b),k=$.slice(-w);p.forEach(A=>k[A]=0);const S=yr(k,w,y),C=e(g[N*2],g[N*2+1],m[S*2],m[S*2+1]);h[v]=C.real,f[v]=C.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zT=Te((e,t)=>e+t),NU=Zy((e,t,n,s)=>({real:e+n,imag:t+s})),Ja=Le(Ic,zT,NU),_U={kernelName:Ic,backendName:"cpu",kernelFunc:Ja};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qy(e,t,n,s,r){const o=K(s),i=on(r,n);for(let a=0;a<e.length;a++){const c=e[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(o>0?i[c]+=t[a]:i[c]+=1)}return i}function BT(e,t,n,s=!1){const r=e.shape[0],o=e.shape[1],i=Ot([r,n],t.dtype);for(let a=0;a<r;a++)for(let c=0;c<o;c++){const l=e.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(s?i.set(1,a,l):t.size>0?i.set(i.get(a,l)+t.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VT=Te((e,t)=>e&t),TU=Le(Wx,VT),EU={kernelName:Wx,backendName:"cpu",kernelFunc:TU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ar(e){return(t,n,s)=>{const r=ke(n,t.length);for(let o=0;o<t.length;++o)r[o]=e(t[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(e,t,n){const s=Ar(t);return Yo(e,s,n)}function Yo(e,t,n){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;gt(i,e);const a=o,c=a.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=Jr(c)}else l=c;const u=n||i.dtype,h=t(l,u,r);return a.makeTensorInfo(i.shape,u,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WT=Ar(e=>Math.ceil(e)),RU=Yo(xu,WT),AU={kernelName:xu,backendName:"cpu",kernelFunc:RU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(e,t,n,s){const r=ke(n,K(t));if(s&&n!=="string"){let o=0;e.forEach(i=>{const a=K(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;e.forEach(i=>{const a=n==="string"?Jr(i.vals):i.vals;let c=0;for(let l=0;l<i.shape[0];++l){const u=l*t[1]+o;for(let h=0;h<i.shape[1];++h)r[u+h]=a[c++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GT=Te((e,t)=>e===t?1:0),HT=Le(_p,GT,null,"bool"),DU={kernelName:_p,backendName:"cpu",kernelFunc:HT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qT=Ar(e=>Math.exp(e)),XT=Yo(ku,qT,"float32"),MU={kernelName:ku,backendName:"cpu",kernelFunc:XT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jT=Ar(e=>Math.expm1(e)),FU=Yo(Iu,jT),OU={kernelName:Iu,backendName:"cpu",kernelFunc:FU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KT=Ar(e=>Math.floor(e)),LU=Yo(Su,KT),PU={kernelName:Su,backendName:"cpu",kernelFunc:LU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YT=Te((e,t)=>Math.floor(e/t)),zU=Le(Nu,YT,null,"int32"),BU={kernelName:Nu,backendName:"cpu",kernelFunc:zU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(e,t,n,s,r,o,i,a,c){const l=Ot([s,o],n);for(let u=0;u<s;u++){const h=[];let f=0;for(let d=0;d<r;d++){const p=e[u*r+d];f+=p*i[d],h.push(p)}if(f<0||f>=c/o)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let d=0;d<o;d++)l.values[u*o+d]=t.get(...t.indexToLoc(f*o+d))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(e,t,n){const s=Ot(n,e.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],c=i[2],l=t.locToIndex([a,c]);i[2]=t.values[l];const u=e.locToIndex(i);0<=u&&u<e.values.length&&(s.values[r]=e.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT=Te((e,t)=>e>t?1:0),VU=Le(Ap,JT,null,"bool"),WU={kernelName:Ap,backendName:"cpu",kernelFunc:VU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tE=Te((e,t)=>e>=t?1:0),UU=Le(_u,tE,null,"bool"),GU={kernelName:_u,backendName:"cpu",kernelFunc:UU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eE=Te((e,t)=>e<t?1:0),HU=Le(Mp,eE,null,"bool"),qU={kernelName:Mp,backendName:"cpu",kernelFunc:HU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nE=Te((e,t)=>e<=t?1:0),XU=Le(Fp,nE,null,"bool"),jU={kernelName:Fp,backendName:"cpu",kernelFunc:XU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(e,t,n){const s=(t-e)/(n-1),r=on(n,"float32");r[0]=e;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rE=Ar(e=>Math.log(e)),KU=Yo(Du,rE),YU={kernelName:Du,backendName:"cpu",kernelFunc:KU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(e,t,n,s){const r=rn(s,K(n));for(let o=0;o<r.length;++o){const i=o*t;let a=e[i];for(let c=0;c<t;++c){const l=e[i+c];(Number.isNaN(l)||l>a)&&(a=l)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iE=Te((e,t)=>Math.max(e,t)),ZU=Le(Fu,iE),QU={kernelName:Fu,backendName:"cpu",kernelFunc:ZU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aE=Te((e,t)=>Math.min(e,t)),JU=Le(Ou,aE),t7={kernelName:Ou,backendName:"cpu",kernelFunc:JU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jy=Te((e,t)=>e*t),e7=Zy((e,t,n,s)=>({real:e*n-t*s,imag:e*s+t*n})),Om=Le(Pu,Jy,e7),n7={kernelName:Pu,backendName:"cpu",kernelFunc:Om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(e,t,n){const s=Go(-1,n);return Jy([],t,s,e,n)}function s7(e){const{inputs:t,backend:n}=e,{x:s}=t;gt(s,"neg");const r=n.data.get(s.dataId).values,[o,i]=cE(r,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,o)}const r7={kernelName:qp,backendName:"cpu",kernelFunc:s7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lE=Te((e,t)=>e!==t?1:0),o7=Le(Xp,lE,null,"bool"),i7={kernelName:Xp,backendName:"cpu",kernelFunc:o7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tw(e,t,n,s,r){const o=t.length,i=K(t),a=vt(t),c=vt(r),l=rn(n,K(r));for(let u=0;u<i;++u){const h=kc(u,o,a),f=new Array(h.length);for(let p=0;p<f.length;p++)f[p]=h[s[p]];const d=yr(f,o,c);l[d]=e[u]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(e){const{inputs:t,attrs:n,backend:s}=e,{x:r}=t,{perm:o}=n;gt(r,"transpose");const i=r.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=r.shape[o[h]];const c=s.data.get(r.dataId).values,l=tw(c,r.shape,r.dtype,o,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const a7={kernelName:Ma,backendName:"cpu",kernelFunc:zn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uE(e,t,n,s){const[r,o]=He(e,s),i=ns(t,"int32"),a=on(K(r),i),c=K(o);for(let l=0;l<a.length;++l){const u=l*c;let h=1;for(let f=0;f<c;++f)h*=n[u+f];a[l]=h}return{outVals:a,outShape:r,outDtype:i}}function c7(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;gt(r,"prod");const a=r.shape.length,c=Lt(o,r.shape),l=me(c,a);let u=c,h=r;const f=[];l!=null&&(h=zn({inputs:{x:r},backend:n,attrs:{perm:l}}),f.push(h),u=Ne(u.length,a));const d=n.data.get(h.dataId).values,{outVals:p,outShape:g,outDtype:m}=uE(h.shape,h.dtype,d,u);let x=g;return i&&(x=Se(g,c)),f.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(x,m,p)}const l7={kernelName:Jp,backendName:"cpu",kernelFunc:c7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(e,t,n){e.forEach((s,r)=>{if(s<0||s>=n){const o=kc(r,t.length,vt(t)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${n})`)}})}function h7(e,t){for(let n=0;n<e.length;++n){const s=e[n],r=n===e.length-1?t:e[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function f7(e,t,n,s){const r=[];let o=0;const i=t.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);h7(n,s);let c=1;for(let l=0;l<t.length-1;++l){c*=t[l];const u=t[l+1];for(let h=1;h<c+1;++h)a[l].push(h*u)}for(let l=0;l<e.length;++l){let u=e[l],h=e[l]+1;for(let f=0;f<n.length;++f){const d=n[f],p=f+t.length-1;if(p>=0){const g=a[p],m=g[g.length-1]-d[u];for(let x=u;x<h;++x)a[p].push(d[x+1]+m)}u=d[u],h=d[h]}h!==u&&(r.push([u,h]),o+=h-u)}return{outSplits:a,valueSlices:r,numValues:o}}function d7(e){const t=[];for(let n=0;n<e.length;++n){const s=e[n].length,r=ke("int32",s);t.push(r),e[n].forEach((o,i)=>r[i]=o)}return t}function j2(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let s=t;s<e.length;s++)n[t-1]*=e[s];return n}function p7(e,t,n,s,r,o){const i=j2(t,2)[1],a=j2(o,2)[1];let c=0;for(const l of n)for(let u=l[0];u<l[1];++u){for(let h=0;h<s;++h)r[c*a+h]=e[u*i+h];++c}}function m7(e,t,n,s,r){const o=t.slice();o[0]=r;const i=ke(n,K(o)),a=e.length,c=a===0?0:a/t[0];return p7(e,t,s,c,i,o),[i,o]}function hE(e,t,n,s,r,o,i,a){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const c=t[0][0]-1;if(u7(o,i,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:u,valueSlices:h,numValues:f}=f7(o,i,e,l),d=d7(u),p=m7(n,s,r,h,f);return[d,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2=2147483647;function fE(e,t,n,s,r,o,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,c=r.length===0,l=i.length===0,u=[];a||u.push(t[0]),c||u.push(r[0]),l||u.push(i[0]);for(let m=1;m<u.length;++m)if(u[m]!==u[m-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],f=ke("int32",h+1);f[0]=0;for(let m=0;m<h;++m){const x=a?e[0]:e[m],b=c?s[0]:s[m],w=l?o[0]:o[m];if(w===0)throw new Error("Requires delta != 0");let y;if(w>0&&b<x||w<0&&b>x)y=0;else if(y=Math.ceil(Math.abs((b-x)/w)),y>K2)throw new Error(`Requires ((limit - start) / delta) <= ${K2}`);f[m+1]=f[m]+y}const d=f[h],p=ke(n,d);let g=0;for(let m=0;m<h;++m){const x=f[m+1]-f[m];let b=a?e[0]:e[m];const w=l?o[0]:o[m];for(let y=0;y<x;++y)p[g++]=b,b+=w}return[f,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ws=qs;class hd{constructor(t,n,s,r,o,i,a,c,l,u){this.shape=t,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=QS(u),this.raggedRank=JS(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===ws.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===ws.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case ws.VALUE_ROWIDS:return hd.getMaxWidthValueRowID(n);case ws.ROW_SPLITS:return hd.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ws[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const n=t.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const o=t[r+1]-t[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(t){const n=t.length;if(n===0)return 0;let s=0,r=t[0],o=0;for(let i=1;i<n;++i){const a=t[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(n-s,o)}tensorShapeFromTensor(t,n,s=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Z2(t,s)}calculateOutputSize(t){const n=this.valuesShape,s=this.defaultValueShape;tN(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=ZS(this.raggedRank,r,n);i[0]<0&&(i[0]=t);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(t,n,s){const r=Math.min(t,s),o=[];let i=0;for(let a=0;a<r;++a,i+=n)o.push(i);for(let a=r;a<t;++a)o.push(-1);return D(o.length===t,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(t,n,s,r){const o=t.length,i=[];for(let a=0;a<o-1;++a){const c=t[a+1]-t[a];let l=Math.min(r,c),u=n[a];u===-1&&(l=0);for(let h=0;h<l;++h)i.push(u),u+=s;for(let h=0;h<c-l;++h)i.push(-1)}if(o>0&&i.length!==t[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,n,s,r){const o=t.length,i=[];if(o===0)return[];let a=0,c=t[0];if(c>=n.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${n.length}`);let l=n[c];i.push(l);for(let u=1;u<o;++u){const h=t[u];if(h===c)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,c=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);l=n[h]}i.push(l)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,n,s,r){const o=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case ws.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,s,r);case ws.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,s,r);default:throw new Error(`Unsupported partition type: ${ws[i]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ws.FIRST_DIM_SIZE:return t[0];case ws.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ws.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ws[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const o=Z2(s,!1),i=ke(this.valuesDType,K(o));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],s[l]);this.setOutput(this.raggedRank,c,i,o)}return[o,i]}setOutput(t,n,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(t+1);const c=K(a),l=n.length;let u=this.defaultValue;if(u.length!==c&&u.length!==1){const p=this.defaultValueShape;H(()=>{const g=U(u,p);u=Cl(g,a).dataSync()})}let h=0,f=0,d=0;for(let p=0;p<=l;++p){let g=p<l?n[p]:-1;if(g===d){++d;continue}if(f<d){const m=o.subarray(h*c),x=i.subarray(f*c),b=(d-f)*c;Y2(x,m,b)}if(p>=l){const m=s.length;g=Math.floor(m/c)}if(g>d)if(this.defaultValue.length===1)i.subarray(d*c,g*c).fill(this.defaultValue[0]),d=g;else for(;g>d;){const m=i.slice(d*c);Y2(m,u,c),++d}g<0?(h=p+1,f=d):(h=p,f=d,d=f+1)}}}function Y2(e,t,n){for(let s=0;s<n;s++)e[s]=t[s]}function Z2(e,t){const n=[];for(let s of e){if(s<0){if(!t)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function dE(e,t,n,s,r,o,i,a,c,l){return new hd(e,t,n,s,r,o,i,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(e,t,n,s){const r=e===t,o=e<t&&n<0,i=t<e&&n>1;if(r||o||i)return on(0,s);const a=Math.abs(Math.ceil((t-e)/n)),c=on(a,s);t<e&&n===1&&(n=-1),c[0]=e;for(let l=1;l<c.length;l++)c[l]=c[l-1]+n;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mE=Ar(e=>1/Math.sqrt(e)),g7=Yo(Gu,mE),x7={kernelName:Gu,backendName:"cpu",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(e,t,n,s,r,o,i,a,c,l){const u=[s/r,r],h=e.values,f=t.values;if(s===0)return Ot(n,t.dtype);const d=c instanceof Ye?c:Ot(u,t.dtype);typeof c=="string"||typeof c=="number"?d.values.fill(c):typeof c=="boolean"&&d.values.fill(+c);for(let p=0;p<o;p++){const g=[];let m=0;for(let x=0;x<i;x++){const b=h[p*i+x];g.push(b),m+=b*a[x]}if(m<0||m>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let x=0;x<r;x++)l?d.values[m*r+x]+=f[p*r+x]:d.values[m*r+x]=t.rank===0?f[0]:f[p*r+x]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=Ar(e=>1/(1+Math.exp(-e))),gE=Zt(Ku,e=>1/(1+Math.exp(-e))),y7={kernelName:Ku,backendName:"cpu",kernelFunc:gE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xE(e,t,n,s,r){const o=iy(s,t,n),i=K(n),a=vt(s);if(o){const h=ay(t,a);return r==="string"?e.slice(h,h+i):e.subarray(h,h+i)}const c=r==="string"?Jr(e):e,l=Ot(s,r,c),u=Ot(n,r);for(let h=0;h<u.size;++h){const f=u.indexToLoc(h),d=f.map((p,g)=>p+t[g]);u.set(l.get(...d),...f)}return r==="string"?wN(u.values):u.values}function zi(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{begin:o,size:i}=s;gt(r,"slice");const[a,c]=vm(r,o,i);ry(r,a,c);const l=n.data.get(r.dataId).values,u=xE(l,a,c,r.shape,r.dtype);return n.makeTensorInfo(c,r.dtype,u)}const w7={kernelName:om,backendName:"cpu",kernelFunc:zi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bE(e,t,n,s,r,o,i){const a=t[0],c=o[0],l=new Array(c),u=new Array(a),h=t[1];if(c===0){if(a!==0)throw new Error(aN(a));const m=ke(n,0),x=ke(r,0);return[m,[0,h],x,l,u]}let f=!0,d=0;const p=new Array(c).fill(0);for(let m=0;m<a;++m){const x=e[m*h];if(x<0)throw new Error(cN(m,x));if(x>=c)throw new Error(lN(m,x,c));++p[x],f=f&&x>=d,d=x}let g=!0;for(let m=0;m<c;++m){const x=p[m]===0;l[m]=x,g=g&&!x,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(g&&f){const m=e,x=s;for(let b=0;b<a;++b)u[b]=b;return[m,[a,h],x,l,u]}else{const m=p[c-1],x=ke(n,m*h),b=ke(r,m),w=new Array(c).fill(0);for(let y=0;y<a;++y){const v=e[y*h],$=w[v],I=(v===0?0:p[v-1])+$;w[v]++;for(let N=0;N<h;++N)x[I*h+N]=e[y*h+N];b[I]=s[y],u[y]=I}for(let y=0;y<c;++y)if(w[y]===0){const $=y===0?0:p[y-1];x[$*h+0]=y;for(let I=1;I<h;++I)x[$*h+I]=0;b[$]=i}return[x,[m,h],b,l,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(e,t,n,s,r){const o=K(s),i=t[0],a=r.length,c=[];let l=1,u=-1;for(let m=0;m<a;++m){const x=r[m];if(x===-1){if(u!==-1)throw new Error(uN(u,m));u=m,c.push(1)}else{if(x<0)throw new Error(hN(m,x));l*=x,c.push(x)}}if(u!==-1){if(l<=0)throw new Error(fN());const m=Math.trunc(o/l);if(l*m!==o)throw new Error(dN(s,c));c[u]=m}if(K(c)!==o)throw new Error(pN(s,c));const f=s.length,d=[];if(f>0){d[f-1]=1;for(let m=f-2;m>=0;--m)d[m]=d[m+1]*s[m+1]}const p=[];if(a>0){p[a-1]=1;for(let m=a-2;m>=0;--m)p[m]=p[m+1]*c[m+1]}const g=ke(n,i*a);for(let m=0;m<i;++m){let x=0;for(let b=0;b<f;++b)x+=e[m*f+b]*d[b];for(let b=0;b<a;++b)g[m*a+b]=Math.trunc(x/p[b]),x%=p[b]}return[g,[i,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ew(e,t,n,s,r,o=!1,i=0){const a=s.length,c=[t[0],e.length/t[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(u1());const f=t.slice();f[0]=h;const d=f.reduce((w,y)=>w*y,1),p=ke(n,d);if(a===0)return h>0&&p.fill(i),[p,f];if(h<=0)throw new Error(u1());let g=0,m=1,x=0,b=r[g];for(;;){let w=0;if(m<a){if(w=r[m],b===w){++m;continue}if(b>=w)throw new Error(mN())}if(b<0||b>=h)throw new Error(gN(b,h));b>x&&p.fill(i,x*l,b*l);for(let y=g;y<m;++y){const v=s[y];if(v<0||v>=c[0])throw new Error(xN(y,s[y],c[0]));for(let $=0;$<l;$++)p[b*l+$]+=e[v*l+$]}if(o)for(let y=0;y<l;y++)p[b*l+y]/=m-g;if(g=m,++m,x=b+1,b=w,m>a)break}return x<h&&p.fill(i,x*l,h*l),[p,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7=Ar(e=>Math.sqrt(e)),$7=Zt(Zu,e=>Math.sqrt(e)),C7={kernelName:Zu,backendName:"cpu",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wE=Te((e,t)=>{const n=e-t;return n*n}),k7=Le(Qu,wE),I7={kernelName:Qu,backendName:"cpu",kernelFunc:k7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vE=Ar((e,t)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=t;return e.replace(new RegExp(n,s?"g":""),r)}),S7=Yo(bb,vE),N7={kernelName:bb,backendName:"cpu",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(e,t,n,s){const r=Ot(e,t.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*n[c]+s[c];r.set(t.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _7{constructor(t,n,s,r,o,i){this.separator=No(t),this.nGramWidths=n,this.leftPad=No(s),this.rightPad=No(r),this.padWidth=o,this.preserveShort=i}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const s=this.getPadWidth(n);return Math.max(0,t+2*s-n+1)}createNGrams(t,n,s,r,o,i){for(let a=0;a<o;++a){const c=this.getPadWidth(i),l=Math.max(0,c-a),u=Math.max(0,c-(o-(a+1))),h=i-(l+u),f=n+(l>0?0:a-c);let d=0;d+=l*this.leftPad.length;for(let b=0;b<h;++b)d+=t[f+b].length;d+=u*this.rightPad.length;const p=l+u+h-1;d+=p*this.separator.length,s[r+a]=new Uint8Array(d);const g=s[r+a];let m=0;const x=b=>b.forEach(w=>g[m++]=w);for(let b=0;b<l;++b)x(this.leftPad),x(this.separator);for(let b=0;b<h-1;++b)x(t[f+b]),x(this.separator);if(h>0){x(t[f+h-1]);for(let b=0;b<u;++b)x(this.separator),x(this.rightPad)}else{for(let b=0;b<u-1;++b)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(t,n){const s=t.length,r=n.length;if(r>0){let c=n[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let u=n[l]>=c;if(u=u&&n[l]<=s,!u)throw new Error(`Invalid split value ${n[l]}, must be in [${c}, ${s}]`);c=n[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const o=r-1,i=ke("int32",r);if(s===0||r===0){const c=new Array(s);for(let l=0;l<=o;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=o;++c){const l=n[c]-n[c-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&u===0&&(u=1),i[c]=i[c-1]+u}const a=new Array(i[o]);for(let c=0;c<o;++c){const l=n[c];let u=i[c];if(this.nGramWidths.forEach(h=>{const f=n[c+1]-n[c],d=this.getNumNGrams(f,h);this.createNGrams(t,l,a,u,d,h),u+=d}),this.preserveShort&&u===i[c]){const h=n[c+1]-n[c];if(h===0)continue;const f=h+2*this.padWidth;this.createNGrams(t,l,a,u,1,f)}}return[a,i]}}function CE(e,t,n,s,r,o,i,a){return new _7(n,s,r,o,i,a).compute(e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T7(e,t,n,s){if(!e.length)return;if(t.length===0){for(let o=0;o<e.length;++o)s.push(e.subarray(o,o+1));return}if(t.length===1){const o=t[0];let i=e.indexOf(o);for(;i!==-1;){const a=e.subarray(0,i);(!n||a.length!==0)&&s.push(a),e=e.subarray(i+1),i=e.indexOf(o)}(!n||e.length!==0)&&s.push(e);return}let r=0;for(let o=0;o<e.length+1;o++)if(o===e.length||t.indexOf(e[o])!==-1){const i=e.subarray(r,o);(!n||i.length!==0)&&s.push(i),r=o+1}}function kE(e,t,n){const s=e.length,r=[];let o=0,i=0;const a=new Array(s);for(let f=0;f<s;++f){const d=r.length;T7(e[f],t,n,r);const p=r.length-d;a[f]=p,o+=p,i=Math.max(i,p)}const c=ke("int32",o*2),l=new Array(o),u=[s,i];let h=0;for(let f=0;f<s;++f)for(let d=0;d<a[f];++d)c[h*2]=f,c[h*2+1]=d,l[h]=r[h],++h;return[c,l,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(e,t){const n=ke("int32",e.length);for(let s=0;s<e.length;++s)n[s]=HO(e[s]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SE=Te((e,t)=>e-t),E7=Zy((e,t,n,s)=>({real:e-n,imag:t-s})),nw=Le(Ju,SE,E7),R7={kernelName:Ju,backendName:"cpu",kernelFunc:nw};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const s=Ot(n,e.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(e.rank);for(let c=0;c<i.length;c++)i[c]=o[c]%e.shape[c];const a=e.locToIndex(i);s.values[r]=e.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=(e,t)=>{const n=t.value-e.value;return n===0?e.index-t.index:n};function _E(e,t,n=0,s=e.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,c=t-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(a-u)/a)*Math.sign(c-a/2),f=Math.max(n,Math.floor(t-c*u/a+h)),d=Math.min(s,Math.floor(t+(a-c)*u/a+h));_E(e,t,f,d)}const r=e[t];let o=n,i=s;for(Sa(e,n,t),al(e[s],r)>0&&Sa(e,n,s);o<i;){for(Sa(e,o,i),o++,i--;al(e[o],r)<0;)o=o+1;for(;al(e[i],r)>0;)i=i-1}al(e[n],r)===0?Sa(e,n,i):(i=i+1,Sa(e,i,s)),i<=t&&(n=i+1),t<=i&&(s=i-1)}}function TE(e,t,n,s,r){const o=t[t.length-1],[i,a]=[e.length/o,o],c=rn(n,i*s),l=rn("int32",i*s);for(let h=0;h<i;h++){const f=h*a,d=e.subarray(f,f+a);let p=new Array(d.length);d.forEach((b,w)=>p[w]={value:b,index:w}),s<p.length&&(_E(p,s),p=p.slice(0,s)),r&&p.sort(al);const g=h*s,m=c.subarray(g,g+s),x=l.subarray(g,g+s);for(let b=0;b<s;b++)m[b]=p[b].value,x[b]=p[b].index}const u=t.slice();return u[u.length-1]=s,[Ot(u,n,c),Ot(u,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(e,t,n,s){const r=Lt(t,n)[0],o=[1,n[0],1];for(let p=0;p<r;p++)o[0]*=n[p];o[1]=n[r];for(let p=r+1;p<n.length;p++)o[2]*=n[p];const i=new Map,a=new Int32Array(n[r]),c=new Ye(o,s,e),l=[],u=o[0]===1&&o[2]===1;for(let p=0;p<n[r];p++){let g;if(u)g=e[p].toString();else{const x=[];for(let b=0;b<o[0];b++)for(let w=0;w<o[2];w++)x.push(c.get(b,p,w));g=x.join(",")}const m=i.get(g);if(m!=null)a[p]=m;else{const x=i.size;i.set(g,x),a[p]=x,l.push(p)}}const h=o.slice();h[1]=i.size;const f=new Ye(h,s);l.forEach((p,g)=>{for(let m=0;m<o[0];m++)for(let x=0;x<o[2];x++)f.set(c.get(m,p,x),m,g,x)});const d=n.slice();return d[r]=h[1],{outputValues:f.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:zT,bincountImpl:Qy,bincountReduceImpl:BT,bitwiseAndImpl:VT,castImpl:PT,ceilImpl:WT,concatImpl:UT,equalImpl:GT,expImpl:qT,expm1Impl:jT,floorDivImpl:YT,floorImpl:KT,gatherNdImpl:ZT,gatherV2Impl:QT,greaterEqualImpl:tE,greaterImpl:JT,lessEqualImpl:nE,lessImpl:eE,linSpaceImpl:sE,logImpl:rE,maxImpl:oE,maximumImpl:iE,minimumImpl:aE,multiplyImpl:Jy,negImpl:cE,notEqualImpl:lE,prodImpl:uE,raggedGatherImpl:hE,raggedRangeImpl:fE,raggedTensorToTensorImpl:dE,rangeImpl:pE,rsqrtImpl:mE,scatterImpl:mi,sigmoidImpl:b7,simpleAbsImpl:LT,sliceImpl:xE,sparseFillEmptyRowsImpl:bE,sparseReshapeImpl:yE,sparseSegmentReductionImpl:ew,sqrtImpl:v7,squaredDifferenceImpl:wE,staticRegexReplaceImpl:vE,stridedSliceImpl:$E,stringNGramsImpl:CE,stringSplitImpl:kE,stringToHashBucketFastImpl:IE,subImpl:SE,tileImpl:NE,topKImpl:TE,transposeImpl:tw,uniqueImpl:EE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */KI("cpu",()=>new Fm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RE=Zt($u,e=>e>=0?e:Math.exp(e)-1),D7={kernelName:$u,backendName:"cpu",kernelFunc:RE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{alpha:o}=s;gt([r],"leakyRelu");const i=K(r.shape),a=n.data.get(r.dataId).values,c=rn("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?o*a[l]:a[l];return n.makeTensorInfo(r.shape,"float32",c)}const M7={kernelName:Dp,backendName:"cpu",kernelFunc:AE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=Te((e,t)=>e<0?t*e:e);function DE(e){const{inputs:t,backend:n}=e,{x:s,alpha:r}=t;gt([s,r],"prelu");const o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,[a,c]=F7(s.shape,r.shape,o,i,"float32");return n.makeTensorInfo(c,"float32",a)}const O7={kernelName:Qp,backendName:"cpu",kernelFunc:DE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ME=Zt(Vu,e=>Math.max(0,e)),L7={kernelName:Vu,backendName:"cpu",kernelFunc:ME};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FE=Zt(Wu,e=>Math.min(Math.max(0,e),6)),P7={kernelName:Wu,backendName:"cpu",kernelFunc:FE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fd(e,t,n,s,r){if(n==="linear")return Nr({inputs:{x:t},backend:e});if(n==="relu")return ME({inputs:{x:t},backend:e});if(n==="elu")return RE({inputs:{x:t},backend:e});if(n==="relu6")return FE({inputs:{x:t},backend:e});if(n==="prelu")return DE({inputs:{x:t,alpha:s},backend:e});if(n==="leakyrelu")return AE({inputs:{x:t},backend:e,attrs:{alpha:r}});if(n==="sigmoid")return gE({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{shape:o}=s,i=K(r.shape),a=iI(o,i),c=K(a);D(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const l=n.data.get(r.dataId);if(l.complexTensorInfos!=null){const u=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;u.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const z7={kernelName:tm,backendName:"cpu",kernelFunc:ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(e){const{inputs:t,backend:n,attrs:s}=e,{a:r,b:o}=t,{transposeA:i,transposeB:a}=s;gt([r,o],"matMul");const c=r.shape.length,l=o.shape.length,u=i?r.shape[c-2]:r.shape[c-1],h=a?o.shape[l-1]:o.shape[l-2],f=i?r.shape[c-1]:r.shape[c-2],d=a?o.shape[l-2]:o.shape[l-1],p=r.shape.slice(0,-2),g=o.shape.slice(0,-2),m=K(p),x=K(g),w=Et(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,d]);D(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const y=i?[m,u,f]:[m,f,u],v=a?[x,d,h]:[x,h,d],$=ae({inputs:{x:r},backend:n,attrs:{shape:y}}),I=ae({inputs:{x:o},backend:n,attrs:{shape:v}}),N=i?$.shape[1]:$.shape[2],k=i?$.shape[2]:$.shape[1],S=a?I.shape[1]:I.shape[2],C=Math.max(m,x),A=n.data.get($.dataId).values,R=n.data.get(I.dataId).values,_=vt($.shape),T=vt(I.shape),[E,M,O]=i?[_[0],1,_[1]]:[_[0],_[1],1],[L,B,G]=a?[1,T[1],T[0]]:[T[1],1,T[0]],q=k*S,Y=Ot([C,k,S],$.dtype),tt=Y.values,J=n.blockSize;for(let st=0;st<C;st++){const rt=st%m,ft=st%x;for(let Z=0;Z<k;Z+=J){const ot=Math.min(Z+J,k);for(let at=0;at<S;at+=J){const Q=Math.min(at+J,S);for(let It=0;It<N;It+=J){const $t=Math.min(It+J,N);for(let Rt=Z;Rt<ot;Rt++)for(let Tt=at;Tt<Q;Tt++){let ut=0;for(let _t=It;_t<$t;_t++){const kn=A[rt*E+Rt*M+_t*O],ee=R[_t*L+Tt*B+ft*G];ut+=kn*ee}tt[st*q+(Rt*S+Tt)]+=ut}}}}}return n.disposeIntermediateTensorInfo($),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(w,Y.dtype,Y.values)}const B7={kernelName:bp,backendName:"cpu",kernelFunc:OE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(e){const{inputs:t,backend:n,attrs:s}=e,{a:r,b:o,bias:i,preluActivationWeights:a}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=s;let f,d,p;const g=[];f=OE({inputs:{a:r,b:o},attrs:{transposeA:c,transposeB:l},backend:n}),i&&(d=Ja({inputs:{a:f,b:i},backend:n}),g.push(f),f=d),u&&(p=fd(n,f,u,a,h),g.push(f),f=p);for(const x of g)n.disposeIntermediateTensorInfo(x);return f}const W7={kernelName:qf,backendName:"cpu",kernelFunc:V7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7=Zt(lu,e=>Math.acos(e)),G7={kernelName:lu,backendName:"cpu",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=Zt(uu,e=>Math.acosh(e)),q7={kernelName:uu,backendName:"cpu",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(e){const{inputs:t,backend:n}=e,s=t;gt(t,"addN");const r=s.map(a=>n.data.get(a.dataId).values),o=Ot(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const c=r[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}const j7={kernelName:Ox,backendName:"cpu",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;gt(r,"all");const a=Lt(o,r.shape);let c=a;const l=me(c,r.shape.length);let u=r;l!=null&&(u=zn({inputs:{x:r},backend:n,attrs:{perm:l}}),c=Ne(c.length,r.shape.length)),tn("all",c,u.shape.length);const[h,f]=He(u.shape,c),d=K(f),p=on(K(h),u.dtype),g=n.data.get(u.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let w=g[b];for(let y=0;y<d;++y){const v=g[b+y];w=w&&v}p[x]=w}l!=null&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(i){const x=Se(h,a),b=ae({inputs:{x:m},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(m),b}return m}const Y7={kernelName:Lx,backendName:"cpu",kernelFunc:K7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;gt(r,"any");const a=Lt(o,r.shape);let c=a;const l=me(c,r.shape.length);let u=r;l!=null&&(u=zn({inputs:{x:r},backend:n,attrs:{perm:l}}),c=Ne(c.length,r.shape.length)),tn("any",c,u.shape.length);const[h,f]=He(u.shape,c),d=K(f),p=on(K(h),u.dtype),g=n.data.get(u.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let w=g[b];for(let y=0;y<d;++y){const v=g[b+y];w=w||v}p[x]=w}l!=null&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(i){const x=Se(h,a),b=ae({inputs:{x:m},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(m),b}return m}const Q7={kernelName:Px,backendName:"cpu",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o}=s;gt(r,"argMax");let i=Lt(o,r.shape);const a=me(i,r.shape.length);let c=r;const l=[];a!=null&&(c=zn({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),i=Ne(i.length,c.shape.length)),i=[i[0]],tn("argMax",i,c.shape.length);const[u,h]=He(c.shape,i),f=K(u),d=on(f,"int32"),p=K(h),g=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const x=m*p;let b=g[x],w=0;for(let y=0;y<p;++y){const v=g[x+y];v>b&&(b=v,w=y)}d[m]=w}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(u,"int32",d)}const t9={kernelName:pp,backendName:"cpu",kernelFunc:J7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o}=s;gt(r,"argMin");let i=Lt(o,r.shape);const a=me(i,r.shape.length);let c=r;const l=[];a!=null&&(c=zn({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),i=Ne(i.length,c.shape.length)),i=[i[0]],tn("argMin",i,c.shape.length);const[u,h]=He(c.shape,i),f=K(u),d=on(f,"int32"),p=K(h),g=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const x=m*p;let b=g[x],w=0;for(let y=0;y<p;++y){const v=g[x+y];v<b&&(b=v,w=y)}d[m]=w}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(u,"int32",d)}const n9={kernelName:mp,backendName:"cpu",kernelFunc:e9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9=Zt(hu,e=>Math.asin(e)),r9={kernelName:hu,backendName:"cpu",kernelFunc:s9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=Zt(fu,e=>Math.asinh(e)),i9={kernelName:fu,backendName:"cpu",kernelFunc:o9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9=Zt(du,e=>Math.atan(e)),c9={kernelName:du,backendName:"cpu",kernelFunc:a9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l9=Te((e,t)=>Math.atan2(e,t)),u9=Le(mu,l9),h9={kernelName:mu,backendName:"cpu",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f9=Zt(pu,e=>Math.atanh(e)),d9={kernelName:pu,backendName:"cpu",kernelFunc:f9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sw(e,t,n,s,r,o){const i=r.strideHeight,a=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,u=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Ot(r.outShape,n),m=g.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],w=r.outShape[3];for(let y=0;y<r.batchSize;++y){const v=y*x,$=y*s[0];for(let I=0;I<r.inChannels;++I)for(let N=0;N<r.outHeight;++N){const k=N*i-f,S=Math.max(0,k),C=Math.min(r.inHeight,u+k),A=v+N*b;for(let R=0;R<r.outWidth;++R){const _=R*a-d,T=Math.max(0,_),E=Math.min(r.inWidth,h+_);let M=p,O=0,L=0;for(let G=S;G<C;G+=c){const q=$+G*s[1];for(let Y=T;Y<E;Y+=l){const tt=q+Y*s[2],J=e[tt+I];o==="max"&&J>M?M=J:o==="avg"&&(O+=J,L++)}if(isNaN(M))break}const B=A+R*w+I;m[B]=o==="avg"?O/L:M}}}return g}function LE(e,t,n,s,r=!1,o=!1){const i=Ot(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,u=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,d=s.padInfo.top,p=s.padInfo.left,g=Ot(t,n,e);for(let m=0;m<s.batchSize;++m)for(let x=0;x<s.inChannels;++x)for(let b=0;b<s.outHeight;++b){const w=b*a-d;let y=w;for(;y<0;)y+=l;const v=Math.min(s.inHeight,h+w);for(let $=0;$<s.outWidth;++$){const I=$*c-p;let N=I;for(;N<0;)N+=u;const k=Math.min(s.inWidth,f+I);let S=Number.NEGATIVE_INFINITY,C=-1;for(let A=y;A<v;A+=l){const R=A-w;for(let _=N;_<k;_+=u){const T=_-I,E=g.get(m,A,_,x);E>S&&(S=E,r?C=o?((m*s.inHeight+A)*s.inWidth+_)*s.inChannels+x:(A*s.inWidth+_)*s.inChannels+x:C=R*f+T)}}i.set(C,m,b,$,x)}}return i}function PE(e,t,n,s,r,o){const i=r.strideDepth,a=r.strideHeight,c=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,m=r.padInfo.top,x=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Ot(r.outShape,n),y=w.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[3]*r.outShape[4],N=r.outShape[4];for(let k=0;k<r.batchSize;++k){const S=k*v,C=k*s[0];for(let A=0;A<r.inChannels;++A)for(let R=0;R<r.outDepth;++R){const _=R*i-g;let T=_;for(;T<0;)T+=l;const E=Math.min(r.inDepth,f+_),M=S+R*$;for(let O=0;O<r.outHeight;++O){const L=O*a-m;let B=L;for(;B<0;)B+=u;const G=Math.min(r.inHeight,d+L),q=M+O*I;for(let Y=0;Y<r.outWidth;++Y){const tt=Y*c-x;let J=tt;for(;J<0;)J+=h;const st=Math.min(r.inWidth,p+tt),rt=q+Y*N;let ft=b,Z=0,ot=0;for(let Q=T;Q<E;Q+=l){const It=C+Q*s[1];for(let $t=B;$t<G;$t+=u){const Rt=It+$t*s[2];for(let Tt=J;Tt<st;Tt+=h){const ut=Rt+Tt*s[3],_t=e[ut+A];if(o==="max"&&_t>ft?ft=_t:o==="avg"&&(Z+=_t,ot++),isNaN(ft))break}if(isNaN(ft))break}if(isNaN(ft))break}const at=rt+A;y[at]=o==="avg"?Z/Math.max(ot,1):ft}}}}return w}function p9(e,t){const n=Ot(t.outShape,"int32"),s=t.strideDepth,r=t.strideHeight,o=t.strideWidth,i=t.dilationDepth,a=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let x=0;x<t.outDepth;++x){const b=x*s-f;let w=b;for(;w<0;)w+=i;const y=Math.min(t.inDepth,l+b);for(let v=0;v<t.outHeight;++v){const $=v*r-d;let I=$;for(;I<0;)I+=a;const N=Math.min(t.inHeight,u+$);for(let k=0;k<t.outWidth;++k){const S=k*o-p;let C=S;for(;C<0;)C+=c;const A=Math.min(t.inWidth,h+S);let R=Number.NEGATIVE_INFINITY,_=-1;for(let T=w;T<y;T+=i){const E=T-b;for(let M=I;M<N;M+=a){const O=M-$;for(let L=C;L<A;L+=c){const B=L-S,G=e.get(g,T,M,L,m);G>=R&&(R=G,_=E*u*h+O*u+B)}}}n.set(_,g,x,v,k,m)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t;gt(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;D(an(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const u=Ps(r.shape,o,i,l,a,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&Xt(u.inShape,u.outShape))h=Nr({inputs:{x:r},backend:n});else{const f=n.data.get(r.dataId).values,d=vt(r.shape),p=sw(f,r.shape,r.dtype,d,u,"avg");h=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return h}const g9={kernelName:gp,backendName:"cpu",kernelFunc:m9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;gt(r,"avgPool3d");const u=ro(r.shape,o,i,1,a,c,l),h=n.data.get(r.dataId).values,f=PE(h,r.shape,r.dtype,vt(r.shape),u,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const b9={kernelName:xp,backendName:"cpu",kernelFunc:x9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;gt([r,o],"avgPool3DGrad");const u=ro(o.shape,i,a,1,c,l),h=u.strideDepth,f=u.strideHeight,d=u.strideWidth,p=u.filterDepth,g=u.filterHeight,m=u.filterWidth,x=u.dilationDepth,b=u.dilationHeight,w=u.dilationWidth,y=u.effectiveFilterDepth,v=u.effectiveFilterHeight,$=u.effectiveFilterWidth,I=y-1-u.padInfo.front,N=$-1-u.padInfo.left,k=v-1-u.padInfo.top,S=Ot(o.shape,"float32"),C=1/(p*g*m),A=n.bufferSync(r);for(let R=0;R<u.batchSize;++R)for(let _=0;_<u.inChannels;++_)for(let T=0;T<u.inDepth;++T)for(let E=0;E<u.inHeight;++E)for(let M=0;M<u.inWidth;++M){const O=T-I,L=E-k,B=M-N;let G=0;for(let q=0;q<y;q+=x){const Y=(O+q)/h;if(!(Y<0||Y>=u.outDepth||Math.floor(Y)!==Y))for(let tt=0;tt<v;tt+=b){const J=(L+tt)/f;if(!(J<0||J>=u.outHeight||Math.floor(J)!==J))for(let st=0;st<$;st+=w){const rt=(B+st)/d;if(rt<0||rt>=u.outWidth||Math.floor(rt)!==rt)continue;const ft=A.get(R,Y,J,rt,_);G+=ft}}}S.set(G*C,R,T,E,M,_)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const w9={kernelName:Bx,backendName:"cpu",kernelFunc:y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,i=o;gt([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,u=Ps(i.shape,a,c,1,l),h=u.strideHeight,f=u.strideWidth,d=u.filterHeight,p=u.filterWidth,g=u.dilationHeight,m=u.dilationWidth,x=u.effectiveFilterHeight,b=u.effectiveFilterWidth,w=b-1-u.padInfo.left,y=x-1-u.padInfo.top,v=Ot(i.shape,"float32"),$=1/(d*p),I=n.data.get(r.dataId).values,N=Ot(r.shape,"float32",I);for(let k=0;k<u.batchSize;++k)for(let S=0;S<u.inChannels;++S)for(let C=0;C<u.inHeight;++C)for(let A=0;A<u.inWidth;++A){const R=C-y,_=A-w;let T=0;for(let E=0;E<x;E+=g){const M=(R+E)/h;if(!(M<0||M>=u.outHeight||Math.floor(M)!==M))for(let O=0;O<b;O+=m){const L=(_+O)/f;if(L<0||L>=u.outWidth||Math.floor(L)!==L)continue;const B=N.get(k,M,L,S);T+=B}}v.set(T*$,k,C,A,S)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const $9={kernelName:zx,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,scale:o,offset:i,mean:a,variance:c}=t;D(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),gt([r,a,c,o,i],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const u=n.data.get(r.dataId).values,h=n.data.get(a.dataId).values,f=n.data.get(c.dataId).values,d=o?n.data.get(o.dataId).values:new Float32Array([1]),p=i?n.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),m=p.length,x=d.length,b=f.length,w=h.length;let y=0,v=0,$=0,I=0;for(let N=0;N<u.length;++N)g[N]=p[y++]+(u[N]-h[v++])*d[$++]/Math.sqrt(f[I++]+l),y>=m&&(y=0),v>=w&&(v=0),$>=x&&($=0),I>=b&&(I=0);return n.makeTensorInfo(r.shape,r.dtype,g)}const k9={kernelName:Ep,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockShape:o,crops:i}=s;gt([r],"batchToSpaceND");const a=o.reduce((x,b)=>x*b),c=ch(r.shape,o,a),l=lh(c.length,o.length),u=uh(r.shape,o,a),h=fy(i,o.length),f=dy(u,i,o.length),d=ae({inputs:{x:r},backend:n,attrs:{shape:c}}),p=zn({inputs:{x:d},backend:n,attrs:{perm:l}}),g=ae({inputs:{x:p},backend:n,attrs:{shape:u}}),m=zi({inputs:{x:g},backend:n,attrs:{begin:h,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const S9={kernelName:yp,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,weights:o}=t,{size:i}=s,a=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,l=Qy(a,c,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,l)}const _9={kernelName:Vx,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9(e){const{inputs:t,backend:n}=e,{s0:s,s1:r}=t,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=Et(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const E9={kernelName:fI,backendName:"cpu",kernelFunc:T9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R9=Zt(bu,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),A9={kernelName:bu,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D9=e=>{const{x:t}=e.inputs,n=e.backend,s=new Float32Array(K(t.shape)),r=n.data.get(t.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values;for(let l=0;l<a.length;l++){const u=a[l],h=c[l];s[l]=Math.hypot(u,h)}return n.makeOutput(s,t.shape,"float32")},M9={kernelName:wp,backendName:"cpu",kernelFunc:D9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(e){const{inputs:t,backend:n}=e,{input:s}=t,r=n.data.get(s.dataId).complexTensorInfos.imag,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const F9={kernelName:ob,backendName:"cpu",kernelFunc:tc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(e){const{inputs:t,backend:n,attrs:s}=e,{axis:r}=s,o=Lt(r,t[0].shape)[0],i=t.map(g=>g.shape);ly(i,o);let a=vr(t.map(g=>g.shape),o);if(K(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const c=t.filter(g=>K(g.shape)>0);if(c.length===1)return Nr({inputs:{x:c[0]},backend:n});if(c[0].dtype==="complex64"){const g=c.map(y=>Pi({inputs:{input:y},backend:n})),m=c.map(y=>tc({inputs:{input:y},backend:n})),x=ec({inputs:g,backend:n,attrs:{axis:o}}),b=ec({inputs:m,backend:n,attrs:{axis:o}}),w=Jn({inputs:{real:x,imag:b},backend:n});return g.forEach(y=>n.disposeIntermediateTensorInfo(y)),m.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),w}const l=c.map(g=>{const x=[-1,K(g.shape.slice(o))];return ae({inputs:{x:g},backend:n,attrs:{shape:x}})}),u=l.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=vr(l.map(g=>g.shape),1);const h=l[0].shape[0]===1,f=UT(u,a,t[0].dtype,h),d=vr(c.map(g=>g.shape),o),p=n.makeTensorInfo(d,t[0].dtype,f);return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const O9={kernelName:vp,backendName:"cpu",kernelFunc:ec};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=s;gt([r,o],"conv2d");const h=oo(c),f=Je(r.shape,o.shape,i,l,a,u,!1,h),d=f.filterHeight,p=f.filterWidth,g=f.dilationHeight,m=f.dilationWidth,x=f.padInfo.left,b=f.padInfo.top,w=f.dataFormat==="channelsLast",y=new Ye(f.outShape,r.dtype),v=vt(r.shape),$=vt(o.shape),I=v[0],N=w?v[1]:v[2],k=w?v[2]:1,S=w?1:v[1],C=y.strides[0],A=w?y.strides[1]:y.strides[2],R=w?y.strides[2]:1,_=w?1:y.strides[1],T=n.data.get(r.dataId).values,E=n.data.get(o.dataId).values,M=y.values;for(let O=0;O<f.batchSize;++O){const L=O*I,B=O*C;for(let G=0;G<f.outHeight;++G){const q=B+G*A,Y=G*f.strideHeight-b;for(let tt=0;tt<d;++tt){const J=Y+tt*g;if(J<0||J>=f.inHeight)continue;const st=tt*$[0],rt=L+J*N;for(let ft=0;ft<f.outWidth;++ft){const Z=q+ft*R,ot=ft*f.strideWidth-x;for(let at=0;at<p;++at){const Q=ot+at*m;if(Q<0||Q>=f.inWidth)continue;const It=st+at*$[1],$t=rt+Q*k;let Rt=It;for(let Tt=0;Tt<f.inChannels;++Tt){const ut=T[$t+Tt*S];for(let _t=0;_t<f.outChannels;++_t)M[Z+_t*_]+=ut*E[Rt+_t];Rt+=f.outChannels}}}}}}return n.makeTensorInfo(y.shape,y.dtype,M)}const L9={kernelName:$p,backendName:"cpu",kernelFunc:zE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=s;gt([r,o],"conv2dBackpropFilter");const h=oo(c),f=Je(r.shape,u,i,1,a,l,!1,h),{strideHeight:d,strideWidth:p,filterHeight:g,filterWidth:m}=f,x=f.dataFormat==="channelsLast",b=new Ye(f.filterShape,"float32"),w=f.padInfo.left,y=f.padInfo.top,v=n.data.get(r.dataId).values,$=n.data.get(o.dataId).values,I=new Ye(r.shape,r.dtype,v),N=new Ye(o.shape,o.dtype,$);for(let k=0;k<g;++k){const S=Math.max(0,Math.ceil((y-k)/d)),C=Math.min(f.outHeight,(f.inHeight+y-k)/d);for(let A=0;A<m;++A){const R=Math.max(0,Math.ceil((w-A)/p)),_=Math.min(f.outWidth,(f.inWidth+w-A)/p);for(let T=0;T<f.inChannels;++T)for(let E=0;E<f.outChannels;++E){let M=0;for(let O=0;O<f.batchSize;++O)for(let L=S;L<C;++L){const B=k+L*d-y;for(let G=R;G<_;++G){const q=A+G*p-w;x?M+=I.get(O,B,q,T)*N.get(O,L,G,E):M+=I.get(O,T,B,q)*N.get(O,E,L,G)}}b.set(M,k,A,T,E)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const z9={kernelName:Gx,backendName:"cpu",kernelFunc:P9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=s;gt([r,o],"conv2dBackpropInput");const h=vt(o.shape),f=vt(r.shape);let d=oo(l);const p=Je(i,o.shape,a,1,c,u,!1,d),g=new Ye(p.inShape,"float32"),m=g.values,x=n.data.get(r.dataId).values,b=n.data.get(o.dataId).values,[w,y,v]=h,{batchSize:$,filterHeight:I,filterWidth:N,inChannels:k,inHeight:S,inWidth:C,outChannels:A,outHeight:R,outWidth:_,strideHeight:T,strideWidth:E}=p;d=p.dataFormat;const M=I-1-p.padInfo.top,O=N-1-p.padInfo.left,L=d==="channelsLast",B=g.strides[0],G=L?g.strides[1]:g.strides[2],q=L?g.strides[2]:1,Y=L?1:g.strides[1],tt=f[0],J=L?f[1]:f[2],st=L?f[2]:1,rt=L?1:f[1];for(let ft=0;ft<$;++ft)for(let Z=0;Z<k;++Z)for(let ot=0;ot<S;++ot){const at=ot-M,Q=Math.max(0,Math.ceil(at/T)),It=Math.min(R,(I+at)/T);for(let $t=0;$t<C;++$t){const Rt=$t-O,Tt=Math.max(0,Math.ceil(Rt/E)),ut=Math.min(_,(N+Rt)/E);let _t=0;for(let ee=Q;ee<It;++ee){const uo=ee*T-at;for(let is=Tt;is<ut;++is){const ni=is*E-Rt,Ws=tt*ft+J*ee+st*is,Fr=w*(I-1-uo)+y*(N-1-ni)+v*Z;for(let ho=0;ho<A;++ho){const fo=x[Ws+rt*ho],po=b[Fr+ho];_t+=fo*po}}}const kn=B*ft+G*ot+q*$t+Y*Z;m[kn]=_t}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const V9={kernelName:Cp,backendName:"cpu",kernelFunc:B9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dilations:c}=s;gt([r,o],"conv3d");const l=Ho(r.shape,o.shape,i,c,a),{filterDepth:u,filterHeight:h,filterWidth:f,dilationDepth:d,dilationHeight:p,dilationWidth:g,padInfo:m}=l,x=m.front,b=m.left,w=m.top,y=new Ye(l.outShape,r.dtype),v=n.data.get(r.dataId).values,$=n.data.get(o.dataId).values,I=y.values,N=vt(r.shape),k=vt(o.shape);for(let S=0;S<l.batchSize;++S){const C=S*N[0],A=S*y.strides[0];for(let R=0;R<l.outDepth;++R){const _=A+R*y.strides[1],T=R*l.strideDepth-x;for(let E=0;E<u;++E){const M=T+E*d;if(M<0||M>=l.inDepth)continue;const O=E*k[0],L=C+M*N[1];for(let B=0;B<l.outHeight;++B){const G=_+B*y.strides[2],q=B*l.strideHeight-w;for(let Y=0;Y<h;++Y){const tt=q+Y*p;if(tt<0||tt>=l.inHeight)continue;const J=O+Y*k[1],st=L+tt*N[2];for(let rt=0;rt<l.outWidth;++rt){const ft=G+rt*l.outChannels,Z=rt*l.strideWidth-b;for(let ot=0;ot<f;++ot){const at=Z+ot*g;if(at<0||at>=l.inWidth)continue;const Q=J+ot*k[2],It=st+at*l.inChannels;let $t=Q;for(let Rt=0;Rt<l.inChannels;++Rt){const Tt=v[It+Rt];for(let ut=0;ut<l.outChannels;++ut)I[ft+ut]+=Tt*$[$t+ut];$t+=l.outChannels}}}}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const U9={kernelName:kp,backendName:"cpu",kernelFunc:W9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,pad:a,filterShape:c}=s;gt([r,o],"conv3dBackpropFilterV2");const l=vt(r.shape),u=vt(o.shape),h=Ho(r.shape,c,i,1,a),f=h.strideDepth,d=h.strideHeight,p=h.strideWidth,g=h.filterDepth,m=h.filterHeight,x=h.filterWidth,b=new Ye(h.filterShape,"float32"),w=b.values,[y,v,$,I]=b.strides,N=n.data.get(o.dataId).values,[k,S,C,A]=u,R=n.data.get(r.dataId).values,[_,T,E,M]=l,O=h.padInfo.front,L=h.padInfo.left,B=h.padInfo.top;for(let G=0;G<g;++G){const q=Math.max(0,Math.ceil((O-G)/f)),Y=Math.min(h.outDepth,(h.inDepth+O-G)/f),tt=G*y;for(let J=0;J<m;++J){const st=Math.max(0,Math.ceil((B-J)/d)),rt=Math.min(h.outHeight,(h.inHeight+B-J)/d),ft=J*v+tt;for(let Z=0;Z<x;++Z){const ot=Math.max(0,Math.ceil((L-Z)/p)),at=Math.min(h.outWidth,(h.inWidth+L-Z)/p),Q=Z*$+ft;for(let It=0;It<h.inChannels;++It){const $t=It*I+Q;for(let Rt=0;Rt<h.outChannels;++Rt){let Tt=0;for(let ut=0;ut<h.batchSize;++ut){const _t=ut*_,kn=ut*k;for(let ee=q;ee<Y;++ee){const is=(G+ee*f-O)*T+_t,ni=ee*S+kn;for(let Ws=st;Ws<rt;++Ws){const ho=(J+Ws*d-B)*E+is,fo=Ws*C+ni;for(let po=ot;po<at;++po){const Ag=(Z+po*p-L)*M+ho,Dg=po*A+fo;Tt+=R[Ag+It]*N[Dg+Rt]}}}}w[$t+Rt]=Tt}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const H9={kernelName:Hx,backendName:"cpu",kernelFunc:G9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{pad:i,strides:a,inputShape:c}=s;gt([r],"conv3dBackpropInputV2");const l=vt(r.shape),u=vt(o.shape),h=Ho(c,o.shape,a,1,i),f=new Ye(h.inShape,"float32"),d=f.values,[p,g,m,x]=f.strides,b=n.data.get(r.dataId).values,[w,y,v,$]=l,I=n.data.get(o.dataId).values,[N,k,S,C]=u,{batchSize:A,filterDepth:R,filterHeight:_,filterWidth:T,inChannels:E,inDepth:M,inHeight:O,inWidth:L,outChannels:B,outDepth:G,outHeight:q,outWidth:Y,strideDepth:tt,strideHeight:J,strideWidth:st}=h,rt=R-1-h.padInfo.front,ft=_-1-h.padInfo.top,Z=T-1-h.padInfo.left;for(let ot=0;ot<A;++ot)for(let at=0;at<E;++at)for(let Q=0;Q<M;++Q){const It=Q-rt,$t=Math.max(0,Math.ceil(It/tt)),Rt=Math.min(G,(R+It)/tt);for(let Tt=0;Tt<O;++Tt){const ut=Tt-ft,_t=Math.max(0,Math.ceil(ut/J)),kn=Math.min(q,(_+ut)/J);for(let ee=0;ee<L;++ee){const uo=ee-Z,is=Math.max(0,Math.ceil(uo/st)),ni=Math.min(Y,(T+uo)/st);let Ws=0;for(let Fr=$t;Fr<Rt;++Fr){const ho=Fr*tt-It;for(let fo=_t;fo<kn;++fo){const po=fo*J-ut;for(let Gc=is;Gc<ni;++Gc){const Ag=Gc*st-uo,Dg=w*ot+y*Fr+v*fo+$*Gc,bF=N*(R-1-ho)+k*(_-1-po)+S*(T-1-Ag)+C*at;for(let zh=0;zh<B;++zh){const yF=b[Dg+zh],wF=I[bF+zh];Ws+=yF*wF}}}}d[p*ot+g*Q+m*Tt+x*ee+at]=Ws}}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const X9={kernelName:qx,backendName:"cpu",kernelFunc:q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j9=Zt(yu,e=>Math.cos(e)),K9={kernelName:yu,backendName:"cpu",kernelFunc:j9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9=Zt(wu,e=>Math.cosh(e)),Z9={kernelName:wu,backendName:"cpu",kernelFunc:Y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(e){const{inputs:t,backend:n,attrs:s}=e,{image:r,boxes:o,boxInd:i}=t,{cropSize:a,method:c,extrapolationValue:l}=s,[u,h,f,d]=r.shape,p=o.shape[0],[g,m]=a,x=Ot([p,g,m,d],"float32"),b=n.data.get(o.dataId).values,w=n.data.get(i.dataId).values,y=n.data.get(r.dataId).values,v=vt(r.shape),$=vt(x.shape);for(let I=0;I<p;I++){const N=I*4,k=b[N],S=b[N+1],C=b[N+2],A=b[N+3],R=w[I];if(R>=u)continue;const _=g>1?(C-k)*(h-1)/(g-1):0,T=m>1?(A-S)*(f-1)/(m-1):0;for(let E=0;E<g;E++){const M=g>1?k*(h-1)+E*_:.5*(k+C)*(h-1);if(M<0||M>h-1){for(let O=0;O<m;O++)for(let L=0;L<d;L++){const B=L+O*$[2]+E*$[1]+I*$[0];x.values[B]=l}continue}if(c==="bilinear"){const O=Math.floor(M),L=Math.ceil(M),B=M-O;for(let G=0;G<m;G++){const q=m>1?S*(f-1)+G*T:.5*(S+A)*(f-1);if(q<0||q>f-1){for(let st=0;st<d;st++){const rt=st+G*$[2]+E*$[1]+I*$[0];x.values[rt]=l}continue}const Y=Math.floor(q),tt=Math.ceil(q),J=q-Y;for(let st=0;st<d;st++){let rt=st+Y*v[2]+O*v[1]+R*v[0];const ft=y[rt];rt=st+tt*v[2]+O*v[1]+R*v[0];const Z=y[rt];rt=st+Y*v[2]+L*v[1]+R*v[0];const ot=y[rt];rt=st+tt*v[2]+L*v[1]+R*v[0];const at=y[rt],Q=ft+(Z-ft)*J,It=ot+(at-ot)*J;rt=st+G*$[2]+E*$[1]+I*$[0],x.values[rt]=Q+(It-Q)*B}}}else for(let O=0;O<m;++O){const L=m>1?S*(f-1)+O*T:.5*(S+A)*(f-1);if(L<0||L>f-1){for(let q=0;q<d;q++){const Y=q+O*$[2]+E*$[1]+I*$[0];x.values[Y]=l}continue}const B=Math.round(L),G=Math.round(M);for(let q=0;q<d;q++){const Y=q+B*v[2]+G*v[1]+R*v[0],tt=q+O*$[2]+E*$[1]+I*$[0];x.values[tt]=y[Y]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const J9={kernelName:jx,backendName:"cpu",kernelFunc:Q9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;gt(r,"cumprod");const c=me([o],r.shape.length);let l=r;c!=null&&(l=zn({inputs:{x:r},backend:n,attrs:{perm:c}}));const u=Ne(1,r.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);const h=ns(l.dtype,"int32"),f=Dx(K(l.shape),h),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(x,b)=>x+p-b-1:(x,b)=>x+b;for(let x=0;x<d.length;x+=p)for(let b=0;b<p;b++){const w=g(x,b);if(b===0)f[w]=i?1:d[w];else{const y=g(x,b-1);f[w]=i?d[y]*f[y]:d[w]*f[y]}}const m=n.makeTensorInfo(l.shape,h,f);if(c!=null){const x=qo(c),b=zn({inputs:{x:m},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const eG={kernelName:Xx,backendName:"cpu",kernelFunc:tG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;gt(r,"cumsum");const c=me([o],r.shape.length);let l=r;c!=null&&(l=zn({inputs:{x:r},backend:n,attrs:{perm:c}}));const u=Ne(1,r.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);const h=ns(l.dtype,"int32"),f=on(K(l.shape),h),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(x,b)=>x+p-b-1:(x,b)=>x+b;for(let x=0;x<d.length;x+=p)for(let b=0;b<p;b++){const w=g(x,b);if(b===0)f[w]=i?0:d[w];else{const y=g(x,b-1);f[w]=i?d[y]+f[y]:d[w]+f[y]}}const m=n.makeTensorInfo(l.shape,h,f);if(c!=null){const x=qo(c),b=zn({inputs:{x:m},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const sG={kernelName:Ip,backendName:"cpu",kernelFunc:nG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,weights:o}=t,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=Qy(c,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}else if(r.shape.length===2){const c=n.bufferSync(r),l=n.bufferSync(o),u=BT(c,l,i,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const oG={kernelName:Kx,backendName:"cpu",kernelFunc:rG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockSize:o,dataFormat:i}=s;D(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],c=r.shape[1],l=r.shape[2],u=r.shape[3],h=c*o,f=l*o,d=u/(o*o),p=n.data.get(r.dataId).values,g=new Float32Array(a*h*f*d);let m=0;for(let x=0;x<a;++x)for(let b=0;b<h;++b){const w=Math.floor(b/o),y=b%o;for(let v=0;v<f;++v){const $=Math.floor(v/o),I=v%o,N=(y*o+I)*d;for(let k=0;k<d;++k){const C=k+N+u*($+l*(w+c*x));g[m++]=p[C]}}}return n.makeTensorInfo([a,h,f,d],r.dtype,g)}const aG={kernelName:Yx,backendName:"cpu",kernelFunc:iG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;gt([r,o],"depthwiseConv2DNative");const u=vt(r.shape),h=vt(o.shape);let f=c;f==null&&(f=[1,1]),D(an(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);const d=Je(r.shape,o.shape,i,f,a,l,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:x,padInfo:b}=d,w=b.left,y=b.top,v=d.outChannels/d.inChannels,$=new Ye(d.outShape,r.dtype),I=n.data.get(r.dataId).values,N=n.data.get(o.dataId).values,k=$.values;for(let S=0;S<d.batchSize;++S){const C=S*u[0],A=S*$.strides[0];for(let R=0;R<d.outHeight;++R){const _=A+R*$.strides[1],T=R*d.strideHeight-y;for(let E=0;E<p;++E){const M=T+E*m;if(M<0||M>=d.inHeight)continue;const O=E*h[0],L=C+M*u[1];for(let B=0;B<d.outWidth;++B){const G=_+B*$.strides[2],q=B*d.strideWidth-w;for(let Y=0;Y<g;++Y){const tt=q+Y*x;if(tt<0||tt>=d.inWidth)continue;const J=O+Y*h[1],st=L+tt*d.inChannels;let rt=G,ft=J;for(let Z=0;Z<d.inChannels;++Z){const ot=I[st+Z];for(let at=0;at<v;++at)k[rt+at]+=ot*N[ft+at];rt+=v,ft+=v}}}}}}return n.makeTensorInfo($.shape,$.dtype,$.values)}const cG={kernelName:Sp,backendName:"cpu",kernelFunc:BE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=s;gt([r,o],"depthwiseConv2dNativeBackpropFilter");const h=Je(r.shape,u,i,a,c,l,!0),{strideHeight:f,strideWidth:d,filterHeight:p,filterWidth:g}=h,m=new Ye(h.filterShape,"float32"),x=h.padInfo.left,b=h.padInfo.top,w=h.outChannels/h.inChannels,y=n.data.get(r.dataId).values,v=new Ye(r.shape,r.dtype,y),$=n.data.get(o.dataId).values,I=new Ye(o.shape,o.dtype,$);for(let N=0;N<p;++N){const k=Math.max(0,Math.ceil((b-N)/f)),S=Math.min(h.outHeight,(h.inHeight+b-N)/f);for(let C=0;C<g;++C){const A=Math.max(0,Math.ceil((x-C)/d)),R=Math.min(h.outWidth,(h.inWidth+x-C)/d);for(let _=0;_<h.outChannels;++_){const T=Math.trunc(_/w),E=_%w;let M=0;for(let O=0;O<h.batchSize;++O)for(let L=k;L<S;++L){const B=N+L*f-b;for(let G=A;G<R;++G){const q=C+G*d-x;M+=v.get(O,B,q,T)*I.get(O,L,G,_)}}m.set(M,N,C,T,E)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const uG={kernelName:Zx,backendName:"cpu",kernelFunc:lG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=s;gt([r,o],"depthwiseConv2DNativeBackpropInput");const h=vt(r.shape),f=vt(o.shape),d=Je(u,o.shape,i,a,c,l,!0),p=new Ye(d.inShape,"float32"),g=p.values,[m,x,b]=p.strides,w=n.data.get(r.dataId).values,[y,v,$]=h,I=n.data.get(o.dataId).values,[N,k,S]=f,{batchSize:C,filterHeight:A,filterWidth:R,inChannels:_,inHeight:T,inWidth:E,outChannels:M,outHeight:O,outWidth:L,strideHeight:B,strideWidth:G}=d,q=A-1-d.padInfo.top,Y=R-1-d.padInfo.left,tt=M/_;for(let J=0;J<C;++J)for(let st=0;st<_;++st)for(let rt=0;rt<T;++rt){const ft=rt-q,Z=Math.max(0,Math.ceil(ft/B)),ot=Math.min(O,(A+ft)/B);for(let at=0;at<E;++at){const Q=at-Y,It=Math.max(0,Math.ceil(Q/G)),$t=Math.min(L,(R+Q)/G);let Rt=0;for(let Tt=Z;Tt<ot;++Tt){const ut=Tt*B-ft;for(let _t=It;_t<$t;++_t){const kn=_t*G-Q,ee=y*J+v*Tt+$*_t,uo=N*(A-1-ut)+k*(R-1-kn)+S*st;for(let is=0;is<tt;++is){const ni=st*tt+is,Ws=w[ee+ni],Fr=I[uo+is];Rt+=Ws*Fr}}}g[m*J+x*rt+b*at+st]=Rt}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const fG={kernelName:Qx,backendName:"cpu",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(e){const{inputs:t,backend:n}=e,{x:s}=t,r=K(s.shape),o=n.data.get(s.dataId).values,i=Ot([r,r],s.dtype),a=i.values;for(let l=0;l<o.length;l++)a[l*r+l]=o[l];const c=[...s.shape,...s.shape];return n.makeTensorInfo(c,i.dtype,i.values)}const pG={kernelName:dI,backendName:"cpu",kernelFunc:dG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:Np,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:r}=e,{strides:o,pad:i,dilations:a}=n,c=t,l=c.data.get(s.dataId).values,u=s.shape.length,h=c.data.get(r.dataId).values,f=r.shape.length,{batchSize:d,inHeight:p,inWidth:g,inChannels:m,outHeight:x,outWidth:b,padInfo:w,strideHeight:y,strideWidth:v,filterHeight:$,filterWidth:I,dilationHeight:N,dilationWidth:k,outShape:S}=rh(s.shape,r.shape,o,i,"NHWC",a),C=K(S),A=S.length,R=ke(s.dtype,C);for(let T=0;T<d;++T)for(let E=0;E<x;++E){const M=E*y-w.top;for(let O=0;O<b;++O){const L=O*v-w.left;for(let B=0;B<m;++B){let G=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<$;++Y){const tt=M+Y*N;if(tt>=0&&tt<p)for(let J=0;J<I;++J){const st=L+J*k;if(st>=0&&st<g){const rt=yr([T,tt,st,B],u,vt(s.shape)),ft=yr([Y,J,B],f,vt(r.shape)),Z=l[rt]+h[ft];Z>G&&(G=Z)}}}const q=yr([T,E,O,B],A,vt(S));R[q]=G}}}return{dataId:c.write(Ji(R,s.dtype),S,s.dtype),shape:S,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:Y0,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:r,dy:o}=e,{strides:i,pad:a,dilations:c}=n,l=t,u=Ys(s.shape,l.data.get(s.dataId).values),h=Ys(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:x,padInfo:b,strideHeight:w,strideWidth:y,filterHeight:v,filterWidth:$,dilationHeight:I,dilationWidth:N,outShape:k}=rh(s.shape,r.shape,i,a,"NHWC",c);D(o.rank===k.length,()=>`Error in ${Y0}, dy must have the same rank as output ${k.length}, but got ${o.rank}`);const S=Ys(k,l.data.get(o.dataId).values),C=lI(r.shape,r.dtype);for(let R=0;R<f;++R)for(let _=0;_<m;++_){const T=_*w-b.top;for(let E=0;E<x;++E){const M=E*y-b.left;for(let O=0;O<g;++O){let L=Number.MIN_SAFE_INTEGER,B=0,G=0;for(let q=0;q<v;++q){const Y=T+q*I;if(Y>=0&&Y<d)for(let tt=0;tt<$;++tt){const J=M+tt*N;if(J>=0&&J<p){const st=u[R][Y][J][O]+h[q][tt][O];st>L&&(L=st,B=q,G=tt)}}}C[B][G][O]+=S[R][_][E][O]}}}return{dataId:l.write(Ji(C,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:K0,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:s,filter:r,dy:o}=e,{strides:i,pad:a,dilations:c}=n,l=t,u=Ys(s.shape,l.data.get(s.dataId).values),h=Ys(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:x,padInfo:b,strideHeight:w,strideWidth:y,filterHeight:v,filterWidth:$,dilationHeight:I,dilationWidth:N,outShape:k}=rh(s.shape,r.shape,i,a,"NHWC",c);D(o.rank===k.length,()=>`Error in ${K0}, dy must have the same rank as output ${k.length}, but got ${o.rank}`);const S=Ys(k,l.data.get(o.dataId).values),C=lI(s.shape,s.dtype);for(let R=0;R<f;++R)for(let _=0;_<m;++_){const T=_*w-b.top;for(let E=0;E<x;++E){const M=E*y-b.left;for(let O=0;O<g;++O){let L=Number.MIN_SAFE_INTEGER,B=T<0?0:T,G=M<0?0:M;for(let q=0;q<v;++q){const Y=T+q*I;if(Y>=0&&Y<d)for(let tt=0;tt<$;++tt){const J=M+tt*N;if(J>=0&&J<p){const st=u[R][Y][J][O]+h[q][tt][O];st>L&&(L=st,B=Y,G=J)}}}C[R][B][G][O]+=S[R][_][E][O]}}}return{dataId:l.write(Ji(C,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(e){const{inputs:t,backend:n,attrs:s}=e,{image:r}=t,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:c}=i||{},l=(c==null?void 0:c.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=o.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${u} type.`);const[f,d]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],g=n.data.get(r.dataId).values,m=r.dtype==="float32"?255:1,x=new Uint8ClampedArray(d*f*4);for(let w=0;w<f*d;++w){const y=[0,0,0,255*l];for(let $=0;$<p;$++){const I=g[w*p+$];if(r.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(r.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);p===1?(y[0]=I*m,y[1]=I*m,y[2]=I*m):y[$]=I*m}const v=w*4;x[v+0]=Math.round(y[0]),x[v+1]=Math.round(y[1]),x[v+2]=Math.round(y[2]),x[v+3]=Math.round(y[3])}o.width=d,o.height=f;const b=new ImageData(x,d,f);return h.putImageData(b,0,0),r}const yG={kernelName:AO,backendName:"cpu",kernelFunc:bG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yh(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;gt(r,"sum");let a;r.dtype==="bool"?a=Oo({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=Nr({inputs:{x:r},backend:n});const c=a.shape.length,l=Lt(o,a.shape),u=me(l,c);let h=l,f=a;u!=null&&(f=zn({inputs:{x:a},backend:n,attrs:{perm:u}}),h=Ne(h.length,c)),tn("sum",h,f.shape.length);const[d,p]=He(f.shape,h),g=ns(f.dtype,"int32");let m=ud(n,d,g);const x=K(p),b=n.data.get(m.dataId).values,w=n.data.get(f.dataId).values;for(let y=0;y<b.length;++y){const v=y*x;let $=0;for(let I=0;I<x;++I)$+=w[v+I];b[y]=$}if(i){const y=Se(m.shape,l),v=m;m=ae({inputs:{x:m},backend:n,attrs:{shape:y}}),n.disposeIntermediateTensorInfo(v)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(f),m}const wG={kernelName:im,backendName:"cpu",kernelFunc:yh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vG(e){const{inputs:t,backend:n,attrs:s}=e,{equation:r}=s,o=t,{allDims:i,summedDims:a,idDims:c}=vy(r,o.length);Cy(i.length,c,o);const{path:l,steps:u}=ky(a,c),h=u.length;let f=null,d=i.length;const p=[];for(let g=0;g<h;++g){for(const m of u[g]){const{permutationIndices:x,expandDims:b}=$y(d,c[m]);let w;Iy(x)?w=o[m]:(w=zn({inputs:{x:o[m]},backend:n,attrs:{perm:x}}),p.push(w));const y=w.shape.slice();for(let v=0;v<b.length;++v)y.splice(b[v],0,1);Xt(w.shape,y)||(w=ae({inputs:{x:w},backend:n,attrs:{shape:y}}),p.push(w)),f===null?f=w:(f=Om({inputs:{a:w,b:f},backend:n}),p.push(f))}g<h-1&&(l[g]>=0&&(f=yh({inputs:{x:f},backend:n,attrs:{axis:l[g]-(i.length-d),keepDims:!1}}),p.push(f)),d--)}for(const g of p)g!==f&&n.disposeIntermediateTensorInfo(g);return f}const $G={kernelName:Jx,backendName:"cpu",kernelFunc:vG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CG(e){const{inputs:t,backend:n}=e,{dy:s,y:r}=t;gt([s,r],"eluGrad");const o=new Float32Array(K(r.shape)),i=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let c=0;c<i.length;++c){const l=i[c];l>=0?o[c]=a[c]:o[c]=a[c]*(l+1)}return n.makeTensorInfo(r.shape,"float32",o)}const kG={kernelName:tb,backendName:"cpu",kernelFunc:CG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG=py,SG=my,NG=gy,_G=xy,TG=by,EG=yy,RG=Zt(Cu,e=>{const t=Math.sign(e),n=Math.abs(e),s=1/(1+IG*n);return t*(1-((((EG*s+TG)*s+_G)*s+NG)*s+SG)*s*Math.exp(-n*n))}),AG={kernelName:Cu,backendName:"cpu",kernelFunc:RG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dd(e){const{inputs:t,backend:n,attrs:s}=e,{input:r}=t,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let c=o;return o<0&&(D(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),ae({inputs:{x:r},backend:n,attrs:{shape:a}})}const DG={kernelName:Tp,backendName:"cpu",kernelFunc:dd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG=Te((e,t)=>e/t),rw=Le(vu,MG),v1={kernelName:vu,backendName:"cpu",kernelFunc:rw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VE(e,t,n){const s=e.shape,r=s[0],o=s[1],i=n.data.get(e.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[r,o],u=K(l),h=rn("float32",u),f=rn("float32",u);for(let m=0;m<r;m++){const x=zi({inputs:{x:a},backend:n,attrs:{begin:[m,0],size:[1,o]}}),b=zi({inputs:{x:c},backend:n,attrs:{begin:[m,0],size:[1,o]}}),w=Jn({inputs:{real:x,imag:b},backend:n}),{real:y,imag:v}=FG(w,t,n),$=Qr(y,v);for(let I=0;I<o;I++){const N=wy($,I);h[m*o+I]=N.real,f[m*o+I]=N.imag}n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w)}const d=n.makeTensorInfo(l,"float32",h),p=n.makeTensorInfo(l,"float32",f),g=Jn({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),g}function FG(e,t,n){const s=K(e.shape),r=n.data.get(e.dataId),o=n.data.get(r.complexTensorInfos.real.dataId).values,i=n.data.get(r.complexTensorInfos.imag.dataId).values;if(OG(s)){const a=$1(o,i,s,t,n),c=[e.shape[0],e.shape[1]];if(t){const l=n.makeTensorInfo(c,"float32",a.real),u=n.makeTensorInfo(c,"float32",a.imag),h=n.makeTensorInfo([],"float32",Go(s,"float32")),f=Nr({inputs:{x:h},backend:n}),d=v1.kernelFunc({inputs:{a:l,b:h},backend:n}),p=v1.kernelFunc({inputs:{a:u,b:f},backend:n}),g=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:g,imag:m}}return a}else{const a=Qr(o,i),c=LG(a,s,t);return eN(c)}}function OG(e){return(e&e-1)===0}function $1(e,t,n,s,r){if(n===1)return{real:e,imag:t};const o=Qr(e,t),i=n/2,a=nN(o),c=a.real,l=a.imag,u=[c.length],h=r.makeTensorInfo(u,"float32",c),f=r.makeTensorInfo(u,"float32",l),d=Jn({inputs:{real:h,imag:f},backend:r}),p=sN(o),g=p.real,m=p.imag,x=[g.length],b=r.makeTensorInfo(x,"float32",g),w=r.makeTensorInfo(x,"float32",m),y=Jn({inputs:{real:b,imag:w},backend:r}),v=$1(c,l,i,s,r),$=v.real,I=v.imag,N=[$.length],k=r.makeTensorInfo(N,"float32",$),S=r.makeTensorInfo(N,"float32",I),C=Jn({inputs:{real:k,imag:S},backend:r}),A=$1(g,m,i,s,r),R=A.real,_=A.imag,T=[R.length],E=r.makeTensorInfo(T,"float32",R),M=r.makeTensorInfo(T,"float32",_),O=Jn({inputs:{real:E,imag:M},backend:r}),L=oN(n,s),B=[L.real.length],G=r.makeTensorInfo(B,"float32",L.real),q=r.makeTensorInfo(B,"float32",L.imag),Y=Jn({inputs:{real:G,imag:q},backend:r}),tt=Om({inputs:{a:Y,b:O},backend:r}),J=Ja({inputs:{a:C,b:tt},backend:r}),st=nw({inputs:{a:C,b:tt},backend:r}),rt=Pi({inputs:{input:J},backend:r}),ft=Pi({inputs:{input:st},backend:r}),Z=tc({inputs:{input:J},backend:r}),ot=tc({inputs:{input:st},backend:r}),at=ec({inputs:[rt,ft],backend:r,attrs:{axis:0}}),Q=ec({inputs:[Z,ot],backend:r,attrs:{axis:0}}),It=r.data.get(at.dataId).values,$t=r.data.get(Q.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(tt),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(st),r.disposeIntermediateTensorInfo(rt),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(ft),r.disposeIntermediateTensorInfo(ot),r.disposeIntermediateTensorInfo(at),r.disposeIntermediateTensorInfo(Q),{real:It,imag:$t}}function LG(e,t,n){const s=new Float32Array(t*2);for(let r=0;r<t;r++){let o=0,i=0;for(let a=0;a<t;a++){const c=iN(r*a,t,n),l=wy(e,a);o+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}n&&(o/=t,i/=t),rN(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PG(e){const{inputs:t,backend:n}=e,{input:s}=t,r=K(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=ae({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),c=VE(a,!1,n),l=ae({inputs:{x:c},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),l}const zG={kernelName:eb,backendName:"cpu",kernelFunc:PG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ow(e){const{backend:t,attrs:n}=e,{shape:s,value:r,dtype:o}=n,i=o||Cc(r),a=ke(i,K(s));return VG(a,r,i),t.makeTensorInfo(s,i,a)}const BG={kernelName:nb,backendName:"cpu",kernelFunc:ow};function VG(e,t,n){e.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:sb,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,r=n,o=rn(s.dtype,K(s.shape)),[i,a,c,l]=s.shape,u=r.data.get(s.dataId).values;for(let f=0;f<i;f++){const d=f*c*a*l;for(let p=0;p<a;p++){const g=p*(c*l);for(let m=0;m<c;m++){const x=m*l;for(let b=0;b<l;b++){const w=Math.round(c-m-1),y=d+g+x+b;let v=u[y];if(w>=0&&w<c){const $=w*l,I=d+g+$+b;v=u[I]}o[y]=v}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s;let g=zE({inputs:{x:r,filter:o},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f}});if(i){const m=g;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const x=ae({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});g=Ja({inputs:{a:g,b:x},backend:n}),n.disposeIntermediateTensorInfo(x)}else g=Ja({inputs:{a:g,b:i},backend:n});n.disposeIntermediateTensorInfo(m)}if(d){const m=g;if(u==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const x=ae({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=fd(n,g,d,x,p),n.disposeIntermediateTensorInfo(x)}else g=fd(n,g,d,a,p);n.disposeIntermediateTensorInfo(m)}return g}const GG={kernelName:Xf,backendName:"cpu",kernelFunc:UG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s;let g=BE({inputs:{x:r,filter:o},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f}});if(i){const m=g;g=Ja({inputs:{a:g,b:i},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){const m=g;g=fd(n,g,d,a,p),n.disposeIntermediateTensorInfo(m)}return g}const qG={kernelName:RI,backendName:"cpu",kernelFunc:HG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XG(e){const{inputs:t,backend:n}=e,{params:s,indices:r}=t,o=K(s.shape),i=r.shape,a=i[i.length-1],[c,l,u,h]=sy(s,r);if(l===0)return n.makeTensorInfo(c,s.dtype,[]);const f=n.data.get(r.dataId).values,d=n.bufferSync(s),p=ZT(f,d,s.dtype,l,a,u,h,s.shape,o);return n.makeTensorInfo(c,s.dtype,p.values)}const jG={kernelName:pI,backendName:"cpu",kernelFunc:XG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,indices:o}=t,{axis:i,batchDims:a}=s;gt([r,o],"gatherV2");const c=Lt(i,r.shape)[0],l=n.data.get(o.dataId).values,u=r.shape[c];for(let y=0;y<l.length;++y){const v=l[y];D(v<=u-1&&v>=0,()=>`GatherV2: the index value ${v} is not in [0, ${u-1}]`)}let h=a;a==null&&(h=0);const f=K(o.shape),d=Ny(r,o,c,h),p=ae({inputs:{x:r},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=ae({inputs:{x:o},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}}),m=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],x=n.bufferSync(g),b=n.bufferSync(p),w=QT(b,x,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(d.outputShape,w.dtype,w.values)}const YG={kernelName:Rp,backendName:"cpu",kernelFunc:KG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZG(e){const{inputs:t,backend:n}=e,{input:s}=t,r=K(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=ae({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),c=VE(a,!0,n),l=ae({inputs:{x:c},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),l}const QG={kernelName:rb,backendName:"cpu",kernelFunc:ZG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG=Zt(Eu,e=>Number.isFinite(e)?1:0,"bool"),tH={kernelName:Eu,backendName:"cpu",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eH=Zt(Ru,e=>Math.abs(e)===1/0?1:0,"bool"),nH={kernelName:Ru,backendName:"cpu",kernelFunc:eH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=Zt(Au,e=>Number.isNaN(e)?1:0,"bool"),rH={kernelName:Au,backendName:"cpu",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(e){const{backend:t,attrs:n}=e,{start:s,stop:r,num:o}=n,i=sE(s,r,o);return t.makeTensorInfo([i.length],"float32",i)}const iH={kernelName:ib,backendName:"cpu",kernelFunc:oH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aH=Zt(Mu,e=>Math.log1p(e)),cH={kernelName:Mu,backendName:"cpu",kernelFunc:aH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH=Te((e,t)=>e&&t),uH=Le(Op,lH,null,"bool"),hH={kernelName:Op,backendName:"cpu",kernelFunc:uH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fH=Zt(Lp,e=>e?0:1,"bool"),dH={kernelName:Lp,backendName:"cpu",kernelFunc:fH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pH=Te((e,t)=>e||t),mH=Le(Pp,pH,null,"bool"),gH={kernelName:Pp,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{depthRadius:o,bias:i,alpha:a,beta:c}=s;gt(r,"LRN");const l=r.shape[3],u=l-1,h=n.data.get(r.dataId).values,f=K(r.shape),d=new Float32Array(f);function p(g){const m=g%l;let x=g-m+Math.max(0,m-o);const b=g-m+Math.min(m+o,u);let w=0;for(;x<=b;x++){const y=h[x];w+=y*y}return w}for(let g=0;g<f;g++){const m=p(g),x=h[g]*Math.pow(i+a*m,-c);d[g]=x}return n.makeTensorInfo(r.shape,r.dtype,d)}const bH={kernelName:zp,backendName:"cpu",kernelFunc:xH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,y:o,dy:i}=t,{depthRadius:a,bias:c,alpha:l,beta:u}=s;gt(i,"LRNGrad");const h=K(i.shape),f=i.shape[3],d=n.data.get(i.dataId).values,p=n.data.get(r.dataId).values,g=n.data.get(o.dataId).values,m=new Float32Array(h),x=h;for(let b=0;b<x;b++){const w=b%f,y=b-w+Math.max(0,w-a),v=b-w+Math.min(f,w+a+1);let $=0;for(let I=y;I<v;I++)$+=Math.pow(p[I],2);$=l*$+c;for(let I=y;I<v;I++){let N=-2*l*u*p[I]*g[b]/$;b===I&&(N+=Math.pow($,-u)),N*=d[b],m[I]+=N}}return n.makeTensorInfo(i.shape,r.dtype,m)}const wH={kernelName:ab,backendName:"cpu",kernelFunc:yH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{reductionIndices:o,keepDims:i}=s,a=n;let c=r.shape;const l=c.length,u=Lt(o,c);let h=u;const f=me(h,l);let d=a.data.get(r.dataId).values;if(f!=null){const y=new Array(l);for(let v=0;v<y.length;v++)y[v]=c[f[v]];d=tw(d,c,r.dtype,f,y),h=Ne(h.length,l),c=y}gt(r,"max"),tn("max",h,l);const[p,g]=He(c,h),m=K(g),x=oE(d,m,p,r.dtype),b=a.write(x,p,r.dtype);let w=p;return i&&(w=Se(p,u)),{dataId:b,shape:w,dtype:r.dtype}}const vH={kernelName:Bp,backendName:"cpu",kernelFunc:WE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t;gt(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;D(an(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const u=Ps(r.shape,o,i,l,a,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&Xt(u.inShape,u.outShape))h=Nr({inputs:{x:r},backend:n});else{const f=n.data.get(r.dataId).values,d=vt(r.shape),p=sw(f,r.shape,r.dtype,d,u,"max");h=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return h}const CH={kernelName:Vp,backendName:"cpu",kernelFunc:$H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;gt(r,"maxPool3d");const u=ro(r.shape,o,i,1,a,c,l),h=n.data.get(r.dataId).values,f=PE(h,r.shape,r.dtype,vt(r.shape),u,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const IH={kernelName:Wp,backendName:"cpu",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;gt([r,o],"maxPool3DGrad");const u=ro(o.shape,i,a,1,c,l),h=n.bufferSync(o),f=p9(h,u),d=u.strideDepth,p=u.strideHeight,g=u.strideWidth,m=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterDepth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,$=w-1-u.padInfo.front,I=v-1-u.padInfo.left,N=y-1-u.padInfo.top,k=Ot(o.shape,"float32"),S=n.bufferSync(r);for(let C=0;C<u.batchSize;++C)for(let A=0;A<u.inChannels;++A)for(let R=0;R<u.inDepth;++R)for(let _=0;_<u.inHeight;++_)for(let T=0;T<u.inWidth;++T){const E=R-$,M=_-N,O=T-I;let L=0;for(let B=0;B<w;B+=m){const G=(E+B)/d;if(!(G<0||G>=u.outDepth||Math.floor(G)!==G))for(let q=0;q<y;q+=x){const Y=(M+q)/p;if(!(Y<0||Y>=u.outHeight||Math.floor(Y)!==Y))for(let tt=0;tt<v;tt+=b){const J=(O+tt)/g;if(J<0||J>=u.outWidth||Math.floor(J)!==J)continue;const st=w*y*v-1-f.get(C,G,Y,J,A),rt=B*y*v+q*v+tt,ft=st===rt?1:0;if(ft===0)continue;const Z=S.get(C,G,Y,J,A);L+=Z*ft}}}k.set(L,C,R,_,T,A)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const NH={kernelName:lb,backendName:"cpu",kernelFunc:SH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _H(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o,output:i}=t,a=o;gt([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=s,f=Ps(a.shape,c,l,1,u,h),d=n.data.get(a.dataId).values,p=Ot(f.outShape,a.dtype,LE(d,a.shape,a.dtype,f).values),g=f.strideHeight,m=f.strideWidth,x=f.dilationHeight,b=f.dilationWidth,w=f.effectiveFilterHeight,y=f.effectiveFilterWidth,v=y-1-f.padInfo.left,$=w-1-f.padInfo.top,I=Ot(a.shape,"float32"),N=n.data.get(r.dataId).values,k=Ot(r.shape,"float32",N);for(let S=0;S<f.batchSize;++S)for(let C=0;C<f.inChannels;++C)for(let A=0;A<f.inHeight;++A)for(let R=0;R<f.inWidth;++R){const _=A-$,T=R-v;let E=0;for(let M=0;M<w;M+=x){const O=(_+M)/g;if(!(O<0||O>=f.outHeight||Math.floor(O)!==O))for(let L=0;L<y;L+=b){const B=(T+L)/m;if(B<0||B>=f.outWidth||Math.floor(B)!==B)continue;const G=w*y-1-p.get(S,O,B,C),q=M*y+L,Y=G===q?1:0;if(Y===0)continue;const tt=k.get(S,O,B,C);E+=tt*Y}}I.set(E,S,A,R,C)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const TH={kernelName:cb,backendName:"cpu",kernelFunc:_H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EH(e,t,n,s,r){const o=vt(t),i=sw(e,t,n,o,r,"max"),a=LE(e,t,n,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH={kernelName:mI,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=t,c=n;gt(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,u=Ps(s.shape,r,o,[1,1],i),[h,f]=EH(l,s.shape,s.dtype,a,u),d=c.write(h,u.outShape,s.dtype),p=c.write(f,u.outShape,s.dtype);return[{dataId:d,shape:u.outShape,dtype:s.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s,a=Lt(o,r.shape),l=He(r.shape,a)[1],u=K(l),h=[],f=n.makeTensorInfo([],"float32",new Float32Array([u]));h.push(f);const d=Oo({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});h.push(d);const p=rw({inputs:{a:d,b:f},backend:n});h.push(p);const g=yh({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:i}});return h.forEach(m=>n.disposeIntermediateTensorInfo(m)),g}const DH={kernelName:Up,backendName:"cpu",kernelFunc:AH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;gt(r,"min");const a=Lt(o,r.shape);let c=a;const l=me(c,r.shape.length);let u=r;l!=null&&(u=zn({inputs:{x:r},backend:n,attrs:{perm:l}}),c=Ne(c.length,r.shape.length)),tn("min",c,u.shape.length);const[h,f]=He(u.shape,c),d=K(f),p=on(K(h),u.dtype),g=n.data.get(u.dataId).values;for(let x=0;x<p.length;++x){const b=x*d;let w=g[b];for(let y=0;y<d;++y){const v=g[b+y];(Number.isNaN(v)||v<w)&&(w=v)}p[x]=w}l!=null&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(i){const x=Se(h,a),b=ae({inputs:{x:m},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(m),b}return m}const FH={kernelName:Gp,backendName:"cpu",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OH(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{paddings:o,mode:i}=s;gt(r,"mirrorPad");const a=o.map((w,y)=>w[0]+r.shape[y]+w[1]),c=o.map(w=>w[0]),l=o.map((w,y)=>w[0]+r.shape[y]),u=i==="reflect"?0:1,h=n.data.get(r.dataId).values,f=r.shape.length,d=vt(r.shape),p=K(a),g=a.length,m=vt(a),x=rn(r.dtype,p);for(let w=0;w<p;w++){let y=kc(w,g,m);for(let $=0;$<g;$++)y[$]<c[$]?y[$]=c[$]*2-y[$]-u:y[$]>=l[$]&&(y[$]=(l[$]-1)*2-y[$]+u);y=y.map(($,I)=>$-c[I]);const v=yr(y,f,d);x[w]=h[v]}return{dataId:n.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const LH={kernelName:Hp,backendName:"cpu",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PH=Te((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),zH=Le(Lu,PH),BH={kernelName:Lu,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(e){const{inputs:t,backend:n,attrs:s}=e,{logits:r}=t,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const c=Lt([a],r.shape),l=WE({inputs:{x:r},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),u=Se(l.shape,c),h=ae({inputs:{x:l},backend:n,attrs:{shape:u}}),f=nw({inputs:{a:r,b:h},backend:n}),d=XT({inputs:{x:f},backend:n}),p=yh({inputs:{x:d},backend:n,attrs:{axis:c,keepDims:!1}}),g=ae({inputs:{x:p},backend:n,attrs:{shape:u}}),m=rw({inputs:{a:d,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const VH={kernelName:lm,backendName:"cpu",kernelFunc:UE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WH(e){const{inputs:t,backend:n,attrs:s}=e,{logits:r}=t,{numSamples:o,seed:i,normalized:a}=s;gt(r,"multinomial");const c=a?r:UE({inputs:{logits:r},backend:n,attrs:{dim:-1}}),l=c.shape[0],u=c.shape[1],h=n.data.get(c.dataId).values,f=[l,o],d=on(K(f),"int32");for(let p=0;p<l;++p){const g=p*u,m=new Float32Array(u-1);m[0]=h[g];for(let w=1;w<m.length;++w)m[w]=m[w-1]+h[g+w];const x=Ub.alea(i.toString()),b=p*o;for(let w=0;w<o;++w){const y=x();d[b+w]=m.length;for(let v=0;v<m.length;v++)if(y<m[v]){d[b+w]=v;break}}}return a||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(f,"int32",d)}const UH={kernelName:gI,backendName:"cpu",kernelFunc:WH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GH=Qb;function HH(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s;gt(r,"NonMaxSuppression");const l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,{selectedIndices:h}=GH(l,u,i,a,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const qH={kernelName:ub,backendName:"cpu",kernelFunc:HH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XH=Jb;function jH(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;gt(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values,{selectedIndices:f,validOutputs:d}=XH(u,h,i,a,c,l);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const KH={kernelName:hb,backendName:"cpu",kernelFunc:jH};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YH=ty;function ZH(e){const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;gt(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,h=n.data.get(o.dataId).values,f=i,d=a,p=c,g=l,{selectedIndices:m,selectedScores:x}=YH(u,h,f,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const QH={kernelName:fb,backendName:"cpu",kernelFunc:ZH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JH(e){const{inputs:t,backend:n,attrs:s}=e,{indices:r}=t,{dtype:o,depth:i,onValue:a,offValue:c}=s;gt(r,"oneHot");const l=K(r.shape),u=new Float32Array(l*i);u.fill(c);const h=n.data.get(r.dataId).values;for(let f=0;f<l;++f)h[f]>=0&&h[f]<i&&(u[f*i+h[f]]=a);return n.makeTensorInfo([...r.shape,i],o,u)}const tq={kernelName:Kp,backendName:"cpu",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pd(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Pi({inputs:{input:s},backend:n}),o=pd({inputs:{x:r},backend:n}),i=tc({inputs:{input:s},backend:n}),a=pd({inputs:{x:i},backend:n}),c=Jn({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),c}else return ow({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const eq={kernelName:fm,backendName:"cpu",kernelFunc:pd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GE(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Pi({inputs:{input:s},backend:n}),o=GE({inputs:{x:r},backend:n}),i=tc({inputs:{input:s},backend:n}),a=pd({inputs:{x:i},backend:n}),c=Jn({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),c}else return ow({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const nq={kernelName:jp,backendName:"cpu",kernelFunc:GE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(e){const{inputs:t,backend:n,attrs:s}=e,{axis:r}=s;if(t.length===1)return dd({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const o=t[0].shape,i=t[0].dtype;t.forEach(u=>{Ls(o,u.shape,"All tensors passed to stack must have matching shapes"),D(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=t.map(u=>{const h=dd({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(h),h}),l=ec({inputs:c,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),l}const sq={kernelName:Yp,backendName:"cpu",kernelFunc:HE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{paddings:o,constantValue:i}=s;gt(r,"pad");const a=o.map((b,w)=>b[0]+r.shape[w]+b[1]),c=o.map(b=>b[0]),l=n.data.get(r.dataId).values,u=K(r.shape),h=r.shape.length,f=vt(r.shape),d=K(a),p=a.length,g=vt(a),m=rn(r.dtype,d);i!==0&&m.fill(i);for(let b=0;b<u;b++){const y=kc(b,h,f).map(($,I)=>$+c[I]),v=yr(y,p,g);m[v]=l[b]}return{dataId:n.write(m,a,r.dtype),shape:a,dtype:r.dtype}}const qE={kernelName:Zp,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq=Te((e,t)=>Math.pow(e,t)),iq=Le(zu,oq),aq={kernelName:zu,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(e){const{inputs:t,backend:n,attrs:s}=e,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=t,{outputRaggedRank:a}=s,c=r.map(x=>n.data.get(x.dataId).values),l=r.map(x=>x.shape),u=n.data.get(o.dataId).values,h=n.data.get(i.dataId).values,[f,d,p]=hE(c,l,u,o.shape,o.dtype,h,i.shape),g=f.map(x=>n.makeTensorInfo([x.length],"int32",x)),m=n.makeTensorInfo(p,o.dtype,d);return g.concat([m])}const lq={kernelName:xI,backendName:"cpu",kernelFunc:cq};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(e){const{inputs:t,backend:n}=e,{starts:s,limits:r,deltas:o}=t,i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,[l,u]=fE(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=n.makeTensorInfo([l.length],"int32",l),f=n.makeTensorInfo([u.length],s.dtype,u);return[h,f]}const hq={kernelName:bI,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fq(e){const{inputs:t,backend:n,attrs:s}=e,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=t,{rowPartitionTypes:c}=s,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,h=n.data.get(i.dataId).values,f=a.map(m=>n.data.get(m.dataId).values),d=a.map(m=>m.shape),[p,g]=dE(l,r.shape,u,o.shape,o.dtype,h,i.shape,f,d,c);return n.makeTensorInfo(p,o.dtype,g)}const dq={kernelName:yI,backendName:"cpu",kernelFunc:fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(e){const{backend:t,attrs:n}=e,{start:s,stop:r,dtype:o,step:i}=n,a=pE(s,r,i,o);return t.makeTensorInfo([a.length],o,a)}const mq={kernelName:db,backendName:"cpu",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gq=Zt(Bu,e=>1/e),xq={kernelName:Bu,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(e){const{inputs:t,backend:n,attrs:s}=e,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s;gt(r,"resizeBilinear");const c=vt(r.shape),[l,u]=a,[h,f,d,p]=r.shape,g=n.data.get(r.dataId).values,m=new Float32Array(K([h,l,u,p])),x=[o&&l>1?f-1:f,o&&u>1?d-1:d],b=[o&&l>1?l-1:l,o&&u>1?u-1:u];let w=0;const y=x[0]/b[0],v=x[1]/b[1];for(let $=0;$<h;$++)for(let I=0;I<l;I++){let N;i?N=y*(I+.5)-.5:N=y*I;const k=Math.max(0,Math.floor(N)),S=N-k,C=Math.min(f-1,Math.ceil(N)),A=$*c[0]+k*c[1],R=$*c[0]+C*c[1];for(let _=0;_<u;_++){let T;i?T=v*(_+.5)-.5:T=v*_;const E=Math.max(0,Math.floor(T)),M=T-E,O=Math.min(d-1,Math.ceil(T)),L=A+E*c[2],B=R+E*c[2],G=A+O*c[2],q=R+O*c[2];for(let Y=0;Y<p;Y++){const tt=g[L+Y],J=g[B+Y],st=g[G+Y],rt=g[q+Y],ft=tt+(st-tt)*M,Z=J+(rt-J)*M,ot=ft+(Z-ft)*S;m[w++]=ot}}}return n.makeTensorInfo([h,l,u,p],"float32",m)}const yq={kernelName:nm,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(e){const{inputs:t,backend:n,attrs:s}=e,{images:r,dy:o}=t,{alignCorners:i}=s;gt([o,r],"resizeBilinearGrad");const a=vt(r.shape),[c,l,u,h]=r.shape,[,f,d]=o.shape,p=new Float32Array(c*l*u*h),g=[i&&f>1?l-1:l,i&&d>1?u-1:u],m=[i&&f>1?f-1:f,i&&d>1?d-1:d],x=g[0]/m[0],b=g[1]/m[1],w=n.data.get(o.dataId).values;let y=0;for(let v=0;v<c;v++){const $=v*a[0];for(let I=0;I<f;I++){const N=I*x,k=Math.floor(N),S=Math.min(Math.ceil(N),l-1),C=$+k*a[1],A=$+S*a[1],R=N-k,_=1-R;for(let T=0;T<d;T++){const E=T*b,M=Math.floor(E),O=Math.min(Math.ceil(E),u-1),L=E-M,B=1-L,G=C+M*a[2],q=C+O*a[2],Y=A+M*a[2],tt=A+O*a[2],J=_*B,st=_*L,rt=R*B,ft=R*L;for(let Z=0;Z<h;Z++){const ot=w[y++];p[G+Z]+=ot*J,p[q+Z]+=ot*st,p[Y+Z]+=ot*rt,p[tt+Z]+=ot*ft}}}}return n.makeTensorInfo([c,u,l,h],"float32",p)}const vq={kernelName:gb,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $q(e){const{inputs:t,backend:n,attrs:s}=e,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s;gt(r,"resizeNearestNeighbor");const c=vt(r.shape),[l,u]=a,[h,f,d,p]=r.shape,g=n.data.get(r.dataId).values,m=new Float32Array(h*l*u*p),x=[o&&l>1?f-1:f,o&&u>1?d-1:d],b=[o&&l>1?l-1:l,o&&u>1?u-1:u],w=x[0]/b[0],y=x[1]/b[1];let v=0;for(let $=0;$<h;$++){const I=$*c[0];for(let N=0;N<l;N++){const k=i?w*(N+.5):w*N;let S=Math.min(f-1,o?Math.round(k):Math.floor(k));i&&(S=Math.max(0,S));const C=I+S*c[1];for(let A=0;A<u;A++){const R=i?y*(A+.5):y*A;let _=Math.min(d-1,o?Math.round(R):Math.floor(R));i&&(_=Math.max(0,_));const T=C+_*c[2];for(let E=0;E<p;E++){const M=g[T+E];m[v++]=M}}}}return n.makeTensorInfo([h,l,u,p],r.dtype,m)}const Cq={kernelName:em,backendName:"cpu",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(e){const{inputs:t,backend:n,attrs:s}=e,{images:r,dy:o}=t,{alignCorners:i}=s;gt([o,r],"resizeNearestNeighborGrad");const a=vt(r.shape),c=vt(o.shape),[l,u,h,f]=r.shape,[,d,p]=o.shape,g=new Float32Array(l*u*h*f),m=n.data.get(o.dataId).values,x=[i&&d>1?u-1:u,i&&p>1?h-1:h],b=[i&&d>1?d-1:d,i&&p>1?p-1:p],w=x[0]/b[0],y=x[1]/b[1],v=1/w,$=1/y,I=Math.ceil(v)*2+2,N=Math.ceil($)*2+2;for(let k=0;k<l;k++){const S=k*a[0];for(let C=0;C<u;C++){const A=S+C*a[1],R=Math.floor(C*v),_=Math.floor(R-I/2);for(let T=0;T<h;T++){const E=A+T*a[2],M=Math.floor(T*$),O=Math.floor(M-N/2);for(let L=0;L<f;L++){let B=0;for(let G=0;G<I;G++){const q=G+_;if(q<0||q>=d)continue;const Y=S+q*c[1],tt=q*w,J=Math.min(u-1,i?Math.round(tt):Math.floor(tt));if(C===J)for(let st=0;st<N;st++){const rt=st+O;if(rt<0||rt>=p)continue;const ft=Y+rt*c[2],Z=rt*y,ot=Math.min(h-1,i?Math.round(Z):Math.floor(Z));T===ot&&(B+=m[ft+L])}}g[E+L]=B}}}}return n.makeTensorInfo(r.shape,r.dtype,g)}const Iq={kernelName:mb,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sq(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{dims:o}=s;gt(r,"reverse");const i=r.shape.length,a=Lt(o,r.shape);if(i===0)return Nr({inputs:{x:r},backend:n});const c=new Ye(r.shape,r.dtype),l=n.bufferSync(r);for(let u=0;u<c.size;u++){const h=c.indexToLoc(u),f=h.slice();a.forEach(d=>f[d]=r.shape[d]-1-f[d]),c.set(l.get(...f),...h)}return n.makeTensorInfo(c.shape,c.dtype,c.values)}const Nq={kernelName:sm,backendName:"cpu",kernelFunc:Sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _q={kernelName:Cb,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,{radians:r,fillValue:o,center:i}=t,a=n,c=rn(s.dtype,K(s.shape)),[l,u,h,f]=s.shape,[d,p]=hy(i,u,h),g=255,m=Math.sin(r),x=Math.cos(r),b=a.data.get(s.dataId).values;for(let y=0;y<l;y++){const v=y*h*u*f;for(let $=0;$<u;$++){const I=$*(h*f);for(let N=0;N<h;N++){const k=N*f;for(let S=0;S<f;S++){const C=[l,$,N,S],A=C[2],R=C[1];let _=(A-d)*x-(R-p)*m,T=(A-d)*m+(R-p)*x;_=Math.round(_+d),T=Math.round(T+p);let E=o;if(typeof o!="number"&&(S===3?E=g:E=o[S]),_>=0&&_<h&&T>=0&&T<u){const O=T*(h*f),L=_*f,B=v+O+L+S;E=b[B]}const M=v+I+k+S;c[M]=E}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tq=Zt(Uu,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),Eq={kernelName:Uu,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(e){const{inputs:t,backend:n,attrs:s}=e,{indices:r,updates:o}=t,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=ea(o,r,i),f=!0,d=n.bufferSync(r),p=n.bufferSync(o),g=mi(d,p,i,h,l,c,a,u,0,f);return n.makeTensorInfo(i,g.dtype,g.values)}const Aq={kernelName:wI,backendName:"cpu",kernelFunc:Rq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(e,t){let n=0,s=e.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),e[r]<t?n=r+1:s=r;return s}function Mq(e,t){let n=0,s=e.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),e[r]<=t?n=r+1:s=r;return s}function Fq(e,t,n,s,r,o){const i=ke("int32",n*r);for(let a=0;a<n;++a){const c=e.slice(a*s,(a+1)*s),l=a*r;for(let u=0;u<r;++u)i[l+u]=o==="left"?Dq(c,t[u+l]):Mq(c,t[u+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(e){const{inputs:t,backend:n,attrs:s}=e,{sortedSequence:r,values:o}=t,{side:i}=s,a=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,l=Fq(a,c,r.shape[0],r.shape[1],o.shape[1],i);return n.makeTensorInfo(o.shape,"int32",l)}const Lq={kernelName:$I,backendName:"cpu",kernelFunc:Oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(e){const{inputs:t,backend:n}=e,{condition:s,t:r,e:o}=t;gt([s,r,o],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,c=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=ns(r.dtype,o.dtype),h=on(K(r.shape),u);let f=0;const d=i===0||i>1||r.shape.length===1?1:K(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let g=0;g<d;g++)a[p]===1?h[f++]=c[p]:h[f++]=l[p];return n.makeTensorInfo(r.shape,u,h)}const zq={kernelName:rm,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bq=Cm,Vq=km,Wq=Zt(Hu,e=>e>=0?Vq*e:Bq*(Math.exp(e)-1)),Uq={kernelName:Hu,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=Zt(ju,e=>e<0?-1:e>0?1:0),Hq={kernelName:ju,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qq=Zt(qu,e=>Math.sin(e)),Xq={kernelName:qu,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jq=Zt(Xu,e=>Math.sinh(e)),Kq={kernelName:Xu,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq=11920928955078125e-23,Q2=Math.log(Yq)+2,Zq=Zt(Yu,e=>{const t=e>-Q2,n=e<Q2,s=Math.exp(e);let r;return n?r=s:t?r=e:r=Math.log(1+s),r}),Qq={kernelName:Yu,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockShape:o,paddings:i}=s;gt([r],"spaceToBatchND");const a=K(o),c=[[0,0]];c.push(...i);for(let $=1+o.length;$<r.shape.length;++$)c.push([0,0]);const l=qE.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:c,constantValue:0}}),u=ch(l.shape,o,a,!1),h=lh(u.length,o.length,!1),f=uh(l.shape,o,a,!1),g=ae({inputs:{x:l},backend:n,attrs:{shape:u}}),b=zn({inputs:{x:g},backend:n,attrs:{perm:h}}),v=ae({inputs:{x:b},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),v}const tX={kernelName:am,backendName:"cpu",kernelFunc:Jq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(e){const{inputs:t,backend:n}=e,{indices:s,values:r,denseShape:o,defaultValue:i}=t;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,c=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=n.data.get(i.dataId).values[0],[h,f,d,p,g]=bE(a,s.shape,s.dtype,c,r.dtype,l,u);return[n.makeTensorInfo(f,s.dtype,h),n.makeTensorInfo([f[0]],r.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const nX={kernelName:CI,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(e){const{inputs:t,backend:n}=e,{inputIndices:s,inputShape:r,newShape:o}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,c=Array.from(n.data.get(o.dataId).values),[l,u,h]=yE(a,s.shape,s.dtype,i,c);return[n.makeTensorInfo(u,s.dtype,l),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const rX={kernelName:kI,backendName:"cpu",kernelFunc:sX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(e){const{inputs:t,backend:n}=e,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,[l,u]=ew(i,s.shape,s.dtype,a,c,!0);return n.makeTensorInfo(u,s.dtype,l)}const iX={kernelName:II,backendName:"cpu",kernelFunc:oX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(e){const{inputs:t,backend:n}=e,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,[l,u]=ew(i,s.shape,s.dtype,a,c);return n.makeTensorInfo(u,s.dtype,l)}const cX={kernelName:SI,backendName:"cpu",kernelFunc:aX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(e){const{inputs:t,backend:n,attrs:s}=e,{sparseIndices:r,sparseValues:o,defaultValue:i}=t,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=ea(o,r,a),d=!1,p=n.bufferSync(r);let g;switch(o.dtype){case"bool":{const m=n.bufferSync(o),x=!!n.data.get(i.dataId).values[0];g=mi(p,m,a,f,u,l,c,h,x,d);break}case"float32":{const m=n.bufferSync(o),x=n.data.get(i.dataId).values[0];g=mi(p,m,a,f,u,l,c,h,x,d);break}case"int32":{const m=n.bufferSync(o),x=n.data.get(i.dataId).values[0];g=mi(p,m,a,f,u,l,c,h,x,d);break}case"string":{const m=n.bufferSync(o),x=Ro(n.data.get(i.dataId).values[0]);g=mi(p,m,a,f,u,l,c,h,x,d);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const uX={kernelName:NI,backendName:"cpu",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=Sy(r,o,a),l=new Array(r.shape.length).fill(0),u=r.shape.slice();return c.map(h=>{const f=[...u];f[a]=h;const d=zi({inputs:{x:r},backend:n,attrs:{begin:l,size:f}});return l[a]+=h,d})}const fX={kernelName:cm,backendName:"cpu",kernelFunc:hX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX={kernelName:xb,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,s=t;gt(n,"square");const r=s.data.get(n.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const c=r[a];o[a]=c*c}return{dataId:s.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=Zt(sh,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),mX={kernelName:sh,backendName:"cpu",kernelFunc:pX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=s;gt(r,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:x,begin:b,end:w,strides:y}=cy(r.shape,o,i,a,c,l,u,h,f);let v;if(g)v=ae({inputs:{x:r},backend:n,attrs:{shape:p}});else if(m||x){D(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const $=oy(b,w,y),I=zi({inputs:{x:r},backend:n,attrs:{begin:b,size:$}});v=ae({inputs:{x:I},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(I)}else{const $=n.bufferSync(r),I=$E(d,$,y,b);v=n.makeTensorInfo(p,I.dtype,I.values)}return v}const xX={kernelName:yb,backendName:"cpu",kernelFunc:gX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(e){const{inputs:t,backend:n,attrs:s}=e,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:u,dataSplits:h}=t,f=n.data.get(u.dataId).values,d=n.data.get(h.dataId).values,[p,g]=CE(f,d,r,o,i,a,c,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",g)]}const yX={kernelName:_I,backendName:"cpu",kernelFunc:bX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(e){const{inputs:t,backend:n,attrs:s}=e,{skipEmpty:r}=s,{input:o,delimiter:i}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values[0],[l,u,h]=kE(a,c,r),f=u.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const vX={kernelName:TI,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(e){const{inputs:t,backend:n,attrs:s}=e,{numBuckets:r}=s,{input:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(o.dataId).values,a=IE(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const CX={kernelName:EI,backendName:"cpu",kernelFunc:$X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX=Zt(th,e=>Math.tan(e)),IX={kernelName:th,backendName:"cpu",kernelFunc:kX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX=Zt(eh,e=>Math.tanh(e)),NX={kernelName:eh,backendName:"cpu",kernelFunc:SX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(e){const{inputs:t,backend:n}=e,{tensor:s,indices:r,updates:o}=t,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:u}=ea(o,r,s.shape),h=!1,f=n.bufferSync(r),d=n.bufferSync(o),p=n.bufferSync(s),g=mi(f,d,s.shape,u,c,a,i,l,p,h);return n.makeTensorInfo(s.shape,g.dtype,g.values)}const TX={kernelName:vI,backendName:"cpu",kernelFunc:_X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{reps:o}=s;gt(r,"tile");const i=NE(n.bufferSync(r),o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const RX={kernelName:nh,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{k:o,sorted:i}=s;gt(r,"topk");const a=n.data.get(r.dataId).values,[c,l]=TE(a,r.shape,r.dtype,o,i);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}const DX={kernelName:wb,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MX(e){const{inputs:t,attrs:n,backend:s}=e,{image:r,transforms:o}=t,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=n,[u,h,f,d]=r.shape,[p,g]=l??[h,f],m=[u,p,g,d],x=vt(r.shape),b=x[0],w=x[1],y=x[2],v=vt(m),$=v[0],I=v[1],N=v[2],k=rn(r.dtype,K(m));k.fill(c);const S=s.data.get(r.dataId).values,C=s.data.get(o.dataId).values;for(let R=0;R<u;++R){const _=o.shape[0]===1?C:C.subarray(R*8,R*8+8);for(let T=0;T<p;++T)for(let E=0;E<g;++E)for(let M=0;M<d;++M){let O;const L=_[6]*E+_[7]*T+1;if(L===0)continue;const B=(_[0]*E+_[1]*T+_[2])/L,G=(_[3]*E+_[4]*T+_[5])/L,q=J2(B,f,a),Y=J2(G,h,a);switch(i){case"nearest":O=BX(S,h,f,b,w,y,R,Y,q,M,c);break;case"bilinear":O=VX(S,h,f,b,w,y,R,Y,q,M,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const tt=R*$+T*I+E*N+M;k[tt]=O}return s.makeTensorInfo(m,r.dtype,k)}return{dataId:s.write(k,m,r.dtype),shape:r.shape,dtype:r.dtype}}const FX={kernelName:vb,backendName:"cpu",kernelFunc:MX};function J2(e,t,n){switch(n){case"reflect":return OX(e,t);case"wrap":return LX(e,t);case"nearest":return zX(e,t);case"constant":default:return PX(e)}}function OX(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const s=2*t;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-t?n+s:-n-1}else if(n>t-1)if(t<=1)n=0;else{const s=2*t;n-=s*Math.trunc(n/s),n>=t&&(n=s-n-1)}return Ii(0,n,t-1)}function LX(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const s=t-1;n+=t*(Math.trunc(-n/s)+1)}else if(n>t-1)if(t<=1)n=0;else{const s=t-1;n-=t*Math.trunc(n/s)}return Ii(0,n,t-1)}function PX(e,t){return e}function zX(e,t){return Ii(0,e,t-1)}function cl(e,t,n,s,r,o,i,a,c,l,u){const h=i*s+a*r+c*o+l;return 0<=a&&a<t&&0<=c&&c<n?e[h]:u}function BX(e,t,n,s,r,o,i,a,c,l,u){const h=Math.round(a),f=Math.round(c);return cl(e,t,n,s,r,o,i,h,f,l,u)}function VX(e,t,n,s,r,o,i,a,c,l,u){const h=Math.floor(a),f=Math.floor(c),d=h+1,p=f+1,g=(p-c)*cl(e,t,n,s,r,o,i,h,f,l,u)+(c-f)*cl(e,t,n,s,r,o,i,h,p,l,u),m=(p-c)*cl(e,t,n,s,r,o,i,d,f,l,u)+(c-f)*cl(e,t,n,s,r,o,i,d,p,l,u);return(d-a)*g+(a-h)*m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(e){const{inputs:t,attrs:n,backend:s}=e,{axis:r}=n,{x:o}=t;gt(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:c,indices:l}=EE(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const UX={kernelName:$b,backendName:"cpu",kernelFunc:WX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GX(e){const{inputs:t,backend:n,attrs:s}=e,{value:r}=t;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],c=new Array(i-1);let l=0;for(let d=0;d<i;d++)d!==o&&(c[l++]=r.shape[d]);const u=new Array(i).fill(0),h=r.shape.slice();h[o]=1;const f=new Array(a);for(let d=0;d<f.length;d++){u[o]=d;const p=zi({inputs:{x:r},backend:n,attrs:{begin:u,size:h}});f[d]=ae({inputs:{x:p},backend:n,attrs:{shape:c}}),n.disposeIntermediateTensorInfo(p)}return f}const HX={kernelName:um,backendName:"cpu",kernelFunc:GX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,segmentIds:o}=t,{numSegments:i}=s;gt(r,"unsortedSegmentSum");const a=r.shape.length,c=o.shape.length,l=[],u=[],h=a-c;let f=o;for(let p=0;p<h;++p){const g=dd({inputs:{input:f},backend:n,attrs:{dim:p+1}});f=g,u.push(g)}for(let p=0;p<i;++p){const g=Go(p,"int32"),m=n.makeTensorInfo([],"int32",g),x=HT({inputs:{a:m,b:f},backend:n}),b=Oo({inputs:{x},backend:n,attrs:{dtype:"float32"}}),w=Om({inputs:{a:b,b:r},backend:n}),y=yh({inputs:{x:w},backend:n,attrs:{axis:0,keepDims:!1}});l.push(y),u.push(m),u.push(x),u.push(b),u.push(w),u.push(y)}const d=HE({inputs:l,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const XX={kernelName:hm,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jX=[W7,$U,G7,q7,_U,j7,Y7,Q7,t9,n9,r9,i9,c9,h9,d9,g9,b9,w9,$9,B7,k9,S9,_9,EU,E9,SU,AU,A9,CU,M9,O9,L9,z9,V9,U9,H9,X9,K9,Z9,J9,eG,sG,oG,aG,cG,uG,fG,pG,mG,gG,xG,yG,$G,D7,kG,DU,AG,MU,DG,OU,zG,BG,WG,PU,BU,GG,qG,jG,YG,WU,GU,kU,QG,F9,tH,nH,rH,M7,qU,jU,iH,YU,cH,hH,dH,gH,bH,wH,vH,QU,CH,IH,NH,TH,RH,DH,FH,t7,LH,BH,UH,n7,r7,qH,KH,QH,i7,tq,nq,sq,qE,aq,O7,l7,lq,hq,dq,mq,IU,v1,xq,L7,P7,z7,yq,vq,Cq,Iq,Nq,_q,Eq,x7,Aq,Lq,zq,Uq,y7,Hq,Xq,Kq,w7,VH,Qq,tX,nX,rX,iX,cX,uX,fX,C7,dX,I7,N7,mX,xX,yX,vX,CX,R7,wG,IX,NX,TX,RX,DX,FX,a7,UX,HX,XX,eq];for(const e of jX)AI(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fi={},qh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function KX(e,t){fi[e]=t}function sr(e,t){if(!(e in fi)||t!=null){const s=ZX(e,t);if(s!==null)fi[e]=s;else return console.log("Could not get context for WebGL version",e),null}const n=fi[e];return n==null||n.isContextLost()?(delete fi[e],sr(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),fi[e])}function YX(e){if(!X().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function ZX(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t??YX(e);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete fi[e]},!1),X().getBool("SOFTWARE_WEBGL_ENABLED")&&(qh.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",qh)||n.getContext("experimental-webgl",qh):n.getContext("webgl2",qh)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Vl;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Vl||(Vl={}));var hs;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(hs||(hs={}));var qe;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qe||(qe={}));function wh(e,t){return[t,e]}function QX(e,t){return e*t}function Xh(e){const t=K(e),n=Math.ceil(t/4);return H0(n)}function Ac(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function JX(e,t){const[n,s]=Ac(e,t);return n*s*4}function iw(e,t){const n=e;let s,r,o,i,a,c,l,u,h,f;return X().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,l=4,u=1,h=n.HALF_FLOAT,f=n.FLOAT,c=n.RGBA8):(s=e.RGBA,r=e.RGBA,o=e.RGBA,i=n.RGBA,a=e.RGBA,l=4,u=4,h=t!=null?t.HALF_FLOAT_OES:null,f=e.FLOAT,c=e.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ht(e,t){const n=t();return X().getBool("DEBUG")&&tj(e),n}function tj(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+rj(e,t))}const ej=596e-10,nj=65504;function sj(e){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||ej<Math.abs(e)&&Math.abs(e)<nj)}function rj(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function jh(e,t){return co(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function oj(e,t){const n=co(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ht(e,()=>e.shaderSource(n,t)),ht(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function ij(e,t){const n=co(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ht(e,()=>e.shaderSource(n,t)),ht(e,()=>e.compileShader(n)),X().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw XE(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const aj=/ERROR: [0-9]+:([0-9]+):/g;function XE(e,t){const n=aj.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}const s=+n[1],r=e.split(`
`),o=r.length.toString().length+2,i=r.map((h,f)=>Da((f+1).toString(),o)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const c=i.slice(0,s-1),l=i.slice(s-1,s),u=i.slice(s);console.log(c.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Da(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function cj(e){return co(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function lj(e,t){if(ht(e,()=>e.linkProgram(t)),!X().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Jg(e,t){if(ht(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function uj(e,t){const n=co(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ht(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),ht(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function hj(e,t){const n=co(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ht(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),ht(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function fj(e){return co(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function dj(e,t){const n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const s=`[${e}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(e>n||t>n){const s=`[${e}x${t}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function pj(e){return co(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function t$(e,t,n,s,r,o,i){const a=e.getAttribLocation(t,n);return a===-1?!1:(ht(e,()=>e.bindBuffer(e.ARRAY_BUFFER,s)),ht(e,()=>e.vertexAttribPointer(a,r,e.FLOAT,!1,o,i)),ht(e,()=>e.enableVertexAttribArray(a)),!0)}function mj(e,t,n){wj(e,n),ht(e,()=>e.activeTexture(e.TEXTURE0+n)),ht(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function gj(e,t,n){return co(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function xj(e,t,n){return e.getUniformLocation(t,n)}function bj(e,t,n,s){ht(e,()=>mj(e,t,s)),ht(e,()=>e.uniform1i(n,s))}function t0(e,t,n){ht(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),ht(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function e$(e,t){ht(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),ht(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function Kh(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+yj(e,t))}function yj(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function co(e,t,n){const s=ht(e,()=>t());if(s==null)throw new Error(n);return s}function wj(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+e.TEXTURE0;if(s<e.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function nc(e,t=2){return K(e.slice(0,e.length-t))}function sc(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Yh(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[nc(e),...sc(e)]),t}function vj(e,t=!1){let n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=X().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&X().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),t&&(n=n*2,s=s*2,e=e.map((a,c)=>c>=e.length-2?Ax(e[c]):e[c]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=Uo(e).newShape);let r=K(e),o=null;e.length<=1&&r<=n?o=[1,r]:e.length===2&&e[0]<=n&&e[1]<=n?o=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?o=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?o=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?o=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(o=[e[0],e[1]*e[2]*e[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(t?2:1)&&Math.min(...o)>0;if(o==null||i)if(t){const a=nc(e);let c=2,l=2;e.length&&([c,l]=sc(e)),r=a*(c/2)*(l/2),o=H0(r).map(u=>u*2)}else o=H0(r);return o}function Zh(e){return e%2===0}function md(e,t){if(e=e.slice(-2),t=t.slice(-2),Xt(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){const n=e[e.length-1],s=t[t.length-1];if(n===s||Zh(n)&&Zh(s)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Zh(e[0])&&Zh(t[0])}let e0,n0;function $j(e){if(e0==null){const t=sr(e);e0=t.getParameter(t.MAX_TEXTURE_SIZE)}return e0}function Cj(e){if(n0==null){const t=sr(e);n0=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,n0)}function kj(e){if(e===0)return 0;let t;const n=sr(e);return Es(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:Es(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function Es(e,t){return e.getExtension(t)!=null}function n$(e){try{if(sr(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Ij(e){if(e===0)return!1;const t=sr(e);if(e===1){if(!Es(t,"OES_texture_float"))return!1}else if(!Es(t,"EXT_color_buffer_float"))return!1;return C1(t)}function Sj(e){if(e===0)return!1;const t=sr(e);if(e===1){if(!Es(t,"OES_texture_float")||!Es(t,"WEBGL_color_buffer_float"))return!1}else{if(Es(t,"EXT_color_buffer_float"))return C1(t);const s="EXT_color_buffer_half_float";if(Es(t,s)){const r=t.getExtension(s);return Nj(t,r)}return!1}return C1(t)}function C1(e){const t=iw(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(o),i}function Nj(e,t){const n=iw(e,t),s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(s),e.deleteFramebuffer(i),a}function _j(e){return e!==2?!1:sr(e).fenceSync!=null}function vh(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&D(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bt=X();bt.registerFlag("HAS_WEBGL",()=>bt.getNumber("WEBGL_VERSION")>0);bt.registerFlag("WEBGL_VERSION",()=>n$(2)?2:n$(1)?1:0);bt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);bt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>bt.get("WEBGL_VERSION")===2);bt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);bt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);bt.registerFlag("WEBGL_PACK",()=>bt.getBool("HAS_WEBGL"));bt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_CLIP",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_REDUCE",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_LAZILY_UNPACK",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_CONV_IM2COL",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>bt.getBool("WEBGL_PACK"));bt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>$j(bt.getNumber("WEBGL_VERSION")));bt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Cj(bt.getNumber("WEBGL_VERSION")));bt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=bt.getNumber("WEBGL_VERSION");return e===0?0:kj(e)});bt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>bt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!HI());bt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Ij(bt.getNumber("WEBGL_VERSION")));bt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>bt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:bt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));bt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Sj(bt.getNumber("WEBGL_VERSION")));bt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>_j(bt.getNumber("WEBGL_VERSION")));bt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>bt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);bt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});bt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>HI()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});bt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);bt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);bt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);bt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);bt.registerFlag("WEBGL_EXP_CONV",()=>!1);bt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>bt.getBool("IS_TEST"));bt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);bt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);bt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);bt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cn(){let e,t,n,s,r,o,i,a,c,l;return X().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=X().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(e,t,n="index"){const s=vt(t);return s.map((r,o)=>{const i=`int ${e[o]} = ${n} / ${r}`,a=o===s.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * ${r}`:`index -= ${e[o]} * ${r}`;return`${i}; ${a};`}).join("")}function Lm(e,t,n="index"){const s=vt(t);return s.map((r,o)=>{const i=`int ${e[o]} = ${n} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * outShapeStrides[${o}]`:`index -= ${e[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function Tj(e,t){const n=e.length,s=e.map(o=>`${t}[${o}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let o=n-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function Ej(e,t,n="index"){const s=e.map((o,i)=>i),r=Tj(s,t);return r.map((o,i)=>{const a=`int ${e[i]} = ${n} / ${r[i]}`,c=i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${r[i]}`:`index -= ${e[i]} * ${r[i]}`;return`${a}; ${c};`}).join("")}function aw(e){const t=vt(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function cw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const jE=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:KE}=y5;function Rj(e,t,n){const s=[];if(e.forEach(d=>{const p=K(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?s.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${d.name};`),s.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:g}=lw(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${d.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${d.name}Shape;`);break}s.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{s.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const r=s.join(`
`),o=e.map(d=>Aj(d,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=t.texShape,a=Cn(),c=Fj(a);let l,u,h=Pj(a);return t.isPacked?(l=Dj(t.logicalShape,i,n.enableShapeUniforms),u=Lj(a)):(l=Mj(t.logicalShape,i,n.enableShapeUniforms),u=Oj(a)),n.packedInputs&&(h+=Wj),[h,c,u,r,l,o,n.userCode].join(`
`)}function Dc(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return tK(e,t);case 1:return nK(e,t);case 2:return rK(e,t);case 3:return iK(e,t);case 4:return cK(e,t);case 5:return lK(e);case 6:return uK(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function YE(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return Jj(e);case 1:return eK(e,t);case 2:return sK(e,t);case 3:return oK(e,t);default:return aK(e,t)}}function Aj(e,t,n=!1,s){let r="";n?r+=YE(e,s):r+=Dc(e,s);const o=e.shapeInfo.logicalShape,i=t.logicalShape;return o.length<=i.length&&(n?r+=hK(e,t):r+=fK(e,t)),r}function Dj(e,t,n){switch(e.length){case 0:return ZE();case 1:return Uj(e,t,n);case 2:return Zj(e,t,n);case 3:return Hj(e,t,n);default:return Xj(e,t,n)}}function Mj(e,t,n){switch(e.length){case 0:return ZE();case 1:return Gj(e,t,n);case 2:return Qj(e,t,n);case 3:return qj(e,t,n);case 4:return jj(e,t,n);case 5:return Kj(e,t);case 6:return Yj(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function Fj(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function Oj(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function Lj(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function Pj(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${zj}
    ${Bj}
    ${Vj}
  `}const zj=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Bj=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Vj=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Wj=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ZE(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Uj(e,t,n){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function Gj(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function Hj(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function qj(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Lm(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;const s=ra(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Xj(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2);let i=o,a="",c="b, r, c";for(let l=2;l<e.length-1;l++)i*=e[e.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${e.length}(${c});
    }
  `}function jj(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Lm(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ra(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function Kj(e,t){const n=ra(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Yj(e,t){const n=ra(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Zj(e,t,n){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Xt(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Qj(e,t,n){return Xt(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function oa(e){return`offset${e}`}function Jj(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Cn();return`
    vec4 ${n}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function tK(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,o]=e.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=oa(n);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,c]=e.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function eK(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e.shapeInfo.texShape,o=Cn();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function nK(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Mc(e)}
      }
    `;const r=e.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=oa(n);return i===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function sK(e,t){const n=e.shapeInfo.logicalShape,s=e.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=e.shapeInfo.texShape,i=o[0],a=o[1],c=Cn();if(o!=null&&Xt(n,o))return t?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function rK(e,t){const n=e.shapeInfo.logicalShape,s=e.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=e.shapeInfo.texShape;if(o!=null&&Xt(n,o)){if(t)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=o[0],d=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Uo(n),c=i;if(c.length<n.length){const f=Fc(e,c),d=["row","col"];return`
      ${Dc(f,t)}
      float ${r}(int row, int col) {
        return ${r}(${Oc(d,a)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Mc(e)}
      }
    `;const l=o[0],u=o[1],h=oa(s);return u===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function oK(e,t){const n=e.shapeInfo.logicalShape,s=e.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const f=n.slice(1),d=[1,2],p=Fc(e,f),g=["b","row","col"];return`
        ${YE(p,t)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Oc(g,d)});
        }
      `}const a=Cn();if(t)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=i[0],l=i[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function iK(e,t){const n=e.shapeInfo.logicalShape,s=e.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:c}=Uo(n),l=a;if(l.length<n.length){const g=Fc(e,l),m=["row","col","depth"];return`
        ${Dc(g,t)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Oc(m,c)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Mc(e)}
      }
    `;const u=e.shapeInfo.texShape,h=u[0],f=u[1],d=e.shapeInfo.flatOffset;if(f===o&&d==null)return t?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===i&&d==null)return t?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=oa(s);return t?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${p};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function aK(e,t){const n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Cn();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const o=e.shapeInfo.logicalShape,i=o.length,a=e.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],u=c[1],h=Math.ceil(o[i-1]/2);let f=h*Math.ceil(o[i-2]/2),d="int b, int row, int col",p=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)d=`int b${g}, `+d,f*=o[i-g-1],p=`b${g} * ${f} + `+p;return`
    vec4 ${s}(${d}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${l});
      return ${r.texture2D}(${n}, uv);
    }
  `}function cK(e,t){const n=e.shapeInfo.logicalShape,s=e.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:c,keptDims:l}=Uo(n);if(c.length<n.length){const b=Fc(e,c),w=["row","col","depth","depth2"];return`
      ${Dc(b,t)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Oc(w,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Mc(e)}
      }
    `;const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],d=h[1],p=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,m=`int stride0 = ${s}Shape[1] * stride1;`;if(d===a&&u==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(d===o&&u==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const x=oa(s);return t?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${x});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${x});
      return sampleTexture(${s}, uv);
    }
  `}function lK(e){const t=e.shapeInfo.logicalShape,n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t[4],o=t[3]*r,i=t[2]*o,a=t[1]*i,{newShape:c,keptDims:l}=Uo(t);if(c.length<t.length){const g=Fc(e,c),m=["row","col","depth","depth2","depth3"];return`
      ${Dc(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Oc(m,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Mc(e)}
      }
    `;const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],d=h[1];if(d===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===r&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=oa(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function uK(e){const t=e.shapeInfo.logicalShape,n=e.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:o}=Uo(t);if(r.length<t.length){const m=Fc(e,r),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${Dc(m)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Oc(x,o)});
      }
    `}const i=t[5],a=t[4]*i,c=t[3]*a,l=t[2]*c,u=t[1]*l;if(e.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Mc(e)}
      }
    `;const h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],p=f[1];if(p===u&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=oa(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Mc(e){const t=e.name,n=K(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function hK(e,t){const n=e.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,a=KE(e.shapeInfo.logicalShape,t.logicalShape),c=Qt(i),l=i-o;let u;const h=["x","y","z","w","u","v"];o===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let f="";i<2&&o>0?f="coords":f=e.shapeInfo.logicalShape.map((b,w)=>`coords.${h[w+l]}`).join(", ");let d="return outputValue;";const g=K(e.shapeInfo.logicalShape)===1,x=K(t.logicalShape)===1;if(o===1&&!g&&!x)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!x)i===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=o-2,w=o-1;a.indexOf(b)>-1&&a.indexOf(w)>-1?d="return vec4(outputValue.x);":a.indexOf(b)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${f});
      ${d}
    }
  `}function fK(e,t){const n=e.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=t.texShape,i=e.shapeInfo.texShape,a=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===c&&e.shapeInfo.flatOffset==null&&Xt(i,o))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=Qt(c),u=KE(e.shapeInfo.logicalShape,t.logicalShape),h=c-a;let f;const d=["x","y","z","w","u","v"];a===0?f="":c<2&&u.length>=1?f="coords = 0;":f=u.map(g=>`coords.${d[g+h]} = 0;`).join(`
`);let p="";return c<2&&a>0?p="coords":p=e.shapeInfo.logicalShape.map((g,m)=>`coords.${d[m+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${f}
      return get${s}(${p});
    }
  `}function Qt(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function lw(e,t,n){const{newShape:s,keptDims:r}=Uo(t),o=t.length,i=e&&o===3&&t[0]===1,a=i?t.slice(1):s,c=!e&&o>1&&!Xt(t,n)&&s.length<o||i;return{useSqueezeShape:c,uniformShape:c?a:t,keptDims:r}}function Fc(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Oc(e,t){return t.map(n=>e[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(e,t,n,s){const r=n.map((u,h)=>{const f={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(f.flatOffset=u.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:f}}),o=r.map(u=>u.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=Rj(r,i,t),c=ij(e.gl,a),l=e.createProgram(c);return X().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i},QE(e,t,l)))}function QE(e,t,n){const s=[],r=[];let o,i,a,c=null,l=null;l=e.getUniformLocation(n,"NAN",!1),X().getNumber("WEBGL_VERSION")===1&&(c=e.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const f={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,`offset${h}`,u)};t.enableShapeUniforms&&(f.shape=e.getUniformLocation(n,`${h}Shape`,u),f.texShape=e.getUniformLocation(n,`${h}TexShape`,u)),s.push(f)}if(t.enableShapeUniforms&&(o=e.getUniformLocation(n,"outShape",u),a=e.getUniformLocation(n,"outShapeStrides",u),i=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)r.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function s$(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,s)=>{const r=n.logicalShape,o=t[s],i=o.shape;if(!Xt(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,c=o.isUniform?null:o.texData.texShape;if(!Xt(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function pK(e,t,n,s,r){t.program.enableShapeUniforms||(s$(t.inShapeInfos,n),s$([t.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?e.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):e.setOutputMatrixTexture(o.texture,i[0],i[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),X().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let c=0;c<n.length;++c){const l=n[c],{uniform:u,offset:h,shape:f,texShape:d}=t.variablesLocations[c];if(f){const{uniformShape:p}=lw(t.program.packedInputs,l.shape,l.texData.texShape);switch(p.length){case 1:e.gl.uniform1iv(f,new Int32Array(p));break;case 2:e.gl.uniform2iv(f,new Int32Array(p));break;case 3:e.gl.uniform3iv(f,new Int32Array(p));break;case 4:e.gl.uniform4iv(f,new Int32Array(p));break}}if(d&&e.gl.uniform2i(d,l.texData.texShape[0],l.texData.texShape[1]),u!=null){if(l.isUniform){if(K(l.shape)<2)e.gl.uniform1f(u,l.uniformValues[0]);else{let p=l.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),e.gl.uniform1fv(u,p)}continue}l.texData.slice!=null&&h!=null&&e.gl.uniform1i(h,l.texData.slice.flatOffset),e.setInputMatrixTexture(l.texData.texture.texture,u,c)}}const a=t.outShapeLocation;if(a)switch(s.shape.length){case 1:e.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:e.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:e.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:e.gl.uniform4iv(a,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const c=vt(s.shape);switch(s.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(c));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(c));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(c));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&r)for(let c=0;c<t.program.customUniforms.length;++c){const l=t.program.customUniforms[c],u=t.customUniformLocations[c],h=r[c];if(l.type==="float")e.gl.uniform1fv(u,h);else if(l.type==="vec2")e.gl.uniform2fv(u,h);else if(l.type==="vec3")e.gl.uniform3fv(u,h);else if(l.type==="vec4")e.gl.uniform4fv(u,h);else if(l.type==="int")e.gl.uniform1iv(u,h);else if(l.type==="ivec2")e.gl.uniform2iv(u,h);else if(l.type==="ivec3")e.gl.uniform3iv(u,h);else if(l.type==="ivec4")e.gl.uniform4iv(u,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}e.executeProgram()}function mK(e,t,n){let s="";t.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!i.isUniform){const c=i.texData.texShape,{useSqueezeShape:l,uniformShape:u,keptDims:h}=lw(e.packedInputs,i.shape,c);let f="",d="",p="";if(u.length===1&&e.packedInputs){const v=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];f=`${v[0]>1}_${v[1]>1}`}else if(u.length===2&&!e.packedInputs)d=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!e.packedInputs){const v=vt(u);p=`${v[0]===c[1]}_${v[v.length-1]===c[1]}`}const g=i.shape.length,m=u.length===2&&Xt(i.shape,c),x=K(i.shape)===1,b=Ka(i.shape,n.shape),w=!e.packedInputs&&g===n.shape.length&&Xt(c,n.texData.texShape),y=e.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${g}_${w}_${l?h:""}_${u.length}_${x}_${b}_${m}_${f}_${d}_${p}_${y}_${a}`}else{const c=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${c}_${a}`}});const r=e.userCode;let o=e.constructor.name;return o+="_"+s+"_"+r+`${X().getNumber("WEBGL_VERSION")}`,o}function ln(e){return X().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gK{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Vl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Cn();this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lm(["r","c","d"],t):ra(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xK{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Vl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Cn();this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lm(["r","c","d"],t):ra(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bK{constructor(t){this.variableNames=["A"],this.outTexUsage=hs.DOWNLOAD;const n=Cn();this.outputShape=t,this.userCode=`
      ${jE}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yK{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=hs.DOWNLOAD;const n=Cn();this.outputShape=t,this.userCode=`
      ${jE}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK={R:0,G:1,B:2,A:3};class r${constructor(t,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Cn();this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const c=s[a];i+=`
          if(offset == ${a}) {
            result = values[${wK[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?cw():aw(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vK{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Cn();this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length);let r="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const c=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?cw():aw(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(e){const t=Cn(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return oj(e,n)}function CK(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return uj(e,t)}function kK(e){const t=new Uint16Array([0,1,2,2,1,3]);return hj(e,t)}function $h(e,t,n,s,r,o){dj(t,n);const i=fj(e),a=e.TEXTURE_2D;return ht(e,()=>e.bindTexture(a,i)),ht(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),ht(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),ht(e,()=>e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)),ht(e,()=>e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST)),X().getNumber("WEBGL_VERSION")===1?ht(e,()=>e.texImage2D(a,0,s,t,n,0,r,o,null)):ht(e,()=>e.texStorage2D(a,1,s,t,n)),ht(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:i,texShape:[n,t]}}function JE(e){return e.internalFormatFloat}function IK(e,t,n,s){const[r,o]=wh(t,n);return $h(e,r,o,JE(s),s.textureFormatFloat,e.FLOAT)}function tR(e){return e.internalFormatHalfFloat}function SK(e,t,n,s){const[r,o]=wh(t,n);return $h(e,r,o,tR(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function eR(e){return e.downloadTextureFormat}function NK(e,t,n,s){const[r,o]=wh(t,n);return $h(e,r,o,eR(s),e.RGBA,e.UNSIGNED_BYTE)}function nR(e){return e.internalFormatPackedFloat}function _K(e,t,n,s){const[r,o]=Ac(t,n);return $h(e,r,o,nR(s),e.RGBA,e.FLOAT)}function sR(e){return e.internalFormatPackedHalfFloat}function TK(e,t,n,s){const[r,o]=Ac(t,n);return $h(e,r,o,sR(s),e.RGBA,s.textureTypeHalfFloat)}function EK(e,t,n){return ht(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),t$(e,t,"clipSpacePos",n,3,20,0)&&t$(e,t,"uv",n,2,20,12)}function RK(e,t,n,s,r,o){ht(e,()=>e.bindTexture(e.TEXTURE_2D,t));let i,a,c;r instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=e.UNSIGNED_BYTE,c=e.RGBA):(i=new Float32Array(n*s*4),a=e.FLOAT,c=o.internalFormatPackedFloat),i.set(r),X().getNumber("WEBGL_VERSION")===2?ht(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,s,e.RGBA,a,i)):ht(e,()=>e.texImage2D(e.TEXTURE_2D,0,c,n,s,0,e.RGBA,a,i)),ht(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function AK(e,t,n){ht(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?X().getNumber("WEBGL_VERSION")===2?ht(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):ht(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):X().getNumber("WEBGL_VERSION")===2?ht(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):ht(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),ht(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function DK(e,t,n,s){const r=e.createBuffer();ht(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r));const a=4*4*t*n;return ht(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),ht(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),ht(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),r}function MK(e,t,n){const s=e,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function FK(e,t,n,s){const[r,o]=wh(t,n),i=4,a=new Uint8Array(QX(t*n,i));return ht(e,()=>e.readPixels(0,0,r,o,s.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function OK(e,t,n,s,r,o,i,a){const c=e,l=new Float32Array(JX(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function LK(e,t,n){const s=new Float32Array(t*n*4);return ht(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s0{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=X().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,KX(n,t)):this.gl=sr(n),t=this.gl,X().getNumber("WEBGL_VERSION")===2){const o=t;this.createVertexArray=()=>ht(o,()=>o.createVertexArray()),this.bindVertexArray=i=>ht(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>ht(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>ht(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(t!=null){const o=t.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ht(t,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>ht(t,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>ht(t,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>ht(t,()=>t.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),X().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=jh(this.gl,o),Es(this.gl,i))this.textureHalfFloatExtension=jh(this.gl,i);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Es(this.gl,r))this.colorBufferHalfFloatExtension=jh(this.gl,r);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Es(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Es(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=CK(this.gl),this.indexBuffer=kK(this.gl),this.framebuffer=pj(this.gl),this.textureConfig=iw(this.gl,this.textureHalfFloatExtension)}get debug(){return X().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;ht(t,()=>t.finish()),ht(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),ht(t,()=>t.deleteFramebuffer(this.framebuffer)),ht(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),ht(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),ht(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),IK(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),SK(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),NK(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),AK(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,s,r){this.throwIfDisposed(),RK(this.gl,t,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),TK(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),_K(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(e$(this.gl,this.framebuffer),this.outputTexture=null),ht(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,s){return this.downloadMatrixDriver(t,()=>FK(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,s,r,o,i){return OK(this.gl,t,n,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return MK(this.gl,t,n)}createBufferFromTexture(t,n,s){this.bindTextureToFrameBuffer(t);const r=DK(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,s;if(X().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},n=o}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(t,n,s){return this.downloadMatrixDriver(t,()=>LK(this.gl,n,s))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=$K(n));const s=cj(n);ht(n,()=>n.attachShader(s,this.vertexShader)),ht(n,()=>n.attachShader(s,t)),lj(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Jg(n,r),r}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const n=this.gl;ht(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),EK(n,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(ht(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Jg(this.gl,this.program),ht(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,s=!0){return this.throwIfDisposed(),s?gj(this.gl,t,n):xj(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),ht(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),bj(this.gl,t,n,s)}setOutputMatrixTexture(t,n,s){this.setOutputMatrixTextureDriver(t,s,n)}setOutputPackedMatrixTexture(t,n,s){this.throwIfDisposed();const[r,o]=Ac(n,s);this.setOutputMatrixTextureDriver(t,r,o)}setOutputMatrixWriteRegion(t,n,s,r){this.setOutputMatrixWriteRegionDriver(s,t,r,n)}setOutputPackedMatrixWriteRegion(t,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Jg(this.gl,this.program),Kh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ht(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ht(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=jh(this.gl,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Bv(()=>this.disposed||this.isQueryAvailable(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=PK(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in X().platform&&(s=X().platform.setTimeoutCustom.bind(X().platform)),Bv(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),t0(this.gl,t,this.framebuffer),this.debug&&Kh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(t0(this.gl,this.outputTexture,this.framebuffer),this.debug&&Kh(this.gl)):e$(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,n,s){this.throwIfDisposed();const r=this.gl;t0(r,t,this.framebuffer),this.debug&&Kh(r),this.outputTexture=t,ht(r,()=>r.viewport(0,0,n,s)),ht(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(t,n,s,r){this.throwIfDisposed(),ht(this.gl,()=>this.gl.scissor(t,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function PK(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:zK,bincountImpl:rR,bincountReduceImpl:BK,bitwiseAndImpl:VK,castImpl:WK,ceilImpl:UK,concatImpl:GK,equalImpl:HK,expImpl:qK,expm1Impl:XK,floorImpl:jK,gatherNdImpl:KK,gatherV2Impl:YK,greaterImpl:ZK,greaterEqualImpl:QK,lessImpl:JK,lessEqualImpl:tY,linSpaceImpl:eY,logImpl:nY,maxImpl:sY,maximumImpl:rY,minimumImpl:oY,multiplyImpl:iY,negImpl:aY,notEqualImpl:cY,prodImpl:lY,raggedGatherImpl:uY,raggedRangeImpl:hY,raggedTensorToTensorImpl:fY,rangeImpl:dY,rsqrtImpl:pY,scatterImpl:mY,sigmoidImpl:gY,simpleAbsImpl:oR,sliceImpl:xY,sparseFillEmptyRowsImpl:bY,sparseReshapeImpl:yY,sparseSegmentReductionImpl:iR,sqrtImpl:wY,staticRegexReplaceImpl:vY,stridedSliceImpl:$Y,stringNGramsImpl:CY,stringSplitImpl:kY,stringToHashBucketFastImpl:IY,subImpl:SY,tileImpl:NY,topKImpl:_Y,transposeImpl:uw,uniqueImpl:TY}=A7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function bn(e,t){return t===1?[e]:aR(e,t)}function EY(e,t){if(e===1)return"rc";let n="";for(let s=0;s<e;s++)n+=t[s],s<e-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RY{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=ln(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=bn("rc",this.rank),s=Qt(this.rank),r=this.getOutOfBoundsCondition(n),o=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${t[t.length-1-i]},`+o;n.push(o)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cR{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${AY(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?cw():aw(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function AY(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Ej(["r","c","d"],"inputShape"):ra(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DY{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,n,s){const r=i$(n,s),o=a$(t,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=o$(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const c=this.freeTextures[o].pop();return this.usedTextures[o].push(c),c}let a;return r===qe.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===qe.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===qe.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===qe.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===qe.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(t,n,s,r){if(this.freeTextures==null)return;const o=i$(s,r),i=a$(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=o$(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=X().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[i],u=l&&l.indexOf(t);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function MY(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function o$(e,t,n,s,r){const o=FY(t,s);let i;if(r){const[c,l]=Ac(e[0],e[1]);i=c*l}else{const[c,l]=wh(e[0],e[1]);i=c*l}const a=MY(n,o);return i*a}function FY(e,t){switch(e){case qe.PACKED_2X2_FLOAT32:return nR(t);case qe.PACKED_2X2_FLOAT16:return sR(t);case qe.UNPACKED_FLOAT32:return JE(t);case qe.UNPACKED_FLOAT16:return tR(t);case qe.PACKED_4X1_UNSIGNED_BYTE:return eR(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function OY(e){return X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?qe.PACKED_2X2_FLOAT32:qe.UNPACKED_FLOAT32:e?qe.PACKED_2X2_FLOAT16:qe.UNPACKED_FLOAT16}function i$(e,t){if(e===hs.UPLOAD)return qe.PACKED_2X2_FLOAT32;if(e===hs.RENDER||e==null)return OY(t);if(e===hs.DOWNLOAD||e===hs.PIXELS)return qe.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function a$(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gr{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Bs="if (isnan(x)) return x;",LY="return x;",c$="return abs(x);",PY="return (x >= 0.0) ? x : (exp(x) - 1.0);",zY=Bs+`
  return (x < 0.0) ? 0.0 : x;
`,BY=Bs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,xo="return x;",VY="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WY="return x;",UY=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,GY=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,HY=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qY="return 1.0 / (1.0 + exp(-1.0 * x));";class $o{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XY{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length);const n=t.length,s=bn("rc",n),r=Qt(n),o=EY(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jY=AS,KY=1e-7,YY=1e-4,Qh={};function ZY(e){return e in Qh||(Qh[e]={}),Qh[e]}const QY=X().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),JY=600;function tZ(){return X().global.screen==null?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*JY/1024/1024}class Pm extends Rx{nextDataId(){return Pm.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof s0)n=t;else{const s=sr(X().getNumber("WEBGL_VERSION"),t);n=new s0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=sr(X().getNumber("WEBGL_VERSION"));n=new s0(s),this.binaryCache=ZY(X().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new DY(this.gpgpu),this.numMBBeforeWarning=tZ(),this.texData=new rI(this,lr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,s,r,o,i){const a=this.makeTensorInfo(n,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[r,o]},c.texShape=[r,o];const l=Yh(n),u=new r$(l,!1,i),h=this.runWebGLProgram(u,[a],s,[[r,o]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(t,n,s){if((X().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||X().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:t,usage:hs.UPLOAD,refCount:1}),r}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,s,r,o){if(X().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:r,values:n,usage:hs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:c}=n;if(i!=null){let f;c?f=new $o(a,xo):f=new gr(a,xo);const d=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:r}],r),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(s!=null)return this.convertAndCacheOnCPU(t);if(r==="string")return s;const l=this.activeTimers!=null;let u;l&&(u=_n());let h;if(r==="complex64"){const f=this.readSync(o.real.dataId),d=this.readSync(o.imag.dataId);h=Qr(f,d)}else h=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=_n()-u),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(g=>p.push(g))}const n=this.texData.get(t),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:c}=n;if(o!=null){let p;c?p=new $o(r,xo):p=new gr(r,xo);const g=this.runWebGLProgram(p,[{dataId:t,shape:r,dtype:i}],i),m=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(s!=null)return this.convertAndCacheOnCPU(t);if(X().getBool("DEBUG")&&!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&X().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,u;if(i!=="complex64"&&X().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const p=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,...Xh(r))}this.pendingRead.set(t,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=p[0],m=p[1];h=Qr(g,m)}else if(l==null)h=this.getValuesFromTexture(t);else{const p=K(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),l!=null){const p=this.gpgpu.gl;ht(p,()=>p.deleteBuffer(l))}const f=this.convertAndCacheOnCPU(t,h),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(f)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&lr().removeDataId(t,this),this.pendingDeletes--),f}readToGPU(t,n={}){const s=this.texData.get(t),{values:r,shape:o,slice:i,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let d;c?d=new $o(o,xo):d=new gr(o,xo);const p=this.runWebGLProgram(d,[{dataId:t,shape:o,dtype:a}],a),g=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),g}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(t,n.customTexShape),h=lr().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const s=n.map(r=>Ro(r));return Ot(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const s=t[n];if(!sj(s))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:s,isPacked:r}=this.texData.get(t),o=K(n);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(t),d=this.texData.get(f.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...Xh(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),p}const i=X().getBool("WEBGL_PACK")&&r===!0,a=i?Yh(n):n,c=i?new yK(a):new bK(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:t}],"float32"),u=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,t();const o=Si(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),i=Si(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(o);a.kernelMs=yO(c),a.getExtraProfileInfo=()=>c.map((l,u)=>({name:i[u],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:_n(),endMs:null}}endTimer(t){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=_n(),t)}async getQueryTime(t){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(t),c=a&&a.origDataId||t,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,o,i)));const u=this.texData.get(t);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=QY){return X().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&K(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){ls("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return jY(t.shape,n)}packedUnaryOp(t,n,s){const r=new $o(t.shape,n),o=this.compileAndRun(r,[t],s);return lr().makeTensorFromTensorInfo(o)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const r=oR(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,c$,t.dtype);const n=new gr(t.shape,c$),s=this.compileAndRun(n,[t]);return lr().makeTensorFromTensorInfo(s)}makeTensorInfo(t,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&cu(s[0])){const o=s.map(i=>No(i));r=this.write(o,t,n)}else r=this.write(s,t,n);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:n}}makeOutput(t,n,s){return lr().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,s),this)}unpackTensor(t){const n=new XY(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new RY(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){const s=[nc(t.shape),...sc(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},o=[nc(n),...sc(n)],i=new cR(o,s),a=!0,c=[s],l=this.runWebGLProgram(i,[r],t.dtype,c,a);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(t,n){const s=this.texData.get(t),{isPacked:r,shape:o,dtype:i}=s;if(n!=null){const f=K(o),d=n[0]*n[1]*4;D(f<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Yh(o);let c;r?c=new xK(a):c=new gK(a);const l=!0,u=[n??Xh(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:t}],i,u,l,n);return{dtype:i,shape:o,dataId:h.dataId}}runWebGLProgram(t,n,s,r,o=!1,i){const a=this.makeTensorInfo(t.outputShape,s),c=this.texData.get(a.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===Vl.DENSE){const x=i??Xh(t.outputShape);c.texShape=x.map(b=>b*2)}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),K(a.shape)===0)return c.values=rn(a.dtype,0),a;const l=[],u=n.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&K(x.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!b.isPacked!=!!t.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),l.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!md(b.shape,x.shape)){const w=x,y=x.shape;x.shape=b.shape,x=this.packedReshape(x,y),l.push(x),b=this.texData.get(x.dataId),w.shape=y}return{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},f=mK(t,u,h),d=this.getAndSaveBinary(f,()=>dK(this.gpgpu,t,u,h)),p=this.activeTimers!=null;let g;p&&(g=this.startTimer()),X().get("ENGINE_COMPILE_ONLY")||pK(this.gpgpu,d,u,h,r),l.forEach(x=>this.disposeIntermediateTensorInfo(x)),p&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));const m=X().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const x=_n();x-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!X().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){const x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(t,n,s,r,o=!1){return s=s||n[0].dtype,this.runWebGLProgram(t,n,s,r,o)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=H(()=>{if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=X().getBool("DEBUG");X().set("DEBUG",!1);const n=this.abs(Nt(1e-8)).dataSync()[0];if(X().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?KY:YY}uploadToGPU(t){const n=this.texData.get(t),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:c}=n;if(i!=null)return;const l=this.activeTimers!=null;let u;l&&(u=_n());let h=n.texShape;if(h==null&&(h=vj(s,c),n.texShape=h),o!=null){const f=Yh(s);let d,p=h[1],g=h[0];const m=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(c||!m)&&([p,g]=Ac(h[0],h[1])),c?d=new vK(f,m):d=new r$(f,m);const x=m?[g,p]:h,b=this.makeTensorInfo(x,r),w=this.texData.get(b.dataId);m?w.usage=hs.PIXELS:w.usage=hs.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,g,o);const y=[[g,p]],$=this.runWebGLProgram(d,[b],r,y,!0),I=this.texData.get($.dataId);n.texShape=I.texShape,n.isPacked=I.isPacked,n.usage=I.usage,X().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(n.texture=I.texture,n.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=_n()-u)}else{const f=this.acquireTexture(h,a,r,c);n.texture=f}}convertAndCacheOnCPU(t,n){const s=this.texData.get(t),{dtype:r}=s;return n!=null&&(s.values=eZ(n,r)),s.values}acquireTexture(t,n,s,r){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,r)}computeBytes(t,n){return t[0]*t[1]*Hf(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(o){throw o}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await YS(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(XE(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:c}=QE(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=s,t.infLoc=r,t.nanLoc=o,t.outShapeLocation=i,t.outShapeStridesLocation=a,t.outTexShapeLocation=c}}createTensorFromGPUData(t,n,s){t.channels=t.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=t,c=lr().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,n,s,o,i,a);return lr().makeTensorFromDataId(l,n,s,c)}}Pm.nextDataId=0;function eZ(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let s=0;s<n.length;++s)n[s]=Math.round(e[s]);return n}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */qI()&&KI("webgl",()=>new Pm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Bi{constructor(t,n,s){this.variableNames=["A","B"],this.outputShape=Et(n,s),this.enableShapeUniforms=ln(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Lc{constructor(t,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Et(n,s);const o=this.outputShape.length;this.enableShapeUniforms=ln(o);let i="";if(r)if(o===0||K(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Qt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=bn("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(e){const{inputs:t,backend:n}=e,{x:s}=t;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const nZ={kernelName:Tu,backendName:"webgl",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zo(e){const{inputs:t,backend:n}=e,{real:s,imag:r}=t,o=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(o.dataId),a=rs({inputs:{x:s},backend:n}),c=rs({inputs:{x:r},backend:n});return i.complexTensorInfos={real:a,imag:c},o}const sZ={kernelName:Ux,backendName:"webgl",kernelFunc:Zo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lR="return (a < 0.) ? b * a : a;",uR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function rZ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{alpha:o}=s,i=n.makeTensorInfo([],"float32",Go(o,"float32")),a=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(uR,r.shape,i.shape):new Bi(lR,r.shape,i.shape),c=n.runWebGLProgram(a,[r,i],"float32");return n.disposeIntermediateTensorInfo(i),c}const oZ={kernelName:Dp,backendName:"webgl",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hR="return (a < 0.) ? b * a : a;",fR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function iZ(e){const{inputs:t,backend:n}=e,{x:s,alpha:r}=t,o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(fR,s.shape,r.shape):new Bi(hR,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],"float32")}const aZ={kernelName:Qp,backendName:"webgl",kernelFunc:iZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pc="if (isnan(x)) return x;";function Ht({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,c=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const h=a.texData.get(i.dataId),f=n(h.values,c);return a.makeTensorInfo(i.shape,c,f)}const l=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let u;return l?u=new $o(i.shape,t):u=new gr(i.shape,e),a.runWebGLProgram(u,[i],c)}}function en({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:c,b:l}=i,u=a;if(s&&c.dtype==="complex64"){const p=u.texData.get(c.dataId),g=u.texData.get(l.dataId),[m,x]=[[p.complexTensorInfos.real,g.complexTensorInfos.real],[p.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(w=>{const[y,v]=w,$={dataId:y.dataId,dtype:y.dtype,shape:c.shape},I={dataId:v.dataId,dtype:v.dtype,shape:l.shape},N=new Bi(e,c.shape,l.shape);return u.runWebGLProgram(N,[$,I],ns(y.dtype,v.dtype))}),b=Zo({inputs:{real:m,imag:x},backend:u});return u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(x),b}const h=o||ns(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||u.shouldExecuteOnCPU([c,l]))&&r!=null){const p=u.texData.get(c.dataId).values,g=u.texData.get(l.dataId).values,m=c.dtype==="string"?Jr(p):p,x=c.dtype==="string"?Jr(g):g,[b,w]=r(c.shape,l.shape,m,x,h),y=u.makeTensorInfo(w,h),v=u.texData.get(y.dataId);return v.values=b,y}const f=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let d;return f?d=new Lc(t,c.shape,l.shape,n):d=new Bi(e,c.shape,l.shape),u.runWebGLProgram(d,[c,l],h)}}function Wl(e,t=!1){if(e==="linear")return t?WY:LY;if(e==="relu")return t?GY:zY;if(e==="elu")return t?UY:PY;if(e==="relu6")return t?HY:BY;if(e==="prelu")return t?fR:hR;if(e==="leakyrelu")return t?uR:lR;if(e==="sigmoid")return t?qY:VY;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dR{constructor(t,n,s,r=!1,o=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ln(this.outputShape.length);const u=r?t[1]:t[2],h=Math.ceil(u/2),f=r?"i * 2, rc.y":"rc.y, i * 2",d=o?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",x="";a&&(c?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:m=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let w="rc.x",y="rc.x";t[0]<n[0]?w=`imod(rc.x, ${t[0]})`:n[0]<t[0]&&(y=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${m}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${y};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${g[0]});
          result += (${p[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class u${constructor(t,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Et(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h$="return a * b;";function fw(e){const{inputs:t,backend:n}=e,{a:s,b:r}=t,o=ns(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),c=n.texData.get(r.dataId),l=new u$(l$.REAL,s.shape,r.shape),u=new u$(l$.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],f=n.runWebGLProgram(l,h,"float32"),d=n.runWebGLProgram(u,h,"float32"),p=Zo({inputs:{real:f,imag:d},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),c=n.texData.get(r.dataId),[l,u]=iY(s.shape,r.shape,a.values,c.values,o),h=n.makeTensorInfo(u,o),f=n.texData.get(h.dataId);return f.values=l,h}let i;return X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Lc(h$,s.shape,r.shape):i=new Bi(h$,s.shape,r.shape),n.runWebGLProgram(i,[s,r],o)}const cZ={kernelName:Pu,backendName:"webgl",kernelFunc:fw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(e,t,n){const s=[nc(e.shape),...sc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[nc(t),...sc(t)],i=new cR(o,s),a=!0,c=[s],l=n.runWebGLProgram(i,[r],e.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function it(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{shape:o}=s,i=n,a=K(r.shape),c=iI(o,a),l=K(c);D(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=i.texData.get(r.dataId);return u.isPacked&&!md(r.shape,c)&&!(u.texture!==null&&md(u.shape,c))?lZ(r,c,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const uZ={kernelName:tm,backendName:"webgl",kernelFunc:it};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f${constructor(t,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=t;this.outputShape=[r,i];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(n!=null){const h=1/n;l=`sumValue += dot(values * ${Ha(h)?h.toPrecision(2):h}, ones);`}let u="";o%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hZ{constructor(t,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=t;this.outputShape=[r,i];let a="0.0",c="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",c="min"):n==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const u=Math.floor(s/4)*4,h=s%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(e){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:e[1],s=$m(n);t.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return t}function aa(e,t,n,s){const r=fZ(e.shape);let o=e;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:c,outSize:l}=r[i];let u,h;n==="mean"?u=i===0?new f$({windowSize:c,inSize:a,batchSize:e.shape[0],outSize:l},a):new f$({windowSize:c,inSize:a,batchSize:e.shape[0],outSize:l}):u=new hZ({windowSize:c,inSize:a,batchSize:e.shape[0],outSize:l},n),h=o,o=s.runWebGLProgram(u,[o],t),h.dataId!==e.dataId&&s.disposeIntermediateTensorInfo(h)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dZ{constructor(t,n){this.variableNames=["A"];const s=new Array(t.length);for(let i=0;i<s.length;i++)s[i]=t[n[i]];this.outputShape=s,this.rank=s.length;const r=Qt(this.rank),o=pZ(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function pZ(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let r=0;r<e.length;r++)s[e[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mZ{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let u=0;u<s.length;u++)s[u]=t[n[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Qt(this.rank),o=aR("rc",this.rank),i=new Array(this.rank);for(let u=0;u<n.length;u++)i[n[u]]=o[u];const a=`vec2(${i.slice(-2).join()})`,c=`++${o[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zm(e,t,n){const s=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mZ(e.shape,t):new dZ(e.shape,t);return n.runWebGLProgram(s,[e],e.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(e,t,n,s){const r=t,o=e.shape.length,i=Lt(r,e.shape);let a=i;const c=me(a,o),l=c!=null;let u=e;l&&(u=zm(e,c,s),a=Ne(a.length,o)),tn("sum",a,o);const[h,f]=He(u.shape,a);let d=h;n&&(d=Se(h,i));const p=K(f),m=K(e.shape)/p,x=it({inputs:{x:u},attrs:{shape:[m,p]},backend:s}),b=kb(e.dtype),w=aa(x,b,"sum",s),y=it({inputs:{x:w},attrs:{shape:d},backend:s});return s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(w),l&&s.disposeIntermediateTensorInfo(u),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s;return gZ(r,o,i,n)}const xZ={kernelName:im,backendName:"webgl",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{perm:o}=s,i=n,a=r.shape.length,c=new Array(a);for(let u=0;u<c.length;u++)c[u]=r.shape[o[u]];let l;if(i.shouldExecuteOnCPU([r])){const h=i.texData.get(r.dataId).values,f=uw(h,r.shape,r.dtype,o,c);l=i.makeTensorInfo(c,r.dtype);const d=i.texData.get(l.dataId);d.values=f}else l=zm(r,o,i);return l}const bZ={kernelName:Ma,backendName:"webgl",kernelFunc:$n};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pR=1e3;function gd({a:e,b:t,transposeA:n,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){const l=e.shape.length,u=t.shape.length,h=n?e.shape[l-2]:e.shape[l-1],f=s?t.shape[u-1]:t.shape[u-2],d=n?e.shape[l-1]:e.shape[l-2],p=s?t.shape[u-2]:t.shape[u-1],g=e.shape.slice(0,-2),m=t.shape.slice(0,-2),x=K(g),b=K(m),y=Et(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([d,p]);D(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${s} must match.`);const v=n?[x,h,d]:[x,d,h],$=s?[b,p,f]:[b,f,p],I=it({inputs:{x:e},backend:r,attrs:{shape:v}}),N=it({inputs:{x:t},backend:r,attrs:{shape:$}}),k=[I,N],S=Math.max(x,b),C=n?I.shape[1]:I.shape[2],A=o!=null,R=i!=null,_=c==="leakyrelu",T=c!=null?Wl(c,!0):null,E=A||R||_||T!=null;let M;if((d===1||p===1)&&C>pR&&E===!1){let L=I,B=N;n&&(L=$n({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),k.push(L)),s&&(B=$n({inputs:{x:N},backend:r,attrs:{perm:[0,2,1]}}),k.push(B));const G=p!==1,q=p===1;let Y=L;G&&(Y=it({inputs:{x:L},backend:r,attrs:{shape:[S,C,1]}}),k.push(Y));const tt=p===1?2:1;let J=B;q&&(J=it({inputs:{x:B},backend:r,attrs:{shape:[S,1,C]}}),k.push(J));const st=fw({inputs:{a:Y,b:J},backend:r});M=Bm({inputs:{x:st},backend:r,attrs:{axis:tt,keepDims:!0}}),k.push(st)}else{const L=ns(e.dtype,t.dtype),B=new dR(v,$,[S,d,p],n,s,A,T,R,_),G=[I,N];if(o!=null&&G.push(o),R&&G.push(i),_){const q=r.makeTensorInfo([],"float32",Go(a,"float32"));G.push(q),k.push(q)}M=r.runWebGLProgram(B,G,L)}const O=it({inputs:{x:M},backend:r,attrs:{shape:y}});k.push(M);for(const L of k)r.disposeIntermediateTensorInfo(L);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(e){const{inputs:t,backend:n,attrs:s}=e,{a:r,b:o,bias:i,preluActivationWeights:a}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=s;return gd({a:r,b:o,transposeA:c,transposeB:l,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const wZ={kernelName:qf,backendName:"webgl",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d$="return abs(x);";function vZ(e){const{inputs:t,backend:n}=e,{x:s}=t;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=n.texData.get(s.dataId),i=oR(o.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new $o(s.shape,d$):r=new gr(s.shape,d$),n.runWebGLProgram(r,[s],s.dtype)}const $Z={kernelName:dp,backendName:"webgl",kernelFunc:vZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CZ=Bs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,kZ=Ht({opSnippet:CZ}),IZ={kernelName:lu,backendName:"webgl",kernelFunc:kZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SZ=Bs+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,NZ=Ht({opSnippet:SZ}),_Z={kernelName:uu,backendName:"webgl",kernelFunc:NZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p$="return a + b;",TZ=en({opSnippet:p$,packedOpSnippet:p$,supportsComplex:!0,cpuKernelImpl:zK}),EZ={kernelName:Ic,backendName:"webgl",kernelFunc:TZ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RZ{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AZ{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rf(e){const{inputs:t,backend:n}=e,s=t;if(s.length===1)return rs({inputs:{x:s[0]},backend:n});if(s.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=Rf({inputs:s.slice(0,c),backend:n}),u=Rf({inputs:s.slice(c),backend:n});return Rf({inputs:[l,u],backend:n})}const r=s.map(c=>c.dtype).reduce((c,l)=>ns(c,l)),o=s.map(c=>c.shape),a=X().getBool("WEBGL_PACK")?new AZ(s[0].shape,o):new RZ(s[0].shape,o);return n.runWebGLProgram(a,s,r)}const DZ={kernelName:Ox,backendName:"webgl",kernelFunc:Rf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const u=me(l,a);let h=r;u!=null&&(h=$n({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Ne(l.length,a)),tn("all",l,a);const[f,d]=He(h.shape,l),p=K(d),g=it({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=aa(g,g.dtype,"all",n);let x;if(i){const b=Se(f,c);x=it({inputs:{x:m},backend:n,attrs:{shape:b}})}else x=it({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),u!=null&&n.disposeIntermediateTensorInfo(h),x}const FZ={kernelName:Lx,backendName:"webgl",kernelFunc:MZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const u=me(l,a);let h=r;u!=null&&(h=$n({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Ne(l.length,a)),tn("any",l,a);const[f,d]=He(h.shape,l),p=K(d),g=it({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=aa(g,g.dtype,"any",n);let x;if(i){const b=Se(f,c);x=it({inputs:{x:m},backend:n,attrs:{shape:b}})}else x=it({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),u!=null&&n.disposeIntermediateTensorInfo(h),x}const LZ={kernelName:Px,backendName:"webgl",kernelFunc:OZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PZ{constructor(t,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=n==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zZ{constructor(t,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=t[t.length-1],i=Math.ceil(o/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=Qt(c),u=bn("coords",c);let h,f;if(i===1){f=c+1;const N=Qt(f);h=`
        ${N} sourceLocR = ${N}(${u.join()}, 0);
        ++${u[c-1]};
        ${N} sourceLocG = ${N}(${u.join()}, 0);
        ++${u[c-2]};
        ${N} sourceLocA = ${N}(${u.join()}, 0);
        --${u[c-1]};
        ${N} sourceLocB = ${N}(${u.join()}, 0);
        --${u[c-2]};`}else f=c,h=`
        ${l} sourceLocR = coords;
        ++${u[c-1]};
        ${l} sourceLocG = coords;
        ++${u[c-2]};
        ${l} sourceLocA = coords;
        --${u[c-1]};
        ${l} sourceLocB = coords;
        --${u[c-2]};`;const d=["x","y","z","w","u","v"].slice(0,f),p="."+d[f-1],g=d.map(N=>"int "+N),m=bn("sourceLocR",f-1).concat("inIdx.r"),x=bn("sourceLocG",f-1).concat("inIdx.g"),b=bn("sourceLocB",f-1).concat("inIdx.b"),w=bn("sourceLocA",f-1).concat("inIdx.a"),y=s==="max"?"greaterThan":"lessThan",v=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()})));`,$=`vec4(
            getAChannel(${m.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,I=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${u[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${u[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${v}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${y}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(e,t,n,s=null){let r=t.shape[0],o=t.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=$m(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},c=new PZ(a,n,s==null),l=[t];s!=null&&l.push(s);const u=e.runWebGLProgram(c,l,"int32");if(u.shape[1]===1)return u;const h=mR(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function gR(e,t,n,s=null){const r=s!=null?s.shape:t.shape,o=r[r.length-1],i=$m(o),a=new zZ(r,i,n,s==null),c=s==null?[t]:[t,s],l=e.runWebGLProgram(a,c,"int32");if(l.shape.length===t.shape.length){const u=gR(e,t,n,l);return e.disposeIntermediateTensorInfo(l),u}return l}function xR(e,t,n,s){const r=[n];if(tn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,t.shape.length),!X().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const o=[],i=e.texData.get(t.dataId),a=i!==null&&i.isPacked;let c=t;a&&(c=e.unpackTensor(t),o.push(c));const[l,u]=He(c.shape,r),h=K(u),f=it({inputs:{x:c},backend:e,attrs:{shape:[-1,h]}});o.push(f);const d=mR(e,f,s);o.push(d);const p=it({inputs:{x:d},backend:e,attrs:{shape:l}});return o.forEach(g=>e.disposeIntermediateTensorInfo(g)),p}return gR(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o}=s;let i=Lt(o,r.shape);const a=me(i,r.shape.length);let c=r;const l=[];a!=null&&(c=$n({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),i=Ne(i.length,c.shape.length)),tn("argMax",[i[0]],c.shape.length);const u=xR(n,c,i[0],"max");return l.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const VZ={kernelName:pp,backendName:"webgl",kernelFunc:BZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o}=s;let i=Lt(o,r.shape);const a=me(i,r.shape.length);let c=r;const l=[];a!=null&&(c=$n({inputs:{x:r},backend:n,attrs:{perm:a}}),l.push(c),i=Ne(i.length,c.shape.length)),tn("argMin",[i[0]],c.shape.length);const u=xR(n,c,i[0],"min");return l.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}const UZ={kernelName:mp,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GZ=Bs+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,HZ=Ht({opSnippet:GZ}),qZ={kernelName:hu,backendName:"webgl",kernelFunc:HZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XZ=Bs+"return log(x + sqrt(x * x + 1.0));",jZ=Ht({opSnippet:XZ}),KZ={kernelName:fu,backendName:"webgl",kernelFunc:jZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YZ=Bs+`
  return atan(x);
`,ZZ=Ht({opSnippet:YZ}),QZ={kernelName:du,backendName:"webgl",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ=hw+`
  return atan(a, b);
`,tQ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ia+`
  return result;
`,eQ=en({opSnippet:JZ,packedOpSnippet:tQ}),nQ={kernelName:mu,backendName:"webgl",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sQ=Bs+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,rQ=Ht({opSnippet:sQ}),oQ={kernelName:pu,backendName:"webgl",kernelFunc:rQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ul{constructor(t,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,a=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const g=n==="avg",m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,x=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?m:x:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let y=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(y="avgValue / max(count, 1.0)");const v=Math.floor(i/4)*4,$=i%4,I=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${v}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${v};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${y});
      }
    `}}class dw{constructor(t,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=t.filterWidth,a=t.strideDepth,c=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,g=t.effectiveFilterWidth,m=t.padInfo.front,x=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const w=n==="avg";let y="0.0";if(w||(y="-1.0 / 1e-20"),s){const S=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${m}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${S} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let $=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&($="avgValue / max(count, 1.0)");const I=Math.floor(i/4)*4,N=i%4,k=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${m}, ${x}, ${b});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${k}
            }

            int xC = xCCorner + ${I};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${k}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t;vh(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;D(an(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const u=Ps(r.shape,o,i,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&Xt(u.inShape,u.outShape))return rs({inputs:{x:r},backend:n});const h=new Ul(u,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const aQ={kernelName:gp,backendName:"webgl",kernelFunc:iQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s,u=[1,1,1],h=ro(r.shape,o,i,u,a,c,l),f=new dw(h,"avg",!1);return n.runWebGLProgram(f,[r],"float32")}const lQ={kernelName:xp,backendName:"webgl",kernelFunc:cQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uQ{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,u=c-1-t.padInfo.top,h=l-1-t.padInfo.left,f=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class hQ{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,s=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterDepth,f=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=h-1-t.padInfo.front,g=f-1-t.padInfo.top,m=d-1-t.padInfo.left,x=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${g}, ${m});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=s,h=[1,1,1],f=ro(i.shape,a,c,h,l,u),d=new hQ(f);return n.runWebGLProgram(d,[r],i.dtype)}const dQ={kernelName:Bx,backendName:"webgl",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,i=o;vh([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,u=Ps(i.shape,a,c,1,l),h=new uQ(u);return n.runWebGLProgram(h,[r],i.dtype)}const mQ={kernelName:zx,backendName:"webgl",kernelFunc:pQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(e){const{inputs:t,backend:n,attrs:s}=e,{a:r,b:o}=t,{transposeA:i,transposeB:a}=s;return gd({a:r,b:o,transposeA:i,transposeB:a,backend:n})}const xQ={kernelName:bp,backendName:"webgl",kernelFunc:gQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bQ{constructor(t,n,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Et(t,n),Et(t,s);let a="0.0";r!=null&&(Et(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";o!=null&&(Et(t,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yQ{constructor(t,n,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Et(t,n),Et(t,s);let a="vec4(0.0)";r!=null&&(Et(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";o!=null&&(Et(t,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ=({inputs:e,backend:t,attrs:n})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=e;D(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=n;c==null&&(c=.001);const l=[s,r,o];let u=null;i!=null&&(u=i.shape,l.push(i));let h=null;a!=null&&(h=a.shape,l.push(a));const f=X().getBool("WEBGL_PACK_NORMALIZATION")?new yQ(s.shape,r.shape,o.shape,u,h,c):new bQ(s.shape,r.shape,o.shape,u,h,c);return t.runWebGLProgram(f,l,l[0].dtype)},vQ={kernelName:Ep,backendName:"webgl",kernelFunc:wQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Q{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=Qt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=CQ(this.rank);let r;const o=t.map((i,a)=>`sourceLoc.${k1[a]} = start[${a}] + coords.${k1[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const k1=["x","y","z","w","u","v"];function CQ(e){if(e===1)return"sourceLoc";if(e<=6)return k1.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kQ{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Qt(this.rank),s=bn("coords",this.rank),r=bn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((u,h)=>`start[${h}]`).join()});`:t.map((u,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(e,t,n,s){const r=s.texData.get(e.dataId),o=s.makeTensorInfo(n,e.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=n,i.dtype=e.dtype;let a=ay(t,vt(e.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||e.dataId};const c=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,c+1),o}function zc(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{begin:o,size:i}=s,[a,c]=vm(r,o,i);if(ry(r,a,c),K(c)===0)return n.makeTensorInfo(c,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),f=xY(h.values,a,c,r.shape,r.dtype);return n.makeTensorInfo(c,r.dtype,f)}const{isPacked:l}=n.texData.get(r.dataId),u=iy(r.shape,a,c);if(l||!u){const h=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kQ(c):new $Q(c),f=[a];return n.runWebGLProgram(h,[r],r.dtype,f)}return n.uploadToGPU(r.dataId),IQ(r,a,c,n)}const SQ={kernelName:om,backendName:"webgl",kernelFunc:zc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NQ=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockShape:o,crops:i}=s;D(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,w)=>b*w),c=ch(r.shape,o,a),l=lh(c.length,o.length),u=uh(r.shape,o,a),h=fy(i,o.length),f=dy(u,i,o.length),d=[],p=it({inputs:{x:r},backend:n,attrs:{shape:c}}),g=$n({inputs:{x:p},backend:n,attrs:{perm:l}}),m=it({inputs:{x:g},backend:n,attrs:{shape:u}}),x=zc({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(g),d.push(m),d.forEach(b=>n.disposeIntermediateTensorInfo(b)),x},_Q={kernelName:yp,backendName:"webgl",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,weights:o}=t,{size:i}=s,a=n.readSync(r.dataId),c=n.readSync(o.dataId),l=rR(a,c,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,l)}const EQ={kernelName:Vx,backendName:"webgl",kernelFunc:TQ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,AQ=`
  return float(int(a.r) & int(b.r));
`;function DQ(e){const{inputs:t,backend:n}=e,{a:s,b:r}=t,o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=X().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||i===1){const c=n.texData.get(s.dataId).values,l=n.texData.get(r.dataId).values,[u,h]=VK(s.shape,r.shape,c,l,s.dtype),f=n.makeTensorInfo(h,s.dtype),d=n.texData.get(f.dataId);return d.values=u,f}let a;return o?a=new Lc(RQ,s.shape,r.shape,!1):a=new Bi(AQ,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const MQ={kernelName:Wx,backendName:"webgl",kernelFunc:DQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(e){const{inputs:t,backend:n}=e,{s0:s,s1:r}=t,o=n.readSync(s.dataId),i=n.readSync(r.dataId),a=Et(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const OQ={kernelName:fI,backendName:"webgl",kernelFunc:FQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ="return float(a != b);",bR=en({opSnippet:LQ,cpuKernelImpl:cY,dtype:"bool"}),PQ={kernelName:Xp,backendName:"webgl",kernelFunc:bR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ch(e){const{inputs:t,backend:n}=e,{input:s}=t,r=n.texData.get(s.dataId);return rs({inputs:{x:r.complexTensorInfos.real},backend:n})}const zQ={kernelName:pb,backendName:"webgl",kernelFunc:Ch};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ="return float(int(x));";function VQ(e,t){const n=new gr(e.shape,BQ),s=t.runWebGLProgram(n,[e],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return rs({inputs:{x:r},backend:n});const i=Re(r.shape),a=I1({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),c=Zo({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const i=Ch({inputs:{input:r},backend:n}),a=I1({inputs:{x:i},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(i),a}if(!aI(r.dtype,o)){const i=rs({inputs:{x:r},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(n.shouldExecuteOnCPU([r])){const i=n.texData.get(r.dataId).values,[a,c,l]=WK(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,c,l)}if(o==="int32")return VQ(r,n);if(o==="bool"){const i=n.makeTensorInfo([],"bool",rn("bool",1)),c=bR({inputs:{a:r,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const WQ={kernelName:gu,backendName:"webgl",kernelFunc:I1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$="return ceil(x);",UQ=Ht({opSnippet:m$,packedOpSnippet:m$,cpuKernelImpl:UK}),GQ={kernelName:xu,backendName:"webgl",kernelFunc:UQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HQ{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qQ{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{clipValueMin:o,clipValueMax:i}=s;let a;X().getBool("WEBGL_PACK_CLIP")?a=new qQ(r.shape):a=new HQ(r.shape);const c=[[o],[i]];return n.runWebGLProgram(a,[r],r.dtype,c)}const jQ={kernelName:bu,backendName:"webgl",kernelFunc:XQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KQ{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g$(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function YQ(e){const{inputs:t,backend:n}=e,{x:s}=t,r=n.texData.get(s.dataId),o=new KQ(s.shape),i=[g$(s,r.complexTensorInfos.real),g$(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}const ZQ={kernelName:wp,backendName:"webgl",kernelFunc:YQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QQ{constructor(t){this.outputShape=[],this.outputShape=vr(t,1),this.variableNames=t.map((i,a)=>`T${a}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+t[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=n.length,o=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JQ{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vr(t,n);const s=this.outputShape,r=s.length,o=Qt(r),i=bn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((g,m)=>`T${m}`);const c=new Array(t.length-1);c[0]=t[0][n];for(let g=1;g<c.length;g++)c[g]=c[g-1]+t[g][n];const l=a[n],u=a.slice(-2),h=a.join();let f=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let g=1;g<c.length;g++){const m=c[g-1];f+=`
        if (${l} < ${c[g]}  && ${l} >= ${c[g-1]}) {
          return getChannel(
            getT${g}(${Jh(a,l,m)}),
            vec2(${Jh(u,l,m)}));
        }`}const d=c.length,p=c[c.length-1];f+=`
        return getChannel(
          getT${d}(${Jh(a,l,p)}),
          vec2(${Jh(u,l,p)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Jh(e,t,n){const s=e.indexOf(t);return e.map((o,i)=>i===s?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vm(e){const{inputs:t,backend:n}=e,{input:s}=t,r=n.texData.get(s.dataId);return rs({inputs:{x:r.complexTensorInfos.imag},backend:n})}const tJ={kernelName:ob,backendName:"webgl",kernelFunc:Vm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ll(e,t,n){const s=e[0].dtype;if(s==="complex64"){const d=e.map(b=>Ch({inputs:{input:b},backend:n})),p=e.map(b=>Vm({inputs:{input:b},backend:n})),g=ll(d,t,n),m=ll(p,t,n),x=Zo({inputs:{real:g,imag:m},backend:n});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),x}let r=n.shouldExecuteOnCPU(e);if(s==="string"&&(r=!0),r){const d=e.map(y=>{const $=[-1,K(y.shape.slice(t))];return it({inputs:{x:y},backend:n,attrs:{shape:$}})}),p=d.map(y=>({vals:n.readSync(y.dataId),shape:y.shape})),g=vr(d.map(y=>y.shape),1),m=d[0].shape[0]===1,x=GK(p,g,s,m),b=vr(e.map(y=>y.shape),t),w=n.makeTensorInfo(b,s,x);return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),w}const o=e.filter(d=>K(d.shape)>0),i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const d=i?new gr(e[0].shape,xo):new $o(e[0].shape,xo);return n.runWebGLProgram(d,e,s)}const a=X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const d=[];for(let g=0;g<o.length;g+=a){const m=o.slice(g,g+a);d.push(ll(m,t,n))}const p=ll(d,t,n);for(const g of d)n.disposeIntermediateTensorInfo(g);return p}if(i){const d=new JQ(o.map(p=>p.shape),t);return n.runWebGLProgram(d,o,s)}const{tensors2D:c,outShape:l}=eJ(o,t,n),u=new QQ(c.map(d=>d.shape)),h=n.runWebGLProgram(u,c,s);c.forEach(d=>n.disposeIntermediateTensorInfo(d));const f=it({inputs:{x:h},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(h),f}function eJ(e,t,n){const s=vr(e.map(o=>o.shape),t);return{tensors2D:e.map(o=>it({inputs:{x:o},attrs:{shape:[-1,K(o.shape.slice(t))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(e){const{inputs:t,backend:n,attrs:s}=e,{axis:r}=s,o=Lt(r,t[0].shape)[0],i=t.map(l=>l.shape);ly(i,o);const a=vr(t.map(l=>l.shape),o);if(K(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const c=t.filter(l=>K(l.shape)>0);return c.length===1?rs({inputs:{x:c[0]},backend:n}):ll(c,o,n)}const nJ={kernelName:vp,backendName:"webgl",kernelFunc:yR};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wR{constructor(t,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const i=t.padInfo.top,a=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,u=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4,m=t.dataFormat==="channelsLast",x=m?1:2,b=m?2:3,w=m?3:1;let y="",v="";s&&(r?y=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?y=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:y=`
          float activation(float x) {
            ${s}
          }
        `,v="result = activation(result);");const $=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${m}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${m}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${m}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${m}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${v}
        setOutput(result);
      }
    `}}class sJ{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,s=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vR{constructor(t,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ln(this.outputShape.length);const i=t.padInfo.left,a=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,u=t.filterWidth,h=u;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<u;m++)f+=`
           vec4 xTexelC${m*2};
           int xTexelC${m*2}Ready;
           vec4 xTexelC${m*2+1};
           int xTexelC${m*2+1}Ready;
           vec4 xC${m};`;f+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let m=0;m<u;m++)f+=`
           xTexelC${m*2} = vec4(0.0);
           xTexelC${m*2}Ready = 0;
           xTexelC${m*2+1} = vec4(0.0);
           xTexelC${m*2+1}Ready = 0;
           xC${m} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let m=0;m<(h+1)/2;m++){const x=m*2;if(f+=`
           xC = xCCorner + ${x*c};
           `,a===1){if(x<u&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,c===1&&x>0?f+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<u)){const b=i%2===0?Ax(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,c>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:f+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):b===1?f+=`
                     xC${x+1} = xTexelC${x};
                     `:f+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<u&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<u&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<u&&(f+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<u&&(f+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<u&&(f+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let d="",p="";s&&(r?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:d=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rJ{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=ln(this.outputShape.length);const{dataFormat:s}=n,r=Cn(),o=s==="channelsLast",i=o?1:2,a=o?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xd(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function $R({x:e,filter:t,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const c=e.shape,l=s.texData.get(e.dataId),u=n.inChannels,h=c[0]*c[1]*c[2],f=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,g=!1;let m;const x=[];if(o!=null){const y=xd(o.shape,d);y!=null&&(o=it({inputs:{x:o},backend:s,attrs:{shape:y}}),x.push(o))}if(r!=null){const y=xd(r.shape,d);y!=null&&(r=it({inputs:{x:r},backend:s,attrs:{shape:y}}),x.push(r))}if(!((h===1||f===1)&&u>pR)&&l.isPacked&&d&&l.texture!=null&&c[2]%2!==0&&Xt(l.shape.slice(-3),c.slice(-3))){const y=c[0]*c[1]*(c[2]+1),v={dataId:e.dataId,shape:[1,y,n.inChannels],dtype:e.dtype},$=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,D(md(l.shape,v.shape),()=>`packed reshape ${l.shape} to ${v.shape} isn't free`);const I=it({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});x.push(I);const N=gd({a:v,b:I,backend:s,transposeA:p,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),k=s.texData.get(N.dataId);D(k.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=$,k.shape=n.outShape,m=rs({inputs:{x:N},backend:s}),m.shape=n.outShape,x.push(N)}else{const y=n.outHeight*n.outWidth,v=it({inputs:{x:e},backend:s,attrs:{shape:d?[n.batchSize,y,n.inChannels]:[n.batchSize,n.inChannels,y]}}),$=it({inputs:{x:t},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),I=gd({a:d?v:$,b:d?$:v,transposeA:!d,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});m=it({inputs:{x:I},backend:s,attrs:{shape:n.outShape}}),x.push(v),x.push($),x.push(I)}for(const y of x)s.disposeIntermediateTensorInfo(y);return m}function CR({x:e,filter:t,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:u,outWidth:h,outHeight:f,dataFormat:d}=n,p=d==="channelsLast",g=c*l*u,m=f*h,x=[n.batchSize,g,m],b=!0,w=!1,y=[];if(o!=null){const O=xd(o.shape,p);O!=null&&(o=it({inputs:{x:o},backend:s,attrs:{shape:O}}),y.push(o))}if(r!=null){const O=xd(r.shape,p);O!=null&&(r=it({inputs:{x:r},backend:s,attrs:{shape:O}}),y.push(r))}const v=it({inputs:{x:t},backend:s,attrs:{shape:[1,g,K(t.shape)/g]}});y.push(v);const $=new rJ(x,n),I=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],N=s.runWebGLProgram($,[e],"float32",I),k=it({inputs:{x:N},backend:s,attrs:{shape:x}});y.push(N),y.push(k);const S=r!=null,C=o!=null,A=a==="leakyrelu",R=a?Wl(a,!0):null,_=new dR(p?k.shape:v.shape,p?v.shape:k.shape,p?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],b,w,S,R,C,A),T=p?[k,v]:[v,k];if(r&&T.push(r),C&&T.push(o),A){const O=s.makeTensorInfo([],"float32",Go(i,"float32"));T.push(O),y.push(O)}const E=s.runWebGLProgram(_,T,"float32"),M=it({inputs:{x:E},backend:s,attrs:{shape:n.outShape}});y.push(E);for(const O of y)s.disposeIntermediateTensorInfo(O);return M}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=s,h=oo(c),f=Je(r.shape,o.shape,i,l,a,u,!1,h);let d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=$R({x:r,filter:o,convInfo:f,backend:n});else if(f.strideWidth<=2&&h==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const g=new vR(f),m=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];d=n.runWebGLProgram(g,[r,o],"float32",m)}else if(X().getBool("WEBGL_CONV_IM2COL"))d=CR({x:r,filter:o,convInfo:f,backend:n});else{const g=new wR(f);d=n.runWebGLProgram(g,[r,o],"float32")}const p=it({inputs:{x:d},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(d),p}const iJ={kernelName:$p,backendName:"webgl",kernelFunc:oJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aJ{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class cJ{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dataFormat==="channelsLast",a=n-1-t.padInfo.top,c=s-1-t.padInfo.left,l=i?1:2,u=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lJ{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,s=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class uJ{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,s=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,c=n-1-t.padInfo.front,l=s-1-t.padInfo.top,u=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=s,h=oo(c),f=Je(r.shape,u,i,1,a,l,!1,h),d=new aJ(f);return n.runWebGLProgram(d,[r,o],"float32")}const fJ={kernelName:Gx,backendName:"webgl",kernelFunc:hJ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dJ{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=ln(this.outputShape.length);const n=t.filterHeight,s=t.filterWidth,r=n-1-t.padInfo.top,o=s-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pJ(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=s,h=oo(l),f=Je(i,o.shape,a,1,c,u,!1,h);if(X().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const d=[[f.strideHeight,f.strideWidth]],p=new dJ(f);return n.runWebGLProgram(p,[r,o],"float32",d)}else{const d=new cJ(f);return n.runWebGLProgram(d,[r,o],"float32")}}const mJ={kernelName:Cp,backendName:"webgl",kernelFunc:pJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dilations:c}=s,l=Ho(r.shape,o.shape,i,c,a),u=new sJ(l);return n.runWebGLProgram(u,[r,o],"float32")}const xJ={kernelName:kp,backendName:"webgl",kernelFunc:gJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,pad:a,filterShape:c}=s,l=Ho(r.shape,c,i,1,a),u=new lJ(l);return n.runWebGLProgram(u,[r,o],"float32")}const yJ={kernelName:Hx,backendName:"webgl",kernelFunc:bJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wJ(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{pad:i,strides:a,inputShape:c}=s,l=Ho(c,o.shape,a,1,i),u=new uJ(l);return n.runWebGLProgram(u,[r,o],"float32")}const vJ={kernelName:qx,backendName:"webgl",kernelFunc:wJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=Pc+`
  return cos(x);
`,CJ=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ia}
  return result;
`,kJ=Ht({opSnippet:$J,packedOpSnippet:CJ}),IJ={kernelName:yu,backendName:"webgl",kernelFunc:kJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,NJ=Ht({opSnippet:SJ}),_J={kernelName:wu,backendName:"webgl",kernelFunc:NJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TJ{constructor(t,n,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,c,l]=t,[u]=n,[h,f]=s;this.outputShape=[u,h,f,l];const d=r==="bilinear"?1:0,[p,g]=[`${a-1}.0`,`${c-1}.0`],[m,x,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[w,y,v]=f>1?[`${(c-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${m});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${y};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${v};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=e=>{const{inputs:t,backend:n,attrs:s}=e,{image:r,boxes:o,boxInd:i}=t,{cropSize:a,method:c,extrapolationValue:l}=s,u=new TJ(r.shape,o.shape,a,c,l);return n.runWebGLProgram(u,[r,o,i],"float32")},RJ={kernelName:jx,backendName:"webgl",kernelFunc:EJ};var Gl;(function(e){e.Prod="*",e.Sum="+"})(Gl||(Gl={}));class x${constructor(t,n,s,r){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===Gl.Prod?"1.0":"0.0",a=s?i:`getX(${b$(o,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",u="";s?(l=r?`end != ${c-1}`:"end != 0",u=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Qt(o)} coords = getOutputCoords();
        int end = ${y$(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${u};
          ${y$(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${b$(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function b$(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function y$(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kR(e,t,n,s,r,o){const i=t.shape.length,a=me([s],i);let c=t;a!=null&&(c=$n({inputs:{x:t},backend:n,attrs:{perm:a}}));const l=Ne(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const u=c.shape[l];let h=rs({inputs:{x:c},backend:n});for(let f=0;f<=Math.ceil(Math.log2(u))-1;f++){const d=new x$(e,c.shape,!1,o),p=[[f]],g=h;h=n.runWebGLProgram(d,[h],h.dtype,p),n.disposeIntermediateTensorInfo(g)}if(r){const f=new x$(e,c.shape,r,o),d=h;h=n.runWebGLProgram(f,[h],h.dtype),n.disposeIntermediateTensorInfo(d)}if(a!=null){const f=qo(a),d=$n({inputs:{x:h},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),d}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;return kR(Gl.Prod,r,n,o,i,a)}const DJ={kernelName:Xx,backendName:"webgl",kernelFunc:AJ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,exclusive:i,reverse:a}=s;return kR(Gl.Sum,r,n,o,i,a)}const FJ={kernelName:Ip,backendName:"webgl",kernelFunc:MJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,weights:o}=t,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=n.readSync(r.dataId),l=n.readSync(o.dataId),u=rR(c,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}else if(r.shape.length===2){const c=n.bufferSync(r),l=n.bufferSync(o),u=BK(c,l,i,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const LJ={kernelName:Kx,backendName:"webgl",kernelFunc:OJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PJ{constructor(t,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockSize:o,dataFormat:i}=s,a=r.shape[0],c=i==="NHWC"?r.shape[1]:r.shape[2],l=i==="NHWC"?r.shape[2]:r.shape[3],u=i==="NHWC"?r.shape[3]:r.shape[1],h=c*o,f=l*o,d=u/(o*o),p=i==="NHWC"?[a,h,f,d]:[a,d,h,f],g=new PJ(p,o,i);return n.runWebGLProgram(g,[r],r.dtype)}const BJ={kernelName:Yx,backendName:"webgl",kernelFunc:zJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IR{constructor(t,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ln(this.outputShape.length);const i=t.filterHeight,a=t.filterWidth,c=t.outChannels/t.inChannels;let l="",u="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SR{constructor(t,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ln(this.outputShape.length);const i=t.outChannels/t.inChannels,a=t.padInfo.left,c=t.strideWidth,l=t.dilationWidth,u=t.filterHeight,h=t.filterWidth,f=h;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<h;x++)d+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;d+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let x=0;x<h;x++)d+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(f+1)/2;x++){const b=x*2;if(d+=`
          xC = xCCorner + ${b*l};
          `,c===1){if(b<h&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?d+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const w=a%2===0?Ax(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:d+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):w===1?d+=`
                    xC${b+1} = xTexelC${b};
                    `:d+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(d+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(d+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",g="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${m}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;let u=c;u==null&&(u=[1,1]),D(an(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Je(r.shape,o.shape,i,u,a,l,!0);let f;X().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new SR(h):f=new IR(h);const d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(f,[r,o],"float32",d)}const WJ={kernelName:Sp,backendName:"webgl",kernelFunc:VJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UJ{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class GJ{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,s=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=n-1-t.padInfo.top,a=s-1-t.padInfo.left,c=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,dy:o}=t,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=s,h=Je(r.shape,u,i,a,c,l,!0),f=new UJ(h);return n.runWebGLProgram(f,[r,o],"float32")}const qJ={kernelName:Zx,backendName:"webgl",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,filter:o}=t,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=s,h=Je(u,o.shape,i,a,c,l,!0),f=new GJ(h);return n.runWebGLProgram(f,[r,o],"float32")}const jJ={kernelName:Qx,backendName:"webgl",kernelFunc:XJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KJ{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YJ(e){const{inputs:t,backend:n}=e,{x:s}=t,r=[...s.shape,...s.shape],o=K(s.shape),i=it({inputs:{x:s},backend:n,attrs:{shape:[o]}}),a=new KJ(o),c=n.runWebGLProgram(a,[i],i.dtype),l=it({inputs:{x:c},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(c),l}const ZJ={kernelName:dI,backendName:"webgl",kernelFunc:YJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QJ{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:u}=t,{top:h,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JJ(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o}=t,{strides:i,pad:a,dilations:c}=s,l=rh(r.shape,o.shape,i,a,"NHWC",c);let u;const h=new QJ(l);u=n.runWebGLProgram(h,[r,o],"float32");const f=it({inputs:{x:u},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(u),f}const ttt={kernelName:Np,backendName:"webgl",kernelFunc:JJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ett(e){const{inputs:t,backend:n,attrs:s}=e,{equation:r}=s,o=t,{allDims:i,summedDims:a,idDims:c}=vy(r,o.length);Cy(i.length,c,o);const{path:l,steps:u}=ky(a,c),h=u.length;let f=null,d=i.length;const p=[];for(let g=0;g<h;++g){for(const m of u[g]){const{permutationIndices:x,expandDims:b}=$y(d,c[m]);let w;Iy(x)?w=o[m]:(w=$n({inputs:{x:o[m]},backend:n,attrs:{perm:x}}),p.push(w));const y=w.shape.slice();for(let v=0;v<b.length;++v)y.splice(b[v],0,1);Xt(w.shape,y)||(w=it({inputs:{x:w},backend:n,attrs:{shape:y}}),p.push(w)),f===null?f=w:(f=fw({inputs:{a:w,b:f},backend:n}),p.push(f))}g<h-1&&(l[g]>=0&&(f=Bm({inputs:{x:f},backend:n,attrs:{axis:l[g]-(i.length-d),keepDims:!1}}),p.push(f)),d--)}for(const g of p)g!==f&&n.disposeIntermediateTensorInfo(g);return f}const ntt={kernelName:Jx,backendName:"webgl",kernelFunc:ett};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const stt="return (x >= 0.0) ? x : (exp(x) - 1.0);",rtt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ott=Ht({opSnippet:stt,packedOpSnippet:rtt}),itt={kernelName:$u,backendName:"webgl",kernelFunc:ott};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const att="return (b >= 0.0) ? a : a * (b + 1.0);",ctt=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,ltt=e=>{const{inputs:t,backend:n}=e,{dy:s,y:r}=t,o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(ctt,s.shape,r.shape):new Bi(att,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],s.dtype)},utt={kernelName:tb,backendName:"webgl",kernelFunc:ltt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const htt=`
  return vec4(equal(a, b));
`,ftt="return float(a == b);",dtt=en({opSnippet:ftt,packedOpSnippet:htt,dtype:"bool",cpuKernelImpl:HK}),ptt={kernelName:_p,backendName:"webgl",kernelFunc:dtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mtt=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${py};
  float a1 = ${my};
  float a2 = ${gy};
  float a3 = ${xy};
  float a4 = ${by};
  float a5 = ${yy};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,gtt=Ht({opSnippet:mtt}),xtt={kernelName:Cu,backendName:"webgl",kernelFunc:gtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const btt=Pc+`
  return exp(x);
`,ytt=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,NR=Ht({opSnippet:btt,packedOpSnippet:ytt,cpuKernelImpl:qK,dtype:"float32"}),wtt={kernelName:ku,backendName:"webgl",kernelFunc:NR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(e){const{inputs:t,attrs:n,backend:s}=e,{dim:r}=n,{input:o}=t,i=o.shape.length,a=o.shape.slice();let c=r;return r<0&&(D(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+r+1),a.splice(c,0,1),it({inputs:{x:o},backend:s,attrs:{shape:a}})}const vtt={kernelName:Tp,backendName:"webgl",kernelFunc:S1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w$="return exp(x) - 1.0;",$tt=Ht({opSnippet:w$,packedOpSnippet:w$,cpuKernelImpl:XK}),Ctt={kernelName:Iu,backendName:"webgl",kernelFunc:$tt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v${constructor(t,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(e,t,n){const s=n.texData.get(e.dataId),r=K(e.shape),o=e.shape[e.shape.length-1],i=r/o,a=it({inputs:{x:e},backend:n,attrs:{shape:[i,o]}}),c=a.shape,l=new v$("real",c,t),u=new v$("imag",c,t),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],f=n.runWebGLProgram(l,h,"float32"),d=n.runWebGLProgram(u,h,"float32"),p=Zo({inputs:{real:f,imag:d},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d);const g=it({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ktt(e){const{inputs:t,backend:n}=e,{input:s}=t;return _R(s,!1,n)}const Itt={kernelName:eb,backendName:"webgl",kernelFunc:ktt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Stt{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kh(e){const{backend:t,attrs:n}=e,{shape:s,value:r}=n;let{dtype:o}=n;if(o=o||Cc(r),o==="string"){const i=ke(o,K(s));return i.fill(r),t.makeTensorInfo(s,o,i)}else{const i=new Stt(s,r),a=[[r]];return t.runWebGLProgram(i,[],o,a)}}const Ntt={kernelName:nb,backendName:"webgl",kernelFunc:kh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _tt{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ttt={kernelName:sb,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,s=t,r=new _tt(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $$="return floor(x);",Ett=Ht({opSnippet:$$,packedOpSnippet:$$,cpuKernelImpl:jK}),Rtt={kernelName:Su,backendName:"webgl",kernelFunc:Ett};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Att=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Dtt=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Mtt=en({opSnippet:Att,packedOpSnippet:Dtt,dtype:"int32"}),Ftt={kernelName:Nu,backendName:"webgl",kernelFunc:Mtt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ott{constructor(t){this.variableNames=["A"];const n=Cn(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ltt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Cn(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ptt={kernelName:MO,backendName:"webgl",kernelFunc:ztt};let ma,r0=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function ztt(e){const{inputs:t,backend:n,attrs:s}=e;let{pixels:r}=t;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[l,c],h=[l,c,o];if(a||i){const g=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ma==null||g!==r0)&&(r0=g,ma=document.createElement("canvas").getContext("2d",{willReadFrequently:r0})),ma.canvas.width=c,ma.canvas.height=l,ma.drawImage(r,0,0,c,l),r=ma.canvas}const f=n.makeTensorInfo(u,"int32");n.texData.get(f.dataId).usage=hs.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),r);const d=X().getBool("WEBGL_PACK")?new Ltt(h):new Ott(h),p=n.runWebGLProgram(d,[f],"int32");return n.disposeData(f.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Btt(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:f,activation:d,leakyreluAlpha:p}=s,g=oo(u),m=Je(r.shape,o.shape,c,h,l,f,!1,g);let x;const b=[],w=i!=null,y=a!=null,v=d==="leakyrelu",$=()=>{const N=[r,o],k=(S,C)=>{if(C==="NCHW"&&S.shape.length===1&&S.shape[0]!==1){const A=it({inputs:{x:S},backend:n,attrs:{shape:[S.shape[0],1,1]}});return b.push(A),A}return S};if(w&&N.push(k(i,u)),y&&N.push(k(a,u)),v){const S=n.makeTensorInfo([],"float32",Go(p,"float32"));N.push(S),b.push(S)}return N};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))x=$R({x:r,filter:o,convInfo:m,backend:n,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(m.strideWidth<=2&&g==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const N=d?Wl(d,!0):null,k=new vR(m,w,N,y,v),S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],C=$();x=n.runWebGLProgram(k,C,"float32",S)}else if(X().getBool("WEBGL_CONV_IM2COL"))x=CR({x:r,filter:o,convInfo:m,backend:n,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const N=d?Wl(d,!1):null,k=new wR(m,w,N,y,v),S=$();x=n.runWebGLProgram(k,S,"float32")}const I=it({inputs:{x},backend:n,attrs:{shape:m.outShape}});return b.push(x),b.forEach(N=>n.disposeIntermediateTensorInfo(N)),I}const Vtt={kernelName:Xf,backendName:"webgl",kernelFunc:Btt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wtt(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,filter:o,bias:i,preluActivationWeights:a}=t,{strides:c,pad:l,dilations:u,dimRoundingMode:h,activation:f,leakyreluAlpha:d}=s,p=[];let g=u;g==null&&(g=[1,1]),D(an(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const m=Je(r.shape,o.shape,c,g,l,h,!0),x=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,b=f?Wl(f,x):null,w=[r,o],y=i!=null,v=a!=null,$=f==="leakyrelu";if(y&&w.push(i),v&&w.push(a),$){const S=n.makeTensorInfo([],"float32",Go(d,"float32"));w.push(S),p.push(S)}let I;x?I=new SR(m,y,b,v,$):I=new IR(m,y,b,v,$);const N=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],k=n.runWebGLProgram(I,w,"float32",N);return p.forEach(S=>n.disposeIntermediateTensorInfo(S)),k}const Utt={kernelName:RI,backendName:"webgl",kernelFunc:Wtt};class Gtt{constructor(t,n,s,r){this.sliceDim=t,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=Qt(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Htt(e){const{inputs:t,backend:n}=e,{params:s,indices:r}=t,o=r.shape,i=o[o.length-1],a=K(s.shape),[c,l,u,h]=sy(s,r),f=it({inputs:{x:r},backend:n,attrs:{shape:[l,i]}}),d=it({inputs:{x:s},backend:n,attrs:{shape:[K(s.shape)/u,u]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const x=n.readSync(r.dataId),b=n.bufferSync(s),w=KK(x,b,s.dtype,l,i,u,h,s.shape,a);return n.makeTensorInfo(c,s.dtype,w.values)}const p=new Gtt(i,h,[l,u],s.shape),g=n.runWebGLProgram(p,[d,f],d.dtype),m=it({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),m}const qtt={kernelName:pI,backendName:"webgl",kernelFunc:Htt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xtt{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Qt(this.rank),r=jtt(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function jtt(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<e.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TR(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,indices:o}=t,{axis:i,batchDims:a}=s,c=Lt(i,r.shape)[0];if(X().get("DEBUG")){const b=n.readSync(o.dataId),w=r.shape[c];for(let y=0;y<b.length;++y){const v=b[y];D(v<=w-1&&v>=0,()=>`GatherV2: the index value ${v} is not in [0, ${w-1}]`)}}const l=Ny(r,o,c,a),u=K(o.shape),h=[],f=it({inputs:{x:r},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),d=it({inputs:{x:o},backend:n,attrs:{shape:[l.batchSize,u/l.batchSize]}});h.push(f),h.push(d);const p=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=n.bufferSync(d),w=n.bufferSync(f),y=YK(w,b,p);return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(l.outputShape,y.dtype,y.values)}const g=new Xtt(f.shape,p),m=n.runWebGLProgram(g,[f,d],f.dtype);h.push(m);const x=it({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return h.forEach(b=>n.disposeIntermediateTensorInfo(b)),x}const Ktt={kernelName:Rp,backendName:"webgl",kernelFunc:TR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ytt="return float(a > b);",Ztt=`
  return vec4(greaterThan(a, b));
`,Qtt=en({opSnippet:Ytt,packedOpSnippet:Ztt,cpuKernelImpl:ZK,dtype:"bool"}),Jtt={kernelName:Ap,backendName:"webgl",kernelFunc:Qtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tet="return float(a >= b);",eet=`
  return vec4(greaterThanEqual(a, b));
`,net=en({opSnippet:tet,packedOpSnippet:eet,dtype:"bool",cpuKernelImpl:QK}),set={kernelName:_u,backendName:"webgl",kernelFunc:net};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ret(e){const{inputs:t,backend:n}=e,{input:s}=t;return _R(s,!0,n)}const oet={kernelName:rb,backendName:"webgl",kernelFunc:ret};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iet="return float(!isnan(x) && !isinf(x));",aet=Ht({opSnippet:iet,dtype:"bool"}),cet={kernelName:Eu,backendName:"webgl",kernelFunc:aet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uet="return float(isinf(x));",het=Ht({opSnippet:uet,dtype:"bool"}),fet={kernelName:Ru,backendName:"webgl",kernelFunc:het};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const det="return float(isnan(x));",pet=Ht({opSnippet:det,dtype:"bool"}),met={kernelName:Au,backendName:"webgl",kernelFunc:pet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const get="return float(a < b);",xet=`
  return vec4(lessThan(a, b));
`,bet=en({opSnippet:get,packedOpSnippet:xet,cpuKernelImpl:JK,dtype:"bool"}),yet={kernelName:Mp,backendName:"webgl",kernelFunc:bet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wet="return float(a <= b);",vet=`
  return vec4(lessThanEqual(a, b));
`,$et=en({opSnippet:wet,packedOpSnippet:vet,cpuKernelImpl:tY,dtype:"bool"}),Cet={kernelName:Fp,backendName:"webgl",kernelFunc:$et};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ket(e){const{backend:t,attrs:n}=e,{start:s,stop:r,num:o}=n,i=eY(s,r,o);return t.makeTensorInfo([i.length],"float32",i)}const Iet={kernelName:ib,backendName:"webgl",kernelFunc:ket};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Net=Pc+`
  return x < 0.0 ? 0./0. : log(x);
`,_et=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Tet=Ht({opSnippet:Net,packedOpSnippet:_et,cpuKernelImpl:nY}),Eet={kernelName:Du,backendName:"webgl",kernelFunc:Tet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ret=Pc+`
  return log(1.0 + x);
`,Aet=Ht({opSnippet:Ret}),Det={kernelName:Mu,backendName:"webgl",kernelFunc:Aet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Met="return float(a >= 1.0 && b >= 1.0);",Fet=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Oet=en({opSnippet:Met,packedOpSnippet:Fet,dtype:"bool"}),Let={kernelName:Op,backendName:"webgl",kernelFunc:Oet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pet="return float(!(x >= 1.0));",zet=Ht({opSnippet:Pet}),Bet={kernelName:Lp,backendName:"webgl",kernelFunc:zet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vet="return float(a >= 1.0 || b >= 1.0);",Wet=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Uet=en({opSnippet:Vet,packedOpSnippet:Wet,dtype:"bool"}),Get={kernelName:Pp,backendName:"webgl",kernelFunc:Uet};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Het{constructor(t,n,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=n,a=t[3]-1;this.outputShape=t;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qet{constructor(t,n,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=t[3]-1;this.outputShape=t;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xet=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{depthRadius:o,bias:i,alpha:a,beta:c}=s,l=X().getBool("WEBGL_PACK_NORMALIZATION")?new qet(r.shape,o,i,a,c):new Het(r.shape,o,i,a,c);return n.runWebGLProgram(l,[r],r.dtype)},jet={kernelName:zp,backendName:"webgl",kernelFunc:Xet};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ket{constructor(t,n,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yet=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:r,y:o,dy:i}=t,{depthRadius:a,bias:c,alpha:l,beta:u}=s,h=new Ket(r.shape,a,c,l,u);return n.runWebGLProgram(h,[r,o,i],r.dtype)},Zet={kernelName:ab,backendName:"webgl",kernelFunc:Yet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qet(e,t,n,s){const r=K(t),i=K(e.shape)/r,a=it({inputs:{x:e},attrs:{shape:[i,r]},backend:s}),c=aa(a,e.dtype,"max",s),l=it({inputs:{x:c},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const u=me(l,a),h=u!=null,f=n.shouldExecuteOnCPU([r]);let d=r;if(h){if(f){const w=n.texData.get(d.dataId).values,y=new Array(a);for(let I=0;I<y.length;I++)y[I]=r.shape[u[I]];const v=uw(w,r.shape,r.dtype,u,y);d=n.makeTensorInfo(y,r.dtype);const $=n.texData.get(d.dataId);$.values=v}else d=zm(r,u,n);l=Ne(l.length,a)}tn("max",l,a);const[p,g]=He(d.shape,l);let m=p;i&&(m=Se(p,c));let x;if(f){const w=n.texData.get(d.dataId).values,y=sY(w,K(g),m,r.dtype);x=n.makeTensorInfo(m,r.dtype);const v=n.texData.get(x.dataId);v.values=y}else x=Qet(d,g,m,n);return h&&n.disposeIntermediateTensorInfo(d),x}const Jet={kernelName:Bp,backendName:"webgl",kernelFunc:ER};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tnt=hw+`
  return max(a, b);
`,ent=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ia+`
  return result;
`,nnt=en({opSnippet:tnt,packedOpSnippet:ent,cpuKernelImpl:rY}),snt={kernelName:Fu,backendName:"webgl",kernelFunc:nnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rnt(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t;vh(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;D(an(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const u=Ps(r.shape,o,i,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&Xt(u.inShape,u.outShape))return rs({inputs:{x:r},backend:n});const h=new Ul(u,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const ont={kernelName:Vp,backendName:"webgl",kernelFunc:rnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function int(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{filterSize:o,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=s,u=[1,1,1],h=ro(r.shape,o,i,u,a,l,c),f=new dw(h,"max",!1);return n.runWebGLProgram(f,[r],r.dtype)}const ant={kernelName:Wp,backendName:"webgl",kernelFunc:int};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cnt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,s=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=o-1-t.padInfo.top,c=i-1-t.padInfo.left,l=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class lnt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,s=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,u=t.effectiveFilterWidth,h=c-1-t.padInfo.front,f=l-1-t.padInfo.top,d=u-1-t.padInfo.left,p=c*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function unt(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o}=t,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=s,h=[1,1,1],f=ro(i.shape,a,c,h,l,u),d=new dw(f,"max",!0),p=n.runWebGLProgram(d,[i],i.dtype),g=new lnt(f),m=n.runWebGLProgram(g,[r,p],i.dtype);return n.disposeIntermediateTensorInfo(p),m}const hnt={kernelName:lb,backendName:"webgl",kernelFunc:unt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fnt(e){const{inputs:t,backend:n,attrs:s}=e,{dy:r,input:o,output:i}=t,a=o;vh([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=s,f=Ps(a.shape,c,l,1,u,h),d=!0,p=new Ul(f,"max",d),g=n.runWebGLProgram(p,[a],a.dtype),m=new cnt(f),x=n.runWebGLProgram(m,[r,g],a.dtype);return n.disposeIntermediateTensorInfo(g),x}const dnt={kernelName:cb,backendName:"webgl",kernelFunc:fnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pnt(e,t,n,s){let r=new Ul(n,"max",!1);const o=s.runWebGLProgram(r,[e],"float32");r=new Ul(n,"max",!0,!0,t);const i=s.runWebGLProgram(r,[e],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mnt={kernelName:mI,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=t,c=n;D(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];D(an(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const u=Ps(s.shape,r,o,l,i),[h,f]=pnt(s,a,u,c);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gnt(e,t,n,s){const r=K(t),i=K(e.shape)/r,a=it({inputs:{x:e},attrs:{shape:[i,r]},backend:s}),c=aa(a,"float32","mean",s),l=it({inputs:{x:c},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xnt={kernelName:Up,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:s}=e,{keepDims:r,axis:o}=t,i=n,a=s.shape.length,c=Lt(o,s.shape);let l=c;const u=me(l,a),h=u!=null,f=i.shouldExecuteOnCPU([s]),d=[];let p=s;if(h){if(f){const y=i.texData.get(p.dataId).values,v=new Array(a);for(let N=0;N<v.length;N++)v[N]=s.shape[u[N]];const $=uw(y,s.shape,s.dtype,u,v);p=i.makeTensorInfo(v,s.dtype);const I=i.texData.get(p.dataId);I.values=$}else p=zm(s,u,i);d.push(p),l=Ne(l.length,a)}tn("sum",l,a);const[g,m]=He(p.shape,l);let x=g;r&&(x=Se(g,c));const b=gnt(p,m,x,i);for(const w of d)i.disposeIntermediateTensorInfo(w);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bnt(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const u=me(l,a);let h=r;u!=null&&(h=$n({inputs:{x:r},backend:n,attrs:{perm:u}}),l=Ne(l.length,r.shape.length)),tn("min",l,a);const[f,d]=He(h.shape,l),p=K(d),g=it({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}}),m=aa(g,g.dtype,"min",n);let x;if(i){const b=Se(f,c);x=it({inputs:{x:m},backend:n,attrs:{shape:b}})}else x=it({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),u!=null&&n.disposeIntermediateTensorInfo(h),x}const ynt={kernelName:Gp,backendName:"webgl",kernelFunc:bnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wnt=hw+`
  return min(a, b);
`,vnt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ia+`
  return result;
`,$nt=en({opSnippet:wnt,packedOpSnippet:vnt,cpuKernelImpl:oY}),Cnt={kernelName:Ou,backendName:"webgl",kernelFunc:$nt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class knt{constructor(t,n,s){this.variableNames=["x"],this.outputShape=n.map((u,h)=>u[0]+t[h]+u[1]);const r=t.length,o=Qt(r),i=n.map(u=>u[0]).join(","),a=n.map((u,h)=>u[0]+t[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Int{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,g)=>p[0]+t[g]+p[1]);const r=t.length,o=Qt(r),i=n.map(p=>p[0]).join(","),a=n.map((p,g)=>p[0]+t[g]).join(","),c=bn("rc",r),l=bn("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=s==="reflect"?0:1;let d="";if(r===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Snt=({inputs:e,backend:t,attrs:n})=>{const{x:s}=e,{paddings:r,mode:o}=n,i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Int(s.shape,r,o):new knt(s.shape,r,o);return t.runWebGLProgram(i,[s],s.dtype)},Nnt={kernelName:Hp,backendName:"webgl",kernelFunc:Snt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _nt=`if (b == 0.0) return NAN;
  return mod(a, b);`,Tnt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ia+`
  return result;
`,Ent=en({opSnippet:_nt,packedOpSnippet:Tnt}),Rnt={kernelName:Lu,backendName:"webgl",kernelFunc:Ent};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ant{constructor(t,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dnt=`
if (a == b) {
  return 1.0;
};
return a / b;`,Mnt=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,RR=en({opSnippet:Dnt,packedOpSnippet:Mnt,checkOutOfBounds:!0}),Fnt={kernelName:vu,backendName:"webgl",kernelFunc:RR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C$="return a - b;",AR=en({opSnippet:C$,packedOpSnippet:C$,supportsComplex:!0,cpuKernelImpl:SY}),Ont={kernelName:Ju,backendName:"webgl",kernelFunc:AR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(e){const{inputs:t,backend:n,attrs:s}=e,{logits:r}=t,{dim:o}=s,i=Lt([o],r.shape),a=ER({inputs:{x:r},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),c=Se(a.shape,i),l=it({inputs:{x:a},backend:n,attrs:{shape:c}}),u=AR({inputs:{a:r,b:l},backend:n}),h=NR({inputs:{x:u},backend:n}),f=Bm({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:!1}}),d=it({inputs:{x:f},backend:n,attrs:{shape:c}}),p=RR({inputs:{a:h,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),p}const Lnt={kernelName:lm,backendName:"webgl",kernelFunc:DR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pnt(e){const{inputs:t,backend:n,attrs:s}=e,{logits:r}=t,{numSamples:o,seed:i,normalized:a}=s,c=a?r:DR({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),l=c.shape[0],u=c.shape[1],h=new Ant(l,u,o),f=[[i]],d=n.runWebGLProgram(h,[c],"int32",f);return a||n.disposeIntermediateTensorInfo(c),d}const znt={kernelName:gI,backendName:"webgl",kernelFunc:Pnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bnt=Bs+`
  return -x;
`,Vnt=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Wnt(e){const{inputs:t,backend:n}=e,{x:s}=t;if(n.shouldExecuteOnCPU([s])){const o=n.texData.get(s.dataId),[i,a]=aY(o.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new $o(s.shape,Vnt):r=new gr(s.shape,Bnt),n.runWebGLProgram(r,[s],s.dtype)}const Unt={kernelName:qp,backendName:"webgl",kernelFunc:Wnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gnt=Qb;function Hnt(e){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s,l=n.readSync(r.dataId),u=n.readSync(o.dataId),{selectedIndices:h}=Gnt(l,u,i,a,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const qnt={kernelName:ub,backendName:"webgl",kernelFunc:Hnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xnt=Jb;function jnt(e){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,u=n.readSync(r.dataId),h=n.readSync(o.dataId),{selectedIndices:f,validOutputs:d}=Xnt(u,h,i,a,c,l);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const Knt={kernelName:hb,backendName:"webgl",kernelFunc:jnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ynt=ty;function Znt(e){ls("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:s}=e,{boxes:r,scores:o}=t,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,u=n.readSync(r.dataId),h=n.readSync(o.dataId),f=i,d=a,p=c,g=l,{selectedIndices:m,selectedScores:x}=Ynt(u,h,f,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const Qnt={kernelName:fb,backendName:"webgl",kernelFunc:Znt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jnt{constructor(t,n,s,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tst=e=>{const{inputs:t,backend:n,attrs:s}=e,{indices:r}=t,{dtype:o,depth:i,onValue:a,offValue:c}=s,l=K(r.shape),u=new Jnt(l,i,a,c),h=it({inputs:{x:r},backend:n,attrs:{shape:[l]}}),f=n.runWebGLProgram(u,[h],o);n.disposeIntermediateTensorInfo(h);const d=[...r.shape,i],p=it({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),p},est={kernelName:Kp,backendName:"webgl",kernelFunc:tst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bd(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="complex64"){const r=Ch({inputs:{input:s},backend:n}),o=bd({inputs:{x:r},backend:n}),i=Vm({inputs:{input:s},backend:n}),a=bd({inputs:{x:i},backend:n}),c=Zo({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),c}else return kh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const nst={kernelName:fm,backendName:"webgl",kernelFunc:bd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MR(e){const{inputs:t,backend:n}=e,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ch({inputs:{input:s},backend:n}),o=MR({inputs:{x:r},backend:n}),i=Vm({inputs:{input:s},backend:n}),a=bd({inputs:{x:i},backend:n}),c=Zo({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),c}else return kh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const sst={kernelName:jp,backendName:"webgl",kernelFunc:MR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rst(e){const{inputs:t,backend:n,attrs:s}=e,{axis:r}=s;if(t.length===1)return S1({inputs:{input:t[0]},backend:n,attrs:{dim:r}});const o=t[0].shape,i=t[0].dtype;t.forEach(u=>{Ls(o,u.shape,"All tensors passed to stack must have matching shapes"),D(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=t.map(u=>{const h=S1({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(h),h}),l=yR({inputs:c,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),l}const ost={kernelName:Yp,backendName:"webgl",kernelFunc:rst};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ist{constructor(t,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,u)=>l[0]+t[u]+l[1]);const r=t.length,o=Qt(r),i=n.map(l=>l[0]).join(","),a=n.map((l,u)=>l[0]+t[u]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ast{constructor(t,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,m)=>g[0]+t[m]+g[1]);const r=t.length,o=Qt(r),i=n.map(g=>g[0]).join(","),a=n.map((g,m)=>g[0]+t[m]).join(","),c=bn("rc",r),l=bn("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${u}) {`],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let g=0,m=r===1?2:4;g<m;g++)p+=`
        ${f[g]}
        if (${d}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${h});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FR=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{paddings:o,constantValue:i}=s;if(K(r.shape)===0){const l=o.map((u,h)=>u[0]+r.shape[h]+u[1]);return kh({backend:n,attrs:{shape:l,value:i,dtype:r.dtype}})}const a=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ast(r.shape,o,i):new ist(r.shape,o,i),c=[[i]];return n.runWebGLProgram(a,[r],r.dtype,c)},cst={kernelName:Zp,backendName:"webgl",kernelFunc:FR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lst=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,ust=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ia+`
  return result;
`,hst=en({opSnippet:lst,packedOpSnippet:ust}),fst={kernelName:zu,backendName:"webgl",kernelFunc:hst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dst(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{axis:o,keepDims:i}=s,a=r.shape.length,c=[],l=Lt(o,r.shape);let u=l;const h=me(u,a);let f=r;h!=null&&(f=$n({inputs:{x:r},backend:n,attrs:{perm:h}}),u=Ne(u.length,a),c.push(f)),tn("prod",u,a);let d;if(n.shouldExecuteOnCPU([f])){const p=n.texData.get(f.dataId).values,{outVals:g,outShape:m,outDtype:x}=lY(f.shape,f.dtype,p,u);d=n.makeTensorInfo(m,x,g)}else{const[p,g]=He(f.shape,u),m=K(g),x=it({inputs:{x:f},backend:n,attrs:{shape:[-1,m]}}),b=kb(r.dtype),w=aa(x,b,"prod",n);d=it({inputs:{x:w},backend:n,attrs:{shape:p}}),c.push(x),c.push(w)}if(i){c.push(d);const p=Se(d.shape,l);d=it({inputs:{x:d},backend:n,attrs:{shape:p}})}return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const pst={kernelName:Jp,backendName:"webgl",kernelFunc:dst};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mst(e){const{inputs:t,backend:n,attrs:s}=e,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=t,{outputRaggedRank:a}=s,c=r.map(x=>n.readSync(x.dataId)),l=r.map(x=>x.shape),u=n.readSync(o.dataId),h=n.readSync(i.dataId),[f,d,p]=uY(c,l,u,o.shape,o.dtype,h,i.shape,a),g=f.map(x=>n.makeTensorInfo([x.length],"int32",x)),m=n.makeTensorInfo(p,o.dtype,d);return g.concat([m])}const gst={kernelName:xI,backendName:"webgl",kernelFunc:mst};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xst(e){const{inputs:t,backend:n}=e,{starts:s,limits:r,deltas:o}=t,i=n.readSync(s.dataId),a=n.readSync(r.dataId),c=n.readSync(o.dataId),[l,u]=hY(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=n.makeTensorInfo([l.length],"int32",l),f=n.makeTensorInfo([u.length],s.dtype,u);return[h,f]}const bst={kernelName:bI,backendName:"webgl",kernelFunc:xst};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yst(e){const{inputs:t,backend:n,attrs:s}=e,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=t,{rowPartitionTypes:c}=s,l=n.readSync(r.dataId),u=n.readSync(o.dataId),h=n.readSync(i.dataId),f=a.map(m=>n.readSync(m.dataId)),d=a.map(m=>m.shape),[p,g]=fY(l,r.shape,u,o.shape,o.dtype,h,i.shape,f,d,c);return n.makeTensorInfo(p,o.dtype,g)}const wst={kernelName:yI,backendName:"webgl",kernelFunc:yst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OR=e=>{const{backend:t,attrs:n}=e,{start:s,stop:r,step:o,dtype:i}=n,a=dY(s,r,o,i);return t.makeTensorInfo([a.length],i,a)},vst={kernelName:db,backendName:"webgl",kernelFunc:OR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $st="return 1.0 / x;",Cst=Ht({opSnippet:$st}),kst={kernelName:Bu,backendName:"webgl",kernelFunc:Cst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ist=Bs+`
  return (x < 0.0) ? 0.0 : x;
`,Sst=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nst=Ht({opSnippet:Ist,packedOpSnippet:Sst}),_st={kernelName:Vu,backendName:"webgl",kernelFunc:Nst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tst=Bs+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Est=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rst=Ht({opSnippet:Tst,packedOpSnippet:Est}),Ast={kernelName:Wu,backendName:"webgl",kernelFunc:Rst};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dst{constructor(t,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=t;this.outputShape=[i,n,s,l];const u=[r&&n>1?a-1:a,r&&s>1?c-1:c],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mst{constructor(t,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=t;this.outputShape=[i,n,s,l];const u=[r&&n>1?a-1:a,r&&s>1?c-1:c],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fst(e){const{inputs:t,backend:n,attrs:s}=e,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Mst(r.shape,c,l,o,i):new Dst(r.shape,c,l,o,i);return n.runWebGLProgram(u,[r],"float32")}const Ost={kernelName:nm,backendName:"webgl",kernelFunc:Fst};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lst{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=t,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],f=1/u,d=1/h,p=Math.ceil(f)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pst(e){const{inputs:t,backend:n,attrs:s}=e,{images:r,dy:o}=t,{alignCorners:i}=s,a=new Lst(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const zst={kernelName:gb,backendName:"webgl",kernelFunc:Pst};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bst{constructor(t,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=t;this.outputShape=[i,n,s,l];const u=[r&&n>1?a-1:a,r&&s>1?c-1:c],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],f=r?"0.5":"0.0";let d;o?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vst{constructor(t,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=t;this.outputShape=[i,n,s,l];const u=[r&&n>1?a-1:a,r&&s>1?c-1:c],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],f=r?"0.5":"0.0";let d;o?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wst(e){const{inputs:t,backend:n,attrs:s}=e,{images:r}=t,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Vst(r.shape,c,l,o,i):new Bst(r.shape,c,l,o,i);return n.runWebGLProgram(u,[r],r.dtype)}const Ust={kernelName:em,backendName:"webgl",kernelFunc:Wst};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gst{constructor(t,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=t,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=c[0]/l[0],h=c[1]/l[1],f=1/u,d=1/h,p=Math.ceil(f)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hst(e){const{inputs:t,backend:n,attrs:s}=e,{images:r,dy:o}=t,{alignCorners:i}=s,a=new Gst(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const qst={kernelName:mb,backendName:"webgl",kernelFunc:Hst};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xst{constructor(t,n){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,o=t.map((a,c)=>r(c)).join(","),i=Qt(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jst{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const r=bn("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Qt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${o}){
            result.g = ${l(r.slice())};
          }
          if(${i}) {
            result.b = ${u(r.slice())};
            if(${o}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(p){return f(p)}function l(p){return p[s-1]="("+p[s-1]+" + 1)",f(p)}function u(p){return p[s-2]="("+p[s-2]+" + 1)",f(p)}function h(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",f(p)}function f(p){const g=t.map((b,w)=>d(w,p)),m=g.join(","),x=g.slice(-2).join(",");return`getChannel(getX(${m}), vec2(${x}))`}function d(p,g){return n.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${g[p]} - 1`:`${g[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kst(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{dims:o}=s,i=r.shape.length,a=Lt(o,r.shape);if(i===0)return rs({inputs:{x:r},backend:n});const c=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jst(r.shape,a):new Xst(r.shape,a);return n.runWebGLProgram(c,[r],r.dtype)}const Yst={kernelName:sm,backendName:"webgl",kernelFunc:Kst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zst{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],r=t[2];this.outputShape=t;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qst={kernelName:Cb,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:s}=e,{radians:r,fillValue:o,center:i}=t,a=n,c=new Zst(s.shape,o),[l,u]=hy(i,s.shape[1],s.shape[2]),h=[[l,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jst=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,trt=Ht({opSnippet:Jst}),ert={kernelName:Uu,backendName:"webgl",kernelFunc:trt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nrt="return inversesqrt(x);",srt=Ht({opSnippet:nrt,cpuKernelImpl:pY}),rrt={kernelName:Gu,backendName:"webgl",kernelFunc:srt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pw{constructor(t,n,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=Qt(o.length),u=Qt(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let d="";r===1?d="i":r===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";c&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,x=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${m}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ort{constructor(t,n,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=Qt(o.length),u=Qt(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let d="";r===1?d="i":r===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";c&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,x=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${m}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function irt(e){const{inputs:t,backend:n,attrs:s}=e,{indices:r,updates:o}=t,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=ea(o,r,i),f=[h/l,l];if(h===0)return n.makeTensorInfo(i,r.dtype);const d=it({inputs:{x:r},backend:n,attrs:{shape:[c,a]}}),p=it({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;X().getBool("WEBGL_PACK")?m=new ort(c,a,d.shape.length,p.shape.length,u,f):m=new pw(c,a,d.shape.length,p.shape.length,u,f);const x=n.runWebGLProgram(m,[p,d,g],p.dtype),b=it({inputs:{x},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(g),b}const art={kernelName:wI,backendName:"webgl",kernelFunc:irt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class crt{constructor(t,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=X().getNumber("WEBGL_VERSION")===2?o:i,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lrt(e){const{inputs:t,backend:n,attrs:s}=e,{sortedSequence:r,values:o}=t,{side:i}=s,a=new crt(r.shape[0],r.shape[1],o.shape[1],i),c=[[r.shape[1]]];return n.runWebGLProgram(a,[r,o],"int32",c)}const urt={kernelName:$I,backendName:"webgl",kernelFunc:lrt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hrt{constructor(t,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let u=0;u<n.length;u++)l.push(`${a[u]}`),u<t&&c.push(`${a[u]}`);r=c.join(),o=l.join()}const i=Qt(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function frt(e){const{inputs:t,backend:n}=e,{condition:s,t:r,e:o}=t,i=new hrt(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(i,[s,r,o],ns(r.dtype,o.dtype))}const drt={kernelName:rm,backendName:"webgl",kernelFunc:frt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const prt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Cm};
  float scale = ${km};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,mrt=Ht({opSnippet:prt}),grt={kernelName:Hu,backendName:"webgl",kernelFunc:mrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xrt=Pc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,brt=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yrt=Ht({opSnippet:xrt,packedOpSnippet:brt,cpuKernelImpl:gY}),wrt={kernelName:Ku,backendName:"webgl",kernelFunc:yrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vrt=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,$rt=Ht({opSnippet:vrt}),Crt={kernelName:ju,backendName:"webgl",kernelFunc:$rt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const krt=Pc+`
  return sin(x);
`,Irt=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ia}
  return result;
`,Srt=Ht({opSnippet:krt,packedOpSnippet:Irt}),Nrt={kernelName:qu,backendName:"webgl",kernelFunc:Srt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _rt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Trt=Ht({opSnippet:_rt}),Ert={kernelName:Xu,backendName:"webgl",kernelFunc:Trt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rrt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Art=Ht({opSnippet:Rrt}),Drt={kernelName:Yu,backendName:"webgl",kernelFunc:Art};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mrt=e=>{const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{blockShape:o,paddings:i}=s;D(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((x,b)=>x*b),c=[[0,0]];c.push(...i);for(let x=1+o.length;x<r.shape.length;++x)c.push([0,0]);const l=[],u=FR({inputs:{x:r},backend:n,attrs:{paddings:c,constantValue:0}}),h=ch(u.shape,o,a,!1),f=lh(h.length,o.length,!1),d=uh(u.shape,o,a,!1),p=it({inputs:{x:u},backend:n,attrs:{shape:h}}),g=$n({inputs:{x:p},backend:n,attrs:{perm:f}}),m=it({inputs:{x:g},backend:n,attrs:{shape:d}});return l.push(u),l.push(p),l.push(g),l.forEach(x=>n.disposeIntermediateTensorInfo(x)),m},Frt={kernelName:am,backendName:"webgl",kernelFunc:Mrt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ort(e){const{inputs:t,backend:n}=e,{indices:s,values:r,denseShape:o,defaultValue:i}=t;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),c=n.readSync(r.dataId),l=n.readSync(o.dataId),u=n.readSync(i.dataId)[0],[h,f,d,p,g]=bY(a,s.shape,s.dtype,c,r.dtype,l,u);return[n.makeTensorInfo(f,s.dtype,h),n.makeTensorInfo([f[0]],r.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const Lrt={kernelName:CI,backendName:"webgl",kernelFunc:Ort};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Prt(e){const{inputs:t,backend:n}=e,{inputIndices:s,inputShape:r,newShape:o}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),c=Array.from(n.readSync(o.dataId)),[l,u,h]=yY(a,s.shape,s.dtype,i,c);return[n.makeTensorInfo(u,s.dtype,l),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const zrt={kernelName:kI,backendName:"webgl",kernelFunc:Prt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Brt(e){const{inputs:t,backend:n}=e,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),c=n.readSync(o.dataId),[l,u]=iR(i,s.shape,s.dtype,a,c,!0);return n.makeTensorInfo(u,s.dtype,l)}const Vrt={kernelName:II,backendName:"webgl",kernelFunc:Brt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wrt(e){const{inputs:t,backend:n}=e,{data:s,indices:r,segmentIds:o}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),c=n.readSync(o.dataId),[l,u]=iR(i,s.shape,s.dtype,a,c);return n.makeTensorInfo(u,s.dtype,l)}const Urt={kernelName:SI,backendName:"webgl",kernelFunc:Wrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Grt(e){const{inputs:t,backend:n,attrs:s}=e,{sparseIndices:r,sparseValues:o,defaultValue:i}=t,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=ea(o,r,a),d=!1;if(o.dtype==="string"){const x=n.bufferSync(r),b=n.bufferSync(o),w=Ro(n.readSync(i.dataId)[0]),y=mY(x,b,a,f,u,l,c,h,w,d);return n.makeTensorInfo(a,y.dtype,y.values)}const p=new pw(l,c,r.shape.length,o.shape.length,h,[f,1],d),g=n.runWebGLProgram(p,[o,r,i],o.dtype),m=it({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),m}const Hrt={kernelName:NI,backendName:"webgl",kernelFunc:Grt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qrt(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=Sy(r,o,a),l=r.shape.length,u=new Array(l).fill(0),h=r.shape.slice();return c.map(f=>{const d=[...h];d[a]=f;const p=zc({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});return u[a]+=f,p})}const Xrt={kernelName:cm,backendName:"webgl",kernelFunc:qrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k$="return sqrt(x);",jrt=Ht({opSnippet:k$,packedOpSnippet:k$,cpuKernelImpl:wY}),Krt={kernelName:Zu,backendName:"webgl",kernelFunc:jrt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yrt="return x * x;",Zrt=Ht({opSnippet:Yrt}),Qrt={kernelName:xb,backendName:"webgl",kernelFunc:Zrt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I$="return (a - b) * (a - b);",Jrt=en({opSnippet:I$,packedOpSnippet:I$}),tot={kernelName:Qu,backendName:"webgl",kernelFunc:Jrt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eot(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(r.dataId),i=Jr(o),a=vY(i,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const not={kernelName:bb,backendName:"webgl",kernelFunc:eot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sot({inputs:e,attrs:t,backend:n}){const{x:s}=e,r=Bs+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,o=new gr(s.shape,r);return n.runWebGLProgram(o,[s],s.dtype)}const rot={kernelName:sh,backendName:"webgl",kernelFunc:sot};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oot{constructor(t,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=Qt(s.length),i=Qt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=s.map((l,u)=>(c++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${c-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${t});
      ${o} strides = ${o}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iot(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:x,begin:b,end:w,strides:y}=cy(r.shape,o,i,a,c,l,u,h,f);let v;if(g)v=it({inputs:{x:r},backend:n,attrs:{shape:p}});else if(m||x){D(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=oy(b,w,y),N=zc({inputs:{x:r},backend:n,attrs:{begin:b,size:I}});v=it({inputs:{x:N},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(N)}else if(n.shouldExecuteOnCPU([r])){const N=n.readSync(r.dataId),k=Ot(r.shape,r.dtype,N),S=$Y(d,k,y,b);v=n.makeTensorInfo(p,r.dtype,S.values)}else{const N=new oot(b,y,d);v=n.runWebGLProgram(N,[r],r.dtype)}const $=it({inputs:{x:v},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(v),$}const aot={kernelName:yb,backendName:"webgl",kernelFunc:iot};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cot(e){const{inputs:t,backend:n,attrs:s}=e,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:u,dataSplits:h}=t,f=n.readSync(u.dataId),d=n.readSync(h.dataId),[p,g]=CY(f,d,r,o,i,a,c,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",g)]}const lot={kernelName:_I,backendName:"webgl",kernelFunc:cot};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uot(e){const{inputs:t,backend:n,attrs:s}=e,{skipEmpty:r}=s,{input:o,delimiter:i}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),c=n.readSync(i.dataId)[0],[l,u,h]=kY(a,c,r),f=u.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const hot={kernelName:TI,backendName:"webgl",kernelFunc:uot};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fot(e){const{inputs:t,backend:n,attrs:s}=e,{numBuckets:r}=s,{input:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=IY(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const dot={kernelName:EI,backendName:"webgl",kernelFunc:fot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pot="return tan(x);",mot=Ht({opSnippet:pot}),got={kernelName:th,backendName:"webgl",kernelFunc:mot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xot=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,bot=Ht({opSnippet:xot}),yot={kernelName:eh,backendName:"webgl",kernelFunc:bot};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wot(e){const{inputs:t,backend:n,attrs:s}=e,{tensor:r,indices:o,updates:i}=t,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=ea(i,o,r.shape),f=[h/l,l];if(h===0)return n.makeTensorInfo(r.shape,o.dtype);const d=it({inputs:{x:o},backend:n,attrs:{shape:[c,a]}}),p=it({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),g=it({inputs:{x:r},backend:n,attrs:{shape:f}}),m=new pw(c,a,d.shape.length,p.shape.length,u,f,!1,!0),x=n.runWebGLProgram(m,[p,d,g],g.dtype),b=it({inputs:{x},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),b}const vot={kernelName:vI,backendName:"webgl",kernelFunc:wot};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ot{constructor(t,n){this.variableNames=["A"];const s=new Array(t.length);for(let i=0;i<s.length;i++)s[i]=t[i]*n[i];this.outputShape=s,this.rank=s.length;const r=Qt(this.rank),o=Cot(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Cot(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<e.length;r++)s.push(`imod(${n[r]}, ${e[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const c=n.readSync(r.dataId),l=r.dtype==="string"?c.map(f=>Ro(f)):c,u=Ot(r.shape,r.dtype,l),h=NY(u,o);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new $ot(r.shape,o);return n.runWebGLProgram(i,[r],r.dtype)}const kot={kernelName:nh,backendName:"webgl",kernelFunc:LR};class Iot{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Sot{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ri(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function S$(e){let t=1;for(;t<e;)t*=2;return t}function Not(e){const{inputs:t,backend:n,attrs:s}=e,{x:r}=t,{k:o,sorted:i}=s,a=X().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=X().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,u=l[l.length-1];if(n.shouldExecuteOnCPU([r])||u<a||o>c){const S=n.readSync(r.dataId),[C,A]=_Y(S,l,r.dtype,o,i);return[n.makeTensorInfo(C.shape,C.dtype,C.values),n.makeTensorInfo(A.shape,A.dtype,A.values)]}if(o===0)return l[l.length-1]=0,[n.makeTensorInfo(l,r.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(u===1)return[r,kh({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),f=h!==null&&h.isPacked,d=f?n.unpackTensor(r):r,g=K(l)/u,m=it({inputs:{x:d},attrs:{shape:[g,u]},backend:n});f&&ri(n,d);const x=S$(o),b=S$(u);let w=null;const y=()=>w===null?[m,m]:[m,w],v=(S,C,A)=>{const R=y(),_=new Iot(A),E=[[u],[w===null?1:0],[Number.NEGATIVE_INFINITY],[S],[C]],M=w;w=n.runWebGLProgram(_,R,"int32",E),ri(n,M)};for(let S=1;S<x;S*=2){const C=S*2;for(let A=S;A>=1;A/=2)v(C,A,[g,b])}for(let S=b;S>x;S/=2){const C=y(),A=new Sot([g,S/2]),_=[[u],[w===null?1:0],[x]],T=w;w=n.runWebGLProgram(A,C,"int32",_),ri(n,T);const E=x/2,M=E*2;for(let O=E;O>=1;O/=2)v(M,O,w.shape)}let $=w;w=zc({inputs:{x:w},backend:n,attrs:{begin:0,size:[g,o]}}),ri(n,$);let I=TR({inputs:{x:m,indices:w},backend:n,attrs:{axis:1,batchDims:1}});ri(n,m);const N=l.slice(0,-1);N.push(o),$=w,w=it({inputs:{x:w},attrs:{shape:N},backend:n}),ri(n,$);const k=I;return I=it({inputs:{x:I},attrs:{shape:N},backend:n}),ri(n,k),[I,w]}const _ot={kernelName:wb,backendName:"webgl",kernelFunc:Not};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tot{constructor(t,n,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eot(e){const{inputs:t,backend:n,attrs:s}=e,{image:r,transforms:o}=t,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=s,[u,h,f,d]=r.shape,[p,g]=l??[h,f],m=[u,p,g,d],x=new Tot(h,f,i,a,c,m);return n.runWebGLProgram(x,[r,o],"float32")}const Rot={kernelName:vb,backendName:"webgl",kernelFunc:Eot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aot(e){const{inputs:t,attrs:n,backend:s}=e,{axis:r}=n,{x:o}=t;vh(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:c,indices:l}=TY(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const Dot={kernelName:$b,backendName:"webgl",kernelFunc:Aot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mot(e){const{inputs:t,backend:n,attrs:s}=e,{value:r}=t;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,c=r.shape[o],l=new Array(a-1);let u=0;for(let g=0;g<a;g++)g!==o&&(l[u++]=i.shape[g]);const h=[],f=new Array(a).fill(0),d=i.shape.slice();d[o]=1;const p=new Array(c);for(let g=0;g<p.length;g++){f[o]=g;const m=zc({inputs:{x:i},backend:n,attrs:{begin:f,size:d}}),x=it({inputs:{x:m},backend:n,attrs:{shape:l}});p[g]=x,h.push(m)}return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const Fot={kernelName:um,backendName:"webgl",kernelFunc:Mot};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oot{constructor(t,n){this.variableNames=["x","segmentIds"];const s=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const c="0.0",l="sumValue",u=Math.floor(s/4)*4,h=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lot(e){const{inputs:t,backend:n,attrs:s}=e,{x:r,segmentIds:o}=t,{numSegments:i}=s,a=r.shape.length,c=[];let l=0;const u=me([l],a);let h=r;u!=null&&(h=$n({inputs:{x:r},backend:n,attrs:{perm:u}}),c.push(h),l=Ne(1,a)[0]);const f=yN(h.shape,l,i),d=K([h.shape[l]]),p=it({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});c.push(p);const g=kb(r.dtype),m=(y,v,$,I,N)=>{const k=y.shape[0],S=y.shape[1],C=bN(S,N),A={windowSize:C,inSize:S,batchSize:k,numSegments:N},R=new Oot(A,v),_=n.compileAndRun(R,[y,$],I);if(c.push(_),_.shape[1]===N)return _;const T=OR({backend:n,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),E=LR({inputs:{x:T},backend:n,attrs:{reps:[S/C]}});return c.push(T),c.push(E),m(_,v,E,I,N)},x=m(p,"unsortedSegmentSum",o,g,i),b=it({inputs:{x},backend:n,attrs:{shape:f}});let w=b;if(u!=null){c.push(b);const y=qo(u);w=$n({inputs:{x:w},backend:n,attrs:{perm:y}})}return c.forEach(y=>n.disposeIntermediateTensorInfo(y)),w}const Pot={kernelName:hm,backendName:"webgl",kernelFunc:Lot};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zot=[wZ,$Z,IZ,_Z,EZ,DZ,FZ,LZ,VZ,UZ,qZ,KZ,QZ,nQ,oQ,aQ,lQ,dQ,mQ,xQ,vQ,_Q,EQ,MQ,OQ,WQ,GQ,jQ,sZ,ZQ,nJ,iJ,fJ,mJ,xJ,yJ,vJ,IJ,_J,RJ,DJ,FJ,LJ,BJ,WJ,qJ,jJ,ZJ,ttt,ntt,itt,utt,ptt,xtt,wtt,vtt,Ctt,Itt,Ntt,Ttt,Rtt,Ftt,Ptt,Vtt,Utt,qtt,Ktt,Jtt,set,nZ,oet,tJ,cet,fet,met,oZ,yet,Cet,Iet,Eet,Det,Let,Bet,Get,jet,Zet,Jet,snt,ont,ant,hnt,dnt,mnt,xnt,ynt,Cnt,Nnt,Rnt,znt,cZ,Unt,qnt,Knt,Qnt,PQ,est,sst,ost,cst,fst,aZ,pst,gst,bst,wst,vst,zQ,Fnt,kst,_st,Ast,uZ,Ost,zst,Ust,qst,Yst,Qst,ert,rrt,art,urt,drt,grt,wrt,Crt,Nrt,Ert,SQ,Lnt,Drt,Frt,Lrt,zrt,Vrt,Urt,Hrt,Xrt,Krt,Qrt,tot,not,rot,aot,lot,hot,dot,Ont,xZ,got,yot,vot,kot,_ot,Rot,bZ,Dot,Fot,Pot,nst];for(const e of zot)AI(e);function ye(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function PR(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Wm(e){let t,n,s;e.length!==2?(t=ye,n=(a,c)=>ye(e(a),c),s=(a,c)=>e(a)-c):(t=e===ye||e===PR?e:Bot,n=e,s=e);function r(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const h=l+u>>>1;n(a[h],c)<0?l=h+1:u=h}while(l<u)}return l}function o(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const h=l+u>>>1;n(a[h],c)<=0?l=h+1:u=h}while(l<u)}return l}function i(a,c,l=0,u=a.length){const h=r(a,c,l,u-1);return h>l&&s(a[h-1],c)>-s(a[h],c)?h-1:h}return{left:r,center:i,right:o}}function Bot(){return 0}function yd(e){return e===null?NaN:+e}function*Vot(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let s of e)(s=t(s,++n,e))!=null&&(s=+s)>=s&&(yield s)}}const zR=Wm(ye),Lo=zR.right,Wot=zR.left,Uot=Wm(yd).center;function Got(e,t){if(!((t=+t)>=0))throw new RangeError("invalid r");let n=e.length;if(!((n=Math.floor(n))>=0))throw new RangeError("invalid length");if(!n||!t)return e;const s=mw(t),r=e.slice();return s(e,r,0,n,1),s(r,e,0,n,1),s(e,r,0,n,1),e}const BR=VR(mw),Hot=VR(qot);function VR(e){return function(t,n,s=n){if(!((n=+n)>=0))throw new RangeError("invalid rx");if(!((s=+s)>=0))throw new RangeError("invalid ry");let{data:r,width:o,height:i}=t;if(!((o=Math.floor(o))>=0))throw new RangeError("invalid width");if(!((i=Math.floor(i!==void 0?i:r.length/o))>=0))throw new RangeError("invalid height");if(!o||!i||!n&&!s)return t;const a=n&&e(n),c=s&&e(s),l=r.slice();return a&&c?(ga(a,l,r,o,i),ga(a,r,l,o,i),ga(a,l,r,o,i),xa(c,r,l,o,i),xa(c,l,r,o,i),xa(c,r,l,o,i)):a?(ga(a,r,l,o,i),ga(a,l,r,o,i),ga(a,r,l,o,i)):c&&(xa(c,r,l,o,i),xa(c,l,r,o,i),xa(c,r,l,o,i)),t}}function ga(e,t,n,s,r){for(let o=0,i=s*r;o<i;)e(t,n,o,o+=s,1)}function xa(e,t,n,s,r){for(let o=0,i=s*r;o<s;++o)e(t,n,o,o+i,s)}function qot(e){const t=mw(e);return(n,s,r,o,i)=>{r<<=2,o<<=2,i<<=2,t(n,s,r+0,o+0,i),t(n,s,r+1,o+1,i),t(n,s,r+2,o+2,i),t(n,s,r+3,o+3,i)}}function mw(e){const t=Math.floor(e);if(t===e)return Xot(e);const n=e-t,s=2*e+1;return(r,o,i,a,c)=>{if(!((a-=c)>=i))return;let l=t*o[i];const u=c*t,h=u+c;for(let f=i,d=i+u;f<d;f+=c)l+=o[Math.min(a,f)];for(let f=i,d=a;f<=d;f+=c)l+=o[Math.min(a,f+u)],r[f]=(l+n*(o[Math.max(i,f-h)]+o[Math.min(a,f+h)]))/s,l-=o[Math.max(i,f-u)]}}function Xot(e){const t=2*e+1;return(n,s,r,o,i)=>{if(!((o-=i)>=r))return;let a=e*s[r];const c=i*e;for(let l=r,u=r+c;l<u;l+=i)a+=s[Math.min(o,l)];for(let l=r,u=o;l<=u;l+=i)a+=s[Math.min(o,l+c)],n[l]=a/t,a-=s[Math.max(r,l-c)]}}function Um(e,t){let n=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&++n;else{let s=-1;for(let r of e)(r=t(r,++s,e))!=null&&(r=+r)>=r&&++n}return n}function jot(e){return e.length|0}function Kot(e){return!(e>0)}function Yot(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function Zot(e){return t=>e(...t)}function Qot(...e){const t=typeof e[e.length-1]=="function"&&Zot(e.pop());e=e.map(Yot);const n=e.map(jot),s=e.length-1,r=new Array(s+1).fill(0),o=[];if(s<0||n.some(Kot))return o;for(;;){o.push(r.map((a,c)=>e[c][a]));let i=s;for(;++r[i]===n[i];){if(i===0)return t?o.map(t):o;r[i--]=0}}}function Jot(e,t){var n=0,s=0;return Float64Array.from(e,t===void 0?r=>n+=+r||0:r=>n+=+t(r,s++,e)||0)}function WR(e,t){let n=0,s,r=0,o=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(s=i-r,r+=s/++n,o+=s*(i-r));else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(a=+a)>=a&&(s=a-r,r+=s/++n,o+=s*(a-r))}if(n>1)return o/(n-1)}function UR(e,t){const n=WR(e,t);return n&&Math.sqrt(n)}function Il(e,t){let n,s;if(t===void 0)for(const r of e)r!=null&&(n===void 0?r>=r&&(n=s=r):(n>r&&(n=r),s<r&&(s=r)));else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(n===void 0?o>=o&&(n=s=o):(n>o&&(n=o),s<o&&(s=o)))}return[n,s]}class Ge{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let s=0;for(let r=0;r<this._n&&r<32;r++){const o=n[r],i=t+o,a=Math.abs(t)<Math.abs(o)?t-(i-o):o-(i-t);a&&(n[s++]=a),t=i}return n[s]=t,this._n=s+1,this}valueOf(){const t=this._partials;let n=this._n,s,r,o,i=0;if(n>0){for(i=t[--n];n>0&&(s=i,r=t[--n],i=s+r,o=r-(i-s),!o););n>0&&(o<0&&t[n-1]<0||o>0&&t[n-1]>0)&&(r=o*2,s=i+r,r==s-i&&(i=s))}return i}}function tit(e,t){const n=new Ge;if(t===void 0)for(let s of e)(s=+s)&&n.add(s);else{let s=-1;for(let r of e)(r=+t(r,++s,e))&&n.add(r)}return+n}function eit(e,t){const n=new Ge;let s=-1;return Float64Array.from(e,t===void 0?r=>n.add(+r||0):r=>n.add(+t(r,++s,e)||0))}class Hl extends Map{constructor(t,n=qR){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[s,r]of t)this.set(s,r)}get(t){return super.get(N1(this,t))}has(t){return super.has(N1(this,t))}set(t,n){return super.set(GR(this,t),n)}delete(t){return super.delete(HR(this,t))}}class Vi extends Set{constructor(t,n=qR){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const s of t)this.add(s)}has(t){return super.has(N1(this,t))}add(t){return super.add(GR(this,t))}delete(t){return super.delete(HR(this,t))}}function N1({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):n}function GR({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):(e.set(s,n),n)}function HR({_intern:e,_key:t},n){const s=t(n);return e.has(s)&&(n=e.get(s),e.delete(s)),n}function qR(e){return e!==null&&typeof e=="object"?e.valueOf():e}function rc(e){return e}function XR(e,...t){return Bc(e,rc,rc,t)}function jR(e,...t){return Bc(e,Array.from,rc,t)}function KR(e,t){for(let n=1,s=t.length;n<s;++n)e=e.flatMap(r=>r.pop().map(([o,i])=>[...r,o,i]));return e}function nit(e,...t){return KR(jR(e,...t),t)}function sit(e,t,...n){return KR(ZR(e,t,...n),n)}function YR(e,t,...n){return Bc(e,rc,t,n)}function ZR(e,t,...n){return Bc(e,Array.from,t,n)}function rit(e,...t){return Bc(e,rc,QR,t)}function oit(e,...t){return Bc(e,Array.from,QR,t)}function QR(e){if(e.length!==1)throw new Error("duplicate key");return e[0]}function Bc(e,t,n,s){return function r(o,i){if(i>=s.length)return n(o);const a=new Hl,c=s[i++];let l=-1;for(const u of o){const h=c(u,++l,o),f=a.get(h);f?f.push(u):a.set(h,[u])}for(const[u,h]of a)a.set(u,r(h,i));return t(a)}(e,0)}function JR(e,t){return Array.from(t,n=>e[n])}function _1(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[n]=t;if(n&&n.length!==2||t.length>1){const s=Uint32Array.from(e,(r,o)=>o);return t.length>1?(t=t.map(r=>e.map(r)),s.sort((r,o)=>{for(const i of t){const a=oc(i[r],i[o]);if(a)return a}})):(n=e.map(n),s.sort((r,o)=>oc(n[r],n[o]))),JR(e,s)}return e.sort(gw(n))}function gw(e=ye){if(e===ye)return oc;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const s=e(t,n);return s||s===0?s:(e(n,n)===0)-(e(t,t)===0)}}function oc(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}function iit(e,t,n){return(t.length!==2?_1(YR(e,t,n),([s,r],[o,i])=>ye(r,i)||ye(s,o)):_1(XR(e,n),([s,r],[o,i])=>t(r,i)||ye(s,o))).map(([s])=>s)}var ait=Array.prototype,cit=ait.slice;function o0(e){return()=>e}const lit=Math.sqrt(50),uit=Math.sqrt(10),hit=Math.sqrt(2);function wd(e,t,n){const s=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(s)),o=s/Math.pow(10,r),i=o>=lit?10:o>=uit?5:o>=hit?2:1;let a,c,l;return r<0?(l=Math.pow(10,-r)/i,a=Math.round(e*l),c=Math.round(t*l),a/l<e&&++a,c/l>t&&--c,l=-l):(l=Math.pow(10,r)*i,a=Math.round(e/l),c=Math.round(t/l),a*l<e&&++a,c*l>t&&--c),c<a&&.5<=n&&n<2?wd(e,t,n*2):[a,c,l]}function Wi(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const s=t<e,[r,o,i]=s?wd(t,e,n):wd(e,t,n);if(!(o>=r))return[];const a=o-r+1,c=new Array(a);if(s)if(i<0)for(let l=0;l<a;++l)c[l]=(o-l)/-i;else for(let l=0;l<a;++l)c[l]=(o-l)*i;else if(i<0)for(let l=0;l<a;++l)c[l]=(r+l)/-i;else for(let l=0;l<a;++l)c[l]=(r+l)*i;return c}function Ui(e,t,n){return t=+t,e=+e,n=+n,wd(e,t,n)[2]}function vd(e,t,n){t=+t,e=+e,n=+n;const s=t<e,r=s?Ui(t,e,n):Ui(e,t,n);return(s?-1:1)*(r<0?1/-r:r)}function xw(e,t,n){let s;for(;;){const r=Ui(e,t,n);if(r===s||r===0||!isFinite(r))return[e,t];r>0?(e=Math.floor(e/r)*r,t=Math.ceil(t/r)*r):r<0&&(e=Math.ceil(e*r)/r,t=Math.floor(t*r)/r),s=r}}function bw(e){return Math.max(1,Math.ceil(Math.log(Um(e))/Math.LN2)+1)}function N$(){var e=rc,t=Il,n=bw;function s(r){Array.isArray(r)||(r=Array.from(r));var o,i=r.length,a,c,l=new Array(i);for(o=0;o<i;++o)l[o]=e(r[o],o,r);var u=t(l),h=u[0],f=u[1],d=n(l,h,f);if(!Array.isArray(d)){const w=f,y=+d;if(t===Il&&([h,f]=xw(h,f,y)),d=Wi(h,f,y),d[0]<=h&&(c=Ui(h,f,y)),d[d.length-1]>=f)if(w>=f&&t===Il){const v=Ui(h,f,y);isFinite(v)&&(v>0?f=(Math.floor(f/v)+1)*v:v<0&&(f=(Math.ceil(f*-v)+1)/-v))}else d.pop()}for(var p=d.length,g=0,m=p;d[g]<=h;)++g;for(;d[m-1]>f;)--m;(g||m<p)&&(d=d.slice(g,m),p=m-g);var x=new Array(p+1),b;for(o=0;o<=p;++o)b=x[o]=[],b.x0=o>0?d[o-1]:h,b.x1=o<p?d[o]:f;if(isFinite(c)){if(c>0)for(o=0;o<i;++o)(a=l[o])!=null&&h<=a&&a<=f&&x[Math.min(p,Math.floor((a-h)/c))].push(r[o]);else if(c<0){for(o=0;o<i;++o)if((a=l[o])!=null&&h<=a&&a<=f){const w=Math.floor((h-a)*c);x[Math.min(p,w+(d[w]<=a))].push(r[o])}}}else for(o=0;o<i;++o)(a=l[o])!=null&&h<=a&&a<=f&&x[Lo(d,a,0,p)].push(r[o]);return x}return s.value=function(r){return arguments.length?(e=typeof r=="function"?r:o0(r),s):e},s.domain=function(r){return arguments.length?(t=typeof r=="function"?r:o0([r[0],r[1]]),s):t},s.thresholds=function(r){return arguments.length?(n=typeof r=="function"?r:o0(Array.isArray(r)?cit.call(r):r),s):n},s}function to(e,t){let n;if(t===void 0)for(const s of e)s!=null&&(n<s||n===void 0&&s>=s)&&(n=s);else{let s=-1;for(let r of e)(r=t(r,++s,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function yw(e,t){let n,s=-1,r=-1;if(t===void 0)for(const o of e)++r,o!=null&&(n<o||n===void 0&&o>=o)&&(n=o,s=r);else for(let o of e)(o=t(o,++r,e))!=null&&(n<o||n===void 0&&o>=o)&&(n=o,s=r);return s}function Po(e,t){let n;if(t===void 0)for(const s of e)s!=null&&(n>s||n===void 0&&s>=s)&&(n=s);else{let s=-1;for(let r of e)(r=t(r,++s,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function ww(e,t){let n,s=-1,r=-1;if(t===void 0)for(const o of e)++r,o!=null&&(n>o||n===void 0&&o>=o)&&(n=o,s=r);else for(let o of e)(o=t(o,++r,e))!=null&&(n>o||n===void 0&&o>=o)&&(n=o,s=r);return s}function Gm(e,t,n=0,s=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),s=Math.floor(Math.min(e.length-1,s)),!(n<=t&&t<=s))return e;for(r=r===void 0?oc:gw(r);s>n;){if(s-n>600){const c=s-n+1,l=t-n+1,u=Math.log(c),h=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*h*(c-h)/c)*(l-c/2<0?-1:1),d=Math.max(n,Math.floor(t-l*h/c+f)),p=Math.min(s,Math.floor(t+(c-l)*h/c+f));Gm(e,t,d,p,r)}const o=e[t];let i=n,a=s;for(Yc(e,n,t),r(e[s],o)>0&&Yc(e,n,s);i<a;){for(Yc(e,i,a),++i,--a;r(e[i],o)<0;)++i;for(;r(e[a],o)>0;)--a}r(e[n],o)===0?Yc(e,n,a):(++a,Yc(e,a,s)),a<=t&&(n=a+1),t<=a&&(s=a-1)}return e}function Yc(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function tA(e,t=ye){let n,s=!1;if(t.length===1){let r;for(const o of e){const i=t(o);(s?ye(i,r)>0:ye(i,i)===0)&&(n=o,r=i,s=!0)}}else for(const r of e)(s?t(r,n)>0:t(r,r)===0)&&(n=r,s=!0);return n}function ql(e,t,n){if(e=Float64Array.from(Vot(e,n)),!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return Po(e);if(t>=1)return to(e);var s,r=(s-1)*t,o=Math.floor(r),i=to(Gm(e,o).subarray(0,o+1)),a=Po(e.subarray(o+1));return i+(a-i)*(r-o)}}function eA(e,t,n=yd){if(!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return+n(e[0],0,e);if(t>=1)return+n(e[s-1],s-1,e);var s,r=(s-1)*t,o=Math.floor(r),i=+n(e[o],o,e),a=+n(e[o+1],o+1,e);return i+(a-i)*(r-o)}}function nA(e,t,n=yd){if(!isNaN(t=+t)){if(s=Float64Array.from(e,(a,c)=>yd(n(e[c],c,e))),t<=0)return ww(s);if(t>=1)return yw(s);var s,r=Uint32Array.from(e,(a,c)=>c),o=s.length-1,i=Math.floor(o*t);return Gm(r,i,0,o,(a,c)=>oc(s[a],s[c])),i=tA(r.subarray(0,i+1),a=>s[a]),i>=0?i:-1}}function fit(e,t,n){const s=Um(e),r=ql(e,.75)-ql(e,.25);return s&&r?Math.ceil((n-t)/(2*r*Math.pow(s,-1/3))):1}function dit(e,t,n){const s=Um(e),r=UR(e);return s&&r?Math.ceil((n-t)*Math.cbrt(s)/(3.49*r)):1}function T1(e,t){let n=0,s=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,s+=r);else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(o=+o)>=o&&(++n,s+=o)}if(n)return s/n}function pit(e,t){return ql(e,.5,t)}function mit(e,t){return nA(e,.5,t)}function*git(e){for(const t of e)yield*t}function vw(e){return Array.from(git(e))}function xit(e,t){const n=new Hl;if(t===void 0)for(let o of e)o!=null&&o>=o&&n.set(o,(n.get(o)||0)+1);else{let o=-1;for(let i of e)(i=t(i,++o,e))!=null&&i>=i&&n.set(i,(n.get(i)||0)+1)}let s,r=0;for(const[o,i]of n)i>r&&(r=i,s=o);return s}function bit(e,t=yit){const n=[];let s,r=!1;for(const o of e)r&&n.push(t(s,o)),s=o,r=!0;return n}function yit(e,t){return[e,t]}function Co(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var s=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++s<r;)o[s]=e+s*n;return o}function wit(e,t=ye){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let n=Array.from(e);const s=new Float64Array(n.length);t.length!==2&&(n=n.map(t),t=ye);const r=(a,c)=>t(n[a],n[c]);let o,i;return e=Uint32Array.from(n,(a,c)=>c),e.sort(t===ye?(a,c)=>oc(n[a],n[c]):gw(r)),e.forEach((a,c)=>{const l=r(a,o===void 0?a:o);l>=0?((o===void 0||l>0)&&(o=a,i=c),s[a]=i):s[a]=NaN}),s}function vit(e,t=ye){let n,s=!1;if(t.length===1){let r;for(const o of e){const i=t(o);(s?ye(i,r)<0:ye(i,i)===0)&&(n=o,r=i,s=!0)}}else for(const r of e)(s?t(r,n)<0:t(r,r)===0)&&(n=r,s=!0);return n}function sA(e,t=ye){if(t.length===1)return ww(e,t);let n,s=-1,r=-1;for(const o of e)++r,(s<0?t(o,o)===0:t(o,n)<0)&&(n=o,s=r);return s}function $it(e,t=ye){if(t.length===1)return yw(e,t);let n,s=-1,r=-1;for(const o of e)++r,(s<0?t(o,o)===0:t(o,n)>0)&&(n=o,s=r);return s}function Cit(e,t){const n=sA(e,t);return n<0?void 0:n}const kit=rA(Math.random);function rA(e){return function(n,s=0,r=n.length){let o=r-(s=+s);for(;o;){const i=e()*o--|0,a=n[o+s];n[o+s]=n[i+s],n[i+s]=a}return n}}function Iit(e,t){let n=0;if(t===void 0)for(let s of e)(s=+s)&&(n+=s);else{let s=-1;for(let r of e)(r=+t(r,++s,e))&&(n+=r)}return n}function oA(e){if(!(o=e.length))return[];for(var t=-1,n=Po(e,Sit),s=new Array(n);++t<n;)for(var r=-1,o,i=s[t]=new Array(o);++r<o;)i[r]=e[r][t];return s}function Sit(e){return e.length}function Nit(){return oA(arguments)}function _it(e,t){if(typeof t!="function")throw new TypeError("test is not a function");let n=-1;for(const s of e)if(!t(s,++n,e))return!1;return!0}function Tit(e,t){if(typeof t!="function")throw new TypeError("test is not a function");let n=-1;for(const s of e)if(t(s,++n,e))return!0;return!1}function Eit(e,t){if(typeof t!="function")throw new TypeError("test is not a function");const n=[];let s=-1;for(const r of e)t(r,++s,e)&&n.push(r);return n}function Rit(e,t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof t!="function")throw new TypeError("mapper is not a function");return Array.from(e,(n,s)=>t(n,s,e))}function Ait(e,t,n){if(typeof t!="function")throw new TypeError("reducer is not a function");const s=e[Symbol.iterator]();let r,o,i=-1;if(arguments.length<3){if({done:r,value:n}=s.next(),r)return;++i}for(;{done:r,value:o}=s.next(),!r;)n=t(n,o,++i,e);return n}function Dit(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}function Mit(e,...t){e=new Vi(e);for(const n of t)for(const s of n)e.delete(s);return e}function Fit(e,t){const n=t[Symbol.iterator](),s=new Vi;for(const r of e){if(s.has(r))return!1;let o,i;for(;({value:o,done:i}=n.next())&&!i;){if(Object.is(r,o))return!1;s.add(o)}}return!0}function Oit(e,...t){e=new Vi(e),t=t.map(Lit);t:for(const n of e)for(const s of t)if(!s.has(n)){e.delete(n);continue t}return e}function Lit(e){return e instanceof Vi?e:new Vi(e)}function iA(e,t){const n=e[Symbol.iterator](),s=new Set;for(const r of t){const o=_$(r);if(s.has(o))continue;let i,a;for(;{value:i,done:a}=n.next();){if(a)return!1;const c=_$(i);if(s.add(c),Object.is(o,c))break}}return!0}function _$(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Pit(e,t){return iA(t,e)}function zit(...e){const t=new Vi;for(const n of e)for(const s of n)t.add(s);return t}function Bit(e){return e}var Af=1,Df=2,E1=3,ul=4,T$=1e-6;function Vit(e){return"translate("+e+",0)"}function Wit(e){return"translate(0,"+e+")"}function Uit(e){return t=>+e(t)}function Git(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function Hit(){return!this.__axis}function Hm(e,t){var n=[],s=null,r=null,o=6,i=6,a=3,c=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=e===Af||e===ul?-1:1,u=e===ul||e===Df?"x":"y",h=e===Af||e===E1?Vit:Wit;function f(d){var p=s??(t.ticks?t.ticks.apply(t,n):t.domain()),g=r??(t.tickFormat?t.tickFormat.apply(t,n):Bit),m=Math.max(o,0)+a,x=t.range(),b=+x[0]+c,w=+x[x.length-1]+c,y=(t.bandwidth?Git:Uit)(t.copy(),c),v=d.selection?d.selection():d,$=v.selectAll(".domain").data([null]),I=v.selectAll(".tick").data(p,t).order(),N=I.exit(),k=I.enter().append("g").attr("class","tick"),S=I.select("line"),C=I.select("text");$=$.merge($.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),I=I.merge(k),S=S.merge(k.append("line").attr("stroke","currentColor").attr(u+"2",l*o)),C=C.merge(k.append("text").attr("fill","currentColor").attr(u,l*m).attr("dy",e===Af?"0em":e===E1?"0.71em":"0.32em")),d!==v&&($=$.transition(d),I=I.transition(d),S=S.transition(d),C=C.transition(d),N=N.transition(d).attr("opacity",T$).attr("transform",function(A){return isFinite(A=y(A))?h(A+c):this.getAttribute("transform")}),k.attr("opacity",T$).attr("transform",function(A){var R=this.parentNode.__axis;return h((R&&isFinite(R=R(A))?R:y(A))+c)})),N.remove(),$.attr("d",e===ul||e===Df?i?"M"+l*i+","+b+"H"+c+"V"+w+"H"+l*i:"M"+c+","+b+"V"+w:i?"M"+b+","+l*i+"V"+c+"H"+w+"V"+l*i:"M"+b+","+c+"H"+w),I.attr("opacity",1).attr("transform",function(A){return h(y(A)+c)}),S.attr(u+"2",l*o),C.attr(u,l*m).text(g),v.filter(Hit).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===Df?"start":e===ul?"end":"middle"),v.each(function(){this.__axis=y})}return f.scale=function(d){return arguments.length?(t=d,f):t},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(s=d==null?null:Array.from(d),f):s&&s.slice()},f.tickFormat=function(d){return arguments.length?(r=d,f):r},f.tickSize=function(d){return arguments.length?(o=i=+d,f):o},f.tickSizeInner=function(d){return arguments.length?(o=+d,f):o},f.tickSizeOuter=function(d){return arguments.length?(i=+d,f):i},f.tickPadding=function(d){return arguments.length?(a=+d,f):a},f.offset=function(d){return arguments.length?(c=+d,f):c},f}function qit(e){return Hm(Af,e)}function Xit(e){return Hm(Df,e)}function jit(e){return Hm(E1,e)}function Kit(e){return Hm(ul,e)}var Yit={value:()=>{}};function ca(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Mf(n)}function Mf(e){this._=e}function Zit(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Mf.prototype=ca.prototype={constructor:Mf,on:function(e,t){var n=this._,s=Zit(e+"",n),r,o=-1,i=s.length;if(arguments.length<2){for(;++o<i;)if((r=(e=s[o]).type)&&(r=Qit(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<i;)if(r=(e=s[o]).type)n[r]=E$(n[r],e.name,t);else if(t==null)for(r in n)n[r]=E$(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Mf(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,o;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],s=0,r=o.length;s<r;++s)o[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,o=s.length;r<o;++r)s[r].value.apply(t,n)}};function Qit(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function E$(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=Yit,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var R1="http://www.w3.org/1999/xhtml";const A1={svg:"http://www.w3.org/2000/svg",xhtml:R1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ih(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),A1.hasOwnProperty(t)?{space:A1[t],local:e}:e}function Jit(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===R1&&t.documentElement.namespaceURI===R1?t.createElement(e):t.createElementNS(n,e)}}function tat(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function qm(e){var t=Ih(e);return(t.local?tat:Jit)(t)}function eat(){}function Xm(e){return e==null?eat:function(){return this.querySelector(e)}}function nat(e){typeof e!="function"&&(e=Xm(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var o=t[r],i=o.length,a=s[r]=new Array(i),c,l,u=0;u<i;++u)(c=o[u])&&(l=e.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new Bn(s,this._parents)}function aA(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function sat(){return[]}function $w(e){return e==null?sat:function(){return this.querySelectorAll(e)}}function rat(e){return function(){return aA(e.apply(this,arguments))}}function oat(e){typeof e=="function"?e=rat(e):e=$w(e);for(var t=this._groups,n=t.length,s=[],r=[],o=0;o<n;++o)for(var i=t[o],a=i.length,c,l=0;l<a;++l)(c=i[l])&&(s.push(e.call(c,c.__data__,l,i)),r.push(c));return new Bn(s,r)}function Cw(e){return function(){return this.matches(e)}}function cA(e){return function(t){return t.matches(e)}}var iat=Array.prototype.find;function aat(e){return function(){return iat.call(this.children,e)}}function cat(){return this.firstElementChild}function lat(e){return this.select(e==null?cat:aat(typeof e=="function"?e:cA(e)))}var uat=Array.prototype.filter;function hat(){return Array.from(this.children)}function fat(e){return function(){return uat.call(this.children,e)}}function dat(e){return this.selectAll(e==null?hat:fat(typeof e=="function"?e:cA(e)))}function pat(e){typeof e!="function"&&(e=Cw(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var o=t[r],i=o.length,a=s[r]=[],c,l=0;l<i;++l)(c=o[l])&&e.call(c,c.__data__,l,o)&&a.push(c);return new Bn(s,this._parents)}function lA(e){return new Array(e.length)}function mat(){return new Bn(this._enter||this._groups.map(lA),this._parents)}function $d(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}$d.prototype={constructor:$d,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function gat(e){return function(){return e}}function xat(e,t,n,s,r,o){for(var i=0,a,c=t.length,l=o.length;i<l;++i)(a=t[i])?(a.__data__=o[i],s[i]=a):n[i]=new $d(e,o[i]);for(;i<c;++i)(a=t[i])&&(r[i]=a)}function bat(e,t,n,s,r,o,i){var a,c,l=new Map,u=t.length,h=o.length,f=new Array(u),d;for(a=0;a<u;++a)(c=t[a])&&(f[a]=d=i.call(c,c.__data__,a,t)+"",l.has(d)?r[a]=c:l.set(d,c));for(a=0;a<h;++a)d=i.call(e,o[a],a,o)+"",(c=l.get(d))?(s[a]=c,c.__data__=o[a],l.delete(d)):n[a]=new $d(e,o[a]);for(a=0;a<u;++a)(c=t[a])&&l.get(f[a])===c&&(r[a]=c)}function yat(e){return e.__data__}function wat(e,t){if(!arguments.length)return Array.from(this,yat);var n=t?bat:xat,s=this._parents,r=this._groups;typeof e!="function"&&(e=gat(e));for(var o=r.length,i=new Array(o),a=new Array(o),c=new Array(o),l=0;l<o;++l){var u=s[l],h=r[l],f=h.length,d=vat(e.call(u,u&&u.__data__,l,s)),p=d.length,g=a[l]=new Array(p),m=i[l]=new Array(p),x=c[l]=new Array(f);n(u,h,g,m,x,d,t);for(var b=0,w=0,y,v;b<p;++b)if(y=g[b]){for(b>=w&&(w=b+1);!(v=m[w])&&++w<p;);y._next=v||null}}return i=new Bn(i,s),i._enter=a,i._exit=c,i}function vat(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $at(){return new Bn(this._exit||this._groups.map(lA),this._parents)}function Cat(e,t,n){var s=this.enter(),r=this,o=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?o.remove():n(o),s&&r?s.merge(r).order():r}function kat(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,o=s.length,i=Math.min(r,o),a=new Array(r),c=0;c<i;++c)for(var l=n[c],u=s[c],h=l.length,f=a[c]=new Array(h),d,p=0;p<h;++p)(d=l[p]||u[p])&&(f[p]=d);for(;c<r;++c)a[c]=n[c];return new Bn(a,this._parents)}function Iat(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,o=s[r],i;--r>=0;)(i=s[r])&&(o&&i.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(i,o),o=i);return this}function Sat(e){e||(e=Nat);function t(h,f){return h&&f?e(h.__data__,f.__data__):!h-!f}for(var n=this._groups,s=n.length,r=new Array(s),o=0;o<s;++o){for(var i=n[o],a=i.length,c=r[o]=new Array(a),l,u=0;u<a;++u)(l=i[u])&&(c[u]=l);c.sort(t)}return new Bn(r,this._parents).order()}function Nat(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function _at(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Tat(){return Array.from(this)}function Eat(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,o=s.length;r<o;++r){var i=s[r];if(i)return i}return null}function Rat(){let e=0;for(const t of this)++e;return e}function Aat(){return!this.node()}function Dat(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],o=0,i=r.length,a;o<i;++o)(a=r[o])&&e.call(a,a.__data__,o,r);return this}function Mat(e){return function(){this.removeAttribute(e)}}function Fat(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Oat(e,t){return function(){this.setAttribute(e,t)}}function Lat(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Pat(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function zat(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Bat(e,t){var n=Ih(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?Fat:Mat:typeof t=="function"?n.local?zat:Pat:n.local?Lat:Oat)(n,t))}function kw(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Vat(e){return function(){this.style.removeProperty(e)}}function Wat(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Uat(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function Gat(e,t,n){return arguments.length>1?this.each((t==null?Vat:typeof t=="function"?Uat:Wat)(e,t,n??"")):Gi(this.node(),e)}function Gi(e,t){return e.style.getPropertyValue(t)||kw(e).getComputedStyle(e,null).getPropertyValue(t)}function Hat(e){return function(){delete this[e]}}function qat(e,t){return function(){this[e]=t}}function Xat(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function jat(e,t){return arguments.length>1?this.each((t==null?Hat:typeof t=="function"?Xat:qat)(e,t)):this.node()[e]}function uA(e){return e.trim().split(/^|\s+/)}function Iw(e){return e.classList||new hA(e)}function hA(e){this._node=e,this._names=uA(e.getAttribute("class")||"")}hA.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function fA(e,t){for(var n=Iw(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function dA(e,t){for(var n=Iw(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function Kat(e){return function(){fA(this,e)}}function Yat(e){return function(){dA(this,e)}}function Zat(e,t){return function(){(t.apply(this,arguments)?fA:dA)(this,e)}}function Qat(e,t){var n=uA(e+"");if(arguments.length<2){for(var s=Iw(this.node()),r=-1,o=n.length;++r<o;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Zat:t?Kat:Yat)(n,t))}function Jat(){this.textContent=""}function tct(e){return function(){this.textContent=e}}function ect(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function nct(e){return arguments.length?this.each(e==null?Jat:(typeof e=="function"?ect:tct)(e)):this.node().textContent}function sct(){this.innerHTML=""}function rct(e){return function(){this.innerHTML=e}}function oct(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ict(e){return arguments.length?this.each(e==null?sct:(typeof e=="function"?oct:rct)(e)):this.node().innerHTML}function act(){this.nextSibling&&this.parentNode.appendChild(this)}function cct(){return this.each(act)}function lct(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uct(){return this.each(lct)}function hct(e){var t=typeof e=="function"?e:qm(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function fct(){return null}function dct(e,t){var n=typeof e=="function"?e:qm(e),s=t==null?fct:typeof t=="function"?t:Xm(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function pct(){var e=this.parentNode;e&&e.removeChild(this)}function mct(){return this.each(pct)}function gct(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function xct(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function bct(e){return this.select(e?xct:gct)}function yct(e){return arguments.length?this.property("__data__",e):this.node().__data__}function wct(e){return function(t){e.call(this,t,this.__data__)}}function vct(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function $ct(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,o;n<r;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++s]=o;++s?t.length=s:delete this.__on}}}function Cct(e,t,n){return function(){var s=this.__on,r,o=wct(t);if(s){for(var i=0,a=s.length;i<a;++i)if((r=s[i]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=t;return}}this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},s?s.push(r):this.__on=[r]}}function kct(e,t,n){var s=vct(e+""),r,o=s.length,i;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(r=0,u=a[c];r<o;++r)if((i=s[r]).type===u.type&&i.name===u.name)return u.value}return}for(a=t?Cct:$ct,r=0;r<o;++r)this.each(a(s[r],t,n));return this}function pA(e,t,n){var s=kw(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Ict(e,t){return function(){return pA(this,e,t)}}function Sct(e,t){return function(){return pA(this,e,t.apply(this,arguments))}}function Nct(e,t){return this.each((typeof t=="function"?Sct:Ict)(e,t))}function*_ct(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,o=s.length,i;r<o;++r)(i=s[r])&&(yield i)}var Sw=[null];function Bn(e,t){this._groups=e,this._parents=t}function la(){return new Bn([[document.documentElement]],Sw)}function Tct(){return this}Bn.prototype=la.prototype={constructor:Bn,select:nat,selectAll:oat,selectChild:lat,selectChildren:dat,filter:pat,data:wat,enter:mat,exit:$at,join:Cat,merge:kat,selection:Tct,order:Iat,sort:Sat,call:_at,nodes:Tat,node:Eat,size:Rat,empty:Aat,each:Dat,attr:Bat,style:Gat,property:jat,classed:Qat,text:nct,html:ict,raise:cct,lower:uct,append:hct,insert:dct,remove:mct,clone:bct,datum:yct,on:kct,dispatch:Nct,[Symbol.iterator]:_ct};function Jt(e){return typeof e=="string"?new Bn([[document.querySelector(e)]],[document.documentElement]):new Bn([[e]],Sw)}function Ect(e){return Jt(qm(e).call(document.documentElement))}var Rct=0;function mA(){return new D1}function D1(){this._="@"+(++Rct).toString(36)}D1.prototype=mA.prototype={constructor:D1,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};function gA(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Yn(e,t){if(e=gA(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}function Act(e,t){return e.target&&(e=gA(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,n=>Yn(n,t))}function Dct(e){return typeof e=="string"?new Bn([document.querySelectorAll(e)],[document.documentElement]):new Bn([aA(e)],Sw)}const Mct={passive:!1},Xl={capture:!0,passive:!1};function i0(e){e.stopImmediatePropagation()}function za(e){e.preventDefault(),e.stopImmediatePropagation()}function jm(e){var t=e.document.documentElement,n=Jt(e).on("dragstart.drag",za,Xl);"onselectstart"in t?n.on("selectstart.drag",za,Xl):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Km(e,t){var n=e.document.documentElement,s=Jt(e).on("dragstart.drag",null);t&&(s.on("click.drag",za,Xl),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const tf=e=>()=>e;function M1(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:o,x:i,y:a,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}M1.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Fct(e){return!e.ctrlKey&&!e.button}function Oct(){return this.parentNode}function Lct(e,t){return t??{x:e.x,y:e.y}}function Pct(){return navigator.maxTouchPoints||"ontouchstart"in this}function xA(){var e=Fct,t=Oct,n=Lct,s=Pct,r={},o=ca("start","drag","end"),i=0,a,c,l,u,h=0;function f(y){y.on("mousedown.drag",d).filter(s).on("touchstart.drag",m).on("touchmove.drag",x,Mct).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(y,v){if(!(u||!e.call(this,y,v))){var $=w(this,t.call(this,y,v),y,v,"mouse");$&&(Jt(y.view).on("mousemove.drag",p,Xl).on("mouseup.drag",g,Xl),jm(y.view),i0(y),l=!1,a=y.clientX,c=y.clientY,$("start",y))}}function p(y){if(za(y),!l){var v=y.clientX-a,$=y.clientY-c;l=v*v+$*$>h}r.mouse("drag",y)}function g(y){Jt(y.view).on("mousemove.drag mouseup.drag",null),Km(y.view,l),za(y),r.mouse("end",y)}function m(y,v){if(e.call(this,y,v)){var $=y.changedTouches,I=t.call(this,y,v),N=$.length,k,S;for(k=0;k<N;++k)(S=w(this,I,y,v,$[k].identifier,$[k]))&&(i0(y),S("start",y,$[k]))}}function x(y){var v=y.changedTouches,$=v.length,I,N;for(I=0;I<$;++I)(N=r[v[I].identifier])&&(za(y),N("drag",y,v[I]))}function b(y){var v=y.changedTouches,$=v.length,I,N;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),I=0;I<$;++I)(N=r[v[I].identifier])&&(i0(y),N("end",y,v[I]))}function w(y,v,$,I,N,k){var S=o.copy(),C=Yn(k||$,v),A,R,_;if((_=n.call(y,new M1("beforestart",{sourceEvent:$,target:f,identifier:N,active:i,x:C[0],y:C[1],dx:0,dy:0,dispatch:S}),I))!=null)return A=_.x-C[0]||0,R=_.y-C[1]||0,function T(E,M,O){var L=C,B;switch(E){case"start":r[N]=T,B=i++;break;case"end":delete r[N],--i;case"drag":C=Yn(O||M,v),B=i;break}S.call(E,y,new M1(E,{sourceEvent:M,subject:_,target:f,identifier:N,active:B,x:C[0]+A,y:C[1]+R,dx:C[0]-L[0],dy:C[1]-L[1],dispatch:S}),I)}}return f.filter=function(y){return arguments.length?(e=typeof y=="function"?y:tf(!!y),f):e},f.container=function(y){return arguments.length?(t=typeof y=="function"?y:tf(y),f):t},f.subject=function(y){return arguments.length?(n=typeof y=="function"?y:tf(y),f):n},f.touchable=function(y){return arguments.length?(s=typeof y=="function"?y:tf(!!y),f):s},f.on=function(){var y=o.on.apply(o,arguments);return y===o?f:y},f.clickDistance=function(y){return arguments.length?(h=(y=+y)*y,f):Math.sqrt(h)},f}function Vc(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Sh(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function Qo(){}var Hi=.7,ic=1/Hi,Ba="\\s*([+-]?\\d+)\\s*",jl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",kr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zct=/^#([0-9a-f]{3,8})$/,Bct=new RegExp(`^rgb\\(${Ba},${Ba},${Ba}\\)$`),Vct=new RegExp(`^rgb\\(${kr},${kr},${kr}\\)$`),Wct=new RegExp(`^rgba\\(${Ba},${Ba},${Ba},${jl}\\)$`),Uct=new RegExp(`^rgba\\(${kr},${kr},${kr},${jl}\\)$`),Gct=new RegExp(`^hsl\\(${jl},${kr},${kr}\\)$`),Hct=new RegExp(`^hsla\\(${jl},${kr},${kr},${jl}\\)$`),R$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Vc(Qo,zo,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:A$,formatHex:A$,formatHex8:qct,formatHsl:Xct,formatRgb:D$,toString:D$});function A$(){return this.rgb().formatHex()}function qct(){return this.rgb().formatHex8()}function Xct(){return bA(this).formatHsl()}function D$(){return this.rgb().formatRgb()}function zo(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=zct.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?M$(t):n===3?new je(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?ef(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?ef(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Bct.exec(e))?new je(t[1],t[2],t[3],1):(t=Vct.exec(e))?new je(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Wct.exec(e))?ef(t[1],t[2],t[3],t[4]):(t=Uct.exec(e))?ef(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Gct.exec(e))?L$(t[1],t[2]/100,t[3]/100,1):(t=Hct.exec(e))?L$(t[1],t[2]/100,t[3]/100,t[4]):R$.hasOwnProperty(e)?M$(R$[e]):e==="transparent"?new je(NaN,NaN,NaN,0):null}function M$(e){return new je(e>>16&255,e>>8&255,e&255,1)}function ef(e,t,n,s){return s<=0&&(e=t=n=NaN),new je(e,t,n,s)}function Nw(e){return e instanceof Qo||(e=zo(e)),e?(e=e.rgb(),new je(e.r,e.g,e.b,e.opacity)):new je}function ac(e,t,n,s){return arguments.length===1?Nw(e):new je(e,t,n,s??1)}function je(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}Vc(je,ac,Sh(Qo,{brighter(e){return e=e==null?ic:Math.pow(ic,e),new je(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Hi:Math.pow(Hi,e),new je(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new je(vi(this.r),vi(this.g),vi(this.b),Cd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:F$,formatHex:F$,formatHex8:jct,formatRgb:O$,toString:O$}));function F$(){return`#${gi(this.r)}${gi(this.g)}${gi(this.b)}`}function jct(){return`#${gi(this.r)}${gi(this.g)}${gi(this.b)}${gi((isNaN(this.opacity)?1:this.opacity)*255)}`}function O$(){const e=Cd(this.opacity);return`${e===1?"rgb(":"rgba("}${vi(this.r)}, ${vi(this.g)}, ${vi(this.b)}${e===1?")":`, ${e})`}`}function Cd(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function vi(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function gi(e){return e=vi(e),(e<16?"0":"")+e.toString(16)}function L$(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Xs(e,t,n,s)}function bA(e){if(e instanceof Xs)return new Xs(e.h,e.s,e.l,e.opacity);if(e instanceof Qo||(e=zo(e)),!e)return new Xs;if(e instanceof Xs)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),o=Math.max(t,n,s),i=NaN,a=o-r,c=(o+r)/2;return a?(t===o?i=(n-s)/a+(n<s)*6:n===o?i=(s-t)/a+2:i=(t-n)/a+4,a/=c<.5?o+r:2-o-r,i*=60):a=c>0&&c<1?0:i,new Xs(i,a,c,e.opacity)}function kd(e,t,n,s){return arguments.length===1?bA(e):new Xs(e,t,n,s??1)}function Xs(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Vc(Xs,kd,Sh(Qo,{brighter(e){return e=e==null?ic:Math.pow(ic,e),new Xs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Hi:Math.pow(Hi,e),new Xs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new je(a0(e>=240?e-240:e+120,r,s),a0(e,r,s),a0(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new Xs(P$(this.h),nf(this.s),nf(this.l),Cd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Cd(this.opacity);return`${e===1?"hsl(":"hsla("}${P$(this.h)}, ${nf(this.s)*100}%, ${nf(this.l)*100}%${e===1?")":`, ${e})`}`}}));function P$(e){return e=(e||0)%360,e<0?e+360:e}function nf(e){return Math.max(0,Math.min(1,e||0))}function a0(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const yA=Math.PI/180,wA=180/Math.PI,Id=18,vA=.96422,$A=1,CA=.82521,kA=4/29,Va=6/29,IA=3*Va*Va,Kct=Va*Va*Va;function SA(e){if(e instanceof tr)return new tr(e.l,e.a,e.b,e.opacity);if(e instanceof xr)return _A(e);e instanceof je||(e=Nw(e));var t=h0(e.r),n=h0(e.g),s=h0(e.b),r=c0((.2225045*t+.7168786*n+.0606169*s)/$A),o,i;return t===n&&n===s?o=i=r:(o=c0((.4360747*t+.3850649*n+.1430804*s)/vA),i=c0((.0139322*t+.0971045*n+.7141733*s)/CA)),new tr(116*r-16,500*(o-r),200*(r-i),e.opacity)}function Yct(e,t){return new tr(e,0,0,t??1)}function Sd(e,t,n,s){return arguments.length===1?SA(e):new tr(e,t,n,s??1)}function tr(e,t,n,s){this.l=+e,this.a=+t,this.b=+n,this.opacity=+s}Vc(tr,Sd,Sh(Qo,{brighter(e){return new tr(this.l+Id*(e??1),this.a,this.b,this.opacity)},darker(e){return new tr(this.l-Id*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=vA*l0(t),e=$A*l0(e),n=CA*l0(n),new je(u0(3.1338561*t-1.6168667*e-.4906146*n),u0(-.9787684*t+1.9161415*e+.033454*n),u0(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function c0(e){return e>Kct?Math.pow(e,1/3):e/IA+kA}function l0(e){return e>Va?e*e*e:IA*(e-kA)}function u0(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function h0(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function NA(e){if(e instanceof xr)return new xr(e.h,e.c,e.l,e.opacity);if(e instanceof tr||(e=SA(e)),e.a===0&&e.b===0)return new xr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*wA;return new xr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Zct(e,t,n,s){return arguments.length===1?NA(e):new xr(n,t,e,s??1)}function Nd(e,t,n,s){return arguments.length===1?NA(e):new xr(e,t,n,s??1)}function xr(e,t,n,s){this.h=+e,this.c=+t,this.l=+n,this.opacity=+s}function _A(e){if(isNaN(e.h))return new tr(e.l,0,0,e.opacity);var t=e.h*yA;return new tr(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Vc(xr,Nd,Sh(Qo,{brighter(e){return new xr(this.h,this.c,this.l+Id*(e??1),this.opacity)},darker(e){return new xr(this.h,this.c,this.l-Id*(e??1),this.opacity)},rgb(){return _A(this).rgb()}}));var TA=-.14861,_w=1.78277,Tw=-.29227,Ym=-.90649,Kl=1.97294,z$=Kl*Ym,B$=Kl*_w,V$=_w*Tw-Ym*TA;function Qct(e){if(e instanceof $i)return new $i(e.h,e.s,e.l,e.opacity);e instanceof je||(e=Nw(e));var t=e.r/255,n=e.g/255,s=e.b/255,r=(V$*s+z$*t-B$*n)/(V$+z$-B$),o=s-r,i=(Kl*(n-r)-Tw*o)/Ym,a=Math.sqrt(i*i+o*o)/(Kl*r*(1-r)),c=a?Math.atan2(i,o)*wA-120:NaN;return new $i(c<0?c+360:c,a,r,e.opacity)}function rr(e,t,n,s){return arguments.length===1?Qct(e):new $i(e,t,n,s??1)}function $i(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Vc($i,rr,Sh(Qo,{brighter(e){return e=e==null?ic:Math.pow(ic,e),new $i(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Hi:Math.pow(Hi,e),new $i(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*yA,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),s=Math.cos(e),r=Math.sin(e);return new je(255*(t+n*(TA*s+_w*r)),255*(t+n*(Tw*s+Ym*r)),255*(t+n*(Kl*s)),this.opacity)}}));function EA(e,t,n,s,r){var o=e*e,i=o*e;return((1-3*e+3*o-i)*t+(4-6*o+3*i)*n+(1+3*e+3*o-3*i)*s+i*r)/6}function RA(e){var t=e.length-1;return function(n){var s=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[s],o=e[s+1],i=s>0?e[s-1]:2*r-o,a=s<t-1?e[s+2]:2*o-r;return EA((n-s/t)*t,i,r,o,a)}}function AA(e){var t=e.length;return function(n){var s=Math.floor(((n%=1)<0?++n:n)*t),r=e[(s+t-1)%t],o=e[s%t],i=e[(s+1)%t],a=e[(s+2)%t];return EA((n-s/t)*t,r,o,i,a)}}const Zm=e=>()=>e;function DA(e,t){return function(n){return e+n*t}}function Jct(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Qm(e,t){var n=t-e;return n?DA(e,n>180||n<-180?n-360*Math.round(n/360):n):Zm(isNaN(e)?t:e)}function tlt(e){return(e=+e)==1?Ke:function(t,n){return n-t?Jct(t,n,e):Zm(isNaN(t)?n:t)}}function Ke(e,t){var n=t-e;return n?DA(e,n):Zm(isNaN(e)?t:e)}const Yl=function e(t){var n=tlt(t);function s(r,o){var i=n((r=ac(r)).r,(o=ac(o)).r),a=n(r.g,o.g),c=n(r.b,o.b),l=Ke(r.opacity,o.opacity);return function(u){return r.r=i(u),r.g=a(u),r.b=c(u),r.opacity=l(u),r+""}}return s.gamma=e,s}(1);function MA(e){return function(t){var n=t.length,s=new Array(n),r=new Array(n),o=new Array(n),i,a;for(i=0;i<n;++i)a=ac(t[i]),s[i]=a.r||0,r[i]=a.g||0,o[i]=a.b||0;return s=e(s),r=e(r),o=e(o),a.opacity=1,function(c){return a.r=s(c),a.g=r(c),a.b=o(c),a+""}}}var FA=MA(RA),elt=MA(AA);function Ew(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),r;return function(o){for(r=0;r<n;++r)s[r]=e[r]*(1-o)+t[r]*o;return s}}function OA(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nlt(e,t){return(OA(t)?Ew:LA)(e,t)}function LA(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,r=new Array(s),o=new Array(n),i;for(i=0;i<s;++i)r[i]=Jo(e[i],t[i]);for(;i<n;++i)o[i]=t[i];return function(a){for(i=0;i<s;++i)o[i]=r[i](a);return o}}function PA(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Ss(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function zA(e,t){var n={},s={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Jo(e[r],t[r]):s[r]=t[r];return function(o){for(r in n)s[r]=n[r](o);return s}}var F1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,f0=new RegExp(F1.source,"g");function slt(e){return function(){return e}}function rlt(e){return function(t){return e(t)+""}}function Rw(e,t){var n=F1.lastIndex=f0.lastIndex=0,s,r,o,i=-1,a=[],c=[];for(e=e+"",t=t+"";(s=F1.exec(e))&&(r=f0.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),a[i]?a[i]+=o:a[++i]=o),(s=s[0])===(r=r[0])?a[i]?a[i]+=r:a[++i]=r:(a[++i]=null,c.push({i,x:Ss(s,r)})),n=f0.lastIndex;return n<t.length&&(o=t.slice(n),a[i]?a[i]+=o:a[++i]=o),a.length<2?c[0]?rlt(c[0].x):slt(t):(t=c.length,function(l){for(var u=0,h;u<t;++u)a[(h=c[u]).i]=h.x(l);return a.join("")})}function Jo(e,t){var n=typeof t,s;return t==null||n==="boolean"?Zm(t):(n==="number"?Ss:n==="string"?(s=zo(t))?(t=s,Yl):Rw:t instanceof zo?Yl:t instanceof Date?PA:OA(t)?Ew:Array.isArray(t)?LA:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?zA:Ss)(e,t)}function olt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function ilt(e,t){var n=Qm(+e,+t);return function(s){var r=n(s);return r-360*Math.floor(r/360)}}function Jm(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var W$=180/Math.PI,O1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function BA(e,t,n,s,r,o){var i,a,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*n+t*s)&&(n-=e*c,s-=t*c),(a=Math.sqrt(n*n+s*s))&&(n/=a,s/=a,c/=a),e*s<t*n&&(e=-e,t=-t,c=-c,i=-i),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*W$,skewX:Math.atan(c)*W$,scaleX:i,scaleY:a}}var sf;function alt(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?O1:BA(t.a,t.b,t.c,t.d,t.e,t.f)}function clt(e){return e==null||(sf||(sf=document.createElementNS("http://www.w3.org/2000/svg","g")),sf.setAttribute("transform",e),!(e=sf.transform.baseVal.consolidate()))?O1:(e=e.matrix,BA(e.a,e.b,e.c,e.d,e.e,e.f))}function VA(e,t,n,s){function r(l){return l.length?l.pop()+" ":""}function o(l,u,h,f,d,p){if(l!==h||u!==f){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:Ss(l,h)},{i:g-2,x:Ss(u,f)})}else(h||f)&&d.push("translate("+h+t+f+n)}function i(l,u,h,f){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),f.push({i:h.push(r(h)+"rotate(",null,s)-2,x:Ss(l,u)})):u&&h.push(r(h)+"rotate("+u+s)}function a(l,u,h,f){l!==u?f.push({i:h.push(r(h)+"skewX(",null,s)-2,x:Ss(l,u)}):u&&h.push(r(h)+"skewX("+u+s)}function c(l,u,h,f,d,p){if(l!==h||u!==f){var g=d.push(r(d)+"scale(",null,",",null,")");p.push({i:g-4,x:Ss(l,h)},{i:g-2,x:Ss(u,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(l,u){var h=[],f=[];return l=e(l),u=e(u),o(l.translateX,l.translateY,u.translateX,u.translateY,h,f),i(l.rotate,u.rotate,h,f),a(l.skewX,u.skewX,h,f),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,h,f),l=u=null,function(d){for(var p=-1,g=f.length,m;++p<g;)h[(m=f[p]).i]=m.x(d);return h.join("")}}}var WA=VA(alt,"px, ","px)","deg)"),UA=VA(clt,", ",")",")"),llt=1e-12;function U$(e){return((e=Math.exp(e))+1/e)/2}function ult(e){return((e=Math.exp(e))-1/e)/2}function hlt(e){return((e=Math.exp(2*e))-1)/(e+1)}const GA=function e(t,n,s){function r(o,i){var a=o[0],c=o[1],l=o[2],u=i[0],h=i[1],f=i[2],d=u-a,p=h-c,g=d*d+p*p,m,x;if(g<llt)x=Math.log(f/l)/t,m=function(I){return[a+I*d,c+I*p,l*Math.exp(t*I*x)]};else{var b=Math.sqrt(g),w=(f*f-l*l+s*g)/(2*l*n*b),y=(f*f-l*l-s*g)/(2*f*n*b),v=Math.log(Math.sqrt(w*w+1)-w),$=Math.log(Math.sqrt(y*y+1)-y);x=($-v)/t,m=function(I){var N=I*x,k=U$(v),S=l/(n*b)*(k*hlt(t*N+v)-ult(v));return[a+S*d,c+S*p,l*k/U$(t*N+v)]}}return m.duration=x*1e3*t/Math.SQRT2,m}return r.rho=function(o){var i=Math.max(.001,+o),a=i*i,c=a*a;return e(i,a,c)},r}(Math.SQRT2,2,4);function HA(e){return function(t,n){var s=e((t=kd(t)).h,(n=kd(n)).h),r=Ke(t.s,n.s),o=Ke(t.l,n.l),i=Ke(t.opacity,n.opacity);return function(a){return t.h=s(a),t.s=r(a),t.l=o(a),t.opacity=i(a),t+""}}}const flt=HA(Qm);var dlt=HA(Ke);function plt(e,t){var n=Ke((e=Sd(e)).l,(t=Sd(t)).l),s=Ke(e.a,t.a),r=Ke(e.b,t.b),o=Ke(e.opacity,t.opacity);return function(i){return e.l=n(i),e.a=s(i),e.b=r(i),e.opacity=o(i),e+""}}function qA(e){return function(t,n){var s=e((t=Nd(t)).h,(n=Nd(n)).h),r=Ke(t.c,n.c),o=Ke(t.l,n.l),i=Ke(t.opacity,n.opacity);return function(a){return t.h=s(a),t.c=r(a),t.l=o(a),t.opacity=i(a),t+""}}}const mlt=qA(Qm);var glt=qA(Ke);function XA(e){return function t(n){n=+n;function s(r,o){var i=e((r=rr(r)).h,(o=rr(o)).h),a=Ke(r.s,o.s),c=Ke(r.l,o.l),l=Ke(r.opacity,o.opacity);return function(u){return r.h=i(u),r.s=a(u),r.l=c(Math.pow(u,n)),r.opacity=l(u),r+""}}return s.gamma=t,s}(1)}const xlt=XA(Qm);var tg=XA(Ke);function jA(e,t){t===void 0&&(t=e,e=Jo);for(var n=0,s=t.length-1,r=t[0],o=new Array(s<0?0:s);n<s;)o[n]=e(r,r=t[++n]);return function(i){var a=Math.max(0,Math.min(s-1,Math.floor(i*=s)));return o[a](i-a)}}function blt(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e(s/(t-1));return n}var cc=0,hl=0,Zc=0,KA=1e3,_d,fl,Td=0,qi=0,eg=0,Zl=typeof performance=="object"&&performance.now?performance:Date,YA=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Nh(){return qi||(YA(ylt),qi=Zl.now()+eg)}function ylt(){qi=0}function Ql(){this._call=this._time=this._next=null}Ql.prototype=ng.prototype={constructor:Ql,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Nh():+n)+(t==null?0:+t),!this._next&&fl!==this&&(fl?fl._next=this:_d=this,fl=this),this._call=e,this._time=n,L1()},stop:function(){this._call&&(this._call=null,this._time=1/0,L1())}};function ng(e,t,n){var s=new Ql;return s.restart(e,t,n),s}function ZA(){Nh(),++cc;for(var e=_d,t;e;)(t=qi-e._time)>=0&&e._call.call(void 0,t),e=e._next;--cc}function G$(){qi=(Td=Zl.now())+eg,cc=hl=0;try{ZA()}finally{cc=0,vlt(),qi=0}}function wlt(){var e=Zl.now(),t=e-Td;t>KA&&(eg-=t,Td=e)}function vlt(){for(var e,t=_d,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:_d=n);fl=e,L1(s)}function L1(e){if(!cc){hl&&(hl=clearTimeout(hl));var t=e-qi;t>24?(e<1/0&&(hl=setTimeout(G$,e-Zl.now()-eg)),Zc&&(Zc=clearInterval(Zc))):(Zc||(Td=Zl.now(),Zc=setInterval(wlt,KA)),cc=1,YA(G$))}}function P1(e,t,n){var s=new Ql;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}function $lt(e,t,n){var s=new Ql,r=t;return t==null?(s.restart(e,t,n),s):(s._restart=s.restart,s.restart=function(o,i,a){i=+i,a=a==null?Nh():+a,s._restart(function c(l){l+=r,s._restart(c,r+=i,a),o(l)},i,a)},s.restart(e,t,n),s)}var Clt=ca("start","end","cancel","interrupt"),klt=[],QA=0,z1=1,B1=2,Ff=3,H$=4,V1=5,Of=6;function sg(e,t,n,s,r,o){var i=e.__transition;if(!i)e.__transition={};else if(n in i)return;Ilt(e,n,{name:t,index:s,group:r,on:Clt,tween:klt,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:QA})}function Aw(e,t){var n=cr(e,t);if(n.state>QA)throw new Error("too late; already scheduled");return n}function Dr(e,t){var n=cr(e,t);if(n.state>Ff)throw new Error("too late; already running");return n}function cr(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ilt(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=ng(o,0,n.time);function o(l){n.state=z1,n.timer.restart(i,n.delay,n.time),n.delay<=l&&i(l-n.delay)}function i(l){var u,h,f,d;if(n.state!==z1)return c();for(u in s)if(d=s[u],d.name===n.name){if(d.state===Ff)return P1(i);d.state===H$?(d.state=Of,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete s[u]):+u<t&&(d.state=Of,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete s[u])}if(P1(function(){n.state===Ff&&(n.state=H$,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=B1,n.on.call("start",e,e.__data__,n.index,n.group),n.state===B1){for(n.state=Ff,r=new Array(f=n.tween.length),u=0,h=-1;u<f;++u)(d=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function a(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=V1,1),h=-1,f=r.length;++h<f;)r[h].call(e,u);n.state===V1&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Of,n.timer.stop(),delete s[t];for(var l in s)return;delete e.__transition}}function Ci(e,t){var n=e.__transition,s,r,o=!0,i;if(n){t=t==null?null:t+"";for(i in n){if((s=n[i]).name!==t){o=!1;continue}r=s.state>B1&&s.state<V1,s.state=Of,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[i]}o&&delete e.__transition}}function Slt(e){return this.each(function(){Ci(this,e)})}function Nlt(e,t){var n,s;return function(){var r=Dr(this,e),o=r.tween;if(o!==n){s=n=o;for(var i=0,a=s.length;i<a;++i)if(s[i].name===t){s=s.slice(),s.splice(i,1);break}}r.tween=s}}function _lt(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var o=Dr(this,e),i=o.tween;if(i!==s){r=(s=i).slice();for(var a={name:t,value:n},c=0,l=r.length;c<l;++c)if(r[c].name===t){r[c]=a;break}c===l&&r.push(a)}o.tween=r}}function Tlt(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=cr(this.node(),n).tween,r=0,o=s.length,i;r<o;++r)if((i=s[r]).name===e)return i.value;return null}return this.each((t==null?Nlt:_lt)(n,e,t))}function Dw(e,t,n){var s=e._id;return e.each(function(){var r=Dr(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return cr(r,s).value[t]}}function JA(e,t){var n;return(typeof t=="number"?Ss:t instanceof zo?Yl:(n=zo(t))?(t=n,Yl):Rw)(e,t)}function Elt(e){return function(){this.removeAttribute(e)}}function Rlt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Alt(e,t,n){var s,r=n+"",o;return function(){var i=this.getAttribute(e);return i===r?null:i===s?o:o=t(s=i,n)}}function Dlt(e,t,n){var s,r=n+"",o;return function(){var i=this.getAttributeNS(e.space,e.local);return i===r?null:i===s?o:o=t(s=i,n)}}function Mlt(e,t,n){var s,r,o;return function(){var i,a=n(this),c;return a==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=a+"",i===c?null:i===s&&c===r?o:(r=c,o=t(s=i,a)))}}function Flt(e,t,n){var s,r,o;return function(){var i,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=a+"",i===c?null:i===s&&c===r?o:(r=c,o=t(s=i,a)))}}function Olt(e,t){var n=Ih(e),s=n==="transform"?UA:JA;return this.attrTween(e,typeof t=="function"?(n.local?Flt:Mlt)(n,s,Dw(this,"attr."+e,t)):t==null?(n.local?Rlt:Elt)(n):(n.local?Dlt:Alt)(n,s,t))}function Llt(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Plt(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function zlt(e,t){var n,s;function r(){var o=t.apply(this,arguments);return o!==s&&(n=(s=o)&&Plt(e,o)),n}return r._value=t,r}function Blt(e,t){var n,s;function r(){var o=t.apply(this,arguments);return o!==s&&(n=(s=o)&&Llt(e,o)),n}return r._value=t,r}function Vlt(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=Ih(e);return this.tween(n,(s.local?zlt:Blt)(s,t))}function Wlt(e,t){return function(){Aw(this,e).delay=+t.apply(this,arguments)}}function Ult(e,t){return t=+t,function(){Aw(this,e).delay=t}}function Glt(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Wlt:Ult)(t,e)):cr(this.node(),t).delay}function Hlt(e,t){return function(){Dr(this,e).duration=+t.apply(this,arguments)}}function qlt(e,t){return t=+t,function(){Dr(this,e).duration=t}}function Xlt(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Hlt:qlt)(t,e)):cr(this.node(),t).duration}function jlt(e,t){if(typeof t!="function")throw new Error;return function(){Dr(this,e).ease=t}}function Klt(e){var t=this._id;return arguments.length?this.each(jlt(t,e)):cr(this.node(),t).ease}function Ylt(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Dr(this,e).ease=n}}function Zlt(e){if(typeof e!="function")throw new Error;return this.each(Ylt(this._id,e))}function Qlt(e){typeof e!="function"&&(e=Cw(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var o=t[r],i=o.length,a=s[r]=[],c,l=0;l<i;++l)(c=o[l])&&e.call(c,c.__data__,l,o)&&a.push(c);return new _r(s,this._parents,this._name,this._id)}function Jlt(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,o=Math.min(s,r),i=new Array(s),a=0;a<o;++a)for(var c=t[a],l=n[a],u=c.length,h=i[a]=new Array(u),f,d=0;d<u;++d)(f=c[d]||l[d])&&(h[d]=f);for(;a<s;++a)i[a]=t[a];return new _r(i,this._parents,this._name,this._id)}function tut(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function eut(e,t,n){var s,r,o=tut(t)?Aw:Dr;return function(){var i=o(this,e),a=i.on;a!==s&&(r=(s=a).copy()).on(t,n),i.on=r}}function nut(e,t){var n=this._id;return arguments.length<2?cr(this.node(),n).on.on(e):this.each(eut(n,e,t))}function sut(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function rut(){return this.on("end.remove",sut(this._id))}function out(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Xm(e));for(var s=this._groups,r=s.length,o=new Array(r),i=0;i<r;++i)for(var a=s[i],c=a.length,l=o[i]=new Array(c),u,h,f=0;f<c;++f)(u=a[f])&&(h=e.call(u,u.__data__,f,a))&&("__data__"in u&&(h.__data__=u.__data__),l[f]=h,sg(l[f],t,n,f,l,cr(u,n)));return new _r(o,this._parents,t,n)}function iut(e){var t=this._name,n=this._id;typeof e!="function"&&(e=$w(e));for(var s=this._groups,r=s.length,o=[],i=[],a=0;a<r;++a)for(var c=s[a],l=c.length,u,h=0;h<l;++h)if(u=c[h]){for(var f=e.call(u,u.__data__,h,c),d,p=cr(u,n),g=0,m=f.length;g<m;++g)(d=f[g])&&sg(d,t,n,g,f,p);o.push(f),i.push(u)}return new _r(o,i,t,n)}var aut=la.prototype.constructor;function cut(){return new aut(this._groups,this._parents)}function lut(e,t){var n,s,r;return function(){var o=Gi(this,e),i=(this.style.removeProperty(e),Gi(this,e));return o===i?null:o===n&&i===s?r:r=t(n=o,s=i)}}function t3(e){return function(){this.style.removeProperty(e)}}function uut(e,t,n){var s,r=n+"",o;return function(){var i=Gi(this,e);return i===r?null:i===s?o:o=t(s=i,n)}}function hut(e,t,n){var s,r,o;return function(){var i=Gi(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),Gi(this,e))),i===c?null:i===s&&c===r?o:(r=c,o=t(s=i,a))}}function fut(e,t){var n,s,r,o="style."+t,i="end."+o,a;return function(){var c=Dr(this,e),l=c.on,u=c.value[o]==null?a||(a=t3(t)):void 0;(l!==n||r!==u)&&(s=(n=l).copy()).on(i,r=u),c.on=s}}function dut(e,t,n){var s=(e+="")=="transform"?WA:JA;return t==null?this.styleTween(e,lut(e,s)).on("end.style."+e,t3(e)):typeof t=="function"?this.styleTween(e,hut(e,s,Dw(this,"style."+e,t))).each(fut(this._id,e)):this.styleTween(e,uut(e,s,t),n).on("end.style."+e,null)}function put(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function mut(e,t,n){var s,r;function o(){var i=t.apply(this,arguments);return i!==r&&(s=(r=i)&&put(e,i,n)),s}return o._value=t,o}function gut(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,mut(e,t,n??""))}function xut(e){return function(){this.textContent=e}}function but(e){return function(){var t=e(this);this.textContent=t??""}}function yut(e){return this.tween("text",typeof e=="function"?but(Dw(this,"text",e)):xut(e==null?"":e+""))}function wut(e){return function(t){this.textContent=e.call(this,t)}}function vut(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&wut(r)),t}return s._value=e,s}function $ut(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,vut(e))}function Cut(){for(var e=this._name,t=this._id,n=n3(),s=this._groups,r=s.length,o=0;o<r;++o)for(var i=s[o],a=i.length,c,l=0;l<a;++l)if(c=i[l]){var u=cr(c,t);sg(c,e,n,l,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new _r(s,this._parents,e,n)}function kut(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(o,i){var a={value:i},c={value:function(){--r===0&&o()}};n.each(function(){var l=Dr(this,s),u=l.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),l.on=t}),r===0&&o()})}var Iut=0;function _r(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function e3(e){return la().transition(e)}function n3(){return++Iut}var Or=la.prototype;_r.prototype=e3.prototype={constructor:_r,select:out,selectAll:iut,selectChild:Or.selectChild,selectChildren:Or.selectChildren,filter:Qlt,merge:Jlt,selection:cut,transition:Cut,call:Or.call,nodes:Or.nodes,node:Or.node,size:Or.size,empty:Or.empty,each:Or.each,on:nut,attr:Olt,attrTween:Vlt,style:dut,styleTween:gut,text:yut,textTween:$ut,remove:rut,tween:Tlt,delay:Glt,duration:Xlt,ease:Klt,easeVarying:Zlt,end:kut,[Symbol.iterator]:Or[Symbol.iterator]};const Sut=e=>+e;function Nut(e){return e*e}function _ut(e){return e*(2-e)}function q$(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function Tut(e){return e*e*e}function Eut(e){return--e*e*e+1}function W1(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Mw=3,Rut=function e(t){t=+t;function n(s){return Math.pow(s,t)}return n.exponent=e,n}(Mw),Aut=function e(t){t=+t;function n(s){return 1-Math.pow(1-s,t)}return n.exponent=e,n}(Mw),X$=function e(t){t=+t;function n(s){return((s*=2)<=1?Math.pow(s,t):2-Math.pow(2-s,t))/2}return n.exponent=e,n}(Mw),s3=Math.PI,r3=s3/2;function Dut(e){return+e==1?1:1-Math.cos(e*r3)}function Mut(e){return Math.sin(e*r3)}function j$(e){return(1-Math.cos(s3*e))/2}function Bo(e){return(Math.pow(2,-10*e)-.0009765625)*1.0009775171065494}function Fut(e){return Bo(1-+e)}function Out(e){return 1-Bo(e)}function K$(e){return((e*=2)<=1?Bo(1-e):2-Bo(e-1))/2}function Lut(e){return 1-Math.sqrt(1-e*e)}function Put(e){return Math.sqrt(1- --e*e)}function Y$(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}var U1=4/11,zut=6/11,But=8/11,Vut=3/4,Wut=9/11,Uut=10/11,Gut=15/16,Hut=21/22,qut=63/64,rf=1/U1/U1;function Xut(e){return 1-Jl(1-e)}function Jl(e){return(e=+e)<U1?rf*e*e:e<But?rf*(e-=zut)*e+Vut:e<Uut?rf*(e-=Wut)*e+Gut:rf*(e-=Hut)*e+qut}function jut(e){return((e*=2)<=1?1-Jl(1-e):Jl(e-1)+1)/2}var Fw=1.70158,Kut=function e(t){t=+t;function n(s){return(s=+s)*s*(t*(s-1)+s)}return n.overshoot=e,n}(Fw),Yut=function e(t){t=+t;function n(s){return--s*s*((s+1)*t+s)+1}return n.overshoot=e,n}(Fw),Z$=function e(t){t=+t;function n(s){return((s*=2)<1?s*s*((t+1)*s-t):(s-=2)*s*((t+1)*s+t)+2)/2}return n.overshoot=e,n}(Fw),lc=2*Math.PI,Ow=1,Lw=.3,Zut=function e(t,n){var s=Math.asin(1/(t=Math.max(1,t)))*(n/=lc);function r(o){return t*Bo(- --o)*Math.sin((s-o)/n)}return r.amplitude=function(o){return e(o,n*lc)},r.period=function(o){return e(t,o)},r}(Ow,Lw),Q$=function e(t,n){var s=Math.asin(1/(t=Math.max(1,t)))*(n/=lc);function r(o){return 1-t*Bo(o=+o)*Math.sin((o+s)/n)}return r.amplitude=function(o){return e(o,n*lc)},r.period=function(o){return e(t,o)},r}(Ow,Lw),Qut=function e(t,n){var s=Math.asin(1/(t=Math.max(1,t)))*(n/=lc);function r(o){return((o=o*2-1)<0?t*Bo(-o)*Math.sin((s-o)/n):2-t*Bo(o)*Math.sin((s+o)/n))/2}return r.amplitude=function(o){return e(o,n*lc)},r.period=function(o){return e(t,o)},r}(Ow,Lw),Jut={time:null,delay:0,duration:250,ease:W1};function tht(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function eht(e){var t,n;e instanceof _r?(t=e._id,e=e._name):(t=n3(),(n=Jut).time=Nh(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,o=0;o<r;++o)for(var i=s[o],a=i.length,c,l=0;l<a;++l)(c=i[l])&&sg(c,e,t,l,i,n||tht(c,t));return new _r(s,this._parents,e,t)}la.prototype.interrupt=Slt;la.prototype.transition=eht;var nht=[null];function sht(e,t){var n=e.__transition,s,r;if(n){t=t==null?null:t+"";for(r in n)if((s=n[r]).state>z1&&s.name===t)return new _r([[e]],nht,t,+r)}return null}const d0=e=>()=>e;function rht(e,{sourceEvent:t,target:n,selection:s,mode:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:s,enumerable:!0,configurable:!0},mode:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function oht(e){e.stopImmediatePropagation()}function p0(e){e.preventDefault(),e.stopImmediatePropagation()}var J$={name:"drag"},m0={name:"space"},ba={name:"handle"},ya={name:"center"};const{abs:tC,max:hn,min:fn}=Math;function eC(e){return[+e[0],+e[1]]}function G1(e){return[eC(e[0]),eC(e[1])]}var Lf={name:"x",handles:["w","e"].map(tu),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Pf={name:"y",handles:["n","s"].map(tu),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},iht={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(tu),input:function(e){return e==null?null:G1(e)},output:function(e){return e}},Lr={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},nC={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},sC={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},aht={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},cht={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function tu(e){return{type:e}}function lht(e){return!e.ctrlKey&&!e.button}function uht(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function hht(){return navigator.maxTouchPoints||"ontouchstart"in this}function g0(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function fht(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function dht(e){var t=e.__brush;return t?t.dim.output(t.selection):null}function pht(){return Pw(Lf)}function mht(){return Pw(Pf)}function ght(){return Pw(iht)}function Pw(e){var t=uht,n=lht,s=hht,r=!0,o=ca("start","brush","end"),i=6,a;function c(m){var x=m.property("__brush",g).selectAll(".overlay").data([tu("overlay")]);x.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Lr.overlay).merge(x).each(function(){var w=g0(this).extent;Jt(this).attr("x",w[0][0]).attr("y",w[0][1]).attr("width",w[1][0]-w[0][0]).attr("height",w[1][1]-w[0][1])}),m.selectAll(".selection").data([tu("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Lr.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var b=m.selectAll(".handle").data(e.handles,function(w){return w.type});b.exit().remove(),b.enter().append("rect").attr("class",function(w){return"handle handle--"+w.type}).attr("cursor",function(w){return Lr[w.type]}),m.each(l).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(s).on("touchstart.brush",f).on("touchmove.brush",d).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}c.move=function(m,x,b){m.tween?m.on("start.brush",function(w){u(this,arguments).beforestart().start(w)}).on("interrupt.brush end.brush",function(w){u(this,arguments).end(w)}).tween("brush",function(){var w=this,y=w.__brush,v=u(w,arguments),$=y.selection,I=e.input(typeof x=="function"?x.apply(this,arguments):x,y.extent),N=Jo($,I);function k(S){y.selection=S===1&&I===null?null:N(S),l.call(w),v.brush()}return $!==null&&I!==null?k:k(1)}):m.each(function(){var w=this,y=arguments,v=w.__brush,$=e.input(typeof x=="function"?x.apply(w,y):x,v.extent),I=u(w,y).beforestart();Ci(w),v.selection=$===null?null:$,l.call(w),I.start(b).brush(b).end(b)})},c.clear=function(m,x){c.move(m,null,x)};function l(){var m=Jt(this),x=g0(this).selection;x?(m.selectAll(".selection").style("display",null).attr("x",x[0][0]).attr("y",x[0][1]).attr("width",x[1][0]-x[0][0]).attr("height",x[1][1]-x[0][1]),m.selectAll(".handle").style("display",null).attr("x",function(b){return b.type[b.type.length-1]==="e"?x[1][0]-i/2:x[0][0]-i/2}).attr("y",function(b){return b.type[0]==="s"?x[1][1]-i/2:x[0][1]-i/2}).attr("width",function(b){return b.type==="n"||b.type==="s"?x[1][0]-x[0][0]+i:i}).attr("height",function(b){return b.type==="e"||b.type==="w"?x[1][1]-x[0][1]+i:i})):m.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function u(m,x,b){var w=m.__brush.emitter;return w&&(!b||!w.clean)?w:new h(m,x,b)}function h(m,x,b){this.that=m,this.args=x,this.state=m.__brush,this.active=0,this.clean=b}h.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(m,x){return this.starting?(this.starting=!1,this.emit("start",m,x)):this.emit("brush",m),this},brush:function(m,x){return this.emit("brush",m,x),this},end:function(m,x){return--this.active===0&&(delete this.state.emitter,this.emit("end",m,x)),this},emit:function(m,x,b){var w=Jt(this.that).datum();o.call(m,this.that,new rht(m,{sourceEvent:x,target:c,selection:e.output(this.state.selection),mode:b,dispatch:o}),w)}};function f(m){if(a&&!m.touches||!n.apply(this,arguments))return;var x=this,b=m.target.__data__.type,w=(r&&m.metaKey?b="overlay":b)==="selection"?J$:r&&m.altKey?ya:ba,y=e===Pf?null:aht[b],v=e===Lf?null:cht[b],$=g0(x),I=$.extent,N=$.selection,k=I[0][0],S,C,A=I[0][1],R,_,T=I[1][0],E,M,O=I[1][1],L,B,G=0,q=0,Y,tt=y&&v&&r&&m.shiftKey,J,st,rt=Array.from(m.touches||[m],ut=>{const _t=ut.identifier;return ut=Yn(ut,x),ut.point0=ut.slice(),ut.identifier=_t,ut});Ci(x);var ft=u(x,arguments,!0).beforestart();if(b==="overlay"){N&&(Y=!0);const ut=[rt[0],rt[1]||rt[0]];$.selection=N=[[S=e===Pf?k:fn(ut[0][0],ut[1][0]),R=e===Lf?A:fn(ut[0][1],ut[1][1])],[E=e===Pf?T:hn(ut[0][0],ut[1][0]),L=e===Lf?O:hn(ut[0][1],ut[1][1])]],rt.length>1&&It(m)}else S=N[0][0],R=N[0][1],E=N[1][0],L=N[1][1];C=S,_=R,M=E,B=L;var Z=Jt(x).attr("pointer-events","none"),ot=Z.selectAll(".overlay").attr("cursor",Lr[b]);if(m.touches)ft.moved=Q,ft.ended=$t;else{var at=Jt(m.view).on("mousemove.brush",Q,!0).on("mouseup.brush",$t,!0);r&&at.on("keydown.brush",Rt,!0).on("keyup.brush",Tt,!0),jm(m.view)}l.call(x),ft.start(m,w.name);function Q(ut){for(const _t of ut.changedTouches||[ut])for(const kn of rt)kn.identifier===_t.identifier&&(kn.cur=Yn(_t,x));if(tt&&!J&&!st&&rt.length===1){const _t=rt[0];tC(_t.cur[0]-_t[0])>tC(_t.cur[1]-_t[1])?st=!0:J=!0}for(const _t of rt)_t.cur&&(_t[0]=_t.cur[0],_t[1]=_t.cur[1]);Y=!0,p0(ut),It(ut)}function It(ut){const _t=rt[0],kn=_t.point0;var ee;switch(G=_t[0]-kn[0],q=_t[1]-kn[1],w){case m0:case J$:{y&&(G=hn(k-S,fn(T-E,G)),C=S+G,M=E+G),v&&(q=hn(A-R,fn(O-L,q)),_=R+q,B=L+q);break}case ba:{rt[1]?(y&&(C=hn(k,fn(T,rt[0][0])),M=hn(k,fn(T,rt[1][0])),y=1),v&&(_=hn(A,fn(O,rt[0][1])),B=hn(A,fn(O,rt[1][1])),v=1)):(y<0?(G=hn(k-S,fn(T-S,G)),C=S+G,M=E):y>0&&(G=hn(k-E,fn(T-E,G)),C=S,M=E+G),v<0?(q=hn(A-R,fn(O-R,q)),_=R+q,B=L):v>0&&(q=hn(A-L,fn(O-L,q)),_=R,B=L+q));break}case ya:{y&&(C=hn(k,fn(T,S-G*y)),M=hn(k,fn(T,E+G*y))),v&&(_=hn(A,fn(O,R-q*v)),B=hn(A,fn(O,L+q*v)));break}}M<C&&(y*=-1,ee=S,S=E,E=ee,ee=C,C=M,M=ee,b in nC&&ot.attr("cursor",Lr[b=nC[b]])),B<_&&(v*=-1,ee=R,R=L,L=ee,ee=_,_=B,B=ee,b in sC&&ot.attr("cursor",Lr[b=sC[b]])),$.selection&&(N=$.selection),J&&(C=N[0][0],M=N[1][0]),st&&(_=N[0][1],B=N[1][1]),(N[0][0]!==C||N[0][1]!==_||N[1][0]!==M||N[1][1]!==B)&&($.selection=[[C,_],[M,B]],l.call(x),ft.brush(ut,w.name))}function $t(ut){if(oht(ut),ut.touches){if(ut.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else Km(ut.view,Y),at.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);Z.attr("pointer-events","all"),ot.attr("cursor",Lr.overlay),$.selection&&(N=$.selection),fht(N)&&($.selection=null,l.call(x)),ft.end(ut,w.name)}function Rt(ut){switch(ut.keyCode){case 16:{tt=y&&v;break}case 18:{w===ba&&(y&&(E=M-G*y,S=C+G*y),v&&(L=B-q*v,R=_+q*v),w=ya,It(ut));break}case 32:{(w===ba||w===ya)&&(y<0?E=M-G:y>0&&(S=C-G),v<0?L=B-q:v>0&&(R=_-q),w=m0,ot.attr("cursor",Lr.selection),It(ut));break}default:return}p0(ut)}function Tt(ut){switch(ut.keyCode){case 16:{tt&&(J=st=tt=!1,It(ut));break}case 18:{w===ya&&(y<0?E=M:y>0&&(S=C),v<0?L=B:v>0&&(R=_),w=ba,It(ut));break}case 32:{w===m0&&(ut.altKey?(y&&(E=M-G*y,S=C+G*y),v&&(L=B-q*v,R=_+q*v),w=ya):(y<0?E=M:y>0&&(S=C),v<0?L=B:v>0&&(R=_),w=ba),ot.attr("cursor",Lr[b]),It(ut));break}default:return}p0(ut)}}function d(m){u(this,arguments).moved(m)}function p(m){u(this,arguments).ended(m)}function g(){var m=this.__brush||{selection:null};return m.extent=G1(t.apply(this,arguments)),m.dim=e,m}return c.extent=function(m){return arguments.length?(t=typeof m=="function"?m:d0(G1(m)),c):t},c.filter=function(m){return arguments.length?(n=typeof m=="function"?m:d0(!!m),c):n},c.touchable=function(m){return arguments.length?(s=typeof m=="function"?m:d0(!!m),c):s},c.handleSize=function(m){return arguments.length?(i=+m,c):i},c.keyModifiers=function(m){return arguments.length?(r=!!m,c):r},c.on=function(){var m=o.on.apply(o,arguments);return m===o?c:m},c}var rC=Math.abs,wa=Math.cos,va=Math.sin,o3=Math.PI,of=o3/2,oC=o3*2,iC=Math.max,x0=1e-12;function b0(e,t){return Array.from({length:t-e},(n,s)=>e+s)}function xht(e){return function(t,n){return e(t.source.value+t.target.value,n.source.value+n.target.value)}}function bht(){return zw(!1,!1)}function yht(){return zw(!1,!0)}function wht(){return zw(!0,!1)}function zw(e,t){var n=0,s=null,r=null,o=null;function i(a){var c=a.length,l=new Array(c),u=b0(0,c),h=new Array(c*c),f=new Array(c),d=0,p;a=Float64Array.from({length:c*c},t?(g,m)=>a[m%c][m/c|0]:(g,m)=>a[m/c|0][m%c]);for(let g=0;g<c;++g){let m=0;for(let x=0;x<c;++x)m+=a[g*c+x]+e*a[x*c+g];d+=l[g]=m}d=iC(0,oC-n*c)/d,p=d?n:oC/c;{let g=0;s&&u.sort((m,x)=>s(l[m],l[x]));for(const m of u){const x=g;if(e){const b=b0(~c+1,c).filter(w=>w<0?a[~w*c+m]:a[m*c+w]);r&&b.sort((w,y)=>r(w<0?-a[~w*c+m]:a[m*c+w],y<0?-a[~y*c+m]:a[m*c+y]));for(const w of b)if(w<0){const y=h[~w*c+m]||(h[~w*c+m]={source:null,target:null});y.target={index:m,startAngle:g,endAngle:g+=a[~w*c+m]*d,value:a[~w*c+m]}}else{const y=h[m*c+w]||(h[m*c+w]={source:null,target:null});y.source={index:m,startAngle:g,endAngle:g+=a[m*c+w]*d,value:a[m*c+w]}}f[m]={index:m,startAngle:x,endAngle:g,value:l[m]}}else{const b=b0(0,c).filter(w=>a[m*c+w]||a[w*c+m]);r&&b.sort((w,y)=>r(a[m*c+w],a[m*c+y]));for(const w of b){let y;if(m<w?(y=h[m*c+w]||(h[m*c+w]={source:null,target:null}),y.source={index:m,startAngle:g,endAngle:g+=a[m*c+w]*d,value:a[m*c+w]}):(y=h[w*c+m]||(h[w*c+m]={source:null,target:null}),y.target={index:m,startAngle:g,endAngle:g+=a[m*c+w]*d,value:a[m*c+w]},m===w&&(y.source=y.target)),y.source&&y.target&&y.source.value<y.target.value){const v=y.source;y.source=y.target,y.target=v}}f[m]={index:m,startAngle:x,endAngle:g,value:l[m]}}g+=p}}return h=Object.values(h),h.groups=f,o?h.sort(o):h}return i.padAngle=function(a){return arguments.length?(n=iC(0,a),i):n},i.sortGroups=function(a){return arguments.length?(s=a,i):s},i.sortSubgroups=function(a){return arguments.length?(r=a,i):r},i.sortChords=function(a){return arguments.length?(a==null?o=null:(o=xht(a))._=a,i):o&&o._},i}const H1=Math.PI,q1=2*H1,ci=1e-6,vht=q1-ci;function i3(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function $ht(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return i3;const n=10**t;return function(s){this._+=s[0];for(let r=1,o=s.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+s[r]}}let _h=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?i3:$ht(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,s,r){this._append`Q${+t},${+n},${this._x1=+s},${this._y1=+r}`}bezierCurveTo(t,n,s,r,o,i){this._append`C${+t},${+n},${+s},${+r},${this._x1=+o},${this._y1=+i}`}arcTo(t,n,s,r,o){if(t=+t,n=+n,s=+s,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let i=this._x1,a=this._y1,c=s-t,l=r-n,u=i-t,h=a-n,f=u*u+h*h;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(f>ci)if(!(Math.abs(h*c-l*u)>ci)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let d=s-i,p=r-a,g=c*c+l*l,m=d*d+p*p,x=Math.sqrt(g),b=Math.sqrt(f),w=o*Math.tan((H1-Math.acos((g+f-m)/(2*x*b)))/2),y=w/b,v=w/x;Math.abs(y-1)>ci&&this._append`L${t+y*u},${n+y*h}`,this._append`A${o},${o},0,0,${+(h*d>u*p)},${this._x1=t+v*c},${this._y1=n+v*l}`}}arc(t,n,s,r,o,i){if(t=+t,n=+n,s=+s,i=!!i,s<0)throw new Error(`negative radius: ${s}`);let a=s*Math.cos(r),c=s*Math.sin(r),l=t+a,u=n+c,h=1^i,f=i?r-o:o-r;this._x1===null?this._append`M${l},${u}`:(Math.abs(this._x1-l)>ci||Math.abs(this._y1-u)>ci)&&this._append`L${l},${u}`,s&&(f<0&&(f=f%q1+q1),f>vht?this._append`A${s},${s},0,1,${h},${t-a},${n-c}A${s},${s},0,1,${h},${this._x1=l},${this._y1=u}`:f>ci&&this._append`A${s},${s},0,${+(f>=H1)},${h},${this._x1=t+s*Math.cos(o)},${this._y1=n+s*Math.sin(o)}`)}rect(t,n,s,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${s=+s}v${+r}h${-s}Z`}toString(){return this._}};function Bw(){return new _h}Bw.prototype=_h.prototype;function Cht(e=3){return new _h(+e)}var kht=Array.prototype.slice;function oi(e){return function(){return e}}function Iht(e){return e.source}function Sht(e){return e.target}function aC(e){return e.radius}function Nht(e){return e.startAngle}function _ht(e){return e.endAngle}function Tht(){return 0}function Eht(){return 10}function a3(e){var t=Iht,n=Sht,s=aC,r=aC,o=Nht,i=_ht,a=Tht,c=null;function l(){var u,h=t.apply(this,arguments),f=n.apply(this,arguments),d=a.apply(this,arguments)/2,p=kht.call(arguments),g=+s.apply(this,(p[0]=h,p)),m=o.apply(this,p)-of,x=i.apply(this,p)-of,b=+r.apply(this,(p[0]=f,p)),w=o.apply(this,p)-of,y=i.apply(this,p)-of;if(c||(c=u=Bw()),d>x0&&(rC(x-m)>d*2+x0?x>m?(m+=d,x-=d):(m-=d,x+=d):m=x=(m+x)/2,rC(y-w)>d*2+x0?y>w?(w+=d,y-=d):(w-=d,y+=d):w=y=(w+y)/2),c.moveTo(g*wa(m),g*va(m)),c.arc(0,0,g,m,x),m!==w||x!==y)if(e){var v=+e.apply(this,arguments),$=b-v,I=(w+y)/2;c.quadraticCurveTo(0,0,$*wa(w),$*va(w)),c.lineTo(b*wa(I),b*va(I)),c.lineTo($*wa(y),$*va(y))}else c.quadraticCurveTo(0,0,b*wa(w),b*va(w)),c.arc(0,0,b,w,y);if(c.quadraticCurveTo(0,0,g*wa(m),g*va(m)),c.closePath(),u)return c=null,u+""||null}return e&&(l.headRadius=function(u){return arguments.length?(e=typeof u=="function"?u:oi(+u),l):e}),l.radius=function(u){return arguments.length?(s=r=typeof u=="function"?u:oi(+u),l):s},l.sourceRadius=function(u){return arguments.length?(s=typeof u=="function"?u:oi(+u),l):s},l.targetRadius=function(u){return arguments.length?(r=typeof u=="function"?u:oi(+u),l):r},l.startAngle=function(u){return arguments.length?(o=typeof u=="function"?u:oi(+u),l):o},l.endAngle=function(u){return arguments.length?(i=typeof u=="function"?u:oi(+u),l):i},l.padAngle=function(u){return arguments.length?(a=typeof u=="function"?u:oi(+u),l):a},l.source=function(u){return arguments.length?(t=u,l):t},l.target=function(u){return arguments.length?(n=u,l):n},l.context=function(u){return arguments.length?(c=u??null,l):c},l}function Rht(){return a3()}function Aht(){return a3(Eht)}var Dht=Array.prototype,c3=Dht.slice;function Mht(e,t){return e-t}function Fht(e){for(var t=0,n=e.length,s=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)s+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return s}const bo=e=>()=>e;function Oht(e,t){for(var n=-1,s=t.length,r;++n<s;)if(r=Lht(e,t[n]))return r;return 0}function Lht(e,t){for(var n=t[0],s=t[1],r=-1,o=0,i=e.length,a=i-1;o<i;a=o++){var c=e[o],l=c[0],u=c[1],h=e[a],f=h[0],d=h[1];if(Pht(c,h,t))return 0;u>s!=d>s&&n<(f-l)*(s-u)/(d-u)+l&&(r=-r)}return r}function Pht(e,t,n){var s;return zht(e,t,n)&&Bht(e[s=+(e[0]===t[0])],n[s],t[s])}function zht(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function Bht(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function Vht(){}var Pr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function X1(){var e=1,t=1,n=bw,s=c;function r(l){var u=n(l);if(Array.isArray(u))u=u.slice().sort(Mht);else{const h=Il(l,Wht);for(u=Wi(...xw(h[0],h[1],u),u);u[u.length-1]>=h[1];)u.pop();for(;u[1]<h[0];)u.shift()}return u.map(h=>o(l,h))}function o(l,u){const h=u==null?NaN:+u;if(isNaN(h))throw new Error(`invalid value: ${u}`);var f=[],d=[];return i(l,h,function(p){s(p,l,h),Fht(p)>0?f.push([p]):d.push(p)}),d.forEach(function(p){for(var g=0,m=f.length,x;g<m;++g)if(Oht((x=f[g])[0],p)!==-1){x.push(p);return}}),{type:"MultiPolygon",value:u,coordinates:f}}function i(l,u,h){var f=new Array,d=new Array,p,g,m,x,b,w;for(p=g=-1,x=ii(l[0],u),Pr[x<<1].forEach(y);++p<e-1;)m=x,x=ii(l[p+1],u),Pr[m|x<<1].forEach(y);for(Pr[x<<0].forEach(y);++g<t-1;){for(p=-1,x=ii(l[g*e+e],u),b=ii(l[g*e],u),Pr[x<<1|b<<2].forEach(y);++p<e-1;)m=x,x=ii(l[g*e+e+p+1],u),w=b,b=ii(l[g*e+p+1],u),Pr[m|x<<1|b<<2|w<<3].forEach(y);Pr[x|b<<3].forEach(y)}for(p=-1,b=l[g*e]>=u,Pr[b<<2].forEach(y);++p<e-1;)w=b,b=ii(l[g*e+p+1],u),Pr[b<<2|w<<3].forEach(y);Pr[b<<3].forEach(y);function y(v){var $=[v[0][0]+p,v[0][1]+g],I=[v[1][0]+p,v[1][1]+g],N=a($),k=a(I),S,C;(S=d[N])?(C=f[k])?(delete d[S.end],delete f[C.start],S===C?(S.ring.push(I),h(S.ring)):f[S.start]=d[C.end]={start:S.start,end:C.end,ring:S.ring.concat(C.ring)}):(delete d[S.end],S.ring.push(I),d[S.end=k]=S):(S=f[k])?(C=d[N])?(delete f[S.start],delete d[C.end],S===C?(S.ring.push(I),h(S.ring)):f[C.start]=d[S.end]={start:C.start,end:S.end,ring:C.ring.concat(S.ring)}):(delete f[S.start],S.ring.unshift($),f[S.start=N]=S):f[N]=d[k]={start:N,end:k,ring:[$,I]}}}function a(l){return l[0]*2+l[1]*(e+1)*4}function c(l,u,h){l.forEach(function(f){var d=f[0],p=f[1],g=d|0,m=p|0,x=y0(u[m*e+g]);d>0&&d<e&&g===d&&(f[0]=cC(d,y0(u[m*e+g-1]),x,h)),p>0&&p<t&&m===p&&(f[1]=cC(p,y0(u[(m-1)*e+g]),x,h))})}return r.contour=o,r.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),h=Math.floor(l[1]);if(!(u>=0&&h>=0))throw new Error("invalid size");return e=u,t=h,r},r.thresholds=function(l){return arguments.length?(n=typeof l=="function"?l:Array.isArray(l)?bo(c3.call(l)):bo(l),r):n},r.smooth=function(l){return arguments.length?(s=l?c:Vht,r):s===c},r}function Wht(e){return isFinite(e)?e:NaN}function ii(e,t){return e==null?!1:+e>=t}function y0(e){return e==null||isNaN(e=+e)?-1/0:e}function cC(e,t,n,s){const r=s-t,o=n-t,i=isFinite(r)||isFinite(o)?r/o:Math.sign(r)/Math.sign(o);return isNaN(i)?e:e+i-.5}function Uht(e){return e[0]}function Ght(e){return e[1]}function Hht(){return 1}function l3(){var e=Uht,t=Ght,n=Hht,s=960,r=500,o=20,i=2,a=o*3,c=s+a*2>>i,l=r+a*2>>i,u=bo(20);function h(b){var w=new Float32Array(c*l),y=Math.pow(2,-i),v=-1;for(const R of b){var $=(e(R,++v,b)+a)*y,I=(t(R,v,b)+a)*y,N=+n(R,v,b);if(N&&$>=0&&$<c&&I>=0&&I<l){var k=Math.floor($),S=Math.floor(I),C=$-k-.5,A=I-S-.5;w[k+S*c]+=(1-C)*(1-A)*N,w[k+1+S*c]+=C*(1-A)*N,w[k+1+(S+1)*c]+=C*A*N,w[k+(S+1)*c]+=(1-C)*A*N}}return BR({data:w,width:c,height:l},o*y),w}function f(b){var w=h(b),y=u(w),v=Math.pow(2,2*i);return Array.isArray(y)||(y=Wi(Number.MIN_VALUE,to(w)/v,y)),X1().size([c,l]).thresholds(y.map($=>$*v))(w).map(($,I)=>($.value=+y[I],d($)))}f.contours=function(b){var w=h(b),y=X1().size([c,l]),v=Math.pow(2,2*i),$=I=>{I=+I;var N=d(y.contour(w,I*v));return N.value=I,N};return Object.defineProperty($,"max",{get:()=>to(w)/v}),$};function d(b){return b.coordinates.forEach(p),b}function p(b){b.forEach(g)}function g(b){b.forEach(m)}function m(b){b[0]=b[0]*Math.pow(2,i)-a,b[1]=b[1]*Math.pow(2,i)-a}function x(){return a=o*3,c=s+a*2>>i,l=r+a*2>>i,f}return f.x=function(b){return arguments.length?(e=typeof b=="function"?b:bo(+b),f):e},f.y=function(b){return arguments.length?(t=typeof b=="function"?b:bo(+b),f):t},f.weight=function(b){return arguments.length?(n=typeof b=="function"?b:bo(+b),f):n},f.size=function(b){if(!arguments.length)return[s,r];var w=+b[0],y=+b[1];if(!(w>=0&&y>=0))throw new Error("invalid size");return s=w,r=y,x()},f.cellSize=function(b){if(!arguments.length)return 1<<i;if(!((b=+b)>=1))throw new Error("invalid cell size");return i=Math.floor(Math.log(b)/Math.LN2),x()},f.thresholds=function(b){return arguments.length?(u=typeof b=="function"?b:Array.isArray(b)?bo(c3.call(b)):bo(b),f):u},f.bandwidth=function(b){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((b=+b)>=0))throw new Error("invalid bandwidth");return o=(Math.sqrt(4*b*b+1)-1)/2,x()},f}const Kr=11102230246251565e-32,dn=134217729,qht=(3+8*Kr)*Kr;function w0(e,t,n,s,r){let o,i,a,c,l=t[0],u=s[0],h=0,f=0;u>l==u>-l?(o=l,l=t[++h]):(o=u,u=s[++f]);let d=0;if(h<e&&f<n)for(u>l==u>-l?(i=l+o,a=o-(i-l),l=t[++h]):(i=u+o,a=o-(i-u),u=s[++f]),o=i,a!==0&&(r[d++]=a);h<e&&f<n;)u>l==u>-l?(i=o+l,c=i-o,a=o-(i-c)+(l-c),l=t[++h]):(i=o+u,c=i-o,a=o-(i-c)+(u-c),u=s[++f]),o=i,a!==0&&(r[d++]=a);for(;h<e;)i=o+l,c=i-o,a=o-(i-c)+(l-c),l=t[++h],o=i,a!==0&&(r[d++]=a);for(;f<n;)i=o+u,c=i-o,a=o-(i-c)+(u-c),u=s[++f],o=i,a!==0&&(r[d++]=a);return(o!==0||d===0)&&(r[d++]=o),d}function Xht(e,t){let n=t[0];for(let s=1;s<e;s++)n+=t[s];return n}function Th(e){return new Float64Array(e)}const jht=(3+16*Kr)*Kr,Kht=(2+12*Kr)*Kr,Yht=(9+64*Kr)*Kr*Kr,$a=Th(4),lC=Th(8),uC=Th(12),hC=Th(16),Sn=Th(4);function Zht(e,t,n,s,r,o,i){let a,c,l,u,h,f,d,p,g,m,x,b,w,y,v,$,I,N;const k=e-r,S=n-r,C=t-o,A=s-o;y=k*A,f=dn*k,d=f-(f-k),p=k-d,f=dn*A,g=f-(f-A),m=A-g,v=p*m-(y-d*g-p*g-d*m),$=C*S,f=dn*C,d=f-(f-C),p=C-d,f=dn*S,g=f-(f-S),m=S-g,I=p*m-($-d*g-p*g-d*m),x=v-I,h=v-x,$a[0]=v-(x+h)+(h-I),b=y+x,h=b-y,w=y-(b-h)+(x-h),x=w-$,h=w-x,$a[1]=w-(x+h)+(h-$),N=b+x,h=N-b,$a[2]=b-(N-h)+(x-h),$a[3]=N;let R=Xht(4,$a),_=Kht*i;if(R>=_||-R>=_||(h=e-k,a=e-(k+h)+(h-r),h=n-S,l=n-(S+h)+(h-r),h=t-C,c=t-(C+h)+(h-o),h=s-A,u=s-(A+h)+(h-o),a===0&&c===0&&l===0&&u===0)||(_=Yht*i+qht*Math.abs(R),R+=k*u+A*a-(C*l+S*c),R>=_||-R>=_))return R;y=a*A,f=dn*a,d=f-(f-a),p=a-d,f=dn*A,g=f-(f-A),m=A-g,v=p*m-(y-d*g-p*g-d*m),$=c*S,f=dn*c,d=f-(f-c),p=c-d,f=dn*S,g=f-(f-S),m=S-g,I=p*m-($-d*g-p*g-d*m),x=v-I,h=v-x,Sn[0]=v-(x+h)+(h-I),b=y+x,h=b-y,w=y-(b-h)+(x-h),x=w-$,h=w-x,Sn[1]=w-(x+h)+(h-$),N=b+x,h=N-b,Sn[2]=b-(N-h)+(x-h),Sn[3]=N;const T=w0(4,$a,4,Sn,lC);y=k*u,f=dn*k,d=f-(f-k),p=k-d,f=dn*u,g=f-(f-u),m=u-g,v=p*m-(y-d*g-p*g-d*m),$=C*l,f=dn*C,d=f-(f-C),p=C-d,f=dn*l,g=f-(f-l),m=l-g,I=p*m-($-d*g-p*g-d*m),x=v-I,h=v-x,Sn[0]=v-(x+h)+(h-I),b=y+x,h=b-y,w=y-(b-h)+(x-h),x=w-$,h=w-x,Sn[1]=w-(x+h)+(h-$),N=b+x,h=N-b,Sn[2]=b-(N-h)+(x-h),Sn[3]=N;const E=w0(T,lC,4,Sn,uC);y=a*u,f=dn*a,d=f-(f-a),p=a-d,f=dn*u,g=f-(f-u),m=u-g,v=p*m-(y-d*g-p*g-d*m),$=c*l,f=dn*c,d=f-(f-c),p=c-d,f=dn*l,g=f-(f-l),m=l-g,I=p*m-($-d*g-p*g-d*m),x=v-I,h=v-x,Sn[0]=v-(x+h)+(h-I),b=y+x,h=b-y,w=y-(b-h)+(x-h),x=w-$,h=w-x,Sn[1]=w-(x+h)+(h-$),N=b+x,h=N-b,Sn[2]=b-(N-h)+(x-h),Sn[3]=N;const M=w0(E,uC,4,Sn,hC);return hC[M-1]}function af(e,t,n,s,r,o){const i=(t-o)*(n-r),a=(e-r)*(s-o),c=i-a,l=Math.abs(i+a);return Math.abs(c)>=jht*l?c:-Zht(e,t,n,s,r,o,l)}const fC=Math.pow(2,-52),cf=new Uint32Array(512);class Ed{static from(t,n=nft,s=sft){const r=t.length,o=new Float64Array(r*2);for(let i=0;i<r;i++){const a=t[i];o[2*i]=n(a),o[2*i+1]=s(a)}return new Ed(o)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const s=Math.max(2*n-5,0);this._triangles=new Uint32Array(s*3),this._halfedges=new Int32Array(s*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:s,_hullTri:r,_hullHash:o}=this,i=t.length>>1;let a=1/0,c=1/0,l=-1/0,u=-1/0;for(let k=0;k<i;k++){const S=t[2*k],C=t[2*k+1];S<a&&(a=S),C<c&&(c=C),S>l&&(l=S),C>u&&(u=C),this._ids[k]=k}const h=(a+l)/2,f=(c+u)/2;let d,p,g;for(let k=0,S=1/0;k<i;k++){const C=v0(h,f,t[2*k],t[2*k+1]);C<S&&(d=k,S=C)}const m=t[2*d],x=t[2*d+1];for(let k=0,S=1/0;k<i;k++){if(k===d)continue;const C=v0(m,x,t[2*k],t[2*k+1]);C<S&&C>0&&(p=k,S=C)}let b=t[2*p],w=t[2*p+1],y=1/0;for(let k=0;k<i;k++){if(k===d||k===p)continue;const S=tft(m,x,b,w,t[2*k],t[2*k+1]);S<y&&(g=k,y=S)}let v=t[2*g],$=t[2*g+1];if(y===1/0){for(let C=0;C<i;C++)this._dists[C]=t[2*C]-t[0]||t[2*C+1]-t[1];Ra(this._ids,this._dists,0,i-1);const k=new Uint32Array(i);let S=0;for(let C=0,A=-1/0;C<i;C++){const R=this._ids[C],_=this._dists[R];_>A&&(k[S++]=R,A=_)}this.hull=k.subarray(0,S),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(af(m,x,b,w,v,$)<0){const k=p,S=b,C=w;p=g,b=v,w=$,g=k,v=S,$=C}const I=eft(m,x,b,w,v,$);this._cx=I.x,this._cy=I.y;for(let k=0;k<i;k++)this._dists[k]=v0(t[2*k],t[2*k+1],I.x,I.y);Ra(this._ids,this._dists,0,i-1),this._hullStart=d;let N=3;s[d]=n[g]=p,s[p]=n[d]=g,s[g]=n[p]=d,r[d]=0,r[p]=1,r[g]=2,o.fill(-1),o[this._hashKey(m,x)]=d,o[this._hashKey(b,w)]=p,o[this._hashKey(v,$)]=g,this.trianglesLen=0,this._addTriangle(d,p,g,-1,-1,-1);for(let k=0,S,C;k<this._ids.length;k++){const A=this._ids[k],R=t[2*A],_=t[2*A+1];if(k>0&&Math.abs(R-S)<=fC&&Math.abs(_-C)<=fC||(S=R,C=_,A===d||A===p||A===g))continue;let T=0;for(let B=0,G=this._hashKey(R,_);B<this._hashSize&&(T=o[(G+B)%this._hashSize],!(T!==-1&&T!==s[T]));B++);T=n[T];let E=T,M;for(;M=s[E],af(R,_,t[2*E],t[2*E+1],t[2*M],t[2*M+1])>=0;)if(E=M,E===T){E=-1;break}if(E===-1)continue;let O=this._addTriangle(E,A,s[E],-1,-1,r[E]);r[A]=this._legalize(O+2),r[E]=O,N++;let L=s[E];for(;M=s[L],af(R,_,t[2*L],t[2*L+1],t[2*M],t[2*M+1])<0;)O=this._addTriangle(L,A,M,r[A],-1,r[L]),r[A]=this._legalize(O+2),s[L]=L,N--,L=M;if(E===T)for(;M=n[E],af(R,_,t[2*M],t[2*M+1],t[2*E],t[2*E+1])<0;)O=this._addTriangle(M,A,E,-1,r[E],r[M]),this._legalize(O+2),r[M]=O,s[E]=E,N--,E=M;this._hullStart=n[A]=E,s[E]=n[L]=A,s[A]=L,o[this._hashKey(R,_)]=A,o[this._hashKey(t[2*E],t[2*E+1])]=E}this.hull=new Uint32Array(N);for(let k=0,S=this._hullStart;k<N;k++)this.hull[k]=S,S=s[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(Qht(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:s,coords:r}=this;let o=0,i=0;for(;;){const a=s[t],c=t-t%3;if(i=c+(t+2)%3,a===-1){if(o===0)break;t=cf[--o];continue}const l=a-a%3,u=c+(t+1)%3,h=l+(a+2)%3,f=n[i],d=n[t],p=n[u],g=n[h];if(Jht(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1],r[2*g],r[2*g+1])){n[t]=g,n[a]=f;const x=s[h];if(x===-1){let w=this._hullStart;do{if(this._hullTri[w]===h){this._hullTri[w]=t;break}w=this._hullPrev[w]}while(w!==this._hullStart)}this._link(t,x),this._link(a,s[i]),this._link(i,h);const b=l+(a+1)%3;o<cf.length&&(cf[o++]=b)}else{if(o===0)break;t=cf[--o]}}return i}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,s,r,o,i){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=s,this._link(a,r),this._link(a+1,o),this._link(a+2,i),this.trianglesLen+=3,a}}function Qht(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function v0(e,t,n,s){const r=e-n,o=t-s;return r*r+o*o}function Jht(e,t,n,s,r,o,i,a){const c=e-i,l=t-a,u=n-i,h=s-a,f=r-i,d=o-a,p=c*c+l*l,g=u*u+h*h,m=f*f+d*d;return c*(h*m-g*d)-l*(u*m-g*f)+p*(u*d-h*f)<0}function tft(e,t,n,s,r,o){const i=n-e,a=s-t,c=r-e,l=o-t,u=i*i+a*a,h=c*c+l*l,f=.5/(i*l-a*c),d=(l*u-a*h)*f,p=(i*h-c*u)*f;return d*d+p*p}function eft(e,t,n,s,r,o){const i=n-e,a=s-t,c=r-e,l=o-t,u=i*i+a*a,h=c*c+l*l,f=.5/(i*l-a*c),d=e+(l*u-a*h)*f,p=t+(i*h-c*u)*f;return{x:d,y:p}}function Ra(e,t,n,s){if(s-n<=20)for(let r=n+1;r<=s;r++){const o=e[r],i=t[o];let a=r-1;for(;a>=n&&t[e[a]]>i;)e[a+1]=e[a--];e[a+1]=o}else{const r=n+s>>1;let o=n+1,i=s;Qc(e,r,o),t[e[n]]>t[e[s]]&&Qc(e,n,s),t[e[o]]>t[e[s]]&&Qc(e,o,s),t[e[n]]>t[e[o]]&&Qc(e,n,o);const a=e[o],c=t[a];for(;;){do o++;while(t[e[o]]<c);do i--;while(t[e[i]]>c);if(i<o)break;Qc(e,o,i)}e[n+1]=e[i],e[i]=a,s-o+1>=i-n?(Ra(e,t,o,s),Ra(e,t,n,i-1)):(Ra(e,t,n,i-1),Ra(e,t,o,s))}}function Qc(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function nft(e){return e[0]}function sft(e){return e[1]}const dC=1e-6;class xi{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,s){t=+t,n=+n,s=+s;const r=t+s,o=n;if(s<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>dC||Math.abs(this._y1-o)>dC)&&(this._+="L"+r+","+o),s&&(this._+=`A${s},${s},0,1,1,${t-s},${n}A${s},${s},0,1,1,${this._x1=r},${this._y1=o}`)}rect(t,n,s,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+s}v${+r}h${-s}Z`}value(){return this._||null}}class j1{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class u3{constructor(t,[n,s,r,o]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((o=+o)>=(s=+s)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=o,this.ymin=s,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:s},vectors:r}=this;let o,i;const a=this.circumcenters=this._circumcenters.subarray(0,s.length/3*2);for(let g=0,m=0,x=s.length,b,w;g<x;g+=3,m+=2){const y=s[g]*2,v=s[g+1]*2,$=s[g+2]*2,I=t[y],N=t[y+1],k=t[v],S=t[v+1],C=t[$],A=t[$+1],R=k-I,_=S-N,T=C-I,E=A-N,M=(R*E-_*T)*2;if(Math.abs(M)<1e-9){if(o===void 0){o=i=0;for(const L of n)o+=t[L*2],i+=t[L*2+1];o/=n.length,i/=n.length}const O=1e9*Math.sign((o-I)*E-(i-N)*T);b=(I+C)/2-O*E,w=(N+A)/2+O*T}else{const O=1/M,L=R*R+_*_,B=T*T+E*E;b=I+(E*L-_*B)*O,w=N+(R*B-T*L)*O}a[m]=b,a[m+1]=w}let c=n[n.length-1],l,u=c*4,h,f=t[2*c],d,p=t[2*c+1];r.fill(0);for(let g=0;g<n.length;++g)c=n[g],l=u,h=f,d=p,u=c*4,f=t[2*c],p=t[2*c+1],r[l+2]=r[u]=d-p,r[l+3]=r[u+1]=f-h}render(t){const n=t==null?t=new xi:void 0,{delaunay:{halfedges:s,inedges:r,hull:o},circumcenters:i,vectors:a}=this;if(o.length<=1)return null;for(let u=0,h=s.length;u<h;++u){const f=s[u];if(f<u)continue;const d=Math.floor(u/3)*2,p=Math.floor(f/3)*2,g=i[d],m=i[d+1],x=i[p],b=i[p+1];this._renderSegment(g,m,x,b,t)}let c,l=o[o.length-1];for(let u=0;u<o.length;++u){c=l,l=o[u];const h=Math.floor(r[l]/3)*2,f=i[h],d=i[h+1],p=c*4,g=this._project(f,d,a[p+2],a[p+3]);g&&this._renderSegment(f,d,g[0],g[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new xi:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const s=n==null?n=new xi:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let i=2;i<o;i+=2)(r[i]!==r[i-2]||r[i+1]!==r[i-1])&&n.lineTo(r[i],r[i+1]);return n.closePath(),s&&s.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,s=t.length/2;n<s;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new j1;return this.renderCell(t,n),n.value()}_renderSegment(t,n,s,r,o){let i;const a=this._regioncode(t,n),c=this._regioncode(s,r);a===0&&c===0?(o.moveTo(t,n),o.lineTo(s,r)):(i=this._clipSegment(t,n,s,r,a,c))&&(o.moveTo(i[0],i[1]),o.lineTo(i[2],i[3]))}contains(t,n,s){return n=+n,n!==n||(s=+s,s!==s)?!1:this.delaunay._step(t,n,s)===t}*neighbors(t){const n=this._clip(t);if(n)for(const s of this.delaunay.neighbors(t)){const r=this._clip(s);if(r){t:for(let o=0,i=n.length;o<i;o+=2)for(let a=0,c=r.length;a<c;a+=2)if(n[o]===r[a]&&n[o+1]===r[a+1]&&n[(o+2)%i]===r[(a+c-2)%c]&&n[(o+3)%i]===r[(a+c-1)%c]){yield s;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:s,halfedges:r,triangles:o}}=this,i=s[t];if(i===-1)return null;const a=[];let c=i;do{const l=Math.floor(c/3);if(a.push(n[l*2],n[l*2+1]),c=c%3===2?c-2:c+1,o[c]!==t)break;c=r[c]}while(c!==i&&c!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:s}=this,r=t*4;return this._simplify(s[r]||s[r+1]?this._clipInfinite(t,n,s[r],s[r+1],s[r+2],s[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const s=n.length;let r=null,o,i,a=n[s-2],c=n[s-1],l,u=this._regioncode(a,c),h,f=0;for(let d=0;d<s;d+=2)if(o=a,i=c,a=n[d],c=n[d+1],l=u,u=this._regioncode(a,c),l===0&&u===0)h=f,f=0,r?r.push(a,c):r=[a,c];else{let p,g,m,x,b;if(l===0){if((p=this._clipSegment(o,i,a,c,l,u))===null)continue;[g,m,x,b]=p}else{if((p=this._clipSegment(a,c,o,i,u,l))===null)continue;[x,b,g,m]=p,h=f,f=this._edgecode(g,m),h&&f&&this._edge(t,h,f,r,r.length),r?r.push(g,m):r=[g,m]}h=f,f=this._edgecode(x,b),h&&f&&this._edge(t,h,f,r,r.length),r?r.push(x,b):r=[x,b]}if(r)h=f,f=this._edgecode(r[0],r[1]),h&&f&&this._edge(t,h,f,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,s,r,o,i){const a=o<i;for(a&&([t,n,s,r,o,i]=[s,r,t,n,i,o]);;){if(o===0&&i===0)return a?[s,r,t,n]:[t,n,s,r];if(o&i)return null;let c,l,u=o||i;u&8?(c=t+(s-t)*(this.ymax-n)/(r-n),l=this.ymax):u&4?(c=t+(s-t)*(this.ymin-n)/(r-n),l=this.ymin):u&2?(l=n+(r-n)*(this.xmax-t)/(s-t),c=this.xmax):(l=n+(r-n)*(this.xmin-t)/(s-t),c=this.xmin),o?(t=c,n=l,o=this._regioncode(t,n)):(s=c,r=l,i=this._regioncode(s,r))}}_clipInfinite(t,n,s,r,o,i){let a=Array.from(n),c;if((c=this._project(a[0],a[1],s,r))&&a.unshift(c[0],c[1]),(c=this._project(a[a.length-2],a[a.length-1],o,i))&&a.push(c[0],c[1]),a=this._clipFinite(t,a))for(let l=0,u=a.length,h,f=this._edgecode(a[u-2],a[u-1]);l<u;l+=2)h=f,f=this._edgecode(a[l],a[l+1]),h&&f&&(l=this._edge(t,h,f,a,l),u=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,s,r,o){for(;n!==s;){let i,a;switch(n){case 5:n=4;continue;case 4:n=6,i=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,i=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,i=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,i=this.xmin,a=this.ymin;break}(r[o]!==i||r[o+1]!==a)&&this.contains(t,i,a)&&(r.splice(o,0,i,a),o+=2)}return o}_project(t,n,s,r){let o=1/0,i,a,c;if(r<0){if(n<=this.ymin)return null;(i=(this.ymin-n)/r)<o&&(c=this.ymin,a=t+(o=i)*s)}else if(r>0){if(n>=this.ymax)return null;(i=(this.ymax-n)/r)<o&&(c=this.ymax,a=t+(o=i)*s)}if(s>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/s)<o&&(a=this.xmax,c=n+(o=i)*r)}else if(s<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/s)<o&&(a=this.xmin,c=n+(o=i)*r)}return[a,c]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const s=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[s]&&t[s]===t[r]||t[n+1]===t[s+1]&&t[s+1]===t[r+1])&&(t.splice(s,2),n-=2)}t.length||(t=null)}return t}}const rft=2*Math.PI,Ca=Math.pow;function oft(e){return e[0]}function ift(e){return e[1]}function aft(e){const{triangles:t,coords:n}=e;for(let s=0;s<t.length;s+=3){const r=2*t[s],o=2*t[s+1],i=2*t[s+2];if((n[i]-n[r])*(n[o+1]-n[r+1])-(n[o]-n[r])*(n[i+1]-n[r+1])>1e-10)return!1}return!0}function cft(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Vw{static from(t,n=oft,s=ift,r){return new Vw("length"in t?lft(t,n,s,r):Float64Array.from(uft(t,n,s,r)))}constructor(t){this._delaunator=new Ed(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&aft(t)){this.collinear=Int32Array.from({length:n.length/2},(f,d)=>d).sort((f,d)=>n[2*f]-n[2*d]||n[2*f+1]-n[2*d+1]);const c=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[n[2*c],n[2*c+1],n[2*l],n[2*l+1]],h=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=n.length/2;f<d;++f){const p=cft(n[2*f],n[2*f+1],h);n[2*f]=p[0],n[2*f+1]=p[1]}this._delaunator=new Ed(n)}else delete this.collinear;const s=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,i=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let c=0,l=s.length;c<l;++c){const u=o[c%3===2?c-2:c+1];(s[c]===-1||i[u]===-1)&&(i[u]=c)}for(let c=0,l=r.length;c<l;++c)a[r[c]]=c;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],i[r[0]]=1,r.length===2&&(i[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new u3(this,t)}*neighbors(t){const{inedges:n,hull:s,_hullIndex:r,halfedges:o,triangles:i,collinear:a}=this;if(a){const h=a.indexOf(t);h>0&&(yield a[h-1]),h<a.length-1&&(yield a[h+1]);return}const c=n[t];if(c===-1)return;let l=c,u=-1;do{if(yield u=i[l],l=l%3===2?l-2:l+1,i[l]!==t)return;if(l=o[l],l===-1){const h=s[(r[t]+1)%s.length];h!==u&&(yield h);return}}while(l!==c)}find(t,n,s=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=s;let o;for(;(o=this._step(s,t,n))>=0&&o!==s&&o!==r;)s=o;return o}_step(t,n,s){const{inedges:r,hull:o,_hullIndex:i,halfedges:a,triangles:c,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let u=t,h=Ca(n-l[t*2],2)+Ca(s-l[t*2+1],2);const f=r[t];let d=f;do{let p=c[d];const g=Ca(n-l[p*2],2)+Ca(s-l[p*2+1],2);if(g<h&&(h=g,u=p),d=d%3===2?d-2:d+1,c[d]!==t)break;if(d=a[d],d===-1){if(d=o[(i[t]+1)%o.length],d!==p&&Ca(n-l[d*2],2)+Ca(s-l[d*2+1],2)<h)return d;break}}while(d!==f);return u}render(t){const n=t==null?t=new xi:void 0,{points:s,halfedges:r,triangles:o}=this;for(let i=0,a=r.length;i<a;++i){const c=r[i];if(c<i)continue;const l=o[i]*2,u=o[c]*2;t.moveTo(s[l],s[l+1]),t.lineTo(s[u],s[u+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const s=t==null?t=new xi:void 0,{points:r}=this;for(let o=0,i=r.length;o<i;o+=2){const a=r[o],c=r[o+1];t.moveTo(a+n,c),t.arc(a,c,n,0,rft)}return s&&s.value()}renderHull(t){const n=t==null?t=new xi:void 0,{hull:s,points:r}=this,o=s[0]*2,i=s.length;t.moveTo(r[o],r[o+1]);for(let a=1;a<i;++a){const c=2*s[a];t.lineTo(r[c],r[c+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new j1;return this.renderHull(t),t.value()}renderTriangle(t,n){const s=n==null?n=new xi:void 0,{points:r,triangles:o}=this,i=o[t*=3]*2,a=o[t+1]*2,c=o[t+2]*2;return n.moveTo(r[i],r[i+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[c],r[c+1]),n.closePath(),s&&s.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,s=t.length/3;n<s;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new j1;return this.renderTriangle(t,n),n.value()}}function lft(e,t,n,s){const r=e.length,o=new Float64Array(r*2);for(let i=0;i<r;++i){const a=e[i];o[i*2]=t.call(s,a,i,e),o[i*2+1]=n.call(s,a,i,e)}return o}function*uft(e,t,n,s){let r=0;for(const o of e)yield t.call(s,o,r,e),yield n.call(s,o,r,e),++r}var pC={},$0={},C0=34,Jc=10,k0=13;function h3(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function hft(e,t){var n=h3(e);return function(s,r){return t(n(s),r,e)}}function mC(e){var t=Object.create(null),n=[];return e.forEach(function(s){for(var r in s)r in t||n.push(t[r]=r)}),n}function jn(e,t){var n=e+"",s=n.length;return s<t?new Array(t-s+1).join(0)+n:n}function fft(e){return e<0?"-"+jn(-e,6):e>9999?"+"+jn(e,6):jn(e,4)}function dft(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),s=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":fft(e.getUTCFullYear())+"-"+jn(e.getUTCMonth()+1,2)+"-"+jn(e.getUTCDate(),2)+(r?"T"+jn(t,2)+":"+jn(n,2)+":"+jn(s,2)+"."+jn(r,3)+"Z":s?"T"+jn(t,2)+":"+jn(n,2)+":"+jn(s,2)+"Z":n||t?"T"+jn(t,2)+":"+jn(n,2)+"Z":"")}function rg(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function s(h,f){var d,p,g=r(h,function(m,x){if(d)return d(m,x-1);p=m,d=f?hft(m,f):h3(m)});return g.columns=p||[],g}function r(h,f){var d=[],p=h.length,g=0,m=0,x,b=p<=0,w=!1;h.charCodeAt(p-1)===Jc&&--p,h.charCodeAt(p-1)===k0&&--p;function y(){if(b)return $0;if(w)return w=!1,pC;var $,I=g,N;if(h.charCodeAt(I)===C0){for(;g++<p&&h.charCodeAt(g)!==C0||h.charCodeAt(++g)===C0;);return($=g)>=p?b=!0:(N=h.charCodeAt(g++))===Jc?w=!0:N===k0&&(w=!0,h.charCodeAt(g)===Jc&&++g),h.slice(I+1,$-1).replace(/""/g,'"')}for(;g<p;){if((N=h.charCodeAt($=g++))===Jc)w=!0;else if(N===k0)w=!0,h.charCodeAt(g)===Jc&&++g;else if(N!==n)continue;return h.slice(I,$)}return b=!0,h.slice(I,p)}for(;(x=y())!==$0;){for(var v=[];x!==pC&&x!==$0;)v.push(x),x=y();f&&(v=f(v,m++))==null||d.push(v)}return d}function o(h,f){return h.map(function(d){return f.map(function(p){return u(d[p])}).join(e)})}function i(h,f){return f==null&&(f=mC(h)),[f.map(u).join(e)].concat(o(h,f)).join(`
`)}function a(h,f){return f==null&&(f=mC(h)),o(h,f).join(`
`)}function c(h){return h.map(l).join(`
`)}function l(h){return h.map(u).join(e)}function u(h){return h==null?"":h instanceof Date?dft(h):t.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:s,parseRows:r,format:i,formatBody:a,formatRows:c,formatRow:l,formatValue:u}}var ua=rg(","),f3=ua.parse,pft=ua.parseRows,mft=ua.format,gft=ua.formatBody,xft=ua.formatRows,bft=ua.formatRow,yft=ua.formatValue,ha=rg("	"),d3=ha.parse,wft=ha.parseRows,vft=ha.format,$ft=ha.formatBody,Cft=ha.formatRows,kft=ha.formatRow,Ift=ha.formatValue;function Sft(e){for(var t in e){var n=e[t].trim(),s,r;if(!n)n=null;else if(n==="true")n=!0;else if(n==="false")n=!1;else if(n==="NaN")n=NaN;else if(!isNaN(s=+n))n=s;else if(r=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))Nft&&r[4]&&!r[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n);else continue;e[t]=n}return e}const Nft=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function _ft(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.blob()}function Tft(e,t){return fetch(e,t).then(_ft)}function Eft(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.arrayBuffer()}function Rft(e,t){return fetch(e,t).then(Eft)}function Aft(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function og(e,t){return fetch(e,t).then(Aft)}function p3(e){return function(t,n,s){return arguments.length===2&&typeof n=="function"&&(s=n,n=void 0),og(t,n).then(function(r){return e(r,s)})}}function Dft(e,t,n,s){arguments.length===3&&typeof n=="function"&&(s=n,n=void 0);var r=rg(e);return og(t,n).then(function(o){return r.parse(o,s)})}var Mft=p3(f3),Fft=p3(d3);function Oft(e,t){return new Promise(function(n,s){var r=new Image;for(var o in t)r[o]=t[o];r.onerror=s,r.onload=function(){n(r)},r.src=e})}function Lft(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(!(e.status===204||e.status===205))return e.json()}function Pft(e,t){return fetch(e,t).then(Lft)}function Ww(e){return(t,n)=>og(t,n).then(s=>new DOMParser().parseFromString(s,e))}const zft=Ww("application/xml");var Bft=Ww("text/html"),Vft=Ww("image/svg+xml");function Wft(e,t){var n,s=1;e==null&&(e=0),t==null&&(t=0);function r(){var o,i=n.length,a,c=0,l=0;for(o=0;o<i;++o)a=n[o],c+=a.x,l+=a.y;for(c=(c/i-e)*s,l=(l/i-t)*s,o=0;o<i;++o)a=n[o],a.x-=c,a.y-=l}return r.initialize=function(o){n=o},r.x=function(o){return arguments.length?(e=+o,r):e},r.y=function(o){return arguments.length?(t=+o,r):t},r.strength=function(o){return arguments.length?(s=+o,r):s},r}function Uft(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return m3(this.cover(t,n),t,n,e)}function m3(e,t,n,s){if(isNaN(t)||isNaN(n))return e;var r,o=e._root,i={data:s},a=e._x0,c=e._y0,l=e._x1,u=e._y1,h,f,d,p,g,m,x,b;if(!o)return e._root=i,e;for(;o.length;)if((g=t>=(h=(a+l)/2))?a=h:l=h,(m=n>=(f=(c+u)/2))?c=f:u=f,r=o,!(o=o[x=m<<1|g]))return r[x]=i,e;if(d=+e._x.call(null,o.data),p=+e._y.call(null,o.data),t===d&&n===p)return i.next=o,r?r[x]=i:e._root=i,e;do r=r?r[x]=new Array(4):e._root=new Array(4),(g=t>=(h=(a+l)/2))?a=h:l=h,(m=n>=(f=(c+u)/2))?c=f:u=f;while((x=m<<1|g)===(b=(p>=f)<<1|d>=h));return r[b]=o,r[x]=i,e}function Gft(e){var t,n,s=e.length,r,o,i=new Array(s),a=new Array(s),c=1/0,l=1/0,u=-1/0,h=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(o=+this._y.call(null,t))||(i[n]=r,a[n]=o,r<c&&(c=r),r>u&&(u=r),o<l&&(l=o),o>h&&(h=o));if(c>u||l>h)return this;for(this.cover(c,l).cover(u,h),n=0;n<s;++n)m3(this,i[n],a[n],e[n]);return this}function Hft(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,s=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,o=(s=Math.floor(t))+1;else{for(var i=r-n||1,a=this._root,c,l;n>e||e>=r||s>t||t>=o;)switch(l=(t<s)<<1|e<n,c=new Array(4),c[l]=a,a=c,i*=2,l){case 0:r=n+i,o=s+i;break;case 1:n=r-i,o=s+i;break;case 2:r=n+i,s=o-i;break;case 3:n=r-i,s=o-i;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=s,this._x1=r,this._y1=o,this}function qft(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Xft(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Fn(e,t,n,s,r){this.node=e,this.x0=t,this.y0=n,this.x1=s,this.y1=r}function jft(e,t,n){var s,r=this._x0,o=this._y0,i,a,c,l,u=this._x1,h=this._y1,f=[],d=this._root,p,g;for(d&&f.push(new Fn(d,r,o,u,h)),n==null?n=1/0:(r=e-n,o=t-n,u=e+n,h=t+n,n*=n);p=f.pop();)if(!(!(d=p.node)||(i=p.x0)>u||(a=p.y0)>h||(c=p.x1)<r||(l=p.y1)<o))if(d.length){var m=(i+c)/2,x=(a+l)/2;f.push(new Fn(d[3],m,x,c,l),new Fn(d[2],i,x,m,l),new Fn(d[1],m,a,c,x),new Fn(d[0],i,a,m,x)),(g=(t>=x)<<1|e>=m)&&(p=f[f.length-1],f[f.length-1]=f[f.length-1-g],f[f.length-1-g]=p)}else{var b=e-+this._x.call(null,d.data),w=t-+this._y.call(null,d.data),y=b*b+w*w;if(y<n){var v=Math.sqrt(n=y);r=e-v,o=t-v,u=e+v,h=t+v,s=d.data}}return s}function Kft(e){if(isNaN(u=+this._x.call(null,e))||isNaN(h=+this._y.call(null,e)))return this;var t,n=this._root,s,r,o,i=this._x0,a=this._y0,c=this._x1,l=this._y1,u,h,f,d,p,g,m,x;if(!n)return this;if(n.length)for(;;){if((p=u>=(f=(i+c)/2))?i=f:c=f,(g=h>=(d=(a+l)/2))?a=d:l=d,t=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(s=t,x=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,r?(o?r.next=o:delete r.next,this):t?(o?t[m]=o:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(s?s[x]=n:this._root=n),this):(this._root=o,this)}function Yft(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Zft(){return this._root}function Qft(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function Jft(e){var t=[],n,s=this._root,r,o,i,a,c;for(s&&t.push(new Fn(s,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(s=n.node,o=n.x0,i=n.y0,a=n.x1,c=n.y1)&&s.length){var l=(o+a)/2,u=(i+c)/2;(r=s[3])&&t.push(new Fn(r,l,u,a,c)),(r=s[2])&&t.push(new Fn(r,o,u,l,c)),(r=s[1])&&t.push(new Fn(r,l,i,a,u)),(r=s[0])&&t.push(new Fn(r,o,i,l,u))}return this}function tdt(e){var t=[],n=[],s;for(this._root&&t.push(new Fn(this._root,this._x0,this._y0,this._x1,this._y1));s=t.pop();){var r=s.node;if(r.length){var o,i=s.x0,a=s.y0,c=s.x1,l=s.y1,u=(i+c)/2,h=(a+l)/2;(o=r[0])&&t.push(new Fn(o,i,a,u,h)),(o=r[1])&&t.push(new Fn(o,u,a,c,h)),(o=r[2])&&t.push(new Fn(o,i,h,u,l)),(o=r[3])&&t.push(new Fn(o,u,h,c,l))}n.push(s)}for(;s=n.pop();)e(s.node,s.x0,s.y0,s.x1,s.y1);return this}function edt(e){return e[0]}function ndt(e){return arguments.length?(this._x=e,this):this._x}function sdt(e){return e[1]}function rdt(e){return arguments.length?(this._y=e,this):this._y}function ig(e,t,n){var s=new Uw(t??edt,n??sdt,NaN,NaN,NaN,NaN);return e==null?s:s.addAll(e)}function Uw(e,t,n,s,r,o){this._x=e,this._y=t,this._x0=n,this._y0=s,this._x1=r,this._y1=o,this._root=void 0}function gC(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var qn=ig.prototype=Uw.prototype;qn.copy=function(){var e=new Uw(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,s;if(!t)return e;if(!t.length)return e._root=gC(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(s=t.source[r])&&(s.length?n.push({source:s,target:t.target[r]=new Array(4)}):t.target[r]=gC(s));return e};qn.add=Uft;qn.addAll=Gft;qn.cover=Hft;qn.data=qft;qn.extent=Xft;qn.find=jft;qn.remove=Kft;qn.removeAll=Yft;qn.root=Zft;qn.size=Qft;qn.visit=Jft;qn.visitAfter=tdt;qn.x=ndt;qn.y=rdt;function Ue(e){return function(){return e}}function ko(e){return(e()-.5)*1e-6}function odt(e){return e.x+e.vx}function idt(e){return e.y+e.vy}function adt(e){var t,n,s,r=1,o=1;typeof e!="function"&&(e=Ue(e==null?1:+e));function i(){for(var l,u=t.length,h,f,d,p,g,m,x=0;x<o;++x)for(h=ig(t,odt,idt).visitAfter(a),l=0;l<u;++l)f=t[l],g=n[f.index],m=g*g,d=f.x+f.vx,p=f.y+f.vy,h.visit(b);function b(w,y,v,$,I){var N=w.data,k=w.r,S=g+k;if(N){if(N.index>f.index){var C=d-N.x-N.vx,A=p-N.y-N.vy,R=C*C+A*A;R<S*S&&(C===0&&(C=ko(s),R+=C*C),A===0&&(A=ko(s),R+=A*A),R=(S-(R=Math.sqrt(R)))/R*r,f.vx+=(C*=R)*(S=(k*=k)/(m+k)),f.vy+=(A*=R)*S,N.vx-=C*(S=1-S),N.vy-=A*S)}return}return y>d+S||$<d-S||v>p+S||I<p-S}}function a(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function c(){if(t){var l,u=t.length,h;for(n=new Array(u),l=0;l<u;++l)h=t[l],n[h.index]=+e(h,l,t)}}return i.initialize=function(l,u){t=l,s=u,c()},i.iterations=function(l){return arguments.length?(o=+l,i):o},i.strength=function(l){return arguments.length?(r=+l,i):r},i.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Ue(+l),c(),i):e},i}function cdt(e){return e.index}function xC(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function ldt(e){var t=cdt,n=h,s,r=Ue(30),o,i,a,c,l,u=1;e==null&&(e=[]);function h(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function f(m){for(var x=0,b=e.length;x<u;++x)for(var w=0,y,v,$,I,N,k,S;w<b;++w)y=e[w],v=y.source,$=y.target,I=$.x+$.vx-v.x-v.vx||ko(l),N=$.y+$.vy-v.y-v.vy||ko(l),k=Math.sqrt(I*I+N*N),k=(k-o[w])/k*m*s[w],I*=k,N*=k,$.vx-=I*(S=c[w]),$.vy-=N*S,v.vx+=I*(S=1-S),v.vy+=N*S}function d(){if(i){var m,x=i.length,b=e.length,w=new Map(i.map((v,$)=>[t(v,$,i),v])),y;for(m=0,a=new Array(x);m<b;++m)y=e[m],y.index=m,typeof y.source!="object"&&(y.source=xC(w,y.source)),typeof y.target!="object"&&(y.target=xC(w,y.target)),a[y.source.index]=(a[y.source.index]||0)+1,a[y.target.index]=(a[y.target.index]||0)+1;for(m=0,c=new Array(b);m<b;++m)y=e[m],c[m]=a[y.source.index]/(a[y.source.index]+a[y.target.index]);s=new Array(b),p(),o=new Array(b),g()}}function p(){if(i)for(var m=0,x=e.length;m<x;++m)s[m]=+n(e[m],m,e)}function g(){if(i)for(var m=0,x=e.length;m<x;++m)o[m]=+r(e[m],m,e)}return f.initialize=function(m,x){i=m,l=x,d()},f.links=function(m){return arguments.length?(e=m,d(),f):e},f.id=function(m){return arguments.length?(t=m,f):t},f.iterations=function(m){return arguments.length?(u=+m,f):u},f.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Ue(+m),p(),f):n},f.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Ue(+m),g(),f):r},f}const udt=1664525,hdt=1013904223,bC=4294967296;function fdt(){let e=1;return()=>(e=(udt*e+hdt)%bC)/bC}function ddt(e){return e.x}function pdt(e){return e.y}var mdt=10,gdt=Math.PI*(3-Math.sqrt(5));function xdt(e){var t,n=1,s=.001,r=1-Math.pow(s,1/300),o=0,i=.6,a=new Map,c=ng(h),l=ca("tick","end"),u=fdt();e==null&&(e=[]);function h(){f(),l.call("tick",t),n<s&&(c.stop(),l.call("end",t))}function f(g){var m,x=e.length,b;g===void 0&&(g=1);for(var w=0;w<g;++w)for(n+=(o-n)*r,a.forEach(function(y){y(n)}),m=0;m<x;++m)b=e[m],b.fx==null?b.x+=b.vx*=i:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=i:(b.y=b.fy,b.vy=0);return t}function d(){for(var g=0,m=e.length,x;g<m;++g){if(x=e[g],x.index=g,x.fx!=null&&(x.x=x.fx),x.fy!=null&&(x.y=x.fy),isNaN(x.x)||isNaN(x.y)){var b=mdt*Math.sqrt(.5+g),w=g*gdt;x.x=b*Math.cos(w),x.y=b*Math.sin(w)}(isNaN(x.vx)||isNaN(x.vy))&&(x.vx=x.vy=0)}}function p(g){return g.initialize&&g.initialize(e,u),g}return d(),t={tick:f,restart:function(){return c.restart(h),t},stop:function(){return c.stop(),t},nodes:function(g){return arguments.length?(e=g,d(),a.forEach(p),t):e},alpha:function(g){return arguments.length?(n=+g,t):n},alphaMin:function(g){return arguments.length?(s=+g,t):s},alphaDecay:function(g){return arguments.length?(r=+g,t):+r},alphaTarget:function(g){return arguments.length?(o=+g,t):o},velocityDecay:function(g){return arguments.length?(i=1-g,t):1-i},randomSource:function(g){return arguments.length?(u=g,a.forEach(p),t):u},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,x){var b=0,w=e.length,y,v,$,I,N;for(x==null?x=1/0:x*=x,b=0;b<w;++b)I=e[b],y=g-I.x,v=m-I.y,$=y*y+v*v,$<x&&(N=I,x=$);return N},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function bdt(){var e,t,n,s,r=Ue(-30),o,i=1,a=1/0,c=.81;function l(d){var p,g=e.length,m=ig(e,ddt,pdt).visitAfter(h);for(s=d,p=0;p<g;++p)t=e[p],m.visit(f)}function u(){if(e){var d,p=e.length,g;for(o=new Array(p),d=0;d<p;++d)g=e[d],o[g.index]=+r(g,d,e)}}function h(d){var p=0,g,m,x=0,b,w,y;if(d.length){for(b=w=y=0;y<4;++y)(g=d[y])&&(m=Math.abs(g.value))&&(p+=g.value,x+=m,b+=m*g.x,w+=m*g.y);d.x=b/x,d.y=w/x}else{g=d,g.x=g.data.x,g.y=g.data.y;do p+=o[g.data.index];while(g=g.next)}d.value=p}function f(d,p,g,m){if(!d.value)return!0;var x=d.x-t.x,b=d.y-t.y,w=m-p,y=x*x+b*b;if(w*w/c<y)return y<a&&(x===0&&(x=ko(n),y+=x*x),b===0&&(b=ko(n),y+=b*b),y<i&&(y=Math.sqrt(i*y)),t.vx+=x*d.value*s/y,t.vy+=b*d.value*s/y),!0;if(d.length||y>=a)return;(d.data!==t||d.next)&&(x===0&&(x=ko(n),y+=x*x),b===0&&(b=ko(n),y+=b*b),y<i&&(y=Math.sqrt(i*y)));do d.data!==t&&(w=o[d.data.index]*s/y,t.vx+=x*w,t.vy+=b*w);while(d=d.next)}return l.initialize=function(d,p){e=d,n=p,u()},l.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Ue(+d),u(),l):r},l.distanceMin=function(d){return arguments.length?(i=d*d,l):Math.sqrt(i)},l.distanceMax=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.theta=function(d){return arguments.length?(c=d*d,l):Math.sqrt(c)},l}function ydt(e,t,n){var s,r=Ue(.1),o,i;typeof e!="function"&&(e=Ue(+e)),t==null&&(t=0),n==null&&(n=0);function a(l){for(var u=0,h=s.length;u<h;++u){var f=s[u],d=f.x-t||1e-6,p=f.y-n||1e-6,g=Math.sqrt(d*d+p*p),m=(i[u]-g)*o[u]*l/g;f.vx+=d*m,f.vy+=p*m}}function c(){if(s){var l,u=s.length;for(o=new Array(u),i=new Array(u),l=0;l<u;++l)i[l]=+e(s[l],l,s),o[l]=isNaN(i[l])?0:+r(s[l],l,s)}}return a.initialize=function(l){s=l,c()},a.strength=function(l){return arguments.length?(r=typeof l=="function"?l:Ue(+l),c(),a):r},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Ue(+l),c(),a):e},a.x=function(l){return arguments.length?(t=+l,a):t},a.y=function(l){return arguments.length?(n=+l,a):n},a}function wdt(e){var t=Ue(.1),n,s,r;typeof e!="function"&&(e=Ue(e==null?0:+e));function o(a){for(var c=0,l=n.length,u;c<l;++c)u=n[c],u.vx+=(r[c]-u.x)*s[c]*a}function i(){if(n){var a,c=n.length;for(s=new Array(c),r=new Array(c),a=0;a<c;++a)s[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,i()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Ue(+a),i(),o):t},o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Ue(+a),i(),o):e},o}function vdt(e){var t=Ue(.1),n,s,r;typeof e!="function"&&(e=Ue(e==null?0:+e));function o(a){for(var c=0,l=n.length,u;c<l;++c)u=n[c],u.vy+=(r[c]-u.y)*s[c]*a}function i(){if(n){var a,c=n.length;for(s=new Array(c),r=new Array(c),a=0;a<c;++a)s[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return o.initialize=function(a){n=a,i()},o.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Ue(+a),i(),o):t},o.y=function(a){return arguments.length?(e=typeof a=="function"?a:Ue(+a),i(),o):e},o}function $dt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Rd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,s=e.slice(0,n);return[s.length>1?s[0]+s.slice(2):s,+e.slice(n+1)]}function uc(e){return e=Rd(Math.abs(e)),e?e[1]:NaN}function Cdt(e,t){return function(n,s){for(var r=n.length,o=[],i=0,a=e[0],c=0;r>0&&a>0&&(c+a+1>s&&(a=Math.max(1,s-c)),o.push(n.substring(r-=a,r+a)),!((c+=a+1)>s));)a=e[i=(i+1)%e.length];return o.reverse().join(t)}}function kdt(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Idt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hc(e){if(!(t=Idt.exec(e)))throw new Error("invalid format: "+e);var t;return new ag({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}hc.prototype=ag.prototype;function ag(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ag.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Sdt(e){t:for(var t=e.length,n=1,s=-1,r;n<t;++n)switch(e[n]){case".":s=r=n;break;case"0":s===0&&(s=n),r=n;break;default:if(!+e[n])break t;s>0&&(s=0);break}return s>0?e.slice(0,s)+e.slice(r+1):e}var g3;function Ndt(e,t){var n=Rd(e,t);if(!n)return e+"";var s=n[0],r=n[1],o=r-(g3=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,i=s.length;return o===i?s:o>i?s+new Array(o-i+1).join("0"):o>0?s.slice(0,o)+"."+s.slice(o):"0."+new Array(1-o).join("0")+Rd(e,Math.max(0,t+o-1))[0]}function yC(e,t){var n=Rd(e,t);if(!n)return e+"";var s=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+s:s.length>r+1?s.slice(0,r+1)+"."+s.slice(r+1):s+new Array(r-s.length+2).join("0")}const wC={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:$dt,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>yC(e*100,t),r:yC,s:Ndt,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function vC(e){return e}var $C=Array.prototype.map,CC=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function x3(e){var t=e.grouping===void 0||e.thousands===void 0?vC:Cdt($C.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",s=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?vC:kdt($C.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(h){h=hc(h);var f=h.fill,d=h.align,p=h.sign,g=h.symbol,m=h.zero,x=h.width,b=h.comma,w=h.precision,y=h.trim,v=h.type;v==="n"?(b=!0,v="g"):wC[v]||(w===void 0&&(w=12),y=!0,v="g"),(m||f==="0"&&d==="=")&&(m=!0,f="0",d="=");var $=g==="$"?n:g==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",I=g==="$"?s:/[%p]/.test(v)?i:"",N=wC[v],k=/[defgprs%]/.test(v);w=w===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function S(C){var A=$,R=I,_,T,E;if(v==="c")R=N(C)+R,C="";else{C=+C;var M=C<0||1/C<0;if(C=isNaN(C)?c:N(Math.abs(C),w),y&&(C=Sdt(C)),M&&+C==0&&p!=="+"&&(M=!1),A=(M?p==="("?p:a:p==="-"||p==="("?"":p)+A,R=(v==="s"?CC[8+g3/3]:"")+R+(M&&p==="("?")":""),k){for(_=-1,T=C.length;++_<T;)if(E=C.charCodeAt(_),48>E||E>57){R=(E===46?r+C.slice(_+1):C.slice(_))+R,C=C.slice(0,_);break}}}b&&!m&&(C=t(C,1/0));var O=A.length+C.length+R.length,L=O<x?new Array(x-O+1).join(f):"";switch(b&&m&&(C=t(L+C,L.length?x-R.length:1/0),L=""),d){case"<":C=A+C+R+L;break;case"=":C=A+L+C+R;break;case"^":C=L.slice(0,O=L.length>>1)+A+C+R+L.slice(O);break;default:C=L+A+C+R;break}return o(C)}return S.toString=function(){return h+""},S}function u(h,f){var d=l((h=hc(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(uc(f)/3)))*3,g=Math.pow(10,-p),m=CC[8+p/3];return function(x){return d(g*x)+m}}return{format:l,formatPrefix:u}}var lf,cg,Gw;b3({thousands:",",grouping:[3],currency:["$",""]});function b3(e){return lf=x3(e),cg=lf.format,Gw=lf.formatPrefix,lf}function y3(e){return Math.max(0,-uc(Math.abs(e)))}function w3(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(uc(t)/3)))*3-uc(Math.abs(e)))}function v3(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,uc(t)-uc(e))+1}var kt=1e-6,Ad=1e-12,Bt=Math.PI,Ce=Bt/2,Dd=Bt/4,Vn=Bt*2,re=180/Bt,Ct=Bt/180,Ut=Math.abs,Wc=Math.atan,Wn=Math.atan2,wt=Math.cos,uf=Math.ceil,$3=Math.exp,K1=Math.hypot,Md=Math.log,I0=Math.pow,pt=Math.sin,Rs=Math.sign||function(e){return e>0?1:e<0?-1:0},Qe=Math.sqrt,Hw=Math.tan;function C3(e){return e>1?0:e<-1?Bt:Math.acos(e)}function Un(e){return e>1?Ce:e<-1?-Ce:Math.asin(e)}function kC(e){return(e=pt(e/2))*e}function be(){}function Fd(e,t){e&&SC.hasOwnProperty(e.type)&&SC[e.type](e,t)}var IC={Feature:function(e,t){Fd(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,s=-1,r=n.length;++s<r;)Fd(n[s].geometry,t)}},SC={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)e=n[s],t.point(e[0],e[1],e[2])},LineString:function(e,t){Y1(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)Y1(n[s],t,0)},Polygon:function(e,t){NC(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)NC(n[s],t)},GeometryCollection:function(e,t){for(var n=e.geometries,s=-1,r=n.length;++s<r;)Fd(n[s],t)}};function Y1(e,t,n){var s=-1,r=e.length-n,o;for(t.lineStart();++s<r;)o=e[s],t.point(o[0],o[1],o[2]);t.lineEnd()}function NC(e,t){var n=-1,s=e.length;for(t.polygonStart();++n<s;)Y1(e[n],t,1);t.polygonEnd()}function js(e,t){e&&IC.hasOwnProperty(e.type)?IC[e.type](e,t):Fd(e,t)}var Od=new Ge,Ld=new Ge,k3,I3,Z1,Q1,J1,Tr={point:be,lineStart:be,lineEnd:be,polygonStart:function(){Od=new Ge,Tr.lineStart=_dt,Tr.lineEnd=Tdt},polygonEnd:function(){var e=+Od;Ld.add(e<0?Vn+e:e),this.lineStart=this.lineEnd=this.point=be},sphere:function(){Ld.add(Vn)}};function _dt(){Tr.point=Edt}function Tdt(){S3(k3,I3)}function Edt(e,t){Tr.point=S3,k3=e,I3=t,e*=Ct,t*=Ct,Z1=e,Q1=wt(t=t/2+Dd),J1=pt(t)}function S3(e,t){e*=Ct,t*=Ct,t=t/2+Dd;var n=e-Z1,s=n>=0?1:-1,r=s*n,o=wt(t),i=pt(t),a=J1*i,c=Q1*o+a*wt(r),l=a*s*pt(r);Od.add(Wn(l,c)),Z1=e,Q1=o,J1=i}function Rdt(e){return Ld=new Ge,js(e,Tr),Ld*2}function Pd(e){return[Wn(e[1],e[0]),Un(e[2])]}function Xi(e){var t=e[0],n=e[1],s=wt(n);return[s*wt(t),s*pt(t),pt(n)]}function hf(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function fc(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function S0(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function ff(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function zd(e){var t=Qe(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var ge,Qn,we,cs,li,N3,_3,Wa,Sl,yo,eo,Vr={point:tx,lineStart:_C,lineEnd:TC,polygonStart:function(){Vr.point=E3,Vr.lineStart=Adt,Vr.lineEnd=Ddt,Sl=new Ge,Tr.polygonStart()},polygonEnd:function(){Tr.polygonEnd(),Vr.point=tx,Vr.lineStart=_C,Vr.lineEnd=TC,Od<0?(ge=-(we=180),Qn=-(cs=90)):Sl>kt?cs=90:Sl<-1e-6&&(Qn=-90),eo[0]=ge,eo[1]=we},sphere:function(){ge=-(we=180),Qn=-(cs=90)}};function tx(e,t){yo.push(eo=[ge=e,we=e]),t<Qn&&(Qn=t),t>cs&&(cs=t)}function T3(e,t){var n=Xi([e*Ct,t*Ct]);if(Wa){var s=fc(Wa,n),r=[s[1],-s[0],0],o=fc(r,s);zd(o),o=Pd(o);var i=e-li,a=i>0?1:-1,c=o[0]*re*a,l,u=Ut(i)>180;u^(a*li<c&&c<a*e)?(l=o[1]*re,l>cs&&(cs=l)):(c=(c+360)%360-180,u^(a*li<c&&c<a*e)?(l=-o[1]*re,l<Qn&&(Qn=l)):(t<Qn&&(Qn=t),t>cs&&(cs=t))),u?e<li?as(ge,e)>as(ge,we)&&(we=e):as(e,we)>as(ge,we)&&(ge=e):we>=ge?(e<ge&&(ge=e),e>we&&(we=e)):e>li?as(ge,e)>as(ge,we)&&(we=e):as(e,we)>as(ge,we)&&(ge=e)}else yo.push(eo=[ge=e,we=e]);t<Qn&&(Qn=t),t>cs&&(cs=t),Wa=n,li=e}function _C(){Vr.point=T3}function TC(){eo[0]=ge,eo[1]=we,Vr.point=tx,Wa=null}function E3(e,t){if(Wa){var n=e-li;Sl.add(Ut(n)>180?n+(n>0?360:-360):n)}else N3=e,_3=t;Tr.point(e,t),T3(e,t)}function Adt(){Tr.lineStart()}function Ddt(){E3(N3,_3),Tr.lineEnd(),Ut(Sl)>kt&&(ge=-(we=180)),eo[0]=ge,eo[1]=we,Wa=null}function as(e,t){return(t-=e)<0?t+360:t}function Mdt(e,t){return e[0]-t[0]}function EC(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Fdt(e){var t,n,s,r,o,i,a;if(cs=we=-(ge=Qn=1/0),yo=[],js(e,Vr),n=yo.length){for(yo.sort(Mdt),t=1,s=yo[0],o=[s];t<n;++t)r=yo[t],EC(s,r[0])||EC(s,r[1])?(as(s[0],r[1])>as(s[0],s[1])&&(s[1]=r[1]),as(r[0],s[1])>as(s[0],s[1])&&(s[0]=r[0])):o.push(s=r);for(i=-1/0,n=o.length-1,t=0,s=o[n];t<=n;s=r,++t)r=o[t],(a=as(s[1],r[0]))>i&&(i=a,ge=r[0],we=s[1])}return yo=eo=null,ge===1/0||Qn===1/0?[[NaN,NaN],[NaN,NaN]]:[[ge,Qn],[we,cs]]}var dl,Bd,Vd,Wd,Ud,Gd,Hd,qd,ex,nx,sx,R3,A3,Rn,An,Dn,Ks={sphere:be,point:qw,lineStart:RC,lineEnd:AC,polygonStart:function(){Ks.lineStart=Pdt,Ks.lineEnd=zdt},polygonEnd:function(){Ks.lineStart=RC,Ks.lineEnd=AC}};function qw(e,t){e*=Ct,t*=Ct;var n=wt(t);Eh(n*wt(e),n*pt(e),pt(t))}function Eh(e,t,n){++dl,Vd+=(e-Vd)/dl,Wd+=(t-Wd)/dl,Ud+=(n-Ud)/dl}function RC(){Ks.point=Odt}function Odt(e,t){e*=Ct,t*=Ct;var n=wt(t);Rn=n*wt(e),An=n*pt(e),Dn=pt(t),Ks.point=Ldt,Eh(Rn,An,Dn)}function Ldt(e,t){e*=Ct,t*=Ct;var n=wt(t),s=n*wt(e),r=n*pt(e),o=pt(t),i=Wn(Qe((i=An*o-Dn*r)*i+(i=Dn*s-Rn*o)*i+(i=Rn*r-An*s)*i),Rn*s+An*r+Dn*o);Bd+=i,Gd+=i*(Rn+(Rn=s)),Hd+=i*(An+(An=r)),qd+=i*(Dn+(Dn=o)),Eh(Rn,An,Dn)}function AC(){Ks.point=qw}function Pdt(){Ks.point=Bdt}function zdt(){D3(R3,A3),Ks.point=qw}function Bdt(e,t){R3=e,A3=t,e*=Ct,t*=Ct,Ks.point=D3;var n=wt(t);Rn=n*wt(e),An=n*pt(e),Dn=pt(t),Eh(Rn,An,Dn)}function D3(e,t){e*=Ct,t*=Ct;var n=wt(t),s=n*wt(e),r=n*pt(e),o=pt(t),i=An*o-Dn*r,a=Dn*s-Rn*o,c=Rn*r-An*s,l=K1(i,a,c),u=Un(l),h=l&&-u/l;ex.add(h*i),nx.add(h*a),sx.add(h*c),Bd+=u,Gd+=u*(Rn+(Rn=s)),Hd+=u*(An+(An=r)),qd+=u*(Dn+(Dn=o)),Eh(Rn,An,Dn)}function Vdt(e){dl=Bd=Vd=Wd=Ud=Gd=Hd=qd=0,ex=new Ge,nx=new Ge,sx=new Ge,js(e,Ks);var t=+ex,n=+nx,s=+sx,r=K1(t,n,s);return r<Ad&&(t=Gd,n=Hd,s=qd,Bd<kt&&(t=Vd,n=Wd,s=Ud),r=K1(t,n,s),r<Ad)?[NaN,NaN]:[Wn(n,t)*re,Un(s/r)*re]}function ka(e){return function(){return e}}function rx(e,t){function n(s,r){return s=e(s,r),t(s[0],s[1])}return e.invert&&t.invert&&(n.invert=function(s,r){return s=t.invert(s,r),s&&e.invert(s[0],s[1])}),n}function ox(e,t){return Ut(e)>Bt&&(e-=Math.round(e/Vn)*Vn),[e,t]}ox.invert=ox;function Xw(e,t,n){return(e%=Vn)?t||n?rx(MC(e),FC(t,n)):MC(e):t||n?FC(t,n):ox}function DC(e){return function(t,n){return t+=e,Ut(t)>Bt&&(t-=Math.round(t/Vn)*Vn),[t,n]}}function MC(e){var t=DC(e);return t.invert=DC(-e),t}function FC(e,t){var n=wt(e),s=pt(e),r=wt(t),o=pt(t);function i(a,c){var l=wt(c),u=wt(a)*l,h=pt(a)*l,f=pt(c),d=f*n+u*s;return[Wn(h*r-d*o,u*n-f*s),Un(d*r+h*o)]}return i.invert=function(a,c){var l=wt(c),u=wt(a)*l,h=pt(a)*l,f=pt(c),d=f*r-h*o;return[Wn(h*r+f*o,u*n+d*s),Un(d*n-u*s)]},i}function M3(e){e=Xw(e[0]*Ct,e[1]*Ct,e.length>2?e[2]*Ct:0);function t(n){return n=e(n[0]*Ct,n[1]*Ct),n[0]*=re,n[1]*=re,n}return t.invert=function(n){return n=e.invert(n[0]*Ct,n[1]*Ct),n[0]*=re,n[1]*=re,n},t}function F3(e,t,n,s,r,o){if(n){var i=wt(t),a=pt(t),c=s*n;r==null?(r=t+s*Vn,o=t-c/2):(r=OC(i,r),o=OC(i,o),(s>0?r<o:r>o)&&(r+=s*Vn));for(var l,u=r;s>0?u>o:u<o;u-=c)l=Pd([i,-a*wt(u),-a*pt(u)]),e.point(l[0],l[1])}}function OC(e,t){t=Xi(t),t[0]-=e,zd(t);var n=C3(-t[1]);return((-t[2]<0?-n:n)+Vn-kt)%Vn}function Wdt(){var e=ka([0,0]),t=ka(90),n=ka(2),s,r,o={point:i};function i(c,l){s.push(c=r(c,l)),c[0]*=re,c[1]*=re}function a(){var c=e.apply(this,arguments),l=t.apply(this,arguments)*Ct,u=n.apply(this,arguments)*Ct;return s=[],r=Xw(-c[0]*Ct,-c[1]*Ct,0).invert,F3(o,l,u,1),c={type:"Polygon",coordinates:[s]},s=r=null,c}return a.center=function(c){return arguments.length?(e=typeof c=="function"?c:ka([+c[0],+c[1]]),a):e},a.radius=function(c){return arguments.length?(t=typeof c=="function"?c:ka(+c),a):t},a.precision=function(c){return arguments.length?(n=typeof c=="function"?c:ka(+c),a):n},a}function O3(){var e=[],t;return{point:function(n,s,r){t.push([n,s,r])},lineStart:function(){e.push(t=[])},lineEnd:be,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function zf(e,t){return Ut(e[0]-t[0])<kt&&Ut(e[1]-t[1])<kt}function df(e,t,n,s){this.x=e,this.z=t,this.o=n,this.e=s,this.v=!1,this.n=this.p=null}function L3(e,t,n,s,r){var o=[],i=[],a,c;if(e.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],x=p[g],b;if(zf(m,x)){if(!m[2]&&!x[2]){for(r.lineStart(),a=0;a<g;++a)r.point((m=p[a])[0],m[1]);r.lineEnd();return}x[0]+=2*kt}o.push(b=new df(m,p,null,!0)),i.push(b.o=new df(m,null,b,!1)),o.push(b=new df(x,p,null,!1)),i.push(b.o=new df(x,null,b,!0))}}),!!o.length){for(i.sort(t),LC(o),LC(i),a=0,c=i.length;a<c;++a)i[a].e=n=!n;for(var l=o[0],u,h;;){for(var f=l,d=!0;f.v;)if((f=f.n)===l)return;u=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,c=u.length;a<c;++a)r.point((h=u[a])[0],h[1]);else s(f.x,f.n.x,1,r);f=f.n}else{if(d)for(u=f.p.z,a=u.length-1;a>=0;--a)r.point((h=u[a])[0],h[1]);else s(f.x,f.p.x,-1,r);f=f.p}f=f.o,u=f.z,d=!d}while(!f.v);r.lineEnd()}}}function LC(e){if(t=e.length){for(var t,n=0,s=e[0],r;++n<t;)s.n=r=e[n],r.p=s,s=r;s.n=r=e[0],r.p=s}}function N0(e){return Ut(e[0])<=Bt?e[0]:Rs(e[0])*((Ut(e[0])+Bt)%Vn-Bt)}function P3(e,t){var n=N0(t),s=t[1],r=pt(s),o=[pt(n),-wt(n),0],i=0,a=0,c=new Ge;r===1?s=Ce+kt:r===-1&&(s=-Ce-kt);for(var l=0,u=e.length;l<u;++l)if(f=(h=e[l]).length)for(var h,f,d=h[f-1],p=N0(d),g=d[1]/2+Dd,m=pt(g),x=wt(g),b=0;b<f;++b,p=y,m=$,x=I,d=w){var w=h[b],y=N0(w),v=w[1]/2+Dd,$=pt(v),I=wt(v),N=y-p,k=N>=0?1:-1,S=k*N,C=S>Bt,A=m*$;if(c.add(Wn(A*k*pt(S),x*I+A*wt(S))),i+=C?N+k*Vn:N,C^p>=n^y>=n){var R=fc(Xi(d),Xi(w));zd(R);var _=fc(o,R);zd(_);var T=(C^N>=0?-1:1)*Un(_[2]);(s>T||s===T&&(R[0]||R[1]))&&(a+=C^N>=0?1:-1)}}return(i<-1e-6||i<kt&&c<-1e-12)^a&1}function z3(e,t,n,s){return function(r){var o=t(r),i=O3(),a=t(i),c=!1,l,u,h,f={point:d,lineStart:g,lineEnd:m,polygonStart:function(){f.point=x,f.lineStart=b,f.lineEnd=w,u=[],l=[]},polygonEnd:function(){f.point=d,f.lineStart=g,f.lineEnd=m,u=vw(u);var y=P3(l,s);u.length?(c||(r.polygonStart(),c=!0),L3(u,Gdt,y,n,r)):y&&(c||(r.polygonStart(),c=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),c&&(r.polygonEnd(),c=!1),u=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(y,v){e(y,v)&&r.point(y,v)}function p(y,v){o.point(y,v)}function g(){f.point=p,o.lineStart()}function m(){f.point=d,o.lineEnd()}function x(y,v){h.push([y,v]),a.point(y,v)}function b(){a.lineStart(),h=[]}function w(){x(h[0][0],h[0][1]),a.lineEnd();var y=a.clean(),v=i.result(),$,I=v.length,N,k,S;if(h.pop(),l.push(h),h=null,!!I){if(y&1){if(k=v[0],(N=k.length-1)>0){for(c||(r.polygonStart(),c=!0),r.lineStart(),$=0;$<N;++$)r.point((S=k[$])[0],S[1]);r.lineEnd()}return}I>1&&y&2&&v.push(v.pop().concat(v.shift())),u.push(v.filter(Udt))}}return f}}function Udt(e){return e.length>1}function Gdt(e,t){return((e=e.x)[0]<0?e[1]-Ce-kt:Ce-e[1])-((t=t.x)[0]<0?t[1]-Ce-kt:Ce-t[1])}const ix=z3(function(){return!0},Hdt,Xdt,[-Bt,-Ce]);function Hdt(e){var t=NaN,n=NaN,s=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(o,i){var a=o>0?Bt:-Bt,c=Ut(o-t);Ut(c-Bt)<kt?(e.point(t,n=(n+i)/2>0?Ce:-Ce),e.point(s,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(o,n),r=0):s!==a&&c>=Bt&&(Ut(t-s)<kt&&(t-=s*kt),Ut(o-a)<kt&&(o-=a*kt),n=qdt(t,n,o,i),e.point(s,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=o,n=i),s=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function qdt(e,t,n,s){var r,o,i=pt(e-n);return Ut(i)>kt?Wc((pt(t)*(o=wt(s))*pt(n)-pt(s)*(r=wt(t))*pt(e))/(r*o*i)):(t+s)/2}function Xdt(e,t,n,s){var r;if(e==null)r=n*Ce,s.point(-Bt,r),s.point(0,r),s.point(Bt,r),s.point(Bt,0),s.point(Bt,-r),s.point(0,-r),s.point(-Bt,-r),s.point(-Bt,0),s.point(-Bt,r);else if(Ut(e[0]-t[0])>kt){var o=e[0]<t[0]?Bt:-Bt;r=n*o/2,s.point(-o,r),s.point(0,r),s.point(o,r)}else s.point(t[0],t[1])}function B3(e){var t=wt(e),n=2*Ct,s=t>0,r=Ut(t)>kt;function o(u,h,f,d){F3(d,e,n,f,u,h)}function i(u,h){return wt(u)*wt(h)>t}function a(u){var h,f,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,x){var b=[m,x],w,y=i(m,x),v=s?y?0:l(m,x):y?l(m+(m<0?Bt:-Bt),x):0;if(!h&&(p=d=y)&&u.lineStart(),y!==d&&(w=c(h,b),(!w||zf(h,w)||zf(b,w))&&(b[2]=1)),y!==d)g=0,y?(u.lineStart(),w=c(b,h),u.point(w[0],w[1])):(w=c(h,b),u.point(w[0],w[1],2),u.lineEnd()),h=w;else if(r&&h&&s^y){var $;!(v&f)&&($=c(b,h,!0))&&(g=0,s?(u.lineStart(),u.point($[0][0],$[0][1]),u.point($[1][0],$[1][1]),u.lineEnd()):(u.point($[1][0],$[1][1]),u.lineEnd(),u.lineStart(),u.point($[0][0],$[0][1],3)))}y&&(!h||!zf(h,b))&&u.point(b[0],b[1]),h=b,d=y,f=v},lineEnd:function(){d&&u.lineEnd(),h=null},clean:function(){return g|(p&&d)<<1}}}function c(u,h,f){var d=Xi(u),p=Xi(h),g=[1,0,0],m=fc(d,p),x=hf(m,m),b=m[0],w=x-b*b;if(!w)return!f&&u;var y=t*x/w,v=-t*b/w,$=fc(g,m),I=ff(g,y),N=ff(m,v);S0(I,N);var k=$,S=hf(I,k),C=hf(k,k),A=S*S-C*(hf(I,I)-1);if(!(A<0)){var R=Qe(A),_=ff(k,(-S-R)/C);if(S0(_,I),_=Pd(_),!f)return _;var T=u[0],E=h[0],M=u[1],O=h[1],L;E<T&&(L=T,T=E,E=L);var B=E-T,G=Ut(B-Bt)<kt,q=G||B<kt;if(!G&&O<M&&(L=M,M=O,O=L),q?G?M+O>0^_[1]<(Ut(_[0]-T)<kt?M:O):M<=_[1]&&_[1]<=O:B>Bt^(T<=_[0]&&_[0]<=E)){var Y=ff(k,(-S+R)/C);return S0(Y,I),[_,Pd(Y)]}}}function l(u,h){var f=s?e:Bt-e,d=0;return u<-f?d|=1:u>f&&(d|=2),h<-f?d|=4:h>f&&(d|=8),d}return z3(i,a,o,s?[0,-e]:[-Bt,e-Bt])}function jdt(e,t,n,s,r,o){var i=e[0],a=e[1],c=t[0],l=t[1],u=0,h=1,f=c-i,d=l-a,p;if(p=n-i,!(!f&&p>0)){if(p/=f,f<0){if(p<u)return;p<h&&(h=p)}else if(f>0){if(p>h)return;p>u&&(u=p)}if(p=r-i,!(!f&&p<0)){if(p/=f,f<0){if(p>h)return;p>u&&(u=p)}else if(f>0){if(p<u)return;p<h&&(h=p)}if(p=s-a,!(!d&&p>0)){if(p/=d,d<0){if(p<u)return;p<h&&(h=p)}else if(d>0){if(p>h)return;p>u&&(u=p)}if(p=o-a,!(!d&&p<0)){if(p/=d,d<0){if(p>h)return;p>u&&(u=p)}else if(d>0){if(p<u)return;p<h&&(h=p)}return u>0&&(e[0]=i+u*f,e[1]=a+u*d),h<1&&(t[0]=i+h*f,t[1]=a+h*d),!0}}}}}var pf=1e9,mf=-1e9;function lg(e,t,n,s){function r(l,u){return e<=l&&l<=n&&t<=u&&u<=s}function o(l,u,h,f){var d=0,p=0;if(l==null||(d=i(l,h))!==(p=i(u,h))||c(l,u)<0^h>0)do f.point(d===0||d===3?e:n,d>1?s:t);while((d=(d+h+4)%4)!==p);else f.point(u[0],u[1])}function i(l,u){return Ut(l[0]-e)<kt?u>0?0:3:Ut(l[0]-n)<kt?u>0?2:1:Ut(l[1]-t)<kt?u>0?1:0:u>0?3:2}function a(l,u){return c(l.x,u.x)}function c(l,u){var h=i(l,1),f=i(u,1);return h!==f?h-f:h===0?u[1]-l[1]:h===1?l[0]-u[0]:h===2?l[1]-u[1]:u[0]-l[0]}return function(l){var u=l,h=O3(),f,d,p,g,m,x,b,w,y,v,$,I={point:N,lineStart:A,lineEnd:R,polygonStart:S,polygonEnd:C};function N(T,E){r(T,E)&&u.point(T,E)}function k(){for(var T=0,E=0,M=d.length;E<M;++E)for(var O=d[E],L=1,B=O.length,G=O[0],q,Y,tt=G[0],J=G[1];L<B;++L)q=tt,Y=J,G=O[L],tt=G[0],J=G[1],Y<=s?J>s&&(tt-q)*(s-Y)>(J-Y)*(e-q)&&++T:J<=s&&(tt-q)*(s-Y)<(J-Y)*(e-q)&&--T;return T}function S(){u=h,f=[],d=[],$=!0}function C(){var T=k(),E=$&&T,M=(f=vw(f)).length;(E||M)&&(l.polygonStart(),E&&(l.lineStart(),o(null,null,1,l),l.lineEnd()),M&&L3(f,a,T,o,l),l.polygonEnd()),u=l,f=d=p=null}function A(){I.point=_,d&&d.push(p=[]),v=!0,y=!1,b=w=NaN}function R(){f&&(_(g,m),x&&y&&h.rejoin(),f.push(h.result())),I.point=N,y&&u.lineEnd()}function _(T,E){var M=r(T,E);if(d&&p.push([T,E]),v)g=T,m=E,x=M,v=!1,M&&(u.lineStart(),u.point(T,E));else if(M&&y)u.point(T,E);else{var O=[b=Math.max(mf,Math.min(pf,b)),w=Math.max(mf,Math.min(pf,w))],L=[T=Math.max(mf,Math.min(pf,T)),E=Math.max(mf,Math.min(pf,E))];jdt(O,L,e,t,n,s)?(y||(u.lineStart(),u.point(O[0],O[1])),u.point(L[0],L[1]),M||u.lineEnd(),$=!1):M&&(u.lineStart(),u.point(T,E),$=!1)}b=T,w=E,y=M}return I}}function Kdt(){var e=0,t=0,n=960,s=500,r,o,i;return i={stream:function(a){return r&&o===a?r:r=lg(e,t,n,s)(o=a)},extent:function(a){return arguments.length?(e=+a[0][0],t=+a[0][1],n=+a[1][0],s=+a[1][1],r=o=null,i):[[e,t],[n,s]]}}}var ax,cx,Bf,Vf,dc={sphere:be,point:be,lineStart:Ydt,lineEnd:be,polygonStart:be,polygonEnd:be};function Ydt(){dc.point=Qdt,dc.lineEnd=Zdt}function Zdt(){dc.point=dc.lineEnd=be}function Qdt(e,t){e*=Ct,t*=Ct,cx=e,Bf=pt(t),Vf=wt(t),dc.point=Jdt}function Jdt(e,t){e*=Ct,t*=Ct;var n=pt(t),s=wt(t),r=Ut(e-cx),o=wt(r),i=pt(r),a=s*i,c=Vf*n-Bf*s*o,l=Bf*n+Vf*s*o;ax.add(Wn(Qe(a*a+c*c),l)),cx=e,Bf=n,Vf=s}function V3(e){return ax=new Ge,js(e,dc),+ax}var lx=[null,null],tpt={type:"LineString",coordinates:lx};function Xd(e,t){return lx[0]=e,lx[1]=t,V3(tpt)}var PC={Feature:function(e,t){return jd(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,s=-1,r=n.length;++s<r;)if(jd(n[s].geometry,t))return!0;return!1}},zC={Sphere:function(){return!0},Point:function(e,t){return BC(e.coordinates,t)},MultiPoint:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)if(BC(n[s],t))return!0;return!1},LineString:function(e,t){return VC(e.coordinates,t)},MultiLineString:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)if(VC(n[s],t))return!0;return!1},Polygon:function(e,t){return WC(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,s=-1,r=n.length;++s<r;)if(WC(n[s],t))return!0;return!1},GeometryCollection:function(e,t){for(var n=e.geometries,s=-1,r=n.length;++s<r;)if(jd(n[s],t))return!0;return!1}};function jd(e,t){return e&&zC.hasOwnProperty(e.type)?zC[e.type](e,t):!1}function BC(e,t){return Xd(e,t)===0}function VC(e,t){for(var n,s,r,o=0,i=e.length;o<i;o++){if(s=Xd(e[o],t),s===0||o>0&&(r=Xd(e[o],e[o-1]),r>0&&n<=r&&s<=r&&(n+s-r)*(1-Math.pow((n-s)/r,2))<Ad*r))return!0;n=s}return!1}function WC(e,t){return!!P3(e.map(ept),W3(t))}function ept(e){return e=e.map(W3),e.pop(),e}function W3(e){return[e[0]*Ct,e[1]*Ct]}function npt(e,t){return(e&&PC.hasOwnProperty(e.type)?PC[e.type]:jd)(e,t)}function UC(e,t,n){var s=Co(e,t-kt,n).concat(t);return function(r){return s.map(function(o){return[r,o]})}}function GC(e,t,n){var s=Co(e,t-kt,n).concat(t);return function(r){return s.map(function(o){return[o,r]})}}function U3(){var e,t,n,s,r,o,i,a,c=10,l=c,u=90,h=360,f,d,p,g,m=2.5;function x(){return{type:"MultiLineString",coordinates:b()}}function b(){return Co(uf(s/u)*u,n,u).map(p).concat(Co(uf(a/h)*h,i,h).map(g)).concat(Co(uf(t/c)*c,e,c).filter(function(w){return Ut(w%u)>kt}).map(f)).concat(Co(uf(o/l)*l,r,l).filter(function(w){return Ut(w%h)>kt}).map(d))}return x.lines=function(){return b().map(function(w){return{type:"LineString",coordinates:w}})},x.outline=function(){return{type:"Polygon",coordinates:[p(s).concat(g(i).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},x.extent=function(w){return arguments.length?x.extentMajor(w).extentMinor(w):x.extentMinor()},x.extentMajor=function(w){return arguments.length?(s=+w[0][0],n=+w[1][0],a=+w[0][1],i=+w[1][1],s>n&&(w=s,s=n,n=w),a>i&&(w=a,a=i,i=w),x.precision(m)):[[s,a],[n,i]]},x.extentMinor=function(w){return arguments.length?(t=+w[0][0],e=+w[1][0],o=+w[0][1],r=+w[1][1],t>e&&(w=t,t=e,e=w),o>r&&(w=o,o=r,r=w),x.precision(m)):[[t,o],[e,r]]},x.step=function(w){return arguments.length?x.stepMajor(w).stepMinor(w):x.stepMinor()},x.stepMajor=function(w){return arguments.length?(u=+w[0],h=+w[1],x):[u,h]},x.stepMinor=function(w){return arguments.length?(c=+w[0],l=+w[1],x):[c,l]},x.precision=function(w){return arguments.length?(m=+w,f=UC(o,r,90),d=GC(t,e,m),p=UC(a,i,90),g=GC(s,n,m),x):m},x.extentMajor([[-180,-90+kt],[180,90-kt]]).extentMinor([[-180,-80-kt],[180,80+kt]])}function spt(){return U3()()}function rpt(e,t){var n=e[0]*Ct,s=e[1]*Ct,r=t[0]*Ct,o=t[1]*Ct,i=wt(s),a=pt(s),c=wt(o),l=pt(o),u=i*wt(n),h=i*pt(n),f=c*wt(r),d=c*pt(r),p=2*Un(Qe(kC(o-s)+i*c*kC(r-n))),g=pt(p),m=p?function(x){var b=pt(x*=p)/g,w=pt(p-x)/g,y=w*u+b*f,v=w*h+b*d,$=w*a+b*l;return[Wn(v,y)*re,Wn($,Qe(y*y+v*v))*re]}:function(){return[n*re,s*re]};return m.distance=p,m}const eu=e=>e;var _0=new Ge,ux=new Ge,G3,H3,hx,fx,Ur={point:be,lineStart:be,lineEnd:be,polygonStart:function(){Ur.lineStart=opt,Ur.lineEnd=apt},polygonEnd:function(){Ur.lineStart=Ur.lineEnd=Ur.point=be,_0.add(Ut(ux)),ux=new Ge},result:function(){var e=_0/2;return _0=new Ge,e}};function opt(){Ur.point=ipt}function ipt(e,t){Ur.point=q3,G3=hx=e,H3=fx=t}function q3(e,t){ux.add(fx*e-hx*t),hx=e,fx=t}function apt(){q3(G3,H3)}var pc=1/0,Kd=pc,nu=-pc,Yd=nu,Zd={point:cpt,lineStart:be,lineEnd:be,polygonStart:be,polygonEnd:be,result:function(){var e=[[pc,Kd],[nu,Yd]];return nu=Yd=-(Kd=pc=1/0),e}};function cpt(e,t){e<pc&&(pc=e),e>nu&&(nu=e),t<Kd&&(Kd=t),t>Yd&&(Yd=t)}var dx=0,px=0,pl=0,Qd=0,Jd=0,Aa=0,mx=0,gx=0,ml=0,X3,j3,pr,mr,_s={point:ji,lineStart:HC,lineEnd:qC,polygonStart:function(){_s.lineStart=hpt,_s.lineEnd=fpt},polygonEnd:function(){_s.point=ji,_s.lineStart=HC,_s.lineEnd=qC},result:function(){var e=ml?[mx/ml,gx/ml]:Aa?[Qd/Aa,Jd/Aa]:pl?[dx/pl,px/pl]:[NaN,NaN];return dx=px=pl=Qd=Jd=Aa=mx=gx=ml=0,e}};function ji(e,t){dx+=e,px+=t,++pl}function HC(){_s.point=lpt}function lpt(e,t){_s.point=upt,ji(pr=e,mr=t)}function upt(e,t){var n=e-pr,s=t-mr,r=Qe(n*n+s*s);Qd+=r*(pr+e)/2,Jd+=r*(mr+t)/2,Aa+=r,ji(pr=e,mr=t)}function qC(){_s.point=ji}function hpt(){_s.point=dpt}function fpt(){K3(X3,j3)}function dpt(e,t){_s.point=K3,ji(X3=pr=e,j3=mr=t)}function K3(e,t){var n=e-pr,s=t-mr,r=Qe(n*n+s*s);Qd+=r*(pr+e)/2,Jd+=r*(mr+t)/2,Aa+=r,r=mr*e-pr*t,mx+=r*(pr+e),gx+=r*(mr+t),ml+=r*3,ji(pr=e,mr=t)}function Y3(e){this._context=e}Y3.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Vn);break}}},result:be};var xx=new Ge,T0,Z3,Q3,gl,xl,su={point:be,lineStart:function(){su.point=ppt},lineEnd:function(){T0&&J3(Z3,Q3),su.point=be},polygonStart:function(){T0=!0},polygonEnd:function(){T0=null},result:function(){var e=+xx;return xx=new Ge,e}};function ppt(e,t){su.point=J3,Z3=gl=e,Q3=xl=t}function J3(e,t){gl-=e,xl-=t,xx.add(Qe(gl*gl+xl*xl)),gl=e,xl=t}let XC,tp,jC,KC;class YC{constructor(t){this._append=t==null?tD:mpt(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==jC||this._append!==tp){const s=this._radius,r=this._;this._="",this._append`m0,${s}a${s},${s} 0 1,1 0,${-2*s}a${s},${s} 0 1,1 0,${2*s}z`,jC=s,tp=this._append,KC=this._,this._=r}this._+=KC;break}}}result(){const t=this._;return this._="",t.length?t:null}}function tD(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function mpt(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return tD;if(t!==XC){const n=10**t;XC=t,tp=function(r){let o=1;this._+=r[0];for(const i=r.length;o<i;++o)this._+=Math.round(arguments[o]*n)/n+r[o]}}return tp}function eD(e,t){let n=3,s=4.5,r,o;function i(a){return a&&(typeof s=="function"&&o.pointRadius(+s.apply(this,arguments)),js(a,r(o))),o.result()}return i.area=function(a){return js(a,r(Ur)),Ur.result()},i.measure=function(a){return js(a,r(su)),su.result()},i.bounds=function(a){return js(a,r(Zd)),Zd.result()},i.centroid=function(a){return js(a,r(_s)),_s.result()},i.projection=function(a){return arguments.length?(r=a==null?(e=null,eu):(e=a).stream,i):e},i.context=function(a){return arguments.length?(o=a==null?(t=null,new YC(n)):new Y3(t=a),typeof s!="function"&&o.pointRadius(s),i):t},i.pointRadius=function(a){return arguments.length?(s=typeof a=="function"?a:(o.pointRadius(+a),+a),i):s},i.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const c=Math.floor(a);if(!(c>=0))throw new RangeError(`invalid digits: ${a}`);n=c}return t===null&&(o=new YC(n)),i},i.projection(e).digits(n).context(t)}function gpt(e){return{stream:Rh(e)}}function Rh(e){return function(t){var n=new bx;for(var s in e)n[s]=e[s];return n.stream=t,n}}function bx(){}bx.prototype={constructor:bx,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function jw(e,t,n){var s=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),s!=null&&e.clipExtent(null),js(n,e.stream(Zd)),t(Zd.result()),s!=null&&e.clipExtent(s),e}function ug(e,t,n){return jw(e,function(s){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],i=Math.min(r/(s[1][0]-s[0][0]),o/(s[1][1]-s[0][1])),a=+t[0][0]+(r-i*(s[1][0]+s[0][0]))/2,c=+t[0][1]+(o-i*(s[1][1]+s[0][1]))/2;e.scale(150*i).translate([a,c])},n)}function Kw(e,t,n){return ug(e,[[0,0],t],n)}function Yw(e,t,n){return jw(e,function(s){var r=+t,o=r/(s[1][0]-s[0][0]),i=(r-o*(s[1][0]+s[0][0]))/2,a=-o*s[0][1];e.scale(150*o).translate([i,a])},n)}function Zw(e,t,n){return jw(e,function(s){var r=+t,o=r/(s[1][1]-s[0][1]),i=-o*s[0][0],a=(r-o*(s[1][1]+s[0][1]))/2;e.scale(150*o).translate([i,a])},n)}var ZC=16,xpt=wt(30*Ct);function QC(e,t){return+t?ypt(e,t):bpt(e)}function bpt(e){return Rh({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function ypt(e,t){function n(s,r,o,i,a,c,l,u,h,f,d,p,g,m){var x=l-s,b=u-r,w=x*x+b*b;if(w>4*t&&g--){var y=i+f,v=a+d,$=c+p,I=Qe(y*y+v*v+$*$),N=Un($/=I),k=Ut(Ut($)-1)<kt||Ut(o-h)<kt?(o+h)/2:Wn(v,y),S=e(k,N),C=S[0],A=S[1],R=C-s,_=A-r,T=b*R-x*_;(T*T/w>t||Ut((x*R+b*_)/w-.5)>.3||i*f+a*d+c*p<xpt)&&(n(s,r,o,i,a,c,C,A,k,y/=I,v/=I,$,g,m),m.point(C,A),n(C,A,k,y,v,$,l,u,h,f,d,p,g,m))}}return function(s){var r,o,i,a,c,l,u,h,f,d,p,g,m={point:x,lineStart:b,lineEnd:y,polygonStart:function(){s.polygonStart(),m.lineStart=v},polygonEnd:function(){s.polygonEnd(),m.lineStart=b}};function x(N,k){N=e(N,k),s.point(N[0],N[1])}function b(){h=NaN,m.point=w,s.lineStart()}function w(N,k){var S=Xi([N,k]),C=e(N,k);n(h,f,u,d,p,g,h=C[0],f=C[1],u=N,d=S[0],p=S[1],g=S[2],ZC,s),s.point(h,f)}function y(){m.point=x,s.lineEnd()}function v(){b(),m.point=$,m.lineEnd=I}function $(N,k){w(r=N,k),o=h,i=f,a=d,c=p,l=g,m.point=w}function I(){n(h,f,u,d,p,g,o,i,r,a,c,l,ZC,s),m.lineEnd=y,y()}return m}}var wpt=Rh({point:function(e,t){this.stream.point(e*Ct,t*Ct)}});function vpt(e){return Rh({point:function(t,n){var s=e(t,n);return this.stream.point(s[0],s[1])}})}function $pt(e,t,n,s,r){function o(i,a){return i*=s,a*=r,[t+e*i,n-e*a]}return o.invert=function(i,a){return[(i-t)/e*s,(n-a)/e*r]},o}function JC(e,t,n,s,r,o){if(!o)return $pt(e,t,n,s,r);var i=wt(o),a=pt(o),c=i*e,l=a*e,u=i/e,h=a/e,f=(a*n-i*t)/e,d=(a*t+i*n)/e;function p(g,m){return g*=s,m*=r,[c*g-l*m+t,n-l*g-c*m]}return p.invert=function(g,m){return[s*(u*g-h*m+f),r*(d-h*g-u*m)]},p}function Mr(e){return Qw(function(){return e})()}function Qw(e){var t,n=150,s=480,r=250,o=0,i=0,a=0,c=0,l=0,u,h=0,f=1,d=1,p=null,g=ix,m=null,x,b,w,y=eu,v=.5,$,I,N,k,S;function C(T){return N(T[0]*Ct,T[1]*Ct)}function A(T){return T=N.invert(T[0],T[1]),T&&[T[0]*re,T[1]*re]}C.stream=function(T){return k&&S===T?k:k=wpt(vpt(u)(g($(y(S=T)))))},C.preclip=function(T){return arguments.length?(g=T,p=void 0,_()):g},C.postclip=function(T){return arguments.length?(y=T,m=x=b=w=null,_()):y},C.clipAngle=function(T){return arguments.length?(g=+T?B3(p=T*Ct):(p=null,ix),_()):p*re},C.clipExtent=function(T){return arguments.length?(y=T==null?(m=x=b=w=null,eu):lg(m=+T[0][0],x=+T[0][1],b=+T[1][0],w=+T[1][1]),_()):m==null?null:[[m,x],[b,w]]},C.scale=function(T){return arguments.length?(n=+T,R()):n},C.translate=function(T){return arguments.length?(s=+T[0],r=+T[1],R()):[s,r]},C.center=function(T){return arguments.length?(o=T[0]%360*Ct,i=T[1]%360*Ct,R()):[o*re,i*re]},C.rotate=function(T){return arguments.length?(a=T[0]%360*Ct,c=T[1]%360*Ct,l=T.length>2?T[2]%360*Ct:0,R()):[a*re,c*re,l*re]},C.angle=function(T){return arguments.length?(h=T%360*Ct,R()):h*re},C.reflectX=function(T){return arguments.length?(f=T?-1:1,R()):f<0},C.reflectY=function(T){return arguments.length?(d=T?-1:1,R()):d<0},C.precision=function(T){return arguments.length?($=QC(I,v=T*T),_()):Qe(v)},C.fitExtent=function(T,E){return ug(C,T,E)},C.fitSize=function(T,E){return Kw(C,T,E)},C.fitWidth=function(T,E){return Yw(C,T,E)},C.fitHeight=function(T,E){return Zw(C,T,E)};function R(){var T=JC(n,0,0,f,d,h).apply(null,t(o,i)),E=JC(n,s-T[0],r-T[1],f,d,h);return u=Xw(a,c,l),I=rx(t,E),N=rx(u,I),$=QC(I,v),_()}function _(){return k=S=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&A,R()}}function Jw(e){var t=0,n=Bt/3,s=Qw(e),r=s(t,n);return r.parallels=function(o){return arguments.length?s(t=o[0]*Ct,n=o[1]*Ct):[t*re,n*re]},r}function Cpt(e){var t=wt(e);function n(s,r){return[s*t,pt(r)/t]}return n.invert=function(s,r){return[s/t,Un(r*t)]},n}function nD(e,t){var n=pt(e),s=(n+pt(t))/2;if(Ut(s)<kt)return Cpt(e);var r=1+n*(2*s-n),o=Qe(r)/s;function i(a,c){var l=Qe(r-2*s*pt(c))/s;return[l*pt(a*=s),o-l*wt(a)]}return i.invert=function(a,c){var l=o-c,u=Wn(a,Ut(l))*Rs(l);return l*s<0&&(u-=Bt*Rs(a)*Rs(l)),[u/s,Un((r-(a*a+l*l)*s*s)/(2*s))]},i}function ep(){return Jw(nD).scale(155.424).center([0,33.6442])}function sD(){return ep().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function kpt(e){var t=e.length;return{point:function(n,s){for(var r=-1;++r<t;)e[r].point(n,s)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function Ipt(){var e,t,n=sD(),s,r=ep().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,i=ep().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,c,l={point:function(f,d){c=[f,d]}};function u(f){var d=f[0],p=f[1];return c=null,s.point(d,p),c||(o.point(d,p),c)||(a.point(d,p),c)}u.invert=function(f){var d=n.scale(),p=n.translate(),g=(f[0]-p[0])/d,m=(f[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?i:n).invert(f)},u.stream=function(f){return e&&t===f?e:e=kpt([n.stream(t=f),r.stream(f),i.stream(f)])},u.precision=function(f){return arguments.length?(n.precision(f),r.precision(f),i.precision(f),h()):n.precision()},u.scale=function(f){return arguments.length?(n.scale(f),r.scale(f*.35),i.scale(f),u.translate(n.translate())):n.scale()},u.translate=function(f){if(!arguments.length)return n.translate();var d=n.scale(),p=+f[0],g=+f[1];return s=n.translate(f).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(l),o=r.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+kt,g+.12*d+kt],[p-.214*d-kt,g+.234*d-kt]]).stream(l),a=i.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+kt,g+.166*d+kt],[p-.115*d-kt,g+.234*d-kt]]).stream(l),h()},u.fitExtent=function(f,d){return ug(u,f,d)},u.fitSize=function(f,d){return Kw(u,f,d)},u.fitWidth=function(f,d){return Yw(u,f,d)},u.fitHeight=function(f,d){return Zw(u,f,d)};function h(){return e=t=null,u}return u.scale(1070)}function rD(e){return function(t,n){var s=wt(t),r=wt(n),o=e(s*r);return o===1/0?[2,0]:[o*r*pt(t),o*pt(n)]}}function Ah(e){return function(t,n){var s=Qe(t*t+n*n),r=e(s),o=pt(r),i=wt(r);return[Wn(t*o,s*i),Un(s&&n*o/s)]}}var tv=rD(function(e){return Qe(2/(1+e))});tv.invert=Ah(function(e){return 2*Un(e/2)});function Spt(){return Mr(tv).scale(124.75).clipAngle(180-.001)}var ev=rD(function(e){return(e=C3(e))&&e/pt(e)});ev.invert=Ah(function(e){return e});function Npt(){return Mr(ev).scale(79.4188).clipAngle(180-.001)}function Dh(e,t){return[e,Md(Hw((Ce+t)/2))]}Dh.invert=function(e,t){return[e,2*Wc($3(t))-Ce]};function _pt(){return oD(Dh).scale(961/Vn)}function oD(e){var t=Mr(e),n=t.center,s=t.scale,r=t.translate,o=t.clipExtent,i=null,a,c,l;t.scale=function(h){return arguments.length?(s(h),u()):s()},t.translate=function(h){return arguments.length?(r(h),u()):r()},t.center=function(h){return arguments.length?(n(h),u()):n()},t.clipExtent=function(h){return arguments.length?(h==null?i=a=c=l=null:(i=+h[0][0],a=+h[0][1],c=+h[1][0],l=+h[1][1]),u()):i==null?null:[[i,a],[c,l]]};function u(){var h=Bt*s(),f=t(M3(t.rotate()).invert([0,0]));return o(i==null?[[f[0]-h,f[1]-h],[f[0]+h,f[1]+h]]:e===Dh?[[Math.max(f[0]-h,i),a],[Math.min(f[0]+h,c),l]]:[[i,Math.max(f[1]-h,a)],[c,Math.min(f[1]+h,l)]])}return u()}function gf(e){return Hw((Ce+e)/2)}function iD(e,t){var n=wt(e),s=e===t?pt(e):Md(n/wt(t))/Md(gf(t)/gf(e)),r=n*I0(gf(e),s)/s;if(!s)return Dh;function o(i,a){r>0?a<-Ce+kt&&(a=-Ce+kt):a>Ce-kt&&(a=Ce-kt);var c=r/I0(gf(a),s);return[c*pt(s*i),r-c*wt(s*i)]}return o.invert=function(i,a){var c=r-a,l=Rs(s)*Qe(i*i+c*c),u=Wn(i,Ut(c))*Rs(c);return c*s<0&&(u-=Bt*Rs(i)*Rs(c)),[u/s,2*Wc(I0(r/l,1/s))-Ce]},o}function Tpt(){return Jw(iD).scale(109.5).parallels([30,30])}function ru(e,t){return[e,t]}ru.invert=ru;function Ept(){return Mr(ru).scale(152.63)}function aD(e,t){var n=wt(e),s=e===t?pt(e):(n-wt(t))/(t-e),r=n/s+e;if(Ut(s)<kt)return ru;function o(i,a){var c=r-a,l=s*i;return[c*pt(l),r-c*wt(l)]}return o.invert=function(i,a){var c=r-a,l=Wn(i,Ut(c))*Rs(c);return c*s<0&&(l-=Bt*Rs(i)*Rs(c)),[l/s,r-Rs(s)*Qe(i*i+c*c)]},o}function Rpt(){return Jw(aD).scale(131.154).center([0,13.9389])}var Nl=1.340264,_l=-.081106,Tl=893e-6,El=.003796,np=Qe(3)/2,Apt=12;function nv(e,t){var n=Un(np*pt(t)),s=n*n,r=s*s*s;return[e*wt(n)/(np*(Nl+3*_l*s+r*(7*Tl+9*El*s))),n*(Nl+_l*s+r*(Tl+El*s))]}nv.invert=function(e,t){for(var n=t,s=n*n,r=s*s*s,o=0,i,a,c;o<Apt&&(a=n*(Nl+_l*s+r*(Tl+El*s))-t,c=Nl+3*_l*s+r*(7*Tl+9*El*s),n-=i=a/c,s=n*n,r=s*s*s,!(Ut(i)<Ad));++o);return[np*e*(Nl+3*_l*s+r*(7*Tl+9*El*s))/wt(n),Un(pt(n)/np)]};function Dpt(){return Mr(nv).scale(177.158)}function sv(e,t){var n=wt(t),s=wt(e)*n;return[n*pt(e)/s,pt(t)/s]}sv.invert=Ah(Wc);function Mpt(){return Mr(sv).scale(144.049).clipAngle(60)}function Fpt(){var e=1,t=0,n=0,s=1,r=1,o=0,i,a,c=null,l,u,h,f=1,d=1,p=Rh({point:function(y,v){var $=w([y,v]);this.stream.point($[0],$[1])}}),g=eu,m,x;function b(){return f=e*s,d=e*r,m=x=null,w}function w(y){var v=y[0]*f,$=y[1]*d;if(o){var I=$*i-v*a;v=v*i+$*a,$=I}return[v+t,$+n]}return w.invert=function(y){var v=y[0]-t,$=y[1]-n;if(o){var I=$*i+v*a;v=v*i-$*a,$=I}return[v/f,$/d]},w.stream=function(y){return m&&x===y?m:m=p(g(x=y))},w.postclip=function(y){return arguments.length?(g=y,c=l=u=h=null,b()):g},w.clipExtent=function(y){return arguments.length?(g=y==null?(c=l=u=h=null,eu):lg(c=+y[0][0],l=+y[0][1],u=+y[1][0],h=+y[1][1]),b()):c==null?null:[[c,l],[u,h]]},w.scale=function(y){return arguments.length?(e=+y,b()):e},w.translate=function(y){return arguments.length?(t=+y[0],n=+y[1],b()):[t,n]},w.angle=function(y){return arguments.length?(o=y%360*Ct,a=pt(o),i=wt(o),b()):o*re},w.reflectX=function(y){return arguments.length?(s=y?-1:1,b()):s<0},w.reflectY=function(y){return arguments.length?(r=y?-1:1,b()):r<0},w.fitExtent=function(y,v){return ug(w,y,v)},w.fitSize=function(y,v){return Kw(w,y,v)},w.fitWidth=function(y,v){return Yw(w,y,v)},w.fitHeight=function(y,v){return Zw(w,y,v)},w}function rv(e,t){var n=t*t,s=n*n;return[e*(.8707-.131979*n+s*(-.013791+s*(.003971*n-.001529*s))),t*(1.007226+n*(.015085+s*(-.044475+.028874*n-.005916*s)))]}rv.invert=function(e,t){var n=t,s=25,r;do{var o=n*n,i=o*o;n-=r=(n*(1.007226+o*(.015085+i*(-.044475+.028874*o-.005916*i)))-t)/(1.007226+o*(.015085*3+i*(-.044475*7+.028874*9*o-.005916*11*i)))}while(Ut(r)>kt&&--s>0);return[e/(.8707+(o=n*n)*(-.131979+o*(-.013791+o*o*o*(.003971-.001529*o)))),n]};function Opt(){return Mr(rv).scale(175.295)}function ov(e,t){return[wt(t)*pt(e),pt(t)]}ov.invert=Ah(Un);function Lpt(){return Mr(ov).scale(249.5).clipAngle(90+kt)}function iv(e,t){var n=wt(t),s=1+wt(e)*n;return[n*pt(e)/s,pt(t)/s]}iv.invert=Ah(function(e){return 2*Wc(e)});function Ppt(){return Mr(iv).scale(250).clipAngle(142)}function av(e,t){return[Md(Hw((Ce+t)/2)),-e]}av.invert=function(e,t){return[-t,2*Wc($3(e))-Ce]};function zpt(){var e=oD(av),t=e.center,n=e.rotate;return e.center=function(s){return arguments.length?t([-s[1],s[0]]):(s=t(),[s[1],-s[0]])},e.rotate=function(s){return arguments.length?n([s[0],s[1],s.length>2?s[2]+90:90]):(s=n(),[s[0],s[1],s[2]-90])},n([0,0,90]).scale(159.155)}function Bpt(e,t){return e.parent===t.parent?1:2}function Vpt(e){return e.reduce(Wpt,0)/e.length}function Wpt(e,t){return e+t.x}function Upt(e){return 1+e.reduce(Gpt,0)}function Gpt(e,t){return Math.max(e,t.y)}function Hpt(e){for(var t;t=e.children;)e=t[0];return e}function qpt(e){for(var t;t=e.children;)e=t[t.length-1];return e}function Xpt(){var e=Bpt,t=1,n=1,s=!1;function r(o){var i,a=0;o.eachAfter(function(f){var d=f.children;d?(f.x=Vpt(d),f.y=Upt(d)):(f.x=i?a+=e(f,i):0,f.y=0,i=f)});var c=Hpt(o),l=qpt(o),u=c.x-e(c,l)/2,h=l.x+e(l,c)/2;return o.eachAfter(s?function(f){f.x=(f.x-o.x)*t,f.y=(o.y-f.y)*n}:function(f){f.x=(f.x-u)/(h-u)*t,f.y=(1-(o.y?f.y/o.y:1))*n})}return r.separation=function(o){return arguments.length?(e=o,r):e},r.size=function(o){return arguments.length?(s=!1,t=+o[0],n=+o[1],r):s?null:[t,n]},r.nodeSize=function(o){return arguments.length?(s=!0,t=+o[0],n=+o[1],r):s?[t,n]:null},r}function jpt(e){var t=0,n=e.children,s=n&&n.length;if(!s)t=1;else for(;--s>=0;)t+=n[s].value;e.value=t}function Kpt(){return this.eachAfter(jpt)}function Ypt(e,t){let n=-1;for(const s of this)e.call(t,s,++n,this);return this}function Zpt(e,t){for(var n=this,s=[n],r,o,i=-1;n=s.pop();)if(e.call(t,n,++i,this),r=n.children)for(o=r.length-1;o>=0;--o)s.push(r[o]);return this}function Qpt(e,t){for(var n=this,s=[n],r=[],o,i,a,c=-1;n=s.pop();)if(r.push(n),o=n.children)for(i=0,a=o.length;i<a;++i)s.push(o[i]);for(;n=r.pop();)e.call(t,n,++c,this);return this}function Jpt(e,t){let n=-1;for(const s of this)if(e.call(t,s,++n,this))return s}function tmt(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,s=t.children,r=s&&s.length;--r>=0;)n+=s[r].value;t.value=n})}function emt(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function nmt(e){for(var t=this,n=smt(t,e),s=[t];t!==n;)t=t.parent,s.push(t);for(var r=s.length;e!==n;)s.splice(r,0,e),e=e.parent;return s}function smt(e,t){if(e===t)return e;var n=e.ancestors(),s=t.ancestors(),r=null;for(e=n.pop(),t=s.pop();e===t;)r=e,e=n.pop(),t=s.pop();return r}function rmt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function omt(){return Array.from(this)}function imt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function amt(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*cmt(){var e=this,t,n=[e],s,r,o;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,s=e.children)for(r=0,o=s.length;r<o;++r)n.push(s[r]);while(n.length)}function cv(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=hmt)):t===void 0&&(t=umt);for(var n=new Ki(e),s,r=[n],o,i,a,c;s=r.pop();)if((i=t(s.data))&&(c=(i=Array.from(i)).length))for(s.children=i,a=c-1;a>=0;--a)r.push(o=i[a]=new Ki(i[a])),o.parent=s,o.depth=s.depth+1;return n.eachBefore(cD)}function lmt(){return cv(this).eachBefore(fmt)}function umt(e){return e.children}function hmt(e){return Array.isArray(e)?e[1]:null}function fmt(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function cD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Ki(e){this.data=e,this.depth=this.height=0,this.parent=null}Ki.prototype=cv.prototype={constructor:Ki,count:Kpt,each:Ypt,eachAfter:Qpt,eachBefore:Zpt,find:Jpt,sum:tmt,sort:emt,path:nmt,ancestors:rmt,descendants:omt,leaves:imt,links:amt,copy:lmt,[Symbol.iterator]:cmt};function Wf(e){return e==null?null:lD(e)}function lD(e){if(typeof e!="function")throw new Error;return e}function di(){return 0}function Ta(e){return function(){return e}}const dmt=1664525,pmt=1013904223,tk=4294967296;function lv(){let e=1;return()=>(e=(dmt*e+pmt)%tk)/tk}function mmt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function gmt(e,t){let n=e.length,s,r;for(;n;)r=t()*n--|0,s=e[n],e[n]=e[r],e[r]=s;return e}function xmt(e){return uD(e,lv())}function uD(e,t){for(var n=0,s=(e=gmt(Array.from(e),t)).length,r=[],o,i;n<s;)o=e[n],i&&hD(i,o)?++n:(i=ymt(r=bmt(r,o)),n=0);return i}function bmt(e,t){var n,s;if(E0(t,e))return[t];for(n=0;n<e.length;++n)if(xf(t,e[n])&&E0(bl(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(s=n+1;s<e.length;++s)if(xf(bl(e[n],e[s]),t)&&xf(bl(e[n],t),e[s])&&xf(bl(e[s],t),e[n])&&E0(fD(e[n],e[s],t),e))return[e[n],e[s],t];throw new Error}function xf(e,t){var n=e.r-t.r,s=t.x-e.x,r=t.y-e.y;return n<0||n*n<s*s+r*r}function hD(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,s=t.x-e.x,r=t.y-e.y;return n>0&&n*n>s*s+r*r}function E0(e,t){for(var n=0;n<t.length;++n)if(!hD(e,t[n]))return!1;return!0}function ymt(e){switch(e.length){case 1:return wmt(e[0]);case 2:return bl(e[0],e[1]);case 3:return fD(e[0],e[1],e[2])}}function wmt(e){return{x:e.x,y:e.y,r:e.r}}function bl(e,t){var n=e.x,s=e.y,r=e.r,o=t.x,i=t.y,a=t.r,c=o-n,l=i-s,u=a-r,h=Math.sqrt(c*c+l*l);return{x:(n+o+c/h*u)/2,y:(s+i+l/h*u)/2,r:(h+r+a)/2}}function fD(e,t,n){var s=e.x,r=e.y,o=e.r,i=t.x,a=t.y,c=t.r,l=n.x,u=n.y,h=n.r,f=s-i,d=s-l,p=r-a,g=r-u,m=c-o,x=h-o,b=s*s+r*r-o*o,w=b-i*i-a*a+c*c,y=b-l*l-u*u+h*h,v=d*p-f*g,$=(p*y-g*w)/(v*2)-s,I=(g*m-p*x)/v,N=(d*w-f*y)/(v*2)-r,k=(f*x-d*m)/v,S=I*I+k*k-1,C=2*(o+$*I+N*k),A=$*$+N*N-o*o,R=-(Math.abs(S)>1e-6?(C+Math.sqrt(C*C-4*S*A))/(2*S):A/C);return{x:s+$+I*R,y:r+N+k*R,r:R}}function ek(e,t,n){var s=e.x-t.x,r,o,i=e.y-t.y,a,c,l=s*s+i*i;l?(o=t.r+n.r,o*=o,c=e.r+n.r,c*=c,o>c?(r=(l+c-o)/(2*l),a=Math.sqrt(Math.max(0,c/l-r*r)),n.x=e.x-r*s-a*i,n.y=e.y-r*i+a*s):(r=(l+o-c)/(2*l),a=Math.sqrt(Math.max(0,o/l-r*r)),n.x=t.x+r*s-a*i,n.y=t.y+r*i+a*s)):(n.x=t.x+n.r,n.y=t.y)}function nk(e,t){var n=e.r+t.r-1e-6,s=t.x-e.x,r=t.y-e.y;return n>0&&n*n>s*s+r*r}function sk(e){var t=e._,n=e.next._,s=t.r+n.r,r=(t.x*n.r+n.x*t.r)/s,o=(t.y*n.r+n.y*t.r)/s;return r*r+o*o}function bf(e){this._=e,this.next=null,this.previous=null}function dD(e,t){if(!(o=(e=mmt(e)).length))return 0;var n,s,r,o,i,a,c,l,u,h,f;if(n=e[0],n.x=0,n.y=0,!(o>1))return n.r;if(s=e[1],n.x=-s.r,s.x=n.r,s.y=0,!(o>2))return n.r+s.r;ek(s,n,r=e[2]),n=new bf(n),s=new bf(s),r=new bf(r),n.next=r.previous=s,s.next=n.previous=r,r.next=s.previous=n;t:for(c=3;c<o;++c){ek(n._,s._,r=e[c]),r=new bf(r),l=s.next,u=n.previous,h=s._.r,f=n._.r;do if(h<=f){if(nk(l._,r._)){s=l,n.next=s,s.previous=n,--c;continue t}h+=l._.r,l=l.next}else{if(nk(u._,r._)){n=u,n.next=s,s.previous=n,--c;continue t}f+=u._.r,u=u.previous}while(l!==u.next);for(r.previous=n,r.next=s,n.next=s.previous=s=r,i=sk(n);(r=r.next)!==s;)(a=sk(r))<i&&(n=r,i=a);s=n.next}for(n=[s._],r=s;(r=r.next)!==s;)n.push(r._);for(r=uD(n,t),c=0;c<o;++c)n=e[c],n.x-=r.x,n.y-=r.y;return r.r}function vmt(e){return dD(e,lv()),e}function $mt(e){return Math.sqrt(e.value)}function Cmt(){var e=null,t=1,n=1,s=di;function r(o){const i=lv();return o.x=t/2,o.y=n/2,e?o.eachBefore(rk(e)).eachAfter(R0(s,.5,i)).eachBefore(ok(1)):o.eachBefore(rk($mt)).eachAfter(R0(di,1,i)).eachAfter(R0(s,o.r/Math.min(t,n),i)).eachBefore(ok(Math.min(t,n)/(2*o.r))),o}return r.radius=function(o){return arguments.length?(e=Wf(o),r):e},r.size=function(o){return arguments.length?(t=+o[0],n=+o[1],r):[t,n]},r.padding=function(o){return arguments.length?(s=typeof o=="function"?o:Ta(+o),r):s},r}function rk(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function R0(e,t,n){return function(s){if(r=s.children){var r,o,i=r.length,a=e(s)*t||0,c;if(a)for(o=0;o<i;++o)r[o].r+=a;if(c=dD(r,n),a)for(o=0;o<i;++o)r[o].r-=a;s.r=c+a}}}function ok(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function pD(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Mh(e,t,n,s,r){for(var o=e.children,i,a=-1,c=o.length,l=e.value&&(s-t)/e.value;++a<c;)i=o[a],i.y0=n,i.y1=r,i.x0=t,i.x1=t+=i.value*l}function kmt(){var e=1,t=1,n=0,s=!1;function r(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(o(t,a)),s&&i.eachBefore(pD),i}function o(i,a){return function(c){c.children&&Mh(c,c.x0,i*(c.depth+1)/a,c.x1,i*(c.depth+2)/a);var l=c.x0,u=c.y0,h=c.x1-n,f=c.y1-n;h<l&&(l=h=(l+h)/2),f<u&&(u=f=(u+f)/2),c.x0=l,c.y0=u,c.x1=h,c.y1=f}}return r.round=function(i){return arguments.length?(s=!!i,r):s},r.size=function(i){return arguments.length?(e=+i[0],t=+i[1],r):[e,t]},r.padding=function(i){return arguments.length?(n=+i,r):n},r}var Imt={depth:-1},ik={},A0={};function Smt(e){return e.id}function Nmt(e){return e.parentId}function _mt(){var e=Smt,t=Nmt,n;function s(r){var o=Array.from(r),i=e,a=t,c,l,u,h,f,d,p,g,m=new Map;if(n!=null){const x=o.map((y,v)=>Tmt(n(y,v,r))),b=x.map(ak),w=new Set(x).add("");for(const y of b)w.has(y)||(w.add(y),x.push(y),b.push(ak(y)),o.push(A0));i=(y,v)=>x[v],a=(y,v)=>b[v]}for(u=0,c=o.length;u<c;++u)l=o[u],d=o[u]=new Ki(l),(p=i(l,u,r))!=null&&(p+="")&&(g=d.id=p,m.set(g,m.has(g)?ik:d)),(p=a(l,u,r))!=null&&(p+="")&&(d.parent=p);for(u=0;u<c;++u)if(d=o[u],p=d.parent){if(f=m.get(p),!f)throw new Error("missing: "+p);if(f===ik)throw new Error("ambiguous: "+p);f.children?f.children.push(d):f.children=[d],d.parent=f}else{if(h)throw new Error("multiple roots");h=d}if(!h)throw new Error("no root");if(n!=null){for(;h.data===A0&&h.children.length===1;)h=h.children[0],--c;for(let x=o.length-1;x>=0&&(d=o[x],d.data===A0);--x)d.data=null}if(h.parent=Imt,h.eachBefore(function(x){x.depth=x.parent.depth+1,--c}).eachBefore(cD),h.parent=null,c>0)throw new Error("cycle");return h}return s.id=function(r){return arguments.length?(e=Wf(r),s):e},s.parentId=function(r){return arguments.length?(t=Wf(r),s):t},s.path=function(r){return arguments.length?(n=Wf(r),s):n},s}function Tmt(e){e=`${e}`;let t=e.length;return yx(e,t-1)&&!yx(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function ak(e){let t=e.length;if(t<2)return"";for(;--t>1&&!yx(e,t););return e.slice(0,t)}function yx(e,t){if(e[t]==="/"){let n=0;for(;t>0&&e[--t]==="\\";)++n;if((n&1)===0)return!0}return!1}function Emt(e,t){return e.parent===t.parent?1:2}function D0(e){var t=e.children;return t?t[0]:e.t}function M0(e){var t=e.children;return t?t[t.length-1]:e.t}function Rmt(e,t,n){var s=n/(t.i-e.i);t.c-=s,t.s+=n,e.c+=s,t.z+=n,t.m+=n}function Amt(e){for(var t=0,n=0,s=e.children,r=s.length,o;--r>=0;)o=s[r],o.z+=t,o.m+=t,t+=o.s+(n+=o.c)}function Dmt(e,t,n){return e.a.parent===t.parent?e.a:n}function Uf(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Uf.prototype=Object.create(Ki.prototype);function Mmt(e){for(var t=new Uf(e,0),n,s=[t],r,o,i,a;n=s.pop();)if(o=n._.children)for(n.children=new Array(a=o.length),i=a-1;i>=0;--i)s.push(r=n.children[i]=new Uf(o[i],i)),r.parent=n;return(t.parent=new Uf(null,0)).children=[t],t}function Fmt(){var e=Emt,t=1,n=1,s=null;function r(l){var u=Mmt(l);if(u.eachAfter(o),u.parent.m=-u.z,u.eachBefore(i),s)l.eachBefore(c);else{var h=l,f=l,d=l;l.eachBefore(function(b){b.x<h.x&&(h=b),b.x>f.x&&(f=b),b.depth>d.depth&&(d=b)});var p=h===f?1:e(h,f)/2,g=p-h.x,m=t/(f.x+p+g),x=n/(d.depth||1);l.eachBefore(function(b){b.x=(b.x+g)*m,b.y=b.depth*x})}return l}function o(l){var u=l.children,h=l.parent.children,f=l.i?h[l.i-1]:null;if(u){Amt(l);var d=(u[0].z+u[u.length-1].z)/2;f?(l.z=f.z+e(l._,f._),l.m=l.z-d):l.z=d}else f&&(l.z=f.z+e(l._,f._));l.parent.A=a(l,f,l.parent.A||h[0])}function i(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,u,h){if(u){for(var f=l,d=l,p=u,g=f.parent.children[0],m=f.m,x=d.m,b=p.m,w=g.m,y;p=M0(p),f=D0(f),p&&f;)g=D0(g),d=M0(d),d.a=l,y=p.z+b-f.z-m+e(p._,f._),y>0&&(Rmt(Dmt(p,l,h),l,y),m+=y,x+=y),b+=p.m,m+=f.m,w+=g.m,x+=d.m;p&&!M0(d)&&(d.t=p,d.m+=b-x),f&&!D0(g)&&(g.t=f,g.m+=m-w,h=l)}return h}function c(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(s=!1,t=+l[0],n=+l[1],r):s?null:[t,n]},r.nodeSize=function(l){return arguments.length?(s=!0,t=+l[0],n=+l[1],r):s?[t,n]:null},r}function hg(e,t,n,s,r){for(var o=e.children,i,a=-1,c=o.length,l=e.value&&(r-n)/e.value;++a<c;)i=o[a],i.x0=t,i.x1=s,i.y0=n,i.y1=n+=i.value*l}var mD=(1+Math.sqrt(5))/2;function gD(e,t,n,s,r,o){for(var i=[],a=t.children,c,l,u=0,h=0,f=a.length,d,p,g=t.value,m,x,b,w,y,v,$;u<f;){d=r-n,p=o-s;do m=a[h++].value;while(!m&&h<f);for(x=b=m,v=Math.max(p/d,d/p)/(g*e),$=m*m*v,y=Math.max(b/$,$/x);h<f;++h){if(m+=l=a[h].value,l<x&&(x=l),l>b&&(b=l),$=m*m*v,w=Math.max(b/$,$/x),w>y){m-=l;break}y=w}i.push(c={value:m,dice:d<p,children:a.slice(u,h)}),c.dice?Mh(c,n,s,r,g?s+=p*m/g:o):hg(c,n,s,g?n+=d*m/g:r,o),g-=m,u=h}return i}const xD=function e(t){function n(s,r,o,i,a){gD(t,s,r,o,i,a)}return n.ratio=function(s){return e((s=+s)>1?s:1)},n}(mD);function Omt(){var e=xD,t=!1,n=1,s=1,r=[0],o=di,i=di,a=di,c=di,l=di;function u(f){return f.x0=f.y0=0,f.x1=n,f.y1=s,f.eachBefore(h),r=[0],t&&f.eachBefore(pD),f}function h(f){var d=r[f.depth],p=f.x0+d,g=f.y0+d,m=f.x1-d,x=f.y1-d;m<p&&(p=m=(p+m)/2),x<g&&(g=x=(g+x)/2),f.x0=p,f.y0=g,f.x1=m,f.y1=x,f.children&&(d=r[f.depth+1]=o(f)/2,p+=l(f)-d,g+=i(f)-d,m-=a(f)-d,x-=c(f)-d,m<p&&(p=m=(p+m)/2),x<g&&(g=x=(g+x)/2),e(f,p,g,m,x))}return u.round=function(f){return arguments.length?(t=!!f,u):t},u.size=function(f){return arguments.length?(n=+f[0],s=+f[1],u):[n,s]},u.tile=function(f){return arguments.length?(e=lD(f),u):e},u.padding=function(f){return arguments.length?u.paddingInner(f).paddingOuter(f):u.paddingInner()},u.paddingInner=function(f){return arguments.length?(o=typeof f=="function"?f:Ta(+f),u):o},u.paddingOuter=function(f){return arguments.length?u.paddingTop(f).paddingRight(f).paddingBottom(f).paddingLeft(f):u.paddingTop()},u.paddingTop=function(f){return arguments.length?(i=typeof f=="function"?f:Ta(+f),u):i},u.paddingRight=function(f){return arguments.length?(a=typeof f=="function"?f:Ta(+f),u):a},u.paddingBottom=function(f){return arguments.length?(c=typeof f=="function"?f:Ta(+f),u):c},u.paddingLeft=function(f){return arguments.length?(l=typeof f=="function"?f:Ta(+f),u):l},u}function Lmt(e,t,n,s,r){var o=e.children,i,a=o.length,c,l=new Array(a+1);for(l[0]=c=i=0;i<a;++i)l[i+1]=c+=o[i].value;u(0,a,e.value,t,n,s,r);function u(h,f,d,p,g,m,x){if(h>=f-1){var b=o[h];b.x0=p,b.y0=g,b.x1=m,b.y1=x;return}for(var w=l[h],y=d/2+w,v=h+1,$=f-1;v<$;){var I=v+$>>>1;l[I]<y?v=I+1:$=I}y-l[v-1]<l[v]-y&&h+1<v&&--v;var N=l[v]-w,k=d-N;if(m-p>x-g){var S=d?(p*k+m*N)/d:m;u(h,v,N,p,g,S,x),u(v,f,k,S,g,m,x)}else{var C=d?(g*k+x*N)/d:x;u(h,v,N,p,g,m,C),u(v,f,k,p,C,m,x)}}}function Pmt(e,t,n,s,r){(e.depth&1?hg:Mh)(e,t,n,s,r)}const zmt=function e(t){function n(s,r,o,i,a){if((c=s._squarify)&&c.ratio===t)for(var c,l,u,h,f=-1,d,p=c.length,g=s.value;++f<p;){for(l=c[f],u=l.children,h=l.value=0,d=u.length;h<d;++h)l.value+=u[h].value;l.dice?Mh(l,r,o,i,g?o+=(a-o)*l.value/g:a):hg(l,r,o,g?r+=(i-r)*l.value/g:i,a),g-=l.value}else s._squarify=c=gD(t,s,r,o,i,a),c.ratio=t}return n.ratio=function(s){return e((s=+s)>1?s:1)},n}(mD);function Bmt(e){for(var t=-1,n=e.length,s,r=e[n-1],o=0;++t<n;)s=r,r=e[t],o+=s[1]*r[0]-s[0]*r[1];return o/2}function Vmt(e){for(var t=-1,n=e.length,s=0,r=0,o,i=e[n-1],a,c=0;++t<n;)o=i,i=e[t],c+=a=o[0]*i[1]-i[0]*o[1],s+=(o[0]+i[0])*a,r+=(o[1]+i[1])*a;return c*=3,[s/c,r/c]}function Wmt(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function Umt(e,t){return e[0]-t[0]||e[1]-t[1]}function ck(e){const t=e.length,n=[0,1];let s=2,r;for(r=2;r<t;++r){for(;s>1&&Wmt(e[n[s-2]],e[n[s-1]],e[r])<=0;)--s;n[s++]=r}return n.slice(0,s)}function Gmt(e){if((n=e.length)<3)return null;var t,n,s=new Array(n),r=new Array(n);for(t=0;t<n;++t)s[t]=[+e[t][0],+e[t][1],t];for(s.sort(Umt),t=0;t<n;++t)r[t]=[s[t][0],-s[t][1]];var o=ck(s),i=ck(r),a=i[0]===o[0],c=i[i.length-1]===o[o.length-1],l=[];for(t=o.length-1;t>=0;--t)l.push(e[s[o[t]][2]]);for(t=+a;t<i.length-c;++t)l.push(e[s[i[t]][2]]);return l}function Hmt(e,t){for(var n=e.length,s=e[n-1],r=t[0],o=t[1],i=s[0],a=s[1],c,l,u=!1,h=0;h<n;++h)s=e[h],c=s[0],l=s[1],l>o!=a>o&&r<(i-c)*(o-l)/(a-l)+c&&(u=!u),i=c,a=l;return u}function qmt(e){for(var t=-1,n=e.length,s=e[n-1],r,o,i=s[0],a=s[1],c=0;++t<n;)r=i,o=a,s=e[t],i=s[0],a=s[1],r-=i,o-=a,c+=Math.hypot(r,o);return c}const un=Math.random,Xmt=function e(t){function n(s,r){return s=s==null?0:+s,r=r==null?1:+r,arguments.length===1?(r=s,s=0):r-=s,function(){return t()*r+s}}return n.source=e,n}(un),jmt=function e(t){function n(s,r){return arguments.length<2&&(r=s,s=0),s=Math.floor(s),r=Math.floor(r)-s,function(){return Math.floor(t()*r+s)}}return n.source=e,n}(un),uv=function e(t){function n(s,r){var o,i;return s=s==null?0:+s,r=r==null?1:+r,function(){var a;if(o!=null)a=o,o=null;else do o=t()*2-1,a=t()*2-1,i=o*o+a*a;while(!i||i>1);return s+r*a*Math.sqrt(-2*Math.log(i)/i)}}return n.source=e,n}(un),Kmt=function e(t){var n=uv.source(t);function s(){var r=n.apply(this,arguments);return function(){return Math.exp(r())}}return s.source=e,s}(un),bD=function e(t){function n(s){return(s=+s)<=0?()=>0:function(){for(var r=0,o=s;o>1;--o)r+=t();return r+o*t()}}return n.source=e,n}(un),Ymt=function e(t){var n=bD.source(t);function s(r){if((r=+r)==0)return t;var o=n(r);return function(){return o()/r}}return s.source=e,s}(un),Zmt=function e(t){function n(s){return function(){return-Math.log1p(-t())/s}}return n.source=e,n}(un),Qmt=function e(t){function n(s){if((s=+s)<0)throw new RangeError("invalid alpha");return s=1/-s,function(){return Math.pow(1-t(),s)}}return n.source=e,n}(un),Jmt=function e(t){function n(s){if((s=+s)<0||s>1)throw new RangeError("invalid p");return function(){return Math.floor(t()+s)}}return n.source=e,n}(un),yD=function e(t){function n(s){if((s=+s)<0||s>1)throw new RangeError("invalid p");return s===0?()=>1/0:s===1?()=>1:(s=Math.log1p(-s),function(){return 1+Math.floor(Math.log1p(-t())/s)})}return n.source=e,n}(un),hv=function e(t){var n=uv.source(t)();function s(r,o){if((r=+r)<0)throw new RangeError("invalid k");if(r===0)return()=>0;if(o=o==null?1:+o,r===1)return()=>-Math.log1p(-t())*o;var i=(r<1?r+1:r)-1/3,a=1/(3*Math.sqrt(i)),c=r<1?()=>Math.pow(t(),1/r):()=>1;return function(){do{do var l=n(),u=1+a*l;while(u<=0);u*=u*u;var h=1-t()}while(h>=1-.0331*l*l*l*l&&Math.log(h)>=.5*l*l+i*(1-u+Math.log(u)));return i*u*c()*o}}return s.source=e,s}(un),wD=function e(t){var n=hv.source(t);function s(r,o){var i=n(r),a=n(o);return function(){var c=i();return c===0?0:c/(c+a())}}return s.source=e,s}(un),vD=function e(t){var n=yD.source(t),s=wD.source(t);function r(o,i){return o=+o,(i=+i)>=1?()=>o:i<=0?()=>0:function(){for(var a=0,c=o,l=i;c*l>16&&c*(1-l)>16;){var u=Math.floor((c+1)*l),h=s(u,c-u+1)();h<=l?(a+=u,c-=u,l=(l-h)/(1-h)):(c=u-1,l/=h)}for(var f=l<.5,d=f?l:1-l,p=n(d),g=p(),m=0;g<=c;++m)g+=p();return a+(f?m:c-m)}}return r.source=e,r}(un),tgt=function e(t){function n(s,r,o){var i;return(s=+s)==0?i=a=>-Math.log(a):(s=1/s,i=a=>Math.pow(a,s)),r=r==null?0:+r,o=o==null?1:+o,function(){return r+o*i(-Math.log1p(-t()))}}return n.source=e,n}(un),egt=function e(t){function n(s,r){return s=s==null?0:+s,r=r==null?1:+r,function(){return s+r*Math.tan(Math.PI*t())}}return n.source=e,n}(un),ngt=function e(t){function n(s,r){return s=s==null?0:+s,r=r==null?1:+r,function(){var o=t();return s+r*Math.log(o/(1-o))}}return n.source=e,n}(un),sgt=function e(t){var n=hv.source(t),s=vD.source(t);function r(o){return function(){for(var i=0,a=o;a>16;){var c=Math.floor(.875*a),l=n(c)();if(l>a)return i+s(c-1,a/l)();i+=c,a-=l}for(var u=-Math.log1p(-t()),h=0;u<=a;++h)u-=Math.log1p(-t());return i+h}}return r.source=e,r}(un),rgt=1664525,ogt=1013904223,lk=1/4294967296;function igt(e=Math.random()){let t=(0<=e&&e<1?e/lk:Math.abs(e))|0;return()=>(t=rgt*t+ogt|0,lk*(t>>>0))}function Vs(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function lo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const wx=Symbol("implicit");function fv(){var e=new Hl,t=[],n=[],s=wx;function r(o){let i=e.get(o);if(i===void 0){if(s!==wx)return s;e.set(o,i=t.push(o)-1)}return n[i%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new Hl;for(const i of o)e.has(i)||e.set(i,t.push(i)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(s=o,r):s},r.copy=function(){return fv(t,n).unknown(s)},Vs.apply(r,arguments),r}function dv(){var e=fv().unknown(void 0),t=e.domain,n=e.range,s=0,r=1,o,i,a=!1,c=0,l=0,u=.5;delete e.unknown;function h(){var f=t().length,d=r<s,p=d?r:s,g=d?s:r;o=(g-p)/Math.max(1,f-c+l*2),a&&(o=Math.floor(o)),p+=(g-p-o*(f-c))*u,i=o*(1-c),a&&(p=Math.round(p),i=Math.round(i));var m=Co(f).map(function(x){return p+o*x});return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),h()):t()},e.range=function(f){return arguments.length?([s,r]=f,s=+s,r=+r,h()):[s,r]},e.rangeRound=function(f){return[s,r]=f,s=+s,r=+r,a=!0,h()},e.bandwidth=function(){return i},e.step=function(){return o},e.round=function(f){return arguments.length?(a=!!f,h()):a},e.padding=function(f){return arguments.length?(c=Math.min(1,l=+f),h()):c},e.paddingInner=function(f){return arguments.length?(c=Math.min(1,f),h()):c},e.paddingOuter=function(f){return arguments.length?(l=+f,h()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),h()):u},e.copy=function(){return dv(t(),[s,r]).round(a).paddingInner(c).paddingOuter(l).align(u)},Vs.apply(h(),arguments)}function $D(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return $D(t())},e}function agt(){return $D(dv.apply(null,arguments).paddingInner(1))}function cgt(e){return function(){return e}}function sp(e){return+e}var uk=[0,1];function Ln(e){return e}function vx(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:cgt(isNaN(t)?NaN:.5)}function lgt(e,t){var n;return e>t&&(n=e,e=t,t=n),function(s){return Math.max(e,Math.min(t,s))}}function ugt(e,t,n){var s=e[0],r=e[1],o=t[0],i=t[1];return r<s?(s=vx(r,s),o=n(i,o)):(s=vx(s,r),o=n(o,i)),function(a){return o(s(a))}}function hgt(e,t,n){var s=Math.min(e.length,t.length)-1,r=new Array(s),o=new Array(s),i=-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<s;)r[i]=vx(e[i],e[i+1]),o[i]=n(t[i],t[i+1]);return function(a){var c=Lo(e,a,1,s)-1;return o[c](r[c](a))}}function Fh(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function fg(){var e=uk,t=uk,n=Jo,s,r,o,i=Ln,a,c,l;function u(){var f=Math.min(e.length,t.length);return i!==Ln&&(i=lgt(e[0],e[f-1])),a=f>2?hgt:ugt,c=l=null,h}function h(f){return f==null||isNaN(f=+f)?o:(c||(c=a(e.map(s),t,n)))(s(i(f)))}return h.invert=function(f){return i(r((l||(l=a(t,e.map(s),Ss)))(f)))},h.domain=function(f){return arguments.length?(e=Array.from(f,sp),u()):e.slice()},h.range=function(f){return arguments.length?(t=Array.from(f),u()):t.slice()},h.rangeRound=function(f){return t=Array.from(f),n=Jm,u()},h.clamp=function(f){return arguments.length?(i=f?!0:Ln,u()):i!==Ln},h.interpolate=function(f){return arguments.length?(n=f,u()):n},h.unknown=function(f){return arguments.length?(o=f,h):o},function(f,d){return s=f,r=d,u()}}function pv(){return fg()(Ln,Ln)}function CD(e,t,n,s){var r=vd(e,t,n),o;switch(s=hc(s??",f"),s.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return s.precision==null&&!isNaN(o=w3(r,i))&&(s.precision=o),Gw(s,i)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(o=v3(r,Math.max(Math.abs(e),Math.abs(t))))&&(s.precision=o-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(o=y3(r))&&(s.precision=o-(s.type==="%")*2);break}}return cg(s)}function ti(e){var t=e.domain;return e.ticks=function(n){var s=t();return Wi(s[0],s[s.length-1],n??10)},e.tickFormat=function(n,s){var r=t();return CD(r[0],r[r.length-1],n??10,s)},e.nice=function(n){n==null&&(n=10);var s=t(),r=0,o=s.length-1,i=s[r],a=s[o],c,l,u=10;for(a<i&&(l=i,i=a,a=l,l=r,r=o,o=l);u-- >0;){if(l=Ui(i,a,n),l===c)return s[r]=i,s[o]=a,t(s);if(l>0)i=Math.floor(i/l)*l,a=Math.ceil(a/l)*l;else if(l<0)i=Math.ceil(i*l)/l,a=Math.floor(a*l)/l;else break;c=l}return e},e}function mc(){var e=pv();return e.copy=function(){return Fh(e,mc())},Vs.apply(e,arguments),ti(e)}function kD(e){var t;function n(s){return s==null||isNaN(s=+s)?t:s}return n.invert=n,n.domain=n.range=function(s){return arguments.length?(e=Array.from(s,sp),n):e.slice()},n.unknown=function(s){return arguments.length?(t=s,n):t},n.copy=function(){return kD(e).unknown(t)},e=arguments.length?Array.from(e,sp):[0,1],ti(n)}function ID(e,t){e=e.slice();var n=0,s=e.length-1,r=e[n],o=e[s],i;return o<r&&(i=n,n=s,s=i,i=r,r=o,o=i),e[n]=t.floor(r),e[s]=t.ceil(o),e}function hk(e){return Math.log(e)}function fk(e){return Math.exp(e)}function fgt(e){return-Math.log(-e)}function dgt(e){return-Math.exp(-e)}function pgt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function mgt(e){return e===10?pgt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function ggt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function dk(e){return(t,n)=>-e(-t,n)}function mv(e){const t=e(hk,fk),n=t.domain;let s=10,r,o;function i(){return r=ggt(s),o=mgt(s),n()[0]<0?(r=dk(r),o=dk(o),e(fgt,dgt)):e(hk,fk),t}return t.base=function(a){return arguments.length?(s=+a,i()):s},t.domain=function(a){return arguments.length?(n(a),i()):n()},t.ticks=a=>{const c=n();let l=c[0],u=c[c.length-1];const h=u<l;h&&([l,u]=[u,l]);let f=r(l),d=r(u),p,g;const m=a==null?10:+a;let x=[];if(!(s%1)&&d-f<m){if(f=Math.floor(f),d=Math.ceil(d),l>0){for(;f<=d;++f)for(p=1;p<s;++p)if(g=f<0?p/o(-f):p*o(f),!(g<l)){if(g>u)break;x.push(g)}}else for(;f<=d;++f)for(p=s-1;p>=1;--p)if(g=f>0?p/o(-f):p*o(f),!(g<l)){if(g>u)break;x.push(g)}x.length*2<m&&(x=Wi(l,u,m))}else x=Wi(f,d,Math.min(d-f,m)).map(o);return h?x.reverse():x},t.tickFormat=(a,c)=>{if(a==null&&(a=10),c==null&&(c=s===10?"s":","),typeof c!="function"&&(!(s%1)&&(c=hc(c)).precision==null&&(c.trim=!0),c=cg(c)),a===1/0)return c;const l=Math.max(1,s*a/t.ticks().length);return u=>{let h=u/o(Math.round(r(u)));return h*s<s-.5&&(h*=s),h<=l?c(u):""}},t.nice=()=>n(ID(n(),{floor:a=>o(Math.floor(r(a))),ceil:a=>o(Math.ceil(r(a)))})),t}function SD(){const e=mv(fg()).domain([1,10]);return e.copy=()=>Fh(e,SD()).base(e.base()),Vs.apply(e,arguments),e}function pk(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function mk(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function gv(e){var t=1,n=e(pk(t),mk(t));return n.constant=function(s){return arguments.length?e(pk(t=+s),mk(t)):t},ti(n)}function ND(){var e=gv(fg());return e.copy=function(){return Fh(e,ND()).constant(e.constant())},Vs.apply(e,arguments)}function gk(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function xgt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function bgt(e){return e<0?-e*e:e*e}function xv(e){var t=e(Ln,Ln),n=1;function s(){return n===1?e(Ln,Ln):n===.5?e(xgt,bgt):e(gk(n),gk(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,s()):n},ti(t)}function bv(){var e=xv(fg());return e.copy=function(){return Fh(e,bv()).exponent(e.exponent())},Vs.apply(e,arguments),e}function ygt(){return bv.apply(null,arguments).exponent(.5)}function xk(e){return Math.sign(e)*e*e}function wgt(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function _D(){var e=pv(),t=[0,1],n=!1,s;function r(o){var i=wgt(e(o));return isNaN(i)?s:n?Math.round(i):i}return r.invert=function(o){return e.invert(xk(o))},r.domain=function(o){return arguments.length?(e.domain(o),r):e.domain()},r.range=function(o){return arguments.length?(e.range((t=Array.from(o,sp)).map(xk)),r):t.slice()},r.rangeRound=function(o){return r.range(o).round(!0)},r.round=function(o){return arguments.length?(n=!!o,r):n},r.clamp=function(o){return arguments.length?(e.clamp(o),r):e.clamp()},r.unknown=function(o){return arguments.length?(s=o,r):s},r.copy=function(){return _D(e.domain(),t).round(n).clamp(e.clamp()).unknown(s)},Vs.apply(r,arguments),ti(r)}function TD(){var e=[],t=[],n=[],s;function r(){var i=0,a=Math.max(1,t.length);for(n=new Array(a-1);++i<a;)n[i-1]=eA(e,i/a);return o}function o(i){return i==null||isNaN(i=+i)?s:t[Lo(n,i)]}return o.invertExtent=function(i){var a=t.indexOf(i);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},o.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let a of i)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(ye),r()},o.range=function(i){return arguments.length?(t=Array.from(i),r()):t.slice()},o.unknown=function(i){return arguments.length?(s=i,o):s},o.quantiles=function(){return n.slice()},o.copy=function(){return TD().domain(e).range(t).unknown(s)},Vs.apply(o,arguments)}function ED(){var e=0,t=1,n=1,s=[.5],r=[0,1],o;function i(c){return c!=null&&c<=c?r[Lo(s,c,0,n)]:o}function a(){var c=-1;for(s=new Array(n);++c<n;)s[c]=((c+1)*t-(c-n)*e)/(n+1);return i}return i.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,a()):[e,t]},i.range=function(c){return arguments.length?(n=(r=Array.from(c)).length-1,a()):r.slice()},i.invertExtent=function(c){var l=r.indexOf(c);return l<0?[NaN,NaN]:l<1?[e,s[0]]:l>=n?[s[n-1],t]:[s[l-1],s[l]]},i.unknown=function(c){return arguments.length&&(o=c),i},i.thresholds=function(){return s.slice()},i.copy=function(){return ED().domain([e,t]).range(r).unknown(o)},Vs.apply(ti(i),arguments)}function RD(){var e=[.5],t=[0,1],n,s=1;function r(o){return o!=null&&o<=o?t[Lo(e,o,0,s)]:n}return r.domain=function(o){return arguments.length?(e=Array.from(o),s=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(o){return arguments.length?(t=Array.from(o),s=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(o){var i=t.indexOf(o);return[e[i-1],e[i]]},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return RD().domain(e).range(t).unknown(n)},Vs.apply(r,arguments)}const F0=new Date,O0=new Date;function Pe(e,t,n,s){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=o=>(e(o=new Date(+o)),o),r.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),r.round=o=>{const i=r(o),a=r.ceil(o);return o-i<a-o?i:a},r.offset=(o,i)=>(t(o=new Date(+o),i==null?1:Math.floor(i)),o),r.range=(o,i,a)=>{const c=[];if(o=r.ceil(o),a=a==null?1:Math.floor(a),!(o<i)||!(a>0))return c;let l;do c.push(l=new Date(+o)),t(o,a),e(o);while(l<o&&o<i);return c},r.filter=o=>Pe(i=>{if(i>=i)for(;e(i),!o(i);)i.setTime(i-1)},(i,a)=>{if(i>=i)if(a<0)for(;++a<=0;)for(;t(i,-1),!o(i););else for(;--a>=0;)for(;t(i,1),!o(i););}),n&&(r.count=(o,i)=>(F0.setTime(+o),O0.setTime(+i),e(F0),e(O0),Math.floor(n(F0,O0))),r.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(s?i=>s(i)%o===0:i=>r.count(0,i)%o===0):r)),r}const gc=Pe(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);gc.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Pe(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):gc);const bk=gc.range,Hr=1e3,As=Hr*60,qr=As*60,no=qr*24,yv=no*7,yk=no*30,L0=no*365,Xr=Pe(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Hr)},(e,t)=>(t-e)/Hr,e=>e.getUTCSeconds()),wk=Xr.range,dg=Pe(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Hr)},(e,t)=>{e.setTime(+e+t*As)},(e,t)=>(t-e)/As,e=>e.getMinutes()),vgt=dg.range,pg=Pe(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*As)},(e,t)=>(t-e)/As,e=>e.getUTCMinutes()),$gt=pg.range,mg=Pe(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Hr-e.getMinutes()*As)},(e,t)=>{e.setTime(+e+t*qr)},(e,t)=>(t-e)/qr,e=>e.getHours()),Cgt=mg.range,gg=Pe(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*qr)},(e,t)=>(t-e)/qr,e=>e.getUTCHours()),kgt=gg.range,Uc=Pe(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*As)/no,e=>e.getDate()-1),Igt=Uc.range,Oh=Pe(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/no,e=>e.getUTCDate()-1),Sgt=Oh.range,wv=Pe(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/no,e=>Math.floor(e/no)),Ngt=wv.range;function fa(e){return Pe(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*As)/yv)}const xc=fa(0),ou=fa(1),AD=fa(2),DD=fa(3),Yi=fa(4),MD=fa(5),FD=fa(6),vk=xc.range,_gt=ou.range,Tgt=AD.range,Egt=DD.range,Rgt=Yi.range,Agt=MD.range,Dgt=FD.range;function da(e){return Pe(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/yv)}const bc=da(0),iu=da(1),OD=da(2),LD=da(3),Zi=da(4),PD=da(5),zD=da(6),$k=bc.range,Mgt=iu.range,Fgt=OD.range,Ogt=LD.range,Lgt=Zi.range,Pgt=PD.range,zgt=zD.range,xg=Pe(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),Bgt=xg.range,bg=Pe(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),Vgt=bg.range,Er=Pe(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Er.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Pe(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});const Wgt=Er.range,Rr=Pe(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Rr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Pe(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});const Ugt=Rr.range;function BD(e,t,n,s,r,o){const i=[[Xr,1,Hr],[Xr,5,5*Hr],[Xr,15,15*Hr],[Xr,30,30*Hr],[o,1,As],[o,5,5*As],[o,15,15*As],[o,30,30*As],[r,1,qr],[r,3,3*qr],[r,6,6*qr],[r,12,12*qr],[s,1,no],[s,2,2*no],[n,1,yv],[t,1,yk],[t,3,3*yk],[e,1,L0]];function a(l,u,h){const f=u<l;f&&([l,u]=[u,l]);const d=h&&typeof h.range=="function"?h:c(l,u,h),p=d?d.range(l,+u+1):[];return f?p.reverse():p}function c(l,u,h){const f=Math.abs(u-l)/h,d=Wm(([,,m])=>m).right(i,f);if(d===i.length)return e.every(vd(l/L0,u/L0,h));if(d===0)return gc.every(Math.max(vd(l,u,h),1));const[p,g]=i[f/i[d-1][2]<i[d][2]/f?d-1:d];return p.every(g)}return[a,c]}const[VD,WD]=BD(Rr,bg,bc,wv,gg,pg),[UD,GD]=BD(Er,xg,xc,Uc,mg,dg);function P0(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function z0(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function tl(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function HD(e){var t=e.dateTime,n=e.date,s=e.time,r=e.periods,o=e.days,i=e.shortDays,a=e.months,c=e.shortMonths,l=el(r),u=nl(r),h=el(o),f=nl(o),d=el(i),p=nl(i),g=el(a),m=nl(a),x=el(c),b=nl(c),w={a:M,A:O,b:L,B,c:null,d:_k,e:_k,f:f0t,g:$0t,G:k0t,H:l0t,I:u0t,j:h0t,L:qD,m:d0t,M:p0t,p:G,q,Q:Rk,s:Ak,S:m0t,u:g0t,U:x0t,V:b0t,w:y0t,W:w0t,x:null,X:null,y:v0t,Y:C0t,Z:I0t,"%":Ek},y={a:Y,A:tt,b:J,B:st,c:null,d:Tk,e:Tk,f:T0t,g:z0t,G:V0t,H:S0t,I:N0t,j:_0t,L:jD,m:E0t,M:R0t,p:rt,q:ft,Q:Rk,s:Ak,S:A0t,u:D0t,U:M0t,V:F0t,w:O0t,W:L0t,x:null,X:null,y:P0t,Y:B0t,Z:W0t,"%":Ek},v={a:S,A:C,b:A,B:R,c:_,d:Sk,e:Sk,f:o0t,g:Ik,G:kk,H:Nk,I:Nk,j:e0t,L:r0t,m:t0t,M:n0t,p:k,q:Jgt,Q:a0t,s:c0t,S:s0t,u:jgt,U:Kgt,V:Ygt,w:Xgt,W:Zgt,x:T,X:E,y:Ik,Y:kk,Z:Qgt,"%":i0t};w.x=$(n,w),w.X=$(s,w),w.c=$(t,w),y.x=$(n,y),y.X=$(s,y),y.c=$(t,y);function $(Z,ot){return function(at){var Q=[],It=-1,$t=0,Rt=Z.length,Tt,ut,_t;for(at instanceof Date||(at=new Date(+at));++It<Rt;)Z.charCodeAt(It)===37&&(Q.push(Z.slice($t,It)),(ut=Ck[Tt=Z.charAt(++It)])!=null?Tt=Z.charAt(++It):ut=Tt==="e"?" ":"0",(_t=ot[Tt])&&(Tt=_t(at,ut)),Q.push(Tt),$t=It+1);return Q.push(Z.slice($t,It)),Q.join("")}}function I(Z,ot){return function(at){var Q=tl(1900,void 0,1),It=N(Q,Z,at+="",0),$t,Rt;if(It!=at.length)return null;if("Q"in Q)return new Date(Q.Q);if("s"in Q)return new Date(Q.s*1e3+("L"in Q?Q.L:0));if(ot&&!("Z"in Q)&&(Q.Z=0),"p"in Q&&(Q.H=Q.H%12+Q.p*12),Q.m===void 0&&(Q.m="q"in Q?Q.q:0),"V"in Q){if(Q.V<1||Q.V>53)return null;"w"in Q||(Q.w=1),"Z"in Q?($t=z0(tl(Q.y,0,1)),Rt=$t.getUTCDay(),$t=Rt>4||Rt===0?iu.ceil($t):iu($t),$t=Oh.offset($t,(Q.V-1)*7),Q.y=$t.getUTCFullYear(),Q.m=$t.getUTCMonth(),Q.d=$t.getUTCDate()+(Q.w+6)%7):($t=P0(tl(Q.y,0,1)),Rt=$t.getDay(),$t=Rt>4||Rt===0?ou.ceil($t):ou($t),$t=Uc.offset($t,(Q.V-1)*7),Q.y=$t.getFullYear(),Q.m=$t.getMonth(),Q.d=$t.getDate()+(Q.w+6)%7)}else("W"in Q||"U"in Q)&&("w"in Q||(Q.w="u"in Q?Q.u%7:"W"in Q?1:0),Rt="Z"in Q?z0(tl(Q.y,0,1)).getUTCDay():P0(tl(Q.y,0,1)).getDay(),Q.m=0,Q.d="W"in Q?(Q.w+6)%7+Q.W*7-(Rt+5)%7:Q.w+Q.U*7-(Rt+6)%7);return"Z"in Q?(Q.H+=Q.Z/100|0,Q.M+=Q.Z%100,z0(Q)):P0(Q)}}function N(Z,ot,at,Q){for(var It=0,$t=ot.length,Rt=at.length,Tt,ut;It<$t;){if(Q>=Rt)return-1;if(Tt=ot.charCodeAt(It++),Tt===37){if(Tt=ot.charAt(It++),ut=v[Tt in Ck?ot.charAt(It++):Tt],!ut||(Q=ut(Z,at,Q))<0)return-1}else if(Tt!=at.charCodeAt(Q++))return-1}return Q}function k(Z,ot,at){var Q=l.exec(ot.slice(at));return Q?(Z.p=u.get(Q[0].toLowerCase()),at+Q[0].length):-1}function S(Z,ot,at){var Q=d.exec(ot.slice(at));return Q?(Z.w=p.get(Q[0].toLowerCase()),at+Q[0].length):-1}function C(Z,ot,at){var Q=h.exec(ot.slice(at));return Q?(Z.w=f.get(Q[0].toLowerCase()),at+Q[0].length):-1}function A(Z,ot,at){var Q=x.exec(ot.slice(at));return Q?(Z.m=b.get(Q[0].toLowerCase()),at+Q[0].length):-1}function R(Z,ot,at){var Q=g.exec(ot.slice(at));return Q?(Z.m=m.get(Q[0].toLowerCase()),at+Q[0].length):-1}function _(Z,ot,at){return N(Z,t,ot,at)}function T(Z,ot,at){return N(Z,n,ot,at)}function E(Z,ot,at){return N(Z,s,ot,at)}function M(Z){return i[Z.getDay()]}function O(Z){return o[Z.getDay()]}function L(Z){return c[Z.getMonth()]}function B(Z){return a[Z.getMonth()]}function G(Z){return r[+(Z.getHours()>=12)]}function q(Z){return 1+~~(Z.getMonth()/3)}function Y(Z){return i[Z.getUTCDay()]}function tt(Z){return o[Z.getUTCDay()]}function J(Z){return c[Z.getUTCMonth()]}function st(Z){return a[Z.getUTCMonth()]}function rt(Z){return r[+(Z.getUTCHours()>=12)]}function ft(Z){return 1+~~(Z.getUTCMonth()/3)}return{format:function(Z){var ot=$(Z+="",w);return ot.toString=function(){return Z},ot},parse:function(Z){var ot=I(Z+="",!1);return ot.toString=function(){return Z},ot},utcFormat:function(Z){var ot=$(Z+="",y);return ot.toString=function(){return Z},ot},utcParse:function(Z){var ot=I(Z+="",!0);return ot.toString=function(){return Z},ot}}}var Ck={"-":"",_:" ",0:"0"},nn=/^\s*\d+/,Ggt=/^%/,Hgt=/[\\^$*+?|[\]().{}]/g;function jt(e,t,n){var s=e<0?"-":"",r=(s?-e:e)+"",o=r.length;return s+(o<n?new Array(n-o+1).join(t)+r:r)}function qgt(e){return e.replace(Hgt,"\\$&")}function el(e){return new RegExp("^(?:"+e.map(qgt).join("|")+")","i")}function nl(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Xgt(e,t,n){var s=nn.exec(t.slice(n,n+1));return s?(e.w=+s[0],n+s[0].length):-1}function jgt(e,t,n){var s=nn.exec(t.slice(n,n+1));return s?(e.u=+s[0],n+s[0].length):-1}function Kgt(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.U=+s[0],n+s[0].length):-1}function Ygt(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.V=+s[0],n+s[0].length):-1}function Zgt(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.W=+s[0],n+s[0].length):-1}function kk(e,t,n){var s=nn.exec(t.slice(n,n+4));return s?(e.y=+s[0],n+s[0].length):-1}function Ik(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.y=+s[0]+(+s[0]>68?1900:2e3),n+s[0].length):-1}function Qgt(e,t,n){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return s?(e.Z=s[1]?0:-(s[2]+(s[3]||"00")),n+s[0].length):-1}function Jgt(e,t,n){var s=nn.exec(t.slice(n,n+1));return s?(e.q=s[0]*3-3,n+s[0].length):-1}function t0t(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.m=s[0]-1,n+s[0].length):-1}function Sk(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.d=+s[0],n+s[0].length):-1}function e0t(e,t,n){var s=nn.exec(t.slice(n,n+3));return s?(e.m=0,e.d=+s[0],n+s[0].length):-1}function Nk(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.H=+s[0],n+s[0].length):-1}function n0t(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.M=+s[0],n+s[0].length):-1}function s0t(e,t,n){var s=nn.exec(t.slice(n,n+2));return s?(e.S=+s[0],n+s[0].length):-1}function r0t(e,t,n){var s=nn.exec(t.slice(n,n+3));return s?(e.L=+s[0],n+s[0].length):-1}function o0t(e,t,n){var s=nn.exec(t.slice(n,n+6));return s?(e.L=Math.floor(s[0]/1e3),n+s[0].length):-1}function i0t(e,t,n){var s=Ggt.exec(t.slice(n,n+1));return s?n+s[0].length:-1}function a0t(e,t,n){var s=nn.exec(t.slice(n));return s?(e.Q=+s[0],n+s[0].length):-1}function c0t(e,t,n){var s=nn.exec(t.slice(n));return s?(e.s=+s[0],n+s[0].length):-1}function _k(e,t){return jt(e.getDate(),t,2)}function l0t(e,t){return jt(e.getHours(),t,2)}function u0t(e,t){return jt(e.getHours()%12||12,t,2)}function h0t(e,t){return jt(1+Uc.count(Er(e),e),t,3)}function qD(e,t){return jt(e.getMilliseconds(),t,3)}function f0t(e,t){return qD(e,t)+"000"}function d0t(e,t){return jt(e.getMonth()+1,t,2)}function p0t(e,t){return jt(e.getMinutes(),t,2)}function m0t(e,t){return jt(e.getSeconds(),t,2)}function g0t(e){var t=e.getDay();return t===0?7:t}function x0t(e,t){return jt(xc.count(Er(e)-1,e),t,2)}function XD(e){var t=e.getDay();return t>=4||t===0?Yi(e):Yi.ceil(e)}function b0t(e,t){return e=XD(e),jt(Yi.count(Er(e),e)+(Er(e).getDay()===4),t,2)}function y0t(e){return e.getDay()}function w0t(e,t){return jt(ou.count(Er(e)-1,e),t,2)}function v0t(e,t){return jt(e.getFullYear()%100,t,2)}function $0t(e,t){return e=XD(e),jt(e.getFullYear()%100,t,2)}function C0t(e,t){return jt(e.getFullYear()%1e4,t,4)}function k0t(e,t){var n=e.getDay();return e=n>=4||n===0?Yi(e):Yi.ceil(e),jt(e.getFullYear()%1e4,t,4)}function I0t(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+jt(t/60|0,"0",2)+jt(t%60,"0",2)}function Tk(e,t){return jt(e.getUTCDate(),t,2)}function S0t(e,t){return jt(e.getUTCHours(),t,2)}function N0t(e,t){return jt(e.getUTCHours()%12||12,t,2)}function _0t(e,t){return jt(1+Oh.count(Rr(e),e),t,3)}function jD(e,t){return jt(e.getUTCMilliseconds(),t,3)}function T0t(e,t){return jD(e,t)+"000"}function E0t(e,t){return jt(e.getUTCMonth()+1,t,2)}function R0t(e,t){return jt(e.getUTCMinutes(),t,2)}function A0t(e,t){return jt(e.getUTCSeconds(),t,2)}function D0t(e){var t=e.getUTCDay();return t===0?7:t}function M0t(e,t){return jt(bc.count(Rr(e)-1,e),t,2)}function KD(e){var t=e.getUTCDay();return t>=4||t===0?Zi(e):Zi.ceil(e)}function F0t(e,t){return e=KD(e),jt(Zi.count(Rr(e),e)+(Rr(e).getUTCDay()===4),t,2)}function O0t(e){return e.getUTCDay()}function L0t(e,t){return jt(iu.count(Rr(e)-1,e),t,2)}function P0t(e,t){return jt(e.getUTCFullYear()%100,t,2)}function z0t(e,t){return e=KD(e),jt(e.getUTCFullYear()%100,t,2)}function B0t(e,t){return jt(e.getUTCFullYear()%1e4,t,4)}function V0t(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Zi(e):Zi.ceil(e),jt(e.getUTCFullYear()%1e4,t,4)}function W0t(){return"+0000"}function Ek(){return"%"}function Rk(e){return+e}function Ak(e){return Math.floor(+e/1e3)}var Ia,vv,YD,yg,$v;ZD({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ZD(e){return Ia=HD(e),vv=Ia.format,YD=Ia.parse,yg=Ia.utcFormat,$v=Ia.utcParse,Ia}var QD="%Y-%m-%dT%H:%M:%S.%LZ";function U0t(e){return e.toISOString()}var G0t=Date.prototype.toISOString?U0t:yg(QD);function H0t(e){var t=new Date(e);return isNaN(t)?null:t}var q0t=+new Date("2000-01-01T00:00:00.000Z")?H0t:$v(QD);function X0t(e){return new Date(e)}function j0t(e){return e instanceof Date?+e:+new Date(+e)}function Cv(e,t,n,s,r,o,i,a,c,l){var u=pv(),h=u.invert,f=u.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),x=l("%a %d"),b=l("%b %d"),w=l("%B"),y=l("%Y");function v($){return(c($)<$?d:a($)<$?p:i($)<$?g:o($)<$?m:s($)<$?r($)<$?x:b:n($)<$?w:y)($)}return u.invert=function($){return new Date(h($))},u.domain=function($){return arguments.length?f(Array.from($,j0t)):f().map(X0t)},u.ticks=function($){var I=f();return e(I[0],I[I.length-1],$??10)},u.tickFormat=function($,I){return I==null?v:l(I)},u.nice=function($){var I=f();return(!$||typeof $.range!="function")&&($=t(I[0],I[I.length-1],$??10)),$?f(ID(I,$)):u},u.copy=function(){return Fh(u,Cv(e,t,n,s,r,o,i,a,c,l))},u}function K0t(){return Vs.apply(Cv(UD,GD,Er,xg,xc,Uc,mg,dg,Xr,vv).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Y0t(){return Vs.apply(Cv(VD,WD,Rr,bg,bc,Oh,gg,pg,Xr,yg).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function wg(){var e=0,t=1,n,s,r,o,i=Ln,a=!1,c;function l(h){return h==null||isNaN(h=+h)?c:i(r===0?.5:(h=(o(h)-n)*r,a?Math.max(0,Math.min(1,h)):h))}l.domain=function(h){return arguments.length?([e,t]=h,n=o(e=+e),s=o(t=+t),r=n===s?0:1/(s-n),l):[e,t]},l.clamp=function(h){return arguments.length?(a=!!h,l):a},l.interpolator=function(h){return arguments.length?(i=h,l):i};function u(h){return function(f){var d,p;return arguments.length?([d,p]=f,i=h(d,p),l):[i(0),i(1)]}}return l.range=u(Jo),l.rangeRound=u(Jm),l.unknown=function(h){return arguments.length?(c=h,l):c},function(h){return o=h,n=h(e),s=h(t),r=n===s?0:1/(s-n),l}}function ei(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function JD(){var e=ti(wg()(Ln));return e.copy=function(){return ei(e,JD())},lo.apply(e,arguments)}function tM(){var e=mv(wg()).domain([1,10]);return e.copy=function(){return ei(e,tM()).base(e.base())},lo.apply(e,arguments)}function eM(){var e=gv(wg());return e.copy=function(){return ei(e,eM()).constant(e.constant())},lo.apply(e,arguments)}function kv(){var e=xv(wg());return e.copy=function(){return ei(e,kv()).exponent(e.exponent())},lo.apply(e,arguments)}function Z0t(){return kv.apply(null,arguments).exponent(.5)}function nM(){var e=[],t=Ln;function n(s){if(s!=null&&!isNaN(s=+s))return t((Lo(e,s,1)-1)/(e.length-1))}return n.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let r of s)r!=null&&!isNaN(r=+r)&&e.push(r);return e.sort(ye),n},n.interpolator=function(s){return arguments.length?(t=s,n):t},n.range=function(){return e.map((s,r)=>t(r/(e.length-1)))},n.quantiles=function(s){return Array.from({length:s+1},(r,o)=>ql(e,o/s))},n.copy=function(){return nM(t).domain(e)},lo.apply(n,arguments)}function vg(){var e=0,t=.5,n=1,s=1,r,o,i,a,c,l=Ln,u,h=!1,f;function d(g){return isNaN(g=+g)?f:(g=.5+((g=+u(g))-o)*(s*g<s*o?a:c),l(h?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,r=u(e=+e),o=u(t=+t),i=u(n=+n),a=r===o?0:.5/(o-r),c=o===i?0:.5/(i-o),s=o<r?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(h=!!g,d):h},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var x,b,w;return arguments.length?([x,b,w]=m,l=jA(g,[x,b,w]),d):[l(0),l(.5),l(1)]}}return d.range=p(Jo),d.rangeRound=p(Jm),d.unknown=function(g){return arguments.length?(f=g,d):f},function(g){return u=g,r=g(e),o=g(t),i=g(n),a=r===o?0:.5/(o-r),c=o===i?0:.5/(i-o),s=o<r?-1:1,d}}function sM(){var e=ti(vg()(Ln));return e.copy=function(){return ei(e,sM())},lo.apply(e,arguments)}function rM(){var e=mv(vg()).domain([.1,1,10]);return e.copy=function(){return ei(e,rM()).base(e.base())},lo.apply(e,arguments)}function oM(){var e=gv(vg());return e.copy=function(){return ei(e,oM()).constant(e.constant())},lo.apply(e,arguments)}function Iv(){var e=xv(vg());return e.copy=function(){return ei(e,Iv()).exponent(e.exponent())},lo.apply(e,arguments)}function Q0t(){return Iv.apply(null,arguments).exponent(.5)}function Ft(e){for(var t=e.length/6|0,n=new Array(t),s=0;s<t;)n[s]="#"+e.slice(s*6,++s*6);return n}const J0t=Ft("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),t1t=Ft("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),e1t=Ft("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),n1t=Ft("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),s1t=Ft("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),r1t=Ft("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),o1t=Ft("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),i1t=Ft("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),a1t=Ft("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),c1t=Ft("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),l1t=Ft("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),ce=e=>FA(e[e.length-1]);var iM=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Ft);const u1t=ce(iM);var aM=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Ft);const h1t=ce(aM);var cM=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Ft);const f1t=ce(cM);var lM=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Ft);const d1t=ce(lM);var uM=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Ft);const p1t=ce(uM);var hM=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Ft);const m1t=ce(hM);var fM=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Ft);const g1t=ce(fM);var dM=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Ft);const x1t=ce(dM);var pM=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Ft);const b1t=ce(pM);var mM=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ft);const y1t=ce(mM);var gM=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ft);const w1t=ce(gM);var xM=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ft);const v1t=ce(xM);var bM=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ft);const $1t=ce(bM);var yM=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ft);const C1t=ce(yM);var wM=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ft);const k1t=ce(wM);var vM=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ft);const I1t=ce(vM);var $M=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ft);const S1t=ce($M);var CM=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ft);const N1t=ce(CM);var kM=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ft);const _1t=ce(kM);var IM=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ft);const T1t=ce(IM);var SM=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ft);const E1t=ce(SM);var NM=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ft);const R1t=ce(NM);var _M=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ft);const A1t=ce(_M);var TM=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ft);const D1t=ce(TM);var EM=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ft);const M1t=ce(EM);var RM=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ft);const F1t=ce(RM);var AM=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ft);const O1t=ce(AM);function L1t(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}const P1t=tg(rr(300,.5,0),rr(-240,.5,1));var z1t=tg(rr(-100,.75,.35),rr(80,1.5,.8)),B1t=tg(rr(260,.75,.35),rr(80,1.5,.8)),yf=rr();function V1t(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return yf.h=360*e-100,yf.s=1.5-1.5*t,yf.l=.8-.9*t,yf+""}var wf=ac(),W1t=Math.PI/3,U1t=Math.PI*2/3;function G1t(e){var t;return e=(.5-e)*Math.PI,wf.r=255*(t=Math.sin(e))*t,wf.g=255*(t=Math.sin(e+W1t))*t,wf.b=255*(t=Math.sin(e+U1t))*t,wf+""}function H1t(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function $g(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}const q1t=$g(Ft("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var X1t=$g(Ft("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),j1t=$g(Ft("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),K1t=$g(Ft("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function At(e){return function(){return e}}const Dk=Math.abs,pn=Math.atan2,zr=Math.cos,Y1t=Math.max,Ua=Math.min,Kn=Math.sin,ue=Math.sqrt,mn=1e-12,Vo=Math.PI,rp=Vo/2,Eo=2*Vo;function Z1t(e){return e>1?0:e<-1?Vo:Math.acos(e)}function Mk(e){return e>=1?rp:e<=-1?-rp:Math.asin(e)}function Lh(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const s=Math.floor(n);if(!(s>=0))throw new RangeError(`invalid digits: ${n}`);t=s}return e},()=>new _h(t)}function Q1t(e){return e.innerRadius}function J1t(e){return e.outerRadius}function txt(e){return e.startAngle}function ext(e){return e.endAngle}function nxt(e){return e&&e.padAngle}function sxt(e,t,n,s,r,o,i,a){var c=n-e,l=s-t,u=i-r,h=a-o,f=h*c-u*l;if(!(f*f<mn))return f=(u*(t-o)-h*(e-r))/f,[e+f*c,t+f*l]}function vf(e,t,n,s,r,o,i){var a=e-n,c=t-s,l=(i?o:-o)/ue(a*a+c*c),u=l*c,h=-l*a,f=e+u,d=t+h,p=n+u,g=s+h,m=(f+p)/2,x=(d+g)/2,b=p-f,w=g-d,y=b*b+w*w,v=r-o,$=f*g-p*d,I=(w<0?-1:1)*ue(Y1t(0,v*v*y-$*$)),N=($*w-b*I)/y,k=(-$*b-w*I)/y,S=($*w+b*I)/y,C=(-$*b+w*I)/y,A=N-m,R=k-x,_=S-m,T=C-x;return A*A+R*R>_*_+T*T&&(N=S,k=C),{cx:N,cy:k,x01:-u,y01:-h,x11:N*(r/v-1),y11:k*(r/v-1)}}function rxt(){var e=Q1t,t=J1t,n=At(0),s=null,r=txt,o=ext,i=nxt,a=null,c=Lh(l);function l(){var u,h,f=+e.apply(this,arguments),d=+t.apply(this,arguments),p=r.apply(this,arguments)-rp,g=o.apply(this,arguments)-rp,m=Dk(g-p),x=g>p;if(a||(a=u=c()),d<f&&(h=d,d=f,f=h),!(d>mn))a.moveTo(0,0);else if(m>Eo-mn)a.moveTo(d*zr(p),d*Kn(p)),a.arc(0,0,d,p,g,!x),f>mn&&(a.moveTo(f*zr(g),f*Kn(g)),a.arc(0,0,f,g,p,x));else{var b=p,w=g,y=p,v=g,$=m,I=m,N=i.apply(this,arguments)/2,k=N>mn&&(s?+s.apply(this,arguments):ue(f*f+d*d)),S=Ua(Dk(d-f)/2,+n.apply(this,arguments)),C=S,A=S,R,_;if(k>mn){var T=Mk(k/f*Kn(N)),E=Mk(k/d*Kn(N));($-=T*2)>mn?(T*=x?1:-1,y+=T,v-=T):($=0,y=v=(p+g)/2),(I-=E*2)>mn?(E*=x?1:-1,b+=E,w-=E):(I=0,b=w=(p+g)/2)}var M=d*zr(b),O=d*Kn(b),L=f*zr(v),B=f*Kn(v);if(S>mn){var G=d*zr(w),q=d*Kn(w),Y=f*zr(y),tt=f*Kn(y),J;if(m<Vo)if(J=sxt(M,O,Y,tt,G,q,L,B)){var st=M-J[0],rt=O-J[1],ft=G-J[0],Z=q-J[1],ot=1/Kn(Z1t((st*ft+rt*Z)/(ue(st*st+rt*rt)*ue(ft*ft+Z*Z)))/2),at=ue(J[0]*J[0]+J[1]*J[1]);C=Ua(S,(f-at)/(ot-1)),A=Ua(S,(d-at)/(ot+1))}else C=A=0}I>mn?A>mn?(R=vf(Y,tt,M,O,d,A,x),_=vf(G,q,L,B,d,A,x),a.moveTo(R.cx+R.x01,R.cy+R.y01),A<S?a.arc(R.cx,R.cy,A,pn(R.y01,R.x01),pn(_.y01,_.x01),!x):(a.arc(R.cx,R.cy,A,pn(R.y01,R.x01),pn(R.y11,R.x11),!x),a.arc(0,0,d,pn(R.cy+R.y11,R.cx+R.x11),pn(_.cy+_.y11,_.cx+_.x11),!x),a.arc(_.cx,_.cy,A,pn(_.y11,_.x11),pn(_.y01,_.x01),!x))):(a.moveTo(M,O),a.arc(0,0,d,b,w,!x)):a.moveTo(M,O),!(f>mn)||!($>mn)?a.lineTo(L,B):C>mn?(R=vf(L,B,G,q,f,-C,x),_=vf(M,O,Y,tt,f,-C,x),a.lineTo(R.cx+R.x01,R.cy+R.y01),C<S?a.arc(R.cx,R.cy,C,pn(R.y01,R.x01),pn(_.y01,_.x01),!x):(a.arc(R.cx,R.cy,C,pn(R.y01,R.x01),pn(R.y11,R.x11),!x),a.arc(0,0,f,pn(R.cy+R.y11,R.cx+R.x11),pn(_.cy+_.y11,_.cx+_.x11),x),a.arc(_.cx,_.cy,C,pn(_.y11,_.x11),pn(_.y01,_.x01),!x))):a.arc(0,0,f,v,y,x)}if(a.closePath(),u)return a=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,h=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Vo/2;return[zr(h)*u,Kn(h)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:At(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:At(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:At(+u),l):n},l.padRadius=function(u){return arguments.length?(s=u==null?null:typeof u=="function"?u:At(+u),l):s},l.startAngle=function(u){return arguments.length?(r=typeof u=="function"?u:At(+u),l):r},l.endAngle=function(u){return arguments.length?(o=typeof u=="function"?u:At(+u),l):o},l.padAngle=function(u){return arguments.length?(i=typeof u=="function"?u:At(+u),l):i},l.context=function(u){return arguments.length?(a=u??null,l):a},l}var oxt=Array.prototype.slice;function Cg(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function DM(e){this._context=e}DM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Ph(e){return new DM(e)}function Sv(e){return e[0]}function Nv(e){return e[1]}function kg(e,t){var n=At(!0),s=null,r=Ph,o=null,i=Lh(a);e=typeof e=="function"?e:e===void 0?Sv:At(e),t=typeof t=="function"?t:t===void 0?Nv:At(t);function a(c){var l,u=(c=Cg(c)).length,h,f=!1,d;for(s==null&&(o=r(d=i())),l=0;l<=u;++l)!(l<u&&n(h=c[l],l,c))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+e(h,l,c),+t(h,l,c));if(d)return o=null,d+""||null}return a.x=function(c){return arguments.length?(e=typeof c=="function"?c:At(+c),a):e},a.y=function(c){return arguments.length?(t=typeof c=="function"?c:At(+c),a):t},a.defined=function(c){return arguments.length?(n=typeof c=="function"?c:At(!!c),a):n},a.curve=function(c){return arguments.length?(r=c,s!=null&&(o=r(s)),a):r},a.context=function(c){return arguments.length?(c==null?s=o=null:o=r(s=c),a):s},a}function MM(e,t,n){var s=null,r=At(!0),o=null,i=Ph,a=null,c=Lh(l);e=typeof e=="function"?e:e===void 0?Sv:At(+e),t=typeof t=="function"?t:At(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?Nv:At(+n);function l(h){var f,d,p,g=(h=Cg(h)).length,m,x=!1,b,w=new Array(g),y=new Array(g);for(o==null&&(a=i(b=c())),f=0;f<=g;++f){if(!(f<g&&r(m=h[f],f,h))===x)if(x=!x)d=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=f-1;p>=d;--p)a.point(w[p],y[p]);a.lineEnd(),a.areaEnd()}x&&(w[f]=+e(m,f,h),y[f]=+t(m,f,h),a.point(s?+s(m,f,h):w[f],n?+n(m,f,h):y[f]))}if(b)return a=null,b+""||null}function u(){return kg().defined(r).curve(i).context(o)}return l.x=function(h){return arguments.length?(e=typeof h=="function"?h:At(+h),s=null,l):e},l.x0=function(h){return arguments.length?(e=typeof h=="function"?h:At(+h),l):e},l.x1=function(h){return arguments.length?(s=h==null?null:typeof h=="function"?h:At(+h),l):s},l.y=function(h){return arguments.length?(t=typeof h=="function"?h:At(+h),n=null,l):t},l.y0=function(h){return arguments.length?(t=typeof h=="function"?h:At(+h),l):t},l.y1=function(h){return arguments.length?(n=h==null?null:typeof h=="function"?h:At(+h),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(s).y(t)},l.defined=function(h){return arguments.length?(r=typeof h=="function"?h:At(!!h),l):r},l.curve=function(h){return arguments.length?(i=h,o!=null&&(a=i(o)),l):i},l.context=function(h){return arguments.length?(h==null?o=a=null:a=i(o=h),l):o},l}function ixt(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function axt(e){return e}function cxt(){var e=axt,t=ixt,n=null,s=At(0),r=At(Eo),o=At(0);function i(a){var c,l=(a=Cg(a)).length,u,h,f=0,d=new Array(l),p=new Array(l),g=+s.apply(this,arguments),m=Math.min(Eo,Math.max(-Eo,r.apply(this,arguments)-g)),x,b=Math.min(Math.abs(m)/l,o.apply(this,arguments)),w=b*(m<0?-1:1),y;for(c=0;c<l;++c)(y=p[d[c]=c]=+e(a[c],c,a))>0&&(f+=y);for(t!=null?d.sort(function(v,$){return t(p[v],p[$])}):n!=null&&d.sort(function(v,$){return n(a[v],a[$])}),c=0,h=f?(m-l*w)/f:0;c<l;++c,g=x)u=d[c],y=p[u],x=g+(y>0?y*h:0)+w,p[u]={data:a[u],index:c,value:y,startAngle:g,endAngle:x,padAngle:b};return p}return i.value=function(a){return arguments.length?(e=typeof a=="function"?a:At(+a),i):e},i.sortValues=function(a){return arguments.length?(t=a,n=null,i):t},i.sort=function(a){return arguments.length?(n=a,t=null,i):n},i.startAngle=function(a){return arguments.length?(s=typeof a=="function"?a:At(+a),i):s},i.endAngle=function(a){return arguments.length?(r=typeof a=="function"?a:At(+a),i):r},i.padAngle=function(a){return arguments.length?(o=typeof a=="function"?a:At(+a),i):o},i}var FM=_v(Ph);function OM(e){this._curve=e}OM.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(e,t){this._curve.point(t*Math.sin(e),t*-Math.cos(e))}};function _v(e){function t(n){return new OM(e(n))}return t._curve=e,t}function yl(e){var t=e.curve;return e.angle=e.x,delete e.x,e.radius=e.y,delete e.y,e.curve=function(n){return arguments.length?t(_v(n)):t()._curve},e}function Fk(){return yl(kg().curve(FM))}function Ok(){var e=MM().curve(FM),t=e.curve,n=e.lineX0,s=e.lineX1,r=e.lineY0,o=e.lineY1;return e.angle=e.x,delete e.x,e.startAngle=e.x0,delete e.x0,e.endAngle=e.x1,delete e.x1,e.radius=e.y,delete e.y,e.innerRadius=e.y0,delete e.y0,e.outerRadius=e.y1,delete e.y1,e.lineStartAngle=function(){return yl(n())},delete e.lineX0,e.lineEndAngle=function(){return yl(s())},delete e.lineX1,e.lineInnerRadius=function(){return yl(r())},delete e.lineY0,e.lineOuterRadius=function(){return yl(o())},delete e.lineY1,e.curve=function(i){return arguments.length?t(_v(i)):t()._curve},e}function wl(e,t){return[(t=+t)*Math.cos(e-=Math.PI/2),t*Math.sin(e)]}class LM{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}class lxt{constructor(t){this._context=t}lineStart(){this._point=0}lineEnd(){}point(t,n){if(t=+t,n=+n,this._point===0)this._point=1;else{const s=wl(this._x0,this._y0),r=wl(this._x0,this._y0=(this._y0+n)/2),o=wl(t,this._y0),i=wl(t,n);this._context.moveTo(...s),this._context.bezierCurveTo(...r,...o,...i)}this._x0=t,this._y0=n}}function PM(e){return new LM(e,!0)}function zM(e){return new LM(e,!1)}function uxt(e){return new lxt(e)}function hxt(e){return e.source}function fxt(e){return e.target}function Ig(e){let t=hxt,n=fxt,s=Sv,r=Nv,o=null,i=null,a=Lh(c);function c(){let l;const u=oxt.call(arguments),h=t.apply(this,u),f=n.apply(this,u);if(o==null&&(i=e(l=a())),i.lineStart(),u[0]=h,i.point(+s.apply(this,u),+r.apply(this,u)),u[0]=f,i.point(+s.apply(this,u),+r.apply(this,u)),i.lineEnd(),l)return i=null,l+""||null}return c.source=function(l){return arguments.length?(t=l,c):t},c.target=function(l){return arguments.length?(n=l,c):n},c.x=function(l){return arguments.length?(s=typeof l=="function"?l:At(+l),c):s},c.y=function(l){return arguments.length?(r=typeof l=="function"?l:At(+l),c):r},c.context=function(l){return arguments.length?(l==null?o=i=null:i=e(o=l),c):o},c}function dxt(){return Ig(PM)}function pxt(){return Ig(zM)}function mxt(){const e=Ig(uxt);return e.angle=e.x,delete e.x,e.radius=e.y,delete e.y,e}const gxt=ue(3),BM={draw(e,t){const n=ue(t+Ua(t/28,.75))*.59436,s=n/2,r=s*gxt;e.moveTo(0,n),e.lineTo(0,-n),e.moveTo(-r,-s),e.lineTo(r,s),e.moveTo(-r,s),e.lineTo(r,-s)}},Sg={draw(e,t){const n=ue(t/Vo);e.moveTo(n,0),e.arc(0,0,n,0,Eo)}},VM={draw(e,t){const n=ue(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},WM=ue(1/3),xxt=WM*2,UM={draw(e,t){const n=ue(t/xxt),s=n*WM;e.moveTo(0,-n),e.lineTo(s,0),e.lineTo(0,n),e.lineTo(-s,0),e.closePath()}},GM={draw(e,t){const n=ue(t)*.62625;e.moveTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.lineTo(-n,0),e.closePath()}},HM={draw(e,t){const n=ue(t-Ua(t/7,2))*.87559;e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,n),e.lineTo(0,-n)}},qM={draw(e,t){const n=ue(t),s=-n/2;e.rect(s,s,n,n)}},XM={draw(e,t){const n=ue(t)*.4431;e.moveTo(n,n),e.lineTo(n,-n),e.lineTo(-n,-n),e.lineTo(-n,n),e.closePath()}},bxt=.8908130915292852,jM=Kn(Vo/10)/Kn(7*Vo/10),yxt=Kn(Eo/10)*jM,wxt=-zr(Eo/10)*jM,KM={draw(e,t){const n=ue(t*bxt),s=yxt*n,r=wxt*n;e.moveTo(0,-n),e.lineTo(s,r);for(let o=1;o<5;++o){const i=Eo*o/5,a=zr(i),c=Kn(i);e.lineTo(c*n,-a*n),e.lineTo(a*s-c*r,c*s+a*r)}e.closePath()}},B0=ue(3),YM={draw(e,t){const n=-ue(t/(B0*3));e.moveTo(0,n*2),e.lineTo(-B0*n,-n),e.lineTo(B0*n,-n),e.closePath()}},vxt=ue(3),ZM={draw(e,t){const n=ue(t)*.6824,s=n/2,r=n*vxt/2;e.moveTo(0,-n),e.lineTo(r,s),e.lineTo(-r,s),e.closePath()}},vs=-.5,$s=ue(3)/2,$x=1/ue(12),$xt=($x/2+1)*3,QM={draw(e,t){const n=ue(t/$xt),s=n/2,r=n*$x,o=s,i=n*$x+n,a=-o,c=i;e.moveTo(s,r),e.lineTo(o,i),e.lineTo(a,c),e.lineTo(vs*s-$s*r,$s*s+vs*r),e.lineTo(vs*o-$s*i,$s*o+vs*i),e.lineTo(vs*a-$s*c,$s*a+vs*c),e.lineTo(vs*s+$s*r,vs*r-$s*s),e.lineTo(vs*o+$s*i,vs*i-$s*o),e.lineTo(vs*a+$s*c,vs*c-$s*a),e.closePath()}},Cx={draw(e,t){const n=ue(t-Ua(t/6,1.7))*.6189;e.moveTo(-n,-n),e.lineTo(n,n),e.moveTo(-n,n),e.lineTo(n,-n)}},Lk=[Sg,VM,UM,qM,KM,YM,QM],Cxt=[Sg,HM,Cx,ZM,BM,XM,GM];function kxt(e,t){let n=null,s=Lh(r);e=typeof e=="function"?e:At(e||Sg),t=typeof t=="function"?t:At(t===void 0?64:+t);function r(){let o;if(n||(n=o=s()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),o)return n=null,o+""||null}return r.type=function(o){return arguments.length?(e=typeof o=="function"?o:At(o),r):e},r.size=function(o){return arguments.length?(t=typeof o=="function"?o:At(+o),r):t},r.context=function(o){return arguments.length?(n=o??null,r):n},r}function Wo(){}function op(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ng(e){this._context=e}Ng.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:op(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:op(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Ixt(e){return new Ng(e)}function JM(e){this._context=e}JM.prototype={areaStart:Wo,areaEnd:Wo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:op(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Sxt(e){return new JM(e)}function tF(e){this._context=e}tF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,s):this._context.moveTo(n,s);break;case 3:this._point=4;default:op(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Nxt(e){return new tF(e)}function eF(e,t){this._basis=new Ng(e),this._beta=t}eF.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var s=e[0],r=t[0],o=e[n]-s,i=t[n]-r,a=-1,c;++a<=n;)c=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(s+c*o),this._beta*t[a]+(1-this._beta)*(r+c*i));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const _xt=function e(t){function n(s){return t===1?new Ng(s):new eF(s,t)}return n.beta=function(s){return e(+s)},n}(.85);function ip(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Tv(e,t){this._context=e,this._k=(1-t)/6}Tv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ip(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:ip(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Txt=function e(t){function n(s){return new Tv(s,t)}return n.tension=function(s){return e(+s)},n}(0);function Ev(e,t){this._context=e,this._k=(1-t)/6}Ev.prototype={areaStart:Wo,areaEnd:Wo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:ip(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ext=function e(t){function n(s){return new Ev(s,t)}return n.tension=function(s){return e(+s)},n}(0);function Rv(e,t){this._context=e,this._k=(1-t)/6}Rv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ip(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Rxt=function e(t){function n(s){return new Rv(s,t)}return n.tension=function(s){return e(+s)},n}(0);function Av(e,t,n){var s=e._x1,r=e._y1,o=e._x2,i=e._y2;if(e._l01_a>mn){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,c=3*e._l01_a*(e._l01_a+e._l12_a);s=(s*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/c,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/c}if(e._l23_a>mn){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,u=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*l+e._x1*e._l23_2a-t*e._l12_2a)/u,i=(i*l+e._y1*e._l23_2a-n*e._l12_2a)/u}e._context.bezierCurveTo(s,r,o,i,e._x2,e._y2)}function nF(e,t){this._context=e,this._alpha=t}nF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Av(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Axt=function e(t){function n(s){return t?new nF(s,t):new Tv(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function sF(e,t){this._context=e,this._alpha=t}sF.prototype={areaStart:Wo,areaEnd:Wo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Av(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Dxt=function e(t){function n(s){return t?new sF(s,t):new Ev(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function rF(e,t){this._context=e,this._alpha=t}rF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,s=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+s*s,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Av(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Mxt=function e(t){function n(s){return t?new rF(s,t):new Rv(s,0)}return n.alpha=function(s){return e(+s)},n}(.5);function oF(e){this._context=e}oF.prototype={areaStart:Wo,areaEnd:Wo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Fxt(e){return new oF(e)}function Pk(e){return e<0?-1:1}function zk(e,t,n){var s=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(s||r<0&&-0),i=(n-e._y1)/(r||s<0&&-0),a=(o*r+i*s)/(s+r);return(Pk(o)+Pk(i))*Math.min(Math.abs(o),Math.abs(i),.5*Math.abs(a))||0}function Bk(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function V0(e,t,n){var s=e._x0,r=e._y0,o=e._x1,i=e._y1,a=(o-s)/3;e._context.bezierCurveTo(s+a,r+a*t,o-a,i-a*n,o,i)}function ap(e){this._context=e}ap.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:V0(this,this._t0,Bk(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,V0(this,Bk(this,n=zk(this,e,t)),n);break;default:V0(this,this._t0,n=zk(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function iF(e){this._context=new aF(e)}(iF.prototype=Object.create(ap.prototype)).point=function(e,t){ap.prototype.point.call(this,t,e)};function aF(e){this._context=e}aF.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,s,r,o){this._context.bezierCurveTo(t,e,s,n,o,r)}};function Oxt(e){return new ap(e)}function Lxt(e){return new iF(e)}function cF(e){this._context=e}cF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var s=Vk(e),r=Vk(t),o=0,i=1;i<n;++o,++i)this._context.bezierCurveTo(s[0][o],r[0][o],s[1][o],r[1][o],e[i],t[i]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function Vk(e){var t,n=e.length-1,s,r=new Array(n),o=new Array(n),i=new Array(n);for(r[0]=0,o[0]=2,i[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,o[t]=4,i[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,o[n-1]=7,i[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)s=r[t]/o[t-1],o[t]-=s,i[t]-=s*i[t-1];for(r[n-1]=i[n-1]/o[n-1],t=n-2;t>=0;--t)r[t]=(i[t]-r[t+1])/o[t];for(o[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-r[t+1];return[r,o]}function Pxt(e){return new cF(e)}function _g(e,t){this._context=e,this._t=t}_g.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function zxt(e){return new _g(e,.5)}function Bxt(e){return new _g(e,0)}function Vxt(e){return new _g(e,1)}function yc(e,t){if((i=e.length)>1)for(var n=1,s,r,o=e[t[0]],i,a=o.length;n<i;++n)for(r=o,o=e[t[n]],s=0;s<a;++s)o[s][1]+=o[s][0]=isNaN(r[s][1])?r[s][0]:r[s][1]}function wc(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function Wxt(e,t){return e[t]}function Uxt(e){const t=[];return t.key=e,t}function Gxt(){var e=At([]),t=wc,n=yc,s=Wxt;function r(o){var i=Array.from(e.apply(this,arguments),Uxt),a,c=i.length,l=-1,u;for(const h of o)for(a=0,++l;a<c;++a)(i[a][l]=[0,+s(h,i[a].key,l,o)]).data=h;for(a=0,u=Cg(t(i));a<c;++a)i[u[a]].index=a;return n(i,u),i}return r.keys=function(o){return arguments.length?(e=typeof o=="function"?o:At(Array.from(o)),r):e},r.value=function(o){return arguments.length?(s=typeof o=="function"?o:At(+o),r):s},r.order=function(o){return arguments.length?(t=o==null?wc:typeof o=="function"?o:At(Array.from(o)),r):t},r.offset=function(o){return arguments.length?(n=o??yc,r):n},r}function Hxt(e,t){if((s=e.length)>0){for(var n,s,r=0,o=e[0].length,i;r<o;++r){for(i=n=0;n<s;++n)i+=e[n][r][1]||0;if(i)for(n=0;n<s;++n)e[n][r][1]/=i}yc(e,t)}}function qxt(e,t){if((c=e.length)>0)for(var n,s=0,r,o,i,a,c,l=e[t[0]].length;s<l;++s)for(i=a=0,n=0;n<c;++n)(o=(r=e[t[n]][s])[1]-r[0])>0?(r[0]=i,r[1]=i+=o):o<0?(r[1]=a,r[0]=a+=o):(r[0]=0,r[1]=o)}function Xxt(e,t){if((r=e.length)>0){for(var n=0,s=e[t[0]],r,o=s.length;n<o;++n){for(var i=0,a=0;i<r;++i)a+=e[i][n][1]||0;s[n][1]+=s[n][0]=-a/2}yc(e,t)}}function jxt(e,t){if(!(!((i=e.length)>0)||!((o=(r=e[t[0]]).length)>0))){for(var n=0,s=1,r,o,i;s<o;++s){for(var a=0,c=0,l=0;a<i;++a){for(var u=e[t[a]],h=u[s][1]||0,f=u[s-1][1]||0,d=(h-f)/2,p=0;p<a;++p){var g=e[t[p]],m=g[s][1]||0,x=g[s-1][1]||0;d+=m-x}c+=h,l+=d*h}r[s-1][1]+=r[s-1][0]=n,c&&(n-=l/c)}r[s-1][1]+=r[s-1][0]=n,yc(e,t)}}function lF(e){var t=e.map(Kxt);return wc(e).sort(function(n,s){return t[n]-t[s]})}function Kxt(e){for(var t=-1,n=0,s=e.length,r,o=-1/0;++t<s;)(r=+e[t][1])>o&&(o=r,n=t);return n}function uF(e){var t=e.map(hF);return wc(e).sort(function(n,s){return t[n]-t[s]})}function hF(e){for(var t=0,n=-1,s=e.length,r;++n<s;)(r=+e[n][1])&&(t+=r);return t}function Yxt(e){return uF(e).reverse()}function Zxt(e){var t=e.length,n,s,r=e.map(hF),o=lF(e),i=0,a=0,c=[],l=[];for(n=0;n<t;++n)s=o[n],i<a?(i+=r[s],c.push(s)):(a+=r[s],l.push(s));return l.reverse().concat(c)}function Qxt(e){return wc(e).reverse()}const $f=e=>()=>e;function Jxt(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function br(e,t,n){this.k=e,this.x=t,this.y=n}br.prototype={constructor:br,scale:function(e){return e===1?this:new br(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new br(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Tg=new br(1,0,0);fF.prototype=br.prototype;function fF(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Tg;return e.__zoom}function W0(e){e.stopImmediatePropagation()}function sl(e){e.preventDefault(),e.stopImmediatePropagation()}function tbt(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function ebt(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Wk(){return this.__zoom||Tg}function nbt(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function sbt(){return navigator.maxTouchPoints||"ontouchstart"in this}function rbt(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],i=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i))}function obt(){var e=tbt,t=ebt,n=rbt,s=nbt,r=sbt,o=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],a=250,c=GA,l=ca("start","zoom","end"),u,h,f,d=500,p=150,g=0,m=10;function x(_){_.property("__zoom",Wk).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",S).filter(r).on("touchstart.zoom",C).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(_,T,E,M){var O=_.selection?_.selection():_;O.property("__zoom",Wk),_!==O?v(_,T,E,M):O.interrupt().each(function(){$(this,arguments).event(M).start().zoom(null,typeof T=="function"?T.apply(this,arguments):T).end()})},x.scaleBy=function(_,T,E,M){x.scaleTo(_,function(){var O=this.__zoom.k,L=typeof T=="function"?T.apply(this,arguments):T;return O*L},E,M)},x.scaleTo=function(_,T,E,M){x.transform(_,function(){var O=t.apply(this,arguments),L=this.__zoom,B=E==null?y(O):typeof E=="function"?E.apply(this,arguments):E,G=L.invert(B),q=typeof T=="function"?T.apply(this,arguments):T;return n(w(b(L,q),B,G),O,i)},E,M)},x.translateBy=function(_,T,E,M){x.transform(_,function(){return n(this.__zoom.translate(typeof T=="function"?T.apply(this,arguments):T,typeof E=="function"?E.apply(this,arguments):E),t.apply(this,arguments),i)},null,M)},x.translateTo=function(_,T,E,M,O){x.transform(_,function(){var L=t.apply(this,arguments),B=this.__zoom,G=M==null?y(L):typeof M=="function"?M.apply(this,arguments):M;return n(Tg.translate(G[0],G[1]).scale(B.k).translate(typeof T=="function"?-T.apply(this,arguments):-T,typeof E=="function"?-E.apply(this,arguments):-E),L,i)},M,O)};function b(_,T){return T=Math.max(o[0],Math.min(o[1],T)),T===_.k?_:new br(T,_.x,_.y)}function w(_,T,E){var M=T[0]-E[0]*_.k,O=T[1]-E[1]*_.k;return M===_.x&&O===_.y?_:new br(_.k,M,O)}function y(_){return[(+_[0][0]+ +_[1][0])/2,(+_[0][1]+ +_[1][1])/2]}function v(_,T,E,M){_.on("start.zoom",function(){$(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){$(this,arguments).event(M).end()}).tween("zoom",function(){var O=this,L=arguments,B=$(O,L).event(M),G=t.apply(O,L),q=E==null?y(G):typeof E=="function"?E.apply(O,L):E,Y=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),tt=O.__zoom,J=typeof T=="function"?T.apply(O,L):T,st=c(tt.invert(q).concat(Y/tt.k),J.invert(q).concat(Y/J.k));return function(rt){if(rt===1)rt=J;else{var ft=st(rt),Z=Y/ft[2];rt=new br(Z,q[0]-ft[0]*Z,q[1]-ft[1]*Z)}B.zoom(null,rt)}})}function $(_,T,E){return!E&&_.__zooming||new I(_,T)}function I(_,T){this.that=_,this.args=T,this.active=0,this.sourceEvent=null,this.extent=t.apply(_,T),this.taps=0}I.prototype={event:function(_){return _&&(this.sourceEvent=_),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(_,T){return this.mouse&&_!=="mouse"&&(this.mouse[1]=T.invert(this.mouse[0])),this.touch0&&_!=="touch"&&(this.touch0[1]=T.invert(this.touch0[0])),this.touch1&&_!=="touch"&&(this.touch1[1]=T.invert(this.touch1[0])),this.that.__zoom=T,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(_){var T=Jt(this.that).datum();l.call(_,this.that,new Jxt(_,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:l}),T)}};function N(_,...T){if(!e.apply(this,arguments))return;var E=$(this,T).event(_),M=this.__zoom,O=Math.max(o[0],Math.min(o[1],M.k*Math.pow(2,s.apply(this,arguments)))),L=Yn(_);if(E.wheel)(E.mouse[0][0]!==L[0]||E.mouse[0][1]!==L[1])&&(E.mouse[1]=M.invert(E.mouse[0]=L)),clearTimeout(E.wheel);else{if(M.k===O)return;E.mouse=[L,M.invert(L)],Ci(this),E.start()}sl(_),E.wheel=setTimeout(B,p),E.zoom("mouse",n(w(b(M,O),E.mouse[0],E.mouse[1]),E.extent,i));function B(){E.wheel=null,E.end()}}function k(_,...T){if(f||!e.apply(this,arguments))return;var E=_.currentTarget,M=$(this,T,!0).event(_),O=Jt(_.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",Y,!0),L=Yn(_,E),B=_.clientX,G=_.clientY;jm(_.view),W0(_),M.mouse=[L,this.__zoom.invert(L)],Ci(this),M.start();function q(tt){if(sl(tt),!M.moved){var J=tt.clientX-B,st=tt.clientY-G;M.moved=J*J+st*st>g}M.event(tt).zoom("mouse",n(w(M.that.__zoom,M.mouse[0]=Yn(tt,E),M.mouse[1]),M.extent,i))}function Y(tt){O.on("mousemove.zoom mouseup.zoom",null),Km(tt.view,M.moved),sl(tt),M.event(tt).end()}}function S(_,...T){if(e.apply(this,arguments)){var E=this.__zoom,M=Yn(_.changedTouches?_.changedTouches[0]:_,this),O=E.invert(M),L=E.k*(_.shiftKey?.5:2),B=n(w(b(E,L),M,O),t.apply(this,T),i);sl(_),a>0?Jt(this).transition().duration(a).call(v,B,M,_):Jt(this).call(x.transform,B,M,_)}}function C(_,...T){if(e.apply(this,arguments)){var E=_.touches,M=E.length,O=$(this,T,_.changedTouches.length===M).event(_),L,B,G,q;for(W0(_),B=0;B<M;++B)G=E[B],q=Yn(G,this),q=[q,this.__zoom.invert(q),G.identifier],O.touch0?!O.touch1&&O.touch0[2]!==q[2]&&(O.touch1=q,O.taps=0):(O.touch0=q,L=!0,O.taps=1+!!u);u&&(u=clearTimeout(u)),L&&(O.taps<2&&(h=q[0],u=setTimeout(function(){u=null},d)),Ci(this),O.start())}}function A(_,...T){if(this.__zooming){var E=$(this,T).event(_),M=_.changedTouches,O=M.length,L,B,G,q;for(sl(_),L=0;L<O;++L)B=M[L],G=Yn(B,this),E.touch0&&E.touch0[2]===B.identifier?E.touch0[0]=G:E.touch1&&E.touch1[2]===B.identifier&&(E.touch1[0]=G);if(B=E.that.__zoom,E.touch1){var Y=E.touch0[0],tt=E.touch0[1],J=E.touch1[0],st=E.touch1[1],rt=(rt=J[0]-Y[0])*rt+(rt=J[1]-Y[1])*rt,ft=(ft=st[0]-tt[0])*ft+(ft=st[1]-tt[1])*ft;B=b(B,Math.sqrt(rt/ft)),G=[(Y[0]+J[0])/2,(Y[1]+J[1])/2],q=[(tt[0]+st[0])/2,(tt[1]+st[1])/2]}else if(E.touch0)G=E.touch0[0],q=E.touch0[1];else return;E.zoom("touch",n(w(B,G,q),E.extent,i))}}function R(_,...T){if(this.__zooming){var E=$(this,T).event(_),M=_.changedTouches,O=M.length,L,B;for(W0(_),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),L=0;L<O;++L)B=M[L],E.touch0&&E.touch0[2]===B.identifier?delete E.touch0:E.touch1&&E.touch1[2]===B.identifier&&delete E.touch1;if(E.touch1&&!E.touch0&&(E.touch0=E.touch1,delete E.touch1),E.touch0)E.touch0[1]=this.__zoom.invert(E.touch0[0]);else if(E.end(),E.taps===2&&(B=Yn(B,this),Math.hypot(h[0]-B[0],h[1]-B[1])<m)){var G=Jt(this).on("dblclick.zoom");G&&G.apply(this,arguments)}}}return x.wheelDelta=function(_){return arguments.length?(s=typeof _=="function"?_:$f(+_),x):s},x.filter=function(_){return arguments.length?(e=typeof _=="function"?_:$f(!!_),x):e},x.touchable=function(_){return arguments.length?(r=typeof _=="function"?_:$f(!!_),x):r},x.extent=function(_){return arguments.length?(t=typeof _=="function"?_:$f([[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]]),x):t},x.scaleExtent=function(_){return arguments.length?(o[0]=+_[0],o[1]=+_[1],x):[o[0],o[1]]},x.translateExtent=function(_){return arguments.length?(i[0][0]=+_[0][0],i[1][0]=+_[1][0],i[0][1]=+_[0][1],i[1][1]=+_[1][1],x):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},x.constrain=function(_){return arguments.length?(n=_,x):n},x.duration=function(_){return arguments.length?(a=+_,x):a},x.interpolate=function(_){return arguments.length?(c=_,x):c},x.on=function(){var _=l.on.apply(l,arguments);return _===l?x:_},x.clickDistance=function(_){return arguments.length?(g=(_=+_)*_,x):Math.sqrt(g)},x.tapDistance=function(_){return arguments.length?(m=+_,x):m},x}const ibt=Object.freeze(Object.defineProperty({__proto__:null,Adder:Ge,Delaunay:Vw,FormatSpecifier:ag,InternMap:Hl,InternSet:Vi,Node:Ki,Path:_h,Voronoi:u3,ZoomTransform:br,active:sht,arc:rxt,area:MM,areaRadial:Ok,ascending:ye,autoType:Sft,axisBottom:jit,axisLeft:Kit,axisRight:Xit,axisTop:qit,bin:N$,bisect:Lo,bisectCenter:Uot,bisectLeft:Wot,bisectRight:Lo,bisector:Wm,blob:Tft,blur:Got,blur2:BR,blurImage:Hot,brush:ght,brushSelection:dht,brushX:pht,brushY:mht,buffer:Rft,chord:bht,chordDirected:wht,chordTranspose:yht,cluster:Xpt,color:zo,contourDensity:l3,contours:X1,count:Um,create:Ect,creator:qm,cross:Qot,csv:Mft,csvFormat:mft,csvFormatBody:gft,csvFormatRow:bft,csvFormatRows:xft,csvFormatValue:yft,csvParse:f3,csvParseRows:pft,cubehelix:rr,cumsum:Jot,curveBasis:Ixt,curveBasisClosed:Sxt,curveBasisOpen:Nxt,curveBumpX:PM,curveBumpY:zM,curveBundle:_xt,curveCardinal:Txt,curveCardinalClosed:Ext,curveCardinalOpen:Rxt,curveCatmullRom:Axt,curveCatmullRomClosed:Dxt,curveCatmullRomOpen:Mxt,curveLinear:Ph,curveLinearClosed:Fxt,curveMonotoneX:Oxt,curveMonotoneY:Lxt,curveNatural:Pxt,curveStep:zxt,curveStepAfter:Vxt,curveStepBefore:Bxt,descending:PR,deviation:UR,difference:Mit,disjoint:Fit,dispatch:ca,drag:xA,dragDisable:jm,dragEnable:Km,dsv:Dft,dsvFormat:rg,easeBack:Z$,easeBackIn:Kut,easeBackInOut:Z$,easeBackOut:Yut,easeBounce:Jl,easeBounceIn:Xut,easeBounceInOut:jut,easeBounceOut:Jl,easeCircle:Y$,easeCircleIn:Lut,easeCircleInOut:Y$,easeCircleOut:Put,easeCubic:W1,easeCubicIn:Tut,easeCubicInOut:W1,easeCubicOut:Eut,easeElastic:Q$,easeElasticIn:Zut,easeElasticInOut:Qut,easeElasticOut:Q$,easeExp:K$,easeExpIn:Fut,easeExpInOut:K$,easeExpOut:Out,easeLinear:Sut,easePoly:X$,easePolyIn:Rut,easePolyInOut:X$,easePolyOut:Aut,easeQuad:q$,easeQuadIn:Nut,easeQuadInOut:q$,easeQuadOut:_ut,easeSin:j$,easeSinIn:Dut,easeSinInOut:j$,easeSinOut:Mut,every:_it,extent:Il,fcumsum:eit,filter:Eit,flatGroup:nit,flatRollup:sit,forceCenter:Wft,forceCollide:adt,forceLink:ldt,forceManyBody:bdt,forceRadial:ydt,forceSimulation:xdt,forceX:wdt,forceY:vdt,get format(){return cg},formatDefaultLocale:b3,formatLocale:x3,get formatPrefix(){return Gw},formatSpecifier:hc,fsum:tit,geoAlbers:sD,geoAlbersUsa:Ipt,geoArea:Rdt,geoAzimuthalEqualArea:Spt,geoAzimuthalEqualAreaRaw:tv,geoAzimuthalEquidistant:Npt,geoAzimuthalEquidistantRaw:ev,geoBounds:Fdt,geoCentroid:Vdt,geoCircle:Wdt,geoClipAntimeridian:ix,geoClipCircle:B3,geoClipExtent:Kdt,geoClipRectangle:lg,geoConicConformal:Tpt,geoConicConformalRaw:iD,geoConicEqualArea:ep,geoConicEqualAreaRaw:nD,geoConicEquidistant:Rpt,geoConicEquidistantRaw:aD,geoContains:npt,geoDistance:Xd,geoEqualEarth:Dpt,geoEqualEarthRaw:nv,geoEquirectangular:Ept,geoEquirectangularRaw:ru,geoGnomonic:Mpt,geoGnomonicRaw:sv,geoGraticule:U3,geoGraticule10:spt,geoIdentity:Fpt,geoInterpolate:rpt,geoLength:V3,geoMercator:_pt,geoMercatorRaw:Dh,geoNaturalEarth1:Opt,geoNaturalEarth1Raw:rv,geoOrthographic:Lpt,geoOrthographicRaw:ov,geoPath:eD,geoProjection:Mr,geoProjectionMutator:Qw,geoRotation:M3,geoStereographic:Ppt,geoStereographicRaw:iv,geoStream:js,geoTransform:gpt,geoTransverseMercator:zpt,geoTransverseMercatorRaw:av,gray:Yct,greatest:tA,greatestIndex:$it,group:XR,groupSort:iit,groups:jR,hcl:Nd,hierarchy:cv,histogram:N$,hsl:kd,html:Bft,image:Oft,index:rit,indexes:oit,interpolate:Jo,interpolateArray:nlt,interpolateBasis:RA,interpolateBasisClosed:AA,interpolateBlues:R1t,interpolateBrBG:u1t,interpolateBuGn:y1t,interpolateBuPu:w1t,interpolateCividis:L1t,interpolateCool:B1t,interpolateCubehelix:xlt,interpolateCubehelixDefault:P1t,interpolateCubehelixLong:tg,interpolateDate:PA,interpolateDiscrete:olt,interpolateGnBu:v1t,interpolateGreens:A1t,interpolateGreys:D1t,interpolateHcl:mlt,interpolateHclLong:glt,interpolateHsl:flt,interpolateHslLong:dlt,interpolateHue:ilt,interpolateInferno:j1t,interpolateLab:plt,interpolateMagma:X1t,interpolateNumber:Ss,interpolateNumberArray:Ew,interpolateObject:zA,interpolateOrRd:$1t,interpolateOranges:O1t,interpolatePRGn:h1t,interpolatePiYG:f1t,interpolatePlasma:K1t,interpolatePuBu:k1t,interpolatePuBuGn:C1t,interpolatePuOr:d1t,interpolatePuRd:I1t,interpolatePurples:M1t,interpolateRainbow:V1t,interpolateRdBu:p1t,interpolateRdGy:m1t,interpolateRdPu:S1t,interpolateRdYlBu:g1t,interpolateRdYlGn:x1t,interpolateReds:F1t,interpolateRgb:Yl,interpolateRgbBasis:FA,interpolateRgbBasisClosed:elt,interpolateRound:Jm,interpolateSinebow:G1t,interpolateSpectral:b1t,interpolateString:Rw,interpolateTransformCss:WA,interpolateTransformSvg:UA,interpolateTurbo:H1t,interpolateViridis:q1t,interpolateWarm:z1t,interpolateYlGn:_1t,interpolateYlGnBu:N1t,interpolateYlOrBr:T1t,interpolateYlOrRd:E1t,interpolateZoom:GA,interrupt:Ci,intersection:Oit,interval:$lt,isoFormat:G0t,isoParse:q0t,json:Pft,lab:Sd,lch:Zct,least:vit,leastIndex:sA,line:kg,lineRadial:Fk,link:Ig,linkHorizontal:dxt,linkRadial:mxt,linkVertical:pxt,local:mA,map:Rit,matcher:Cw,max:to,maxIndex:yw,mean:T1,median:pit,medianIndex:mit,merge:vw,min:Po,minIndex:ww,mode:xit,namespace:Ih,namespaces:A1,nice:xw,now:Nh,pack:Cmt,packEnclose:xmt,packSiblings:vmt,pairs:bit,partition:kmt,path:Bw,pathRound:Cht,permute:JR,pie:cxt,piecewise:jA,pointRadial:wl,pointer:Yn,pointers:Act,polygonArea:Bmt,polygonCentroid:Vmt,polygonContains:Hmt,polygonHull:Gmt,polygonLength:qmt,precisionFixed:y3,precisionPrefix:w3,precisionRound:v3,quadtree:ig,quantile:ql,quantileIndex:nA,quantileSorted:eA,quantize:blt,quickselect:Gm,radialArea:Ok,radialLine:Fk,randomBates:Ymt,randomBernoulli:Jmt,randomBeta:wD,randomBinomial:vD,randomCauchy:egt,randomExponential:Zmt,randomGamma:hv,randomGeometric:yD,randomInt:jmt,randomIrwinHall:bD,randomLcg:igt,randomLogNormal:Kmt,randomLogistic:ngt,randomNormal:uv,randomPareto:Qmt,randomPoisson:sgt,randomUniform:Xmt,randomWeibull:tgt,range:Co,rank:wit,reduce:Ait,reverse:Dit,rgb:ac,ribbon:Rht,ribbonArrow:Aht,rollup:YR,rollups:ZR,scaleBand:dv,scaleDiverging:sM,scaleDivergingLog:rM,scaleDivergingPow:Iv,scaleDivergingSqrt:Q0t,scaleDivergingSymlog:oM,scaleIdentity:kD,scaleImplicit:wx,scaleLinear:mc,scaleLog:SD,scaleOrdinal:fv,scalePoint:agt,scalePow:bv,scaleQuantile:TD,scaleQuantize:ED,scaleRadial:_D,scaleSequential:JD,scaleSequentialLog:tM,scaleSequentialPow:kv,scaleSequentialQuantile:nM,scaleSequentialSqrt:Z0t,scaleSequentialSymlog:eM,scaleSqrt:ygt,scaleSymlog:ND,scaleThreshold:RD,scaleTime:K0t,scaleUtc:Y0t,scan:Cit,schemeAccent:t1t,schemeBlues:NM,schemeBrBG:iM,schemeBuGn:mM,schemeBuPu:gM,schemeCategory10:J0t,schemeDark2:e1t,schemeGnBu:xM,schemeGreens:_M,schemeGreys:TM,schemeObservable10:n1t,schemeOrRd:bM,schemeOranges:AM,schemePRGn:aM,schemePaired:s1t,schemePastel1:r1t,schemePastel2:o1t,schemePiYG:cM,schemePuBu:wM,schemePuBuGn:yM,schemePuOr:lM,schemePuRd:vM,schemePurples:EM,schemeRdBu:uM,schemeRdGy:hM,schemeRdPu:$M,schemeRdYlBu:fM,schemeRdYlGn:dM,schemeReds:RM,schemeSet1:i1t,schemeSet2:a1t,schemeSet3:c1t,schemeSpectral:pM,schemeTableau10:l1t,schemeYlGn:kM,schemeYlGnBu:CM,schemeYlOrBr:IM,schemeYlOrRd:SM,select:Jt,selectAll:Dct,selection:la,selector:Xm,selectorAll:$w,shuffle:kit,shuffler:rA,some:Tit,sort:_1,stack:Gxt,stackOffsetDiverging:qxt,stackOffsetExpand:Hxt,stackOffsetNone:yc,stackOffsetSilhouette:Xxt,stackOffsetWiggle:jxt,stackOrderAppearance:lF,stackOrderAscending:uF,stackOrderDescending:Yxt,stackOrderInsideOut:Zxt,stackOrderNone:wc,stackOrderReverse:Qxt,stratify:_mt,style:Gi,subset:Pit,sum:Iit,superset:iA,svg:Vft,symbol:kxt,symbolAsterisk:BM,symbolCircle:Sg,symbolCross:VM,symbolDiamond:UM,symbolDiamond2:GM,symbolPlus:HM,symbolSquare:qM,symbolSquare2:XM,symbolStar:KM,symbolTimes:Cx,symbolTriangle:YM,symbolTriangle2:ZM,symbolWye:QM,symbolX:Cx,symbols:Lk,symbolsFill:Lk,symbolsStroke:Cxt,text:og,thresholdFreedmanDiaconis:fit,thresholdScott:dit,thresholdSturges:bw,tickFormat:CD,tickIncrement:Ui,tickStep:vd,ticks:Wi,timeDay:Uc,timeDays:Igt,get timeFormat(){return vv},timeFormatDefaultLocale:ZD,timeFormatLocale:HD,timeFriday:MD,timeFridays:Agt,timeHour:mg,timeHours:Cgt,timeInterval:Pe,timeMillisecond:gc,timeMilliseconds:bk,timeMinute:dg,timeMinutes:vgt,timeMonday:ou,timeMondays:_gt,timeMonth:xg,timeMonths:Bgt,get timeParse(){return YD},timeSaturday:FD,timeSaturdays:Dgt,timeSecond:Xr,timeSeconds:wk,timeSunday:xc,timeSundays:vk,timeThursday:Yi,timeThursdays:Rgt,timeTickInterval:GD,timeTicks:UD,timeTuesday:AD,timeTuesdays:Tgt,timeWednesday:DD,timeWednesdays:Egt,timeWeek:xc,timeWeeks:vk,timeYear:Er,timeYears:Wgt,timeout:P1,timer:ng,timerFlush:ZA,transition:e3,transpose:oA,tree:Fmt,treemap:Omt,treemapBinary:Lmt,treemapDice:Mh,treemapResquarify:zmt,treemapSlice:hg,treemapSliceDice:Pmt,treemapSquarify:xD,tsv:Fft,tsvFormat:vft,tsvFormatBody:$ft,tsvFormatRow:kft,tsvFormatRows:Cft,tsvFormatValue:Ift,tsvParse:d3,tsvParseRows:wft,union:zit,unixDay:wv,unixDays:Ngt,utcDay:Oh,utcDays:Sgt,get utcFormat(){return yg},utcFriday:PD,utcFridays:Pgt,utcHour:gg,utcHours:kgt,utcMillisecond:gc,utcMilliseconds:bk,utcMinute:pg,utcMinutes:$gt,utcMonday:iu,utcMondays:Mgt,utcMonth:bg,utcMonths:Vgt,get utcParse(){return $v},utcSaturday:zD,utcSaturdays:zgt,utcSecond:Xr,utcSeconds:wk,utcSunday:bc,utcSundays:$k,utcThursday:Zi,utcThursdays:Lgt,utcTickInterval:WD,utcTicks:VD,utcTuesday:OD,utcTuesdays:Fgt,utcWednesday:LD,utcWednesdays:Ogt,utcWeek:bc,utcWeeks:$k,utcYear:Rr,utcYears:Ugt,variance:WR,window:kw,xml:zft,zip:Nit,zoom:obt,zoomIdentity:Tg,zoomTransform:fF},Symbol.toStringTag,{value:"Module"}));class Eg{constructor(t=2,n=64){In(this,"model");In(this,"dim");if(new.target===Eg)throw new Error("Cannot instantiate abstract class Model directly.");this.dim=t,this.model=eU(),this.model.add(Hh({inputShape:[t+1],units:n,activation:"elu"})),this.model.add(Hh({units:n,activation:"elu"})),this.model.add(Hh({units:n,activation:"elu"})),this.model.add(Hh({units:t}))}setModel(t){this.model=t}async download(){await this.model.save("downloads://model")}train(t,n=1e4,s=32){throw new Error("Method 'train()' not implemented.")}forward(t,n){throw new Error("Method 'forward()' not implemented.")}step(t,n,s){throw new Error("Method 'step()' not implemented.")}sample(t,n=100){throw new Error("Method 'sample()' not implemented.")}sample_from_initial_points(t,n=100){throw new Error("Method 'sample_from_initial_points()' not implemented.")}}class abt extends Eg{constructor(t=2,n=64){super(t,n)}async train(t,n=1e4,s=32){const r=(i,a)=>FS.meanSquaredError(a,i),o=go.adam(.01);for(let i=0;i<n;i++)H(()=>{const a=Zr([s],0,t.shape[0],"int32"),c=Is(t,a),l=Zr([s,1]),u=Oa([s,this.dim]),h=u.mul(lt(1,l)).add(c.mul(l)),f=c.sub(u);o.minimize(()=>{const d=this.forward(h,l);return r(d,f)})})}forward(t,n){return H(()=>{const s=n.reshape([t.shape[0],1]),r=Ze([t,s],1);return this.model.predict(r)})}step(t,n,s){return H(()=>{const r=n.reshape([t.shape[0],1]),i=s.reshape([t.shape[0],1]).sub(r),a=this.forward(t,r).mul(i).div(2),c=t.add(a),l=r.add(i.div(2)),u=this.forward(c,l).mul(i);return t.add(u)})}sample(t,n=100){return H(()=>{const s=Oa([t,this.dim]),r=Di(0,1,n+1);let o=[],i=s;for(let a=0;a<n;a++){const c=r.slice([a],[1]),l=On(c,[t]),u=r.slice([a+1],[1]),h=On(u,[t]);i=this.step(i,l,h),o.push(i)}return vn(o)})}sample_from_initial_points(t,n=100){return H(()=>{const s=t.shape[0],r=t,o=Di(0,1,n+1);let i=[],a=r;for(let c=0;c<n;c++){const l=o.slice([c],[1]),u=On(l,[s]),h=o.slice([c+1],[1]),f=On(h,[s]);a=this.step(a,u,f),i.push(a)}return vn(i)})}}class cbt extends Eg{constructor(n=2,s=128,r=1e3,o=1e-4,i=.02){super(n,s);In(this,"T");In(this,"betas");In(this,"alphas");In(this,"alphasCumprod");In(this,"alphasCumprodPrev");In(this,"sqrtAlphasCumprod");In(this,"sqrtOneMinusAlphasCumprod");In(this,"sqrtInvAlphasCumprod");In(this,"sqrtInvAlphasCumprodMinusOne");In(this,"variance");In(this,"posteriorCoef1");In(this,"posteriorCoef2");this.T=r,this.betas=Di(o,i,r),this.alphas=lt(1,this.betas),this.alphasCumprod=Yf(this.alphas),this.sqrtAlphasCumprod=xe(this.alphasCumprod),this.sqrtOneMinusAlphasCumprod=xe(lt(1,this.alphasCumprod)),this.sqrtInvAlphasCumprod=xe(yt(1,this.alphasCumprod)),this.sqrtInvAlphasCumprodMinusOne=xe(lt(yt(1,this.alphasCumprod),1)),this.alphasCumprodPrev=Ze([ts([1]),this.alphasCumprod.slice([0],[r-1])]),this.variance=this.betas.mul(lt(1,this.alphasCumprodPrev)).div(lt(1,this.alphasCumprod)).clipByValue(1e-20,1e20),this.posteriorCoef1=H(()=>this.betas.mul(xe(this.alphasCumprodPrev)).div(lt(1,this.alphasCumprod))),this.posteriorCoef2=H(()=>lt(1,this.alphasCumprodPrev).mul(xe(this.alphas)).div(lt(1,this.alphasCumprod)))}async train(n,s=1e4,r=32){const o=r,i=n.shape[0],a=go.adam(1e-4),c=(u,h)=>FS.meanSquaredError(u,h),l=[];for(let u=0;u<s;++u)if(H(()=>{const h=Zr([o],0,i,"int32"),f=Is(n,h),d=Oa(f.shape),p=Zr([o],0,this.T,"int32"),g=this.addNoise(f,d,p);a.minimize(()=>{const m=this.forward(g,p),x=c(d,m);return l.push(x.dataSync()[0]),x})}),u%1e3===0){const h=l.slice(-100).reduce((f,d)=>f+d,0)/100;console.log(`Iteration ${u}, Loss: ${h}`)}}addNoise(n,s,r){return H(()=>{const o=Is(this.sqrtAlphasCumprod,r).expandDims(1),i=Is(this.sqrtOneMinusAlphasCumprod,r).expandDims(1);return n.mul(o).add(s.mul(i))})}forward(n,s){return H(()=>{const o=s.reshape([n.shape[0],1]).div(this.T),i=Ze([n,o],1);return this.model.predict(i)})}step(n,s){return H(()=>{const r=s.rank===2?s.squeeze():s,o=this.forward(n,r),i=Is(this.sqrtInvAlphasCumprod,r).expandDims(1),a=Is(this.sqrtInvAlphasCumprodMinusOne,r).expandDims(1),c=n.mul(i).sub(o.mul(a)),l=Is(this.posteriorCoef1,r).expandDims(1),u=Is(this.posteriorCoef2,r).expandDims(1),h=n.mul(u).add(c.mul(l)),f=Oa(n.shape),d=Is(this.variance,r).sqrt().expandDims(1).mul(f),p=r.equal(Nt(0,"int32")).expandDims(1);return h.add(d.mul(ct(p.logicalNot(),"float32")))})}sample(n,s=this.T){return H(()=>{let r=Oa([n,this.dim]);const o=[],i=[...Array(s).keys()].reverse();for(const a of i){const c=ja([n],a,"int32");r=this.step(r,c),o.push(r)}return vn(o)})}sample_from_initial_points(n,s=this.T){return H(()=>{let r=n;const o=[],i=[...Array(s).keys()].reverse();for(const a of i){o.push(r);const c=ja([r.shape[0]],a,"int32");r=this.step(r,c)}return o.push(r),vn(o)})}}const dF={"Flow Matching":{"Plot Types":["Contour Plot","Scatter Plot","Mesh Plot","Trajectories"],"Default Plot Types":["Contour Plot","Trajectories"]},Diffusion:{"Plot Types":["Contour Plot","Scatter Plot"],"Default Plot Types":["Contour Plot"]}},lbt=["Flow Matching"],kx={"Flow Matching":["Euler"],Diffusion:["DDPM","DDIM"]},cp={"Flow Matching":{"Three Modes":"/models/flow_matching_three_modes/model.json","Smiley Face":"/models/flow_matching_smiley_face/model.json"},Diffusion:{"Smiley Face":"/models/diffusion_smiley_face/model.json"}},ubt={"Flow Matching":abt,Diffusion:cbt},lp={"Flow Matching":{dim:2,hidden:64},Diffusion:{dim:2,hidden:64}},hbt={"Smiley Face":"/datasets/smiley_face.json","Three Modes":"/datasets/three_modes.json"},Ee={distributionWidth:500,distributionHeight:500,mainAreaHeight:640,miniDistributionWidth:40,displayAreaWidth:1200,displayAreaHeight:500,pointColor:"#4594e3"},vc=Gn(100),U0=Gn(500),Qi=Gn("Flow Matching"),up=Gn("Euler"),au=Gn("Smiley Face"),Ix=Gn(void 0),pF=Gn(void 0),Rl=Gn(void 0),Dv=Gn(void 0),$c=Gn(0),Ga=Gn(!1),fbt=Gn(30),ks=Gn({xMin:-3,xMax:3,yMin:-3,yMax:3}),Sx=Gn(dF[Nn(Qi)]["Default Plot Types"]);var dbt=os('<div class="title-container svelte-gbsnp9"><div class="title-inner-container svelte-gbsnp9"><div class="title svelte-gbsnp9"><p class="svelte-gbsnp9"><b>Diffusion</b>Lab</p></div> <h1 class="sub-title svelte-gbsnp9">Learn about diffusion and flow  models with interactive visualization.</h1></div> <a href="https://github.com/helblazer811/DiffusionLab" id="github-logo" target="_blank" class="svelte-gbsnp9"><img alt="GitHub Logo" class="svelte-gbsnp9"> <span>Code</span></a></div>');function pbt(e){var t=dbt(),n=Ve(de(t),2),s=de(n);ki(s,"src",`${Al??""}/github-logo.svg`),fp(2),oe(n),oe(t),yn(e,t)}var mbt=Hk('<svg viewBox="0 0 24 24" class="svelte-iwxx8j"><rect x="6" y="5" width="4" height="14"></rect><rect x="14" y="5" width="4" height="14"></rect></svg>'),gbt=Hk('<svg viewBox="0 0 24 24" class="svelte-iwxx8j"><polygon points="5,3 19,12 5,21"></polygon></svg>'),xbt=os('<button aria-label="Play/Pause" class="svelte-iwxx8j"><!></button>');function bbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(Ga,"$isPlaying",n),o=()=>Kt($c,"$currentTime",n),i=()=>Kt(vc,"$numberOfSteps",n),a=()=>Kt(fbt,"$playbackSpeed",n);let c=us();function l(){Ga.update(p=>!p)}Zk(()=>{clearInterval(dt(c))}),Xe(()=>(r(),dt(c),o(),i(),a()),()=>{r()&&(clearInterval(dt(c)),sn(c,setInterval(()=>{if(r()){let p=o()+1/i();p>1&&(p=0),$c.update(()=>p)}else clearInterval(dt(c))},1e3/a())))}),or(),Os();var u=xbt(),h=de(u);{var f=p=>{var g=mbt();yn(p,g)},d=p=>{var g=gbt();yn(p,g)};_x(h,p=>{r()?p(f):p(d,!1)})}oe(u),vl("click",u,l),yn(e,u),gs(),s()}var ybt=os('<div class="time-slider-container svelte-a26x8o"><div class="time-slider-inner-container svelte-a26x8o"><div class="play-button-container svelte-a26x8o"><!></div> <div class="time-slider svelte-a26x8o"><input type="range" min="0" max="1" step="0.001" list="ticks" class="slider svelte-a26x8o"> <div class="tick-container svelte-a26x8o"><div class="tick svelte-a26x8o" style="left: 1%;"></div> <div class="tick-label svelte-a26x8o" style="left: 1%;">t=0</div> <div class="tick svelte-a26x8o" style="left: 99%;"></div> <div class="tick-label svelte-a26x8o" style="left: 99%;">t=1</div></div></div></div></div>');function wbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt($c,"$currentTime",n);let o=us();Xe(()=>r(),()=>{const f=r()*100;sn(o,`background: linear-gradient(to right, #4594e3 ${f}%, #d3d3d3 ${f}%)`)}),or();var i=ybt(),a=de(i),c=de(a),l=de(c);bbt(l,{}),oe(c);var u=Ve(c,2),h=de(u);eI(h),fp(2),oe(u),oe(a),oe(i),Io(()=>aO(h,dt(o))),fO(h,r,f=>G0($c,f)),yn(e,i),gs(),s()}var vbt=os("<option> </option>"),$bt=os('<div class="control svelte-19s2qc9"><label class="svelte-19s2qc9"> </label> <div class="select svelte-19s2qc9"><select class="svelte-19s2qc9"></select></div></div>');function Uk(e,t){let n=mt(t,"name",8),s=mt(t,"options",8),r=mt(t,"current",12);var o=$bt(),i=de(o),a=de(i,!0);oe(i);var c=Ve(i,2),l=de(c);Io(()=>{r(),KF(()=>{n(),s()})}),Ex(l,5,s,Tx,(u,h)=>{var f=vbt(),d={},p=de(f,!0);oe(f),Io(()=>{d!==(d=dt(h))&&(f.value=(f.__value=dt(h))??""),Gf(p,dt(h))}),yn(u,f)}),oe(l),oe(c),oe(o),Io(()=>{ki(i,"for",n()),Gf(a,n()),ki(l,"id",n())}),pO(l,r),yn(e,o)}var Cbt=os("<div><svg></svg></div>");function kbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(au,"$datasetName",n);let o=mt(t,"data",8),i=mt(t,"distributionId",8,"target"),a=us();function c(){i()!==r()&&(au.set(i()),Rl.set(Zs([])),Dv.set(Zs([])),$c.set(0),Ga.set(!1))}async function l(f,d="target"){d.replace(/\s+/g,"_"),f=await f.arraySync();let p=Po(f,k=>k[0]),g=to(f,k=>k[0]),m=Po(f,k=>k[1]),x=to(f,k=>k[1]);const b=.2,w=g-p,y=x-m;p-=b*w,g+=b*w,m-=b*y,x+=b*y;const v=mc().domain([p,g]).range([0,Ee.miniDistributionWidth]),$=mc().domain([m,x]).range([0,Ee.miniDistributionWidth]),I=Jt(dt(a));let N=I.select(`#mini_${d}`);N.empty()?N=I.append("g").attr("id","mini_"+d):N.selectAll("*").remove(),N.selectAll("circle").data(f).enter().append("circle").attr("cx",k=>v(k[0])).attr("cy",k=>$(k[1])).attr("r",1).attr("fill",Ee.pointColor)}Xe(()=>(Dt(o()),dt(a),Dt(i())),()=>{o()&&dt(a)&&l(o(),i())}),or(),Os();var u=Cbt(),h=de(u);Yk(h,f=>sn(a,f),()=>dt(a)),oe(u),Io(()=>{iO(u,1,sO(i()===r()?"mini-distribution active-dataset":"mini-distribution inactive-dataset"),"svelte-1mldc2j"),ki(h,"id",`mini_${i()??""}`)}),vl("click",u,c),yn(e,u),gs(),s()}var Ibt=os('<label><input type="checkbox"> </label><br>',1),Sbt=os('<div class="dropdown-content svelte-1lpywyt"></div>'),Nbt=os('<div class="dropdown svelte-1lpywyt"><div class="dropdown-button svelte-1lpywyt" role="button" tabindex="0"> </div> <!></div>');function _bt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(Qi,"$trainingObjective",n),o=()=>Kt(Sx,"$activePlotTypes",n),i=us();let a=us(!1);function c(p){const g=new Set(o());g.has(p)?g.delete(p):g.add(p),Sx.set(Array.from(g))}Xe(()=>r(),()=>{var p;sn(i,((p=dF[r()])==null?void 0:p["Plot Types"])||[])}),or(),Os();var l=Nbt(),u=de(l),h=de(u,!0);oe(u);var f=Ve(u,2);{var d=p=>{var g=Sbt();Ex(g,5,()=>dt(i),Tx,(m,x)=>{var b=Ibt(),w=Nx(b),y=de(w);eI(y);var v=Ve(y);oe(w),fp(),Io($=>{uO(y,$),Gf(v,` ${dt(x)??""}`)},[()=>o().includes(dt(x))],Ea),vl("change",y,()=>c(dt(x))),yn(m,b)}),oe(g),yn(p,g)};_x(f,p=>{dt(a)&&p(d)})}oe(l),Io(()=>Gf(h,o().length>0?`${o().length} selected`:"Select options")),vl("click",u,()=>sn(a,!dt(a))),vl("keydown",u,p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),sn(a,!dt(a)))}),yn(e,l),gs(),s()}var Tbt=os('<div class="training-bar-container svelte-d1imyr"><div class="training-bar svelte-d1imyr"><div class="menu training-objective-menu svelte-d1imyr"><!></div> <div class="menu sampler-menu svelte-d1imyr"><!></div> <div class="menu style-menu svelte-d1imyr"><h1 class="label svelte-d1imyr">Style Settings</h1> <!></div> <div class="menu dataset-menu svelte-d1imyr"><h1 class="label svelte-d1imyr">Dataset</h1> <div class="mini-distribution-container svelte-d1imyr"></div></div></div></div>');function Ebt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(Qi,"$trainingObjective",n),o=()=>Kt(up,"$sampler",n);let i=mt(t,"datasetDict",24,()=>({}));Os();var a=Tbt(),c=de(a),l=de(c),u=de(l);Uk(u,{name:"Training Objective",get options(){return lbt},get current(){return Lv(),r()},set current(x){G0(Qi,x)},$$legacy:!0}),oe(l);var h=Ve(l,2),f=de(h);Uk(f,{name:"Sampler",get options(){return kx[r()]},get current(){return Lv(),o()},set current(x){G0(up,x)},$$legacy:!0}),oe(h);var d=Ve(h,2),p=Ve(de(d),2);_bt(p,{}),oe(d);var g=Ve(d,2),m=Ve(de(g),2);Ex(m,5,()=>Object.entries(i()),Tx,(x,b)=>{let w=()=>dt(b)[0],y=()=>dt(b)[1];kbt(x,{get data(){return y()},get distributionId(){return w()}})}),oe(m),oe(g),oe(c),oe(a),yn(e,a),gs(),s()}const hp=Gn(0);typeof window<"u"&&(hp.set(window.innerWidth),window.addEventListener("resize",()=>{hp.set(window.innerWidth)}));function Rg(e,t,n,s,r){let o=e.arraySync();const i=mc().domain([r.xMin,r.xMax]).range([0,n]),a=mc().domain([r.yMin,r.yMax]).range([0,n]),c=o.map(h=>[i(h[0]),a(h[1])]),l=t*(s-n);return c.map(h=>[h[0]+l,h[1]])}function mF(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(hp,"$screenWidth",n),o=()=>Kt(ks,"$domainRange",n);let i=mt(t,"isActive",8,!0),a=mt(t,"svgElement",8),c=mt(t,"time",8,0),l=mt(t,"data",8),u=mt(t,"distributionId",8,"target"),h=mt(t,"opacity",8,.5),f=mt(t,"fillColor",8,"#7b7b7b"),d=mt(t,"bandwidth",8,30),p=mt(t,"numberOfContours",8,4),g=mt(t,"showBorder",8,!1),m=mt(t,"borderColor",8,"#7b7b7b"),x=mt(t,"label",8),b=mt(t,"labelIsLatex",8,!1);function w($,I,N,k="target"){const S=Jt(a());let C=S.select(`#${k}_latex`);C.empty()?C=S.append("foreignObject").attr("id",k+"_latex"):C.selectAll("*").remove(),C.attr("x",I).attr("y",N).attr("width",300).attr("height",100);const A=C.append("xhtml:div").style("width","100%").style("height","100%").style("display","flex").style("align-items","center").style("justify-content","center").style("font","34px 'KaTeX_Main', serif").style("color","#7b7b7b");katex.render($,A.node(),{throwOnError:!1})}function y($,I,N,k="target"){const S=r()||800,C=Jt(a());let A=C.select(`#${k}_text`);A.empty()?A=C.append("g").attr("id",k+"_text"):A.selectAll("*").remove(),A.append("text").attr("x",I).attr("y",S>600?N:N+20).attr("text-anchor","middle").style("font-size",S>600?"24px":"40px").style("font-family","Helvetica, sans-serif").style("fill","#7b7b7b").text($)}function v($,I,N=.9,k="target",S=100){let C=Rg($,I,Ee.distributionWidth,Ee.displayAreaWidth,o());const A=l3().x(T=>T[0]).y(T=>T[1]).size([Ee.displayAreaWidth,Ee.displayAreaHeight]).bandwidth(d()).thresholds(p())(C),R=Jt(a());let _=R.select(`#${k}_contour`);_.empty()?_=R.append("g").attr("id",k+"_contour").attr("isolation","isolate"):_.selectAll("*").remove(),_.selectAll("path").data(A).enter().append("path").attr("d",eD()).attr("fill",f()).attr("stroke",m()).attr("stroke-width",g()?3:0).attr("stroke-opacity",N).attr("fill-opacity",N).attr("mix-blend-mode","screen")}Xe(()=>(Dt(l()),Dt(a()),r(),Dt(i()),Dt(c()),Dt(h()),Dt(u()),Dt(x()),Dt(b())),()=>{if(l()&&a()&&r()&&i()&&(v(l(),c(),h(),u()),x())){const $=c()*(Ee.displayAreaWidth-Ee.distributionWidth)+Ee.distributionWidth/2;b()?w(x(),$,40,u()):y(x(),$,40,u())}}),Xe(()=>(Dt(i()),Dt(a()),Dt(u())),()=>{if(!i()&&a()){const I=Jt(a()).select(`#${u()}_contour`);I.empty()||I.remove()}}),or(),Os(),gs(),s()}function Rbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(ks,"$domainRange",n),o=()=>Kt(hp,"$screenWidth",n);let i=mt(t,"isActive",8,!0),a=mt(t,"time",8,0),c=mt(t,"opacity",8,.5),l=mt(t,"data",8),u=mt(t,"svgElement",8),h=mt(t,"distributionId",8,"target"),f=mt(t,"pointColor",8,"#7b7b7b");function d(p,g=0,m=.5,x="target",b=300){p=Rg(p,g,Ee.distributionWidth,Ee.displayAreaWidth,r()),p=p.slice(0,Math.min(p.length,b));const w=Jt(u());let y=w.select(`#${x}_scatter`);y.empty()?y=w.append("g").attr("id",x+"_scatter").attr("isolation","isolate"):y.selectAll("*").remove(),y.selectAll("circle").data(p).enter().append("circle").attr("cx",v=>v[0]).attr("cy",v=>v[1]).attr("r",3).attr("opacity",m).attr("fill",f())}Xe(()=>(Dt(l()),Dt(u()),o(),Dt(i()),Dt(a()),Dt(c()),Dt(h())),()=>{l()&&u()&&o()&&i()&&d(l(),a(),c(),h())}),Xe(()=>(Dt(i()),Dt(u()),Dt(h())),()=>{if(!i()&&u()){const g=Jt(u()).select(`#${h()}_scatter`);g.empty()||g.remove()}}),or(),Os(),gs(),s()}function Abt(e,t,n,s,r,o){const i=new Worker(new URL(""+new URL("../workers/sampling.worker-DaxvBuYw.js",import.meta.url).href,import.meta.url),{type:"module"});i.onmessage=a=>{const{type:c,result:l}=a.data;c==="result"?o(a.data.allSamples):c==="status"?console.log("Worker status:",a.data.message):c==="error"&&console.error("Worker error:",a.data.message)},i.postMessage({type:"sample",data:{modelJSONPath:e,trainingObjective:t,modelConfig:n,numSamples:s,numberOfSteps:r}})}function gF(e,t,n,s,r,o){const i=new Worker(new URL(""+new URL("../workers/sampling.worker-DaxvBuYw.js",import.meta.url).href,import.meta.url),{type:"module"});i.onmessage=a=>{const{type:c,result:l}=a.data;c==="result"?o(a.data.allSamples):c==="status"?console.log("Worker status:",a.data.message):c==="error"&&console.error("Worker error:",a.data.message)},i.postMessage({type:"sample_from_initial_points",data:{modelJSONPath:e,trainingObjective:t,modelConfig:n,initialPoints:s,numberOfSteps:r}})}function Dbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(vc,"$numberOfSteps",n),o=()=>Kt(ks,"$domainRange",n),i=()=>Kt(au,"$datasetName",n),a=()=>Kt(Qi,"$trainingObjective",n);let c=mt(t,"svgElement",8),l=mt(t,"isActive",8,!1),u=mt(t,"time",8,0),h=mt(t,"gridResolution",8,10),f=mt(t,"distributionId",8,"target"),d=mt(t,"strokeWidth",8,3),p=mt(t,"strokeColor",8,"#424242"),g=us([]);function m(x){const b=Math.floor(x*(r()-1));if(!c()||!dt(g)[b])return;let w=dt(g)[b];w=Zs(w),w=w.reshape([h()*h(),2]),w=Rg(w,x,Ee.distributionWidth,Ee.displayAreaWidth,o()),w=Zs(w),w=w.reshape([h(),h(),2]),w=w.arraySync();const y=Jt(c());let v=y.select(`#${f()}_mesh_grid`);v.empty()?v=y.append("g").attr("id",f()+"_mesh_grid").attr("isolation","isolate"):v.selectAll("*").remove();for(let $=0;$<h();$++)for(let I=0;I<h();I++){const[N,k]=w[$][I];if(I<h()-1){const[S,C]=w[$][I+1];v.append("line").attr("x1",N).attr("y1",k).attr("x2",S).attr("y2",C).attr("stroke",p()).attr("stroke-width",d())}if($<h()-1){const[S,C]=w[$+1][I];v.append("line").attr("x1",N).attr("y1",k).attr("x2",S).attr("y2",C).attr("stroke",p()).attr("stroke-width",d())}}}Xe(()=>(i(),o(),Dt(h()),a(),r()),()=>{if(i()){const x=o().xMax-o().xMin,b=o().yMax-o().yMin,w=o().xMin+.1*x,y=o().xMax-.1*x,v=o().yMin+.1*b,$=o().yMax-.1*b,I=Di(w,y,h()),N=Di(v,$,h());let k=vn(gS(I,N),2);k=k.reshape([h()*h(),2]),k=k.arraySync(),gF(Al+cp[a()][i()],a(),lp[a()],k,r(),S=>{let C=Zs(S);C=C.reshape([r(),h(),h(),2]),sn(g,C.arraySync())})}}),Xe(()=>(Dt(c()),dt(g),Dt(l()),Dt(u())),()=>{c()&&dt(g).length>0&&l()&&m(u())}),Xe(()=>(Dt(l()),Dt(c()),Dt(f())),()=>{if(!l()&&c()){const b=Jt(c()).select(`#${f()}_mesh_grid`);b.empty()||b.remove()}}),or(),Os(),gs(),s()}function Mbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(au,"$datasetName",n),o=()=>Kt(Qi,"$trainingObjective",n);let i=mt(t,"isActive",8,!0),a=mt(t,"opacity",8,.3),c=mt(t,"time",8,0),l=mt(t,"svgElement",8),u=mt(t,"distributionId",8,"target"),h=mt(t,"trajectoryColor",8,"rgb(255, 100, 0)"),f=mt(t,"gridResolution",8,25),d=us(),p=us(!1),g=us(void 0),m=us(void 0);function x(y){let v=[];for(let I=0;I<dt(m).length;I++){const N=dt(m)[I][0],k=Math.sqrt(Math.pow(N[0]-y[0],2)+Math.pow(N[1]-y[1],2));v.push(k)}return v.indexOf(Math.min(...v))}function b(y=[0,0],v,$=0,I=.5,N="target"){const k=x(y),S=v[k],C=Math.floor($*(S.length-1)),A=S.slice(0,C+1),R=S.slice(C),_=Jt(l());let T=_.select(`#${N}_trajectories`);T.empty()?T=_.append("g").attr("id",N+"_trajectories").attr("isolation","isolate"):T.selectAll("*").remove();const E=kg().x(M=>M[0]).y(M=>M[1]).curve(Ph);T.append("path").datum(A).attr("d",E).attr("fill","none").attr("stroke",h()).attr("stroke-width",3),T.append("path").datum(R).attr("d",E).attr("fill","none").attr("stroke",h()).attr("stroke-width",3).attr("opacity",I*.45),T.append("circle").attr("cx",S[C][0]).attr("cy",S[C][1]).attr("r",5).attr("fill",h())}async function w(y,v,$){gF(Al+cp[v][y],v,lp[v],$,Nn(vc),I=>{let N=[];for(let k=0;k<I.length;k++){const S=I[k],C=Zs(S),A=Rg(C,k/I.length,Ee.distributionWidth,Ee.displayAreaWidth,Nn(ks));N.push(A)}sn(m,vn(N)),sn(m,Wt(dt(m),[1,0,2])),sn(m,dt(m).arraySync())})}Xe(()=>(dt(p),Dt(l()),dt(g),Dt(i()),dt(d),Dt(u()),Ee),()=>{if(!dt(p)&&l()&&dt(g)&&i()){sn(p,!0),console.log("Initializing drag handle");const y=Jt(l());sn(d,y.append("g").attr("id",`${u()}_handle`).style("cursor","grab")),dt(d).append("image").attr("xlink:href","/PointerIcon.svg").attr("x",dt(g)[0]).attr("y",dt(g)[1]).attr("transform","translate(-20, -20)").attr("width",40).attr("height",40).attr("z-index",1e3),dt(d).append("text").attr("x",dt(g)[0]).attr("y",dt(g)[1]-25).attr("text-anchor","middle").attr("font-size",16).attr("font-family","sans-serif").attr("fill","#333333").style("pointer-events","none").text("Initial Condition");const v=xA().on("start",()=>dt(d).style("cursor","grabbing")).on("drag",$=>{let[I,N]=Yn($,y.node());I=Math.max(0,Math.min(I,Ee.distributionWidth)),N=Math.max(0,Math.min(N,Ee.distributionHeight)),dt(d).select("image").attr("x",I).attr("y",N),dt(d).select("text").attr("x",I).attr("y",N-25),sn(g,[I,N])}).on("end",()=>dt(d).style("cursor","grab"));dt(d).call(v)}}),Xe(()=>(r(),o(),Dt(f())),()=>{if(r()&&o()){const y=r(),v=o(),$=Nn(ks).xMax-Nn(ks).xMin,I=Nn(ks).yMax-Nn(ks).yMin,N=Nn(ks).xMin+0*$,k=Nn(ks).xMax-0*$,S=Nn(ks).yMin+0*I,C=Nn(ks).yMax-0*I,A=Di(N,k,f()),R=Di(S,C,f());let _=vn(gS(A,R),2);_=_.reshape([f()*f(),2]),_=_.arraySync(),w(y,v,_)}}),Xe(()=>(Dt(l()),dt(m),Dt(i()),Dt(c()),dt(g),Dt(a()),Dt(u())),()=>{if(l()&&dt(m)&&i()&&c()){if(dt(g)===void 0){const y=dt(m).map(I=>I[0]),v=T1(y,I=>I[0]),$=T1(y,I=>I[1]);sn(g,[v,$])}b(dt(g),dt(m),c(),a(),u())}}),Xe(()=>(Dt(i()),Dt(l()),Dt(u())),()=>{if(!i()&&l()){const y=Jt(l()),v=y.select(`#${u()}_trajectories`);v.empty()||v.remove();const $=y.select(`#${u()}_handle`);$.empty()||$.remove(),sn(p,!1)}}),or(),Os(),gs(),s()}var Fbt=os("<!> <!> <!> <!>",1);function Gk(e,t){ms(t,!1);let n=mt(t,"svgElement",8),s=mt(t,"time",8,0),r=mt(t,"data",8);mt(t,"allTimeSamples",8);let o=mt(t,"xLocation",8,0),i=mt(t,"opacity",8,.5),a=mt(t,"labelIsLatex",8,!1),c=mt(t,"label",8),l=mt(t,"distributionId",8),u=mt(t,"activePlotTypes",24,()=>["Contour Plot"]),h=mt(t,"showBorder",8,!1),f=mt(t,"fillColor",8,"#7b7b7b"),d=mt(t,"borderColor",8,"#7b7b7b");Os();var p=Fbt(),g=Nx(p);const m=Ea(()=>u().includes("Scatter Plot"));Rbt(g,{get svgElement(){return n()},get isActive(){return dt(m)},get data(){return r()},get time(){return s()},get distributionId(){return l()},get xLocation(){return o()},get opacity(){return i()},get pointColor(){return d()}});var x=Ve(g,2);const b=Ea(()=>u().includes("Contour Plot"));mF(x,{get svgElement(){return n()},get isActive(){return dt(b)},get data(){return r()},get time(){return s()},get distributionId(){return l()},get opacity(){return i()},get label(){return c()},get labelIsLatex(){return a()},get showBorder(){return h()},get fillColor(){return f()},get borderColor(){return d()}});var w=Ve(x,2);const y=Ea(()=>u().includes("Mesh Plot"));Dbt(w,{get svgElement(){return n()},get isActive(){return dt(y)},get time(){return s()},get distributionId(){return l()},get opacity(){return i()}});var v=Ve(w,2);const $=Ea(()=>u().includes("Trajectories"));Mbt(v,{get svgElement(){return n()},get time(){return s()},get isActive(){return dt($)},get distributionId(){return l()}}),yn(e,p),gs()}function Obt(e,t){ms(t,!1);let n=mt(t,"svgElement",8),s=mt(t,"time",8,0),r=mt(t,"data",8),o=mt(t,"xLocation",8,0),i=mt(t,"opacity",8,.5),a=mt(t,"labelIsLatex",8,!1),c=mt(t,"label",8),l=mt(t,"distributionId",8);mt(t,"displayMode",8,"contour");let u=mt(t,"showBorder",8,!1),h=mt(t,"fillColor",8,"#7b7b7b"),f=mt(t,"borderColor",8,"#7b7b7b");Xe(()=>Dt(n()),()=>{n()}),or(),Os(),mF(e,{get svgElement(){return n()},get data(){return r()},get time(){return s()},get distributionId(){return l()},get xLocation(){return o()},get opacity(){return i()},get label(){return c()},get labelIsLatex(){return a()},get showBorder(){return u()},get fillColor(){return h()},get borderColor(){return f()}}),gs()}var Lbt=os("<!> <!> <!>",1),Pbt=os('<div class="display-area svelte-16d678j"><svg preserveAspectRatio="xMidYMid meet" width="100%" height="100%"></svg> <!></div>');function zbt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt($c,"$currentTime",n),o=()=>Kt(Dv,"$allTimeSamples",n),i=()=>Kt(vc,"$numberOfSteps",n),a=()=>Kt(pF,"$sourceDistributionSamples",n),c=()=>Kt(Ix,"$targetDistributionSamples",n),l=()=>Kt(Rl,"$currentDistributionSamples",n),u=()=>Kt(Sx,"$activePlotTypes",n);let h=us();Xe(()=>(r(),o(),i(),Rl),()=>{if(r()&&o()){let m=Math.floor(r()*i());m>=i()&&(m=i()-1);const x=H(()=>o().gather(m));Rl.set(x)}}),or(),Os();var f=Pbt(),d=de(f);Yk(d,m=>sn(h,m),()=>dt(h));var p=Ve(d,2);{var g=m=>{var x=Lbt(),b=Nx(x);Obt(b,{get svgElement(){return dt(h)},time:0,get data(){return a()},opacity:.7,label:"",distributionId:"source",showBorder:!1,fillColor:"rgba(25, 131, 255, 0.2)",borderColor:"rgba(25, 131, 255, 1)"});var w=Ve(b,2);Gk(w,{get svgElement(){return dt(h)},time:1,get data(){return c()},opacity:.7,label:"",distributionId:"target",showBorder:!1,fillColor:"rgba(25, 131, 255, 0.2)",borderColor:"rgba(25, 131, 255, 1)"});var y=Ve(w,2);Gk(y,{get svgElement(){return dt(h)},get time(){return r()},get data(){return l()},get allTimeSamples(){return o()},opacity:.8,label:"",fillColor:"rgba(255, 100, 0, 0.5)",borderColor:"rgba(255, 100, 0, 1)",labelIsLatex:!0,showBorder:!1,distributionId:"current",get activePlotTypes(){return u()}}),yn(m,x)};_x(p,m=>{dt(h)&&m(g)})}oe(f),Io(()=>ki(d,"viewBox",`0 0 ${Ee.displayAreaWidth} ${Ee.displayAreaHeight}`)),yn(e,f),gs(),s()}function Bbt(){let e=0,t=0;for(;e===0;)e=Math.random();for(;t===0;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function Vbt(e){return Array.from({length:e},Bbt)}function Wbt(e){const t=e.length,n=Array.from({length:t},()=>Array(t).fill(0));for(let s=0;s<t;s++)for(let r=0;r<=s;r++){let o=e[s][r];for(let i=0;i<r;i++)o-=n[s][i]*n[r][i];s===r?n[s][r]=Math.sqrt(o):n[s][r]=o/n[r][r]}return n}function Ubt(e,t){const n=e.length,s=Array(n).fill(0);for(let r=0;r<n;r++)for(let o=0;o<=r;o++)s[r]+=e[r][o]*t[o];return s}function Gbt(e,t){return e.map((n,s)=>n+t[s])}function xF(e,t,n=1){if(n==1){const s=e.length,r=Wbt(t),o=Vbt(s),i=Ubt(r,o);return Gbt(i,e)}else{const s=[];for(let r=0;r<n;r++){const o=xF(e,t);s.push(o)}return Zs(s)}}var Hbt=os('<div class="container svelte-8lvegu"><!> <!> <div class="main-area svelte-8lvegu"><!></div> <!> <div class="footer svelte-8lvegu"></div></div>');function lyt(e,t){ms(t,!1);const[n,s]=ir(),r=()=>Kt(au,"$datasetName",n),o=()=>Kt(U0,"$numSamples",n),i=()=>Kt(Qi,"$trainingObjective",n),a=()=>Kt(up,"$sampler",n);mt(t,"trainModel",8,!1);let c=us({});function l(x){return x=Al+x,fetch(x).then(b=>b.json()).then(b=>Zs(b.points))}function u(x){x.code==="Space"&&(x.preventDefault(),Ga.update(b=>!b))}YF(async()=>{let x={};for(const[y,v]of Object.entries(hbt)){const $=await l(v);x={...x,[y]:$}}sn(c,x),window.addEventListener("keydown",u);const b=dt(c)[r()];Ix.set(b);const w=xF([0,0],[[1,0],[0,1]],o());pF.set(w),ubt[i()],lp[i()]}),Zk(()=>{typeof window<"u"&&window.removeEventListener("keydown",u)}),Xe(()=>(r(),dt(c),i(),a(),ibt),()=>{if(r()&&dt(c)[r()]&&typeof window<"u"){cp[i()][r()]||console.error(`No pretrained model found for ${i()} on ${r()}`),kx[i()].includes(a())||up.set(kx[i()][0]),Ga.set(!1);const x=dt(c)[r()];Ix.set(x),Rl.set(Re([0,2]));const b=i(),w=Al+cp[i()][r()];Abt(w,b,lp[b],Nn(U0),Nn(vc),y=>{y=Zs(y),Dv.set(y);let v=U(y,[Nn(U0)*Nn(vc),2]);v=v.arraySync(),Po(v,$=>$[0]),to(v,$=>$[0]),Po(v,$=>$[1]),to(v,$=>$[1]),Ga.set(!0)})}}),or(),Os();var h=Hbt(),f=de(h);pbt(f);var d=Ve(f,2);Ebt(d,{get datasetDict(){return dt(c)}});var p=Ve(d,2),g=de(p);zbt(g,{}),oe(p);var m=Ve(p,2);wbt(m,{}),fp(2),oe(h),yn(e,h),gs(),s()}export{lyt as component};
